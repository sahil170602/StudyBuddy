;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="18d32dc4-2904-7a63-57fd-dbcb8e5c8065")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,749199,e=>{"use strict";var t=e.i(242882),s=e.i(820308),a=e.i(150671),n=e.i(714403),r=e.i(635494),i=e.i(189329);e.s(["default",0,({sql:e,params:o=s.DEFAULT_QUERY_PARAMS,where:l,orderBy:c})=>{let{data:d}=(0,r.useSelectedProjectQuery)(),u=(0,i.useDatabaseSelectorStateSnapshot)(),{data:m}=(0,a.useReadReplicasQuery)({projectRef:d?.ref}),p=(m||[]).find(e=>e.identifier===u.selectedDatabaseId)?.connectionString,h=u.selectedDatabaseId,_="function"==typeof e?e([]):e,{data:f,error:g,isPending:x,isRefetching:y,refetch:b}=(0,t.useQuery)({queryKey:["projects",d?.ref,"db",{...o,sql:_,identifier:h},l,c],queryFn:({signal:e})=>(0,n.executeSql)({projectRef:d?.ref,connectionString:p||d?.connectionString,sql:_},e).then(e=>e.result),enabled:!!_,refetchOnWindowFocus:!1,refetchOnReconnect:!1});return{error:g||("object"==typeof f?f?.error:""),data:f,isLoading:x,isRefetching:y,params:o,runQuery:b,resolvedSql:_}}])},820308,775159,e=>{"use strict";var t,s,a=e.i(55956),n=((t={}).API="api",t.STORAGE="storage",t.AUTH="auth",t.QUERY_PERFORMANCE="query_performance",t.DATABASE="database",t);e.s(["Presets",()=>n],775159);var r=((s={}).LAST_10_MINUTES="Last 10 minutes",s.LAST_30_MINUTES="Last 30 minutes",s.LAST_60_MINUTES="Last 60 minutes",s.LAST_3_HOURS="Last 3 hours",s.LAST_24_HOURS="Last 24 hours",s.LAST_7_DAYS="Last 7 days",s.LAST_14_DAYS="Last 14 days",s.LAST_28_DAYS="Last 28 days",s);let i=[{text:"Last 10 minutes",calcFrom:()=>(0,a.default)().subtract(10,"minute").toISOString(),calcTo:()=>(0,a.default)().toISOString(),availableIn:["free","pro","team","enterprise","platform"]},{text:"Last 30 minutes",calcFrom:()=>(0,a.default)().subtract(30,"minute").toISOString(),calcTo:()=>(0,a.default)().toISOString(),availableIn:["free","pro","team","enterprise","platform"]},{text:"Last 60 minutes",calcFrom:()=>(0,a.default)().subtract(1,"hour").toISOString(),calcTo:()=>(0,a.default)().toISOString(),default:!0,availableIn:["free","pro","team","enterprise","platform"]},{text:"Last 3 hours",calcFrom:()=>(0,a.default)().subtract(3,"hour").toISOString(),calcTo:()=>(0,a.default)().toISOString(),availableIn:["free","pro","team","enterprise","platform"]},{text:"Last 24 hours",calcFrom:()=>(0,a.default)().subtract(1,"day").toISOString(),calcTo:()=>(0,a.default)().toISOString(),availableIn:["free","pro","team","enterprise","platform"]},{text:"Last 7 days",calcFrom:()=>(0,a.default)().subtract(7,"day").toISOString(),calcTo:()=>(0,a.default)().toISOString(),availableIn:["pro","team","enterprise"]},{text:"Last 14 days",calcFrom:()=>(0,a.default)().subtract(14,"day").toISOString(),calcTo:()=>(0,a.default)().toISOString(),availableIn:["team","enterprise"]},{text:"Last 28 days",calcFrom:()=>(0,a.default)().subtract(28,"day").toISOString(),calcTo:()=>(0,a.default)().toISOString(),availableIn:["team","enterprise"]}],o={iso_timestamp_start:i[0].calcFrom(),iso_timestamp_end:i[0].calcTo()},l=(e,t=!0)=>{if(0===e.length)return"";let s=e.map(e=>{let t=e.key.split("."),s=[t[t.length-2],t[t.length-1]].join("."),a=e.key.includes(".")?s:e.key,n=e.value.toString().includes('"')||e.value.toString().includes("'"),r=!isNaN(Number(e.value)),i=!r&&n?e.value:`'${e.value}'`,o=!r&&String(i).toLowerCase(),l=r?e.value:o;switch(e.compare){case"matches":return`REGEXP_CONTAINS(${a}, ${l})`;case"is":default:return`${a} = ${l}`;case"!=":return`${a} != ${l}`;case">=":return`${a} >= ${l}`;case"<=":return`${a} <= ${l}`;case">":return`${a} > ${l}`;case"<":return`${a} < ${l}`}}).filter(Boolean).join(" AND ");return""===s?"":t?"WHERE "+s:"AND "+s},c={[n.API]:{title:"API",queries:{totalRequests:{queryType:"logs",sql:e=>`
        -- reports-api-total-requests
        select
          cast(timestamp_trunc(t.timestamp, hour) as datetime) as timestamp,
          count(t.id) as count
        FROM edge_logs t
          cross join unnest(metadata) as m
          cross join unnest(m.response) as response
          cross join unnest(m.request) as request
          cross join unnest(request.headers) as headers
          ${l(e)}
        GROUP BY
          timestamp
        ORDER BY
          timestamp ASC`},topRoutes:{queryType:"logs",sql:e=>`
        -- reports-api-top-routes
        select
          request.path as path,
          request.method as method,
          request.search as search,
          response.status_code as status_code,
          count(t.id) as count
        from edge_logs t
          cross join unnest(metadata) as m
          cross join unnest(m.response) as response
          cross join unnest(m.request) as request
          cross join unnest(request.headers) as headers
          ${l(e)}
        group by
          request.path, request.method, request.search, response.status_code
        order by
          count desc
        limit 10
        `},errorCounts:{queryType:"logs",sql:e=>`
        -- reports-api-error-counts
        select
          cast(timestamp_trunc(t.timestamp, hour) as datetime) as timestamp,
          count(t.id) as count
        FROM edge_logs t
          cross join unnest(metadata) as m
          cross join unnest(m.response) as response
          cross join unnest(m.request) as request
          cross join unnest(request.headers) as headers
        WHERE
          response.status_code >= 400
        ${l(e,!1)}
        GROUP BY
          timestamp
        ORDER BY
          timestamp ASC
        `},topErrorRoutes:{queryType:"logs",sql:e=>`
        -- reports-api-top-error-routes
        select
          request.path as path,
          request.method as method,
          request.search as search,
          response.status_code as status_code,
          count(t.id) as count
        from edge_logs t
          cross join unnest(metadata) as m
          cross join unnest(m.response) as response
          cross join unnest(m.request) as request
          cross join unnest(request.headers) as headers
        where
          response.status_code >= 400
        ${l(e,!1)}
        group by
          request.path, request.method, request.search, response.status_code
        order by
          count desc
        limit 10
        `},responseSpeed:{queryType:"logs",sql:e=>`
        -- reports-api-response-speed
        select
          cast(timestamp_trunc(t.timestamp, hour) as datetime) as timestamp,
          avg(response.origin_time) as avg
        FROM
          edge_logs t
          cross join unnest(metadata) as m
          cross join unnest(m.response) as response
          cross join unnest(m.request) as request
          cross join unnest(request.headers) as headers
          ${l(e)}
        GROUP BY
          timestamp
        ORDER BY
          timestamp ASC
      `},topSlowRoutes:{queryType:"logs",sql:e=>`
        -- reports-api-top-slow-routes
        select
          request.path as path,
          request.method as method,
          request.search as search,
          response.status_code as status_code,
          count(t.id) as count,
          avg(response.origin_time) as avg
        from edge_logs t
          cross join unnest(metadata) as m
          cross join unnest(m.response) as response
          cross join unnest(m.request) as request
          cross join unnest(request.headers) as headers
        ${l(e)}
        group by
          request.path, request.method, request.search, response.status_code
        order by
          avg desc
        limit 10
        `},networkTraffic:{queryType:"logs",sql:e=>`
        -- reports-api-network-traffic
        select
          cast(timestamp_trunc(t.timestamp, hour) as datetime) as timestamp,
          coalesce(
            safe_divide(
              sum(
                cast(coalesce(headers.content_length, "0") as int64)
              ),
              1000000
            ),
            0
          ) as ingress_mb,
          coalesce(
            safe_divide(
              sum(
                cast(coalesce(resp_headers.content_length, "0") as int64)
              ),
              1000000
            ),
            0
          ) as egress_mb,
        FROM
          edge_logs t
          cross join unnest(metadata) as m
          cross join unnest(m.response) as response
          cross join unnest(m.request) as request
          cross join unnest(request.headers) as headers
          cross join unnest(response.headers) as resp_headers
          ${l(e)}
        GROUP BY
          timestamp
        ORDER BY
          timestamp ASC
        `},requestsByCountry:{queryType:"logs",sql:e=>`
        -- reports-api-requests-by-country
        select
          cf.country as country,
          count(t.id) as count
        from edge_logs t
          cross join unnest(metadata) as m
          cross join unnest(m.response) as response
          cross join unnest(m.request) as request
          cross join unnest(request.headers) as headers
          cross join unnest(request.cf) as cf
        where
          cf.country is not null
        ${l(e,!1)}
        group by
          cf.country
        `}}},[n.AUTH]:{title:"",queries:{}},[n.STORAGE]:{title:"Storage",queries:{cacheHitRate:{queryType:"logs",sql:e=>`
        -- reports-storage-cache-hit-rate
SELECT
  timestamp_trunc(timestamp, hour) as timestamp,
  countif( h.cf_cache_status in ('HIT', 'STALE', 'REVALIDATED', 'UPDATING') ) as hit_count,
  countif( h.cf_cache_status in ('MISS', 'NONE/UNKNOWN', 'EXPIRED', 'BYPASS', 'DYNAMIC') ) as miss_count
from edge_logs f
  cross join unnest(f.metadata) as m
  cross join unnest(m.request) as r
  cross join unnest(m.response) as res
  cross join unnest(res.headers) as h
where starts_with(r.path, '/storage/v1/object') and r.method = 'GET'
  ${l(e,!1)}
group by timestamp
order by timestamp desc
`},topCacheMisses:{queryType:"logs",sql:e=>`
        -- reports-storage-top-cache-misses
SELECT
  r.path as path,
  r.search as search,
  count(id) as count
from edge_logs f
  cross join unnest(f.metadata) as m
  cross join unnest(m.request) as r
  cross join unnest(m.response) as res
  cross join unnest(res.headers) as h
where starts_with(r.path, '/storage/v1/object')
  and r.method = 'GET'
  and h.cf_cache_status in ('MISS', 'NONE/UNKNOWN', 'EXPIRED', 'BYPASS', 'DYNAMIC')
  ${l(e,!1)}
group by path, search
order by count desc
limit 12
    `}}},[n.QUERY_PERFORMANCE]:{title:"Query performance",queries:{mostFrequentlyInvoked:{queryType:"db",sql:(e,t,s,a=!1,n=!1)=>`
        -- reports-query-performance-most-frequently-invoked
set search_path to public, extensions;

select
    auth.rolname,
    statements.query,
    statements.calls,
    -- -- Postgres 13, 14, 15
    statements.total_exec_time + statements.total_plan_time as total_time,
    statements.min_exec_time + statements.min_plan_time as min_time,
    statements.max_exec_time + statements.max_plan_time as max_time,
    statements.mean_exec_time + statements.mean_plan_time as mean_time,
    -- -- Postgres <= 12
    -- total_time,
    -- min_time,
    -- max_time,
    -- mean_time,
    statements.rows / statements.calls as avg_rows,
    statements.rows as rows_read,
    case 
      when (statements.shared_blks_hit + statements.shared_blks_read) > 0 
      then round(
        (statements.shared_blks_hit * 100.0) / 
        (statements.shared_blks_hit + statements.shared_blks_read), 
        2
      )
      else 0
    end as cache_hit_rate${a?`,
    case
      when (lower(statements.query) like 'select%' or lower(statements.query) like 'with pgrst%')
      then (
        select json_build_object(
          'has_suggestion', array_length(index_statements, 1) > 0,
          'startup_cost_before', startup_cost_before,
          'startup_cost_after', startup_cost_after,
          'total_cost_before', total_cost_before,
          'total_cost_after', total_cost_after,
          'index_statements', index_statements
        )
        from index_advisor(statements.query)
      )
      else null
    end as index_advisor_result`:""}
  from pg_stat_statements as statements
    inner join pg_authid as auth on statements.userid = auth.oid
  ${t||""}
  ${s||"order by statements.calls desc"}
  limit 20`},mostTimeConsuming:{queryType:"db",sql:(e,t,s,a=!1,n=!1)=>`
        -- reports-query-performance-most-time-consuming
set search_path to public, extensions;

select
    auth.rolname,
    statements.query,
    statements.calls,
    statements.total_exec_time + statements.total_plan_time as total_time,
    statements.mean_exec_time + statements.mean_plan_time as mean_time,
    ((statements.total_exec_time + statements.total_plan_time)/sum(statements.total_exec_time + statements.total_plan_time) OVER()) * 100 as prop_total_time${a?`,
    case
      when (lower(statements.query) like 'select%' or lower(statements.query) like 'with pgrst%')
      then (
        select json_build_object(
          'has_suggestion', array_length(index_statements, 1) > 0,
          'startup_cost_before', startup_cost_before,
          'startup_cost_after', startup_cost_after,
          'total_cost_before', total_cost_before,
          'total_cost_after', total_cost_after,
          'index_statements', index_statements
        )
        from index_advisor(statements.query)
      )
      else null
    end as index_advisor_result`:""}
  from pg_stat_statements as statements
    inner join pg_authid as auth on statements.userid = auth.oid
  ${t||""}
  ${s||"order by total_time desc"}
  limit 20`},slowestExecutionTime:{queryType:"db",sql:(e,t,s,a=!1,n=!1)=>`
        -- reports-query-performance-slowest-execution-time
set search_path to public, extensions;

select
    auth.rolname,
    statements.query,
    statements.calls,
    -- -- Postgres 13, 14, 15
    statements.total_exec_time + statements.total_plan_time as total_time,
    statements.min_exec_time + statements.min_plan_time as min_time,
    statements.max_exec_time + statements.max_plan_time as max_time,
    statements.mean_exec_time + statements.mean_plan_time as mean_time,
    -- -- Postgres <= 12
    -- total_time,
    -- min_time,
    -- max_time,
    -- mean_time,
    statements.rows / statements.calls as avg_rows${a?`,
    case
      when (lower(statements.query) like 'select%' or lower(statements.query) like 'with pgrst%')
      then (
        select json_build_object(
          'has_suggestion', array_length(index_statements, 1) > 0,
          'startup_cost_before', startup_cost_before,
          'startup_cost_after', startup_cost_after,
          'total_cost_before', total_cost_before,
          'total_cost_after', total_cost_after,
          'index_statements', index_statements
        )
        from index_advisor(statements.query)
      )
      else null
    end as index_advisor_result`:""}
  from pg_stat_statements as statements
    inner join pg_authid as auth on statements.userid = auth.oid
  ${t||""}
  ${s||"order by max_time desc"}
  limit 20`},queryHitRate:{queryType:"db",sql:e=>`-- reports-query-performance-cache-and-index-hit-rate
select
    'index hit rate' as name,
    (sum(idx_blks_hit)) / nullif(sum(idx_blks_hit + idx_blks_read),0) as ratio
  from pg_statio_user_indexes
  union all
  select
    'table hit rate' as name,
    sum(heap_blks_hit) / nullif(sum(heap_blks_hit) + sum(heap_blks_read),0) as ratio
  from pg_statio_user_tables;`},unified:{queryType:"db",sql:(e,t,s,a=!1,n=!1)=>`
        -- reports-query-performance-unified
        set search_path to public, extensions;

        with query_results as (
          select
              auth.rolname,
              statements.query,
              statements.calls,
              -- -- Postgres 13, 14, 15
              statements.total_exec_time + statements.total_plan_time as total_time,
              statements.min_exec_time + statements.min_plan_time as min_time,
              statements.max_exec_time + statements.max_plan_time as max_time,
              statements.mean_exec_time + statements.mean_plan_time as mean_time,
              -- -- Postgres <= 12
              -- total_time,
              -- min_time,
              -- max_time,
              -- mean_time,
              statements.rows / statements.calls as avg_rows,
              statements.rows as rows_read,
              statements.shared_blks_hit as debug_hit,
              statements.shared_blks_read as debug_read,
              case 
                when (statements.shared_blks_hit + statements.shared_blks_read) > 0 
                then (statements.shared_blks_hit::numeric * 100.0) / 
                     (statements.shared_blks_hit + statements.shared_blks_read)
                else 0
              end as cache_hit_rate,
              ((statements.total_exec_time + statements.total_plan_time)/sum(statements.total_exec_time + statements.total_plan_time) OVER()) * 100 as prop_total_time${a?`,
              case
                when (lower(statements.query) like 'select%' or lower(statements.query) like 'with pgrst%')
                then (
                  select json_build_object(
                    'has_suggestion', array_length(index_statements, 1) > 0,
                    'startup_cost_before', startup_cost_before,
                    'startup_cost_after', startup_cost_after,
                    'total_cost_before', total_cost_before,
                    'total_cost_after', total_cost_after,
                    'index_statements', index_statements
                  )
                  from index_advisor(statements.query)
                )
                else null
              end as index_advisor_result`:""}
            from pg_stat_statements as statements
              inner join pg_authid as auth on statements.userid = auth.oid
            ${t||""}
          )
          select *
          from query_results
          ${n&&a?"where (index_advisor_result->>'has_suggestion')::boolean = true":""}
          ${s||"order by total_time desc"}
          limit 20`},slowQueriesCount:{queryType:"db",sql:()=>`
        -- reports-query-performance-slow-queries-count
        set search_path to public, extensions;

        -- Count of slow queries (> 1 second average)
        SELECT count(*) as slow_queries_count
        FROM pg_stat_statements 
        WHERE statements.mean_exec_time > 1000;`},queryMetrics:{queryType:"db",sql:(e,t,s,a=!1,n=!1)=>`
        -- reports-query-performance-metrics
        set search_path to public, extensions;
      
        SELECT 
          COALESCE(ROUND(AVG(statements.rows::numeric / NULLIF(statements.calls, 0)), 1), 0) as avg_rows_per_call,
          COUNT(*) FILTER (WHERE statements.total_exec_time + statements.total_plan_time > 1000) as slow_queries,
          COALESCE(
            ROUND(
              SUM(statements.shared_blks_hit) * 100.0 / 
              NULLIF(SUM(statements.shared_blks_hit + statements.shared_blks_read), 0), 
              2
            ), 0
          ) || '%' as cache_hit_rate
        FROM pg_stat_statements as statements
        WHERE statements.calls > 0
        ${t||""}
        ${s||""}`}}},[n.DATABASE]:{title:"database",queries:{largeObjects:{queryType:"db",sql:e=>`-- reports-database-large-objects
SELECT
        SCHEMA_NAME,
        relname,
        table_size
      FROM
        (SELECT
          pg_catalog.pg_namespace.nspname AS SCHEMA_NAME,
          relname,
          pg_total_relation_size(pg_catalog.pg_class.oid) AS table_size
        FROM pg_catalog.pg_class
        JOIN pg_catalog.pg_namespace ON relnamespace = pg_catalog.pg_namespace.oid
        ) t
      WHERE SCHEMA_NAME NOT LIKE 'pg_%'
      ORDER BY table_size DESC
      LIMIT 5;`}}}};e.s(["DEFAULT_QUERY_PARAMS",0,o,"DEPRECATED_REPORTS",0,["total_realtime_ingress","total_rest_options_requests","total_auth_ingress","total_auth_get_requests","total_auth_post_requests","total_auth_patch_requests","total_auth_options_requests","total_storage_options_requests","total_storage_patch_requests","total_options_requests","total_rest_ingress","total_rest_get_requests","total_rest_post_requests","total_rest_patch_requests","total_rest_delete_requests","total_storage_get_requests","total_storage_post_requests","total_storage_delete_requests","total_auth_delete_requests","total_get_requests","total_patch_requests","total_post_requests","total_ingress","total_delete_requests"],"EDGE_FUNCTION_REGIONS",0,[{key:"ap-northeast-1",label:"Tokyo"},{key:"ap-northeast-2",label:"Seoul"},{key:"ap-south-1",label:"Mumbai"},{key:"ap-southeast-1",label:"Singapore"},{key:"ap-southeast-2",label:"Sydney"},{key:"ca-central-1",label:"Canada Central"},{key:"us-east-1",label:"N. Virginia"},{key:"us-west-1",label:"N. California"},{key:"us-west-2",label:"Oregon"},{key:"eu-central-1",label:"Frankfurt"},{key:"eu-west-1",label:"Ireland"},{key:"eu-west-2",label:"London"},{key:"eu-west-3",label:"Paris"},{key:"sa-east-1",label:"SÃ£o Paulo"}],"LAYOUT_COLUMN_COUNT",0,2,"PRESET_CONFIG",0,c,"REPORTS_DATEPICKER_HELPERS",0,i,"REPORT_DATERANGE_HELPER_LABELS",()=>r,"generateRegexpWhere",0,l],820308)},232520,e=>{"use strict";var t=e.i(478902),s=e.i(389959),a=e.i(274664),n=e.i(678001),r=e.i(217027),i=e.i(174617),o=e.i(153545),l="AlertDialog",[c,d]=(0,a.createContextScope)(l,[r.createDialogScope]),u=(0,r.createDialogScope)(),m=e=>{let{__scopeAlertDialog:s,...a}=e,n=u(s);return(0,t.jsx)(r.Root,{...n,...a,modal:!0})};m.displayName=l;var p=s.forwardRef((e,s)=>{let{__scopeAlertDialog:a,...n}=e,i=u(a);return(0,t.jsx)(r.Trigger,{...i,...n,ref:s})});p.displayName="AlertDialogTrigger";var h=e=>{let{__scopeAlertDialog:s,...a}=e,n=u(s);return(0,t.jsx)(r.Portal,{...n,...a})};h.displayName="AlertDialogPortal";var _=s.forwardRef((e,s)=>{let{__scopeAlertDialog:a,...n}=e,i=u(a);return(0,t.jsx)(r.Overlay,{...i,...n,ref:s})});_.displayName="AlertDialogOverlay";var f="AlertDialogContent",[g,x]=c(f),y=(0,o.createSlottable)("AlertDialogContent"),b=s.forwardRef((e,a)=>{let{__scopeAlertDialog:o,children:l,...c}=e,d=u(o),m=s.useRef(null),p=(0,n.useComposedRefs)(a,m),h=s.useRef(null);return(0,t.jsx)(r.WarningProvider,{contentName:f,titleName:v,docsSlug:"alert-dialog",children:(0,t.jsx)(g,{scope:o,cancelRef:h,children:(0,t.jsxs)(r.Content,{role:"alertdialog",...d,...c,ref:p,onOpenAutoFocus:(0,i.composeEventHandlers)(c.onOpenAutoFocus,e=>{e.preventDefault(),h.current?.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[(0,t.jsx)(y,{children:l}),(0,t.jsx)(A,{contentRef:m})]})})})});b.displayName=f;var v="AlertDialogTitle",j=s.forwardRef((e,s)=>{let{__scopeAlertDialog:a,...n}=e,i=u(a);return(0,t.jsx)(r.Title,{...i,...n,ref:s})});j.displayName=v;var w="AlertDialogDescription",S=s.forwardRef((e,s)=>{let{__scopeAlertDialog:a,...n}=e,i=u(a);return(0,t.jsx)(r.Description,{...i,...n,ref:s})});S.displayName=w;var E=s.forwardRef((e,s)=>{let{__scopeAlertDialog:a,...n}=e,i=u(a);return(0,t.jsx)(r.Close,{...i,...n,ref:s})});E.displayName="AlertDialogAction";var N="AlertDialogCancel",T=s.forwardRef((e,s)=>{let{__scopeAlertDialog:a,...i}=e,{cancelRef:o}=x(N,a),l=u(a),c=(0,n.useComposedRefs)(s,o);return(0,t.jsx)(r.Close,{...l,...i,ref:c})});T.displayName=N;var A=({contentRef:e})=>{let t=`\`${f}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${f}\` by passing a \`${w}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${f}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return s.useEffect(()=>{document.getElementById(e.current?.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},q=e.i(843778),C=e.i(837710),R=e.i(709520);let k=({children:e,...s})=>(0,t.jsx)(h,{...s,children:(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-end justify-center sm:items-center",children:e})});k.displayName=h.displayName;let I=s.forwardRef(({className:e,centered:s=!0,...a},n)=>(0,t.jsx)(_,{ref:n,className:(0,q.cn)("bg-black/40 backdrop-blur-sm","z-50 fixed inset-0 grid place-items-center overflow-y-auto data-closed:animate-overlay-hide py-8",!s&&"flex flex-col flex-start pb-8 sm:pt-12 md:pt-20 lg:pt-32 xl:pt-40 px-5",e),...a}));I.displayName=_.displayName;let P=(0,R.cva)((0,q.cn)("relative z-50 w-full max-w-screen border shadow-md dark:shadow-sm","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95","data-[state=closed]:slide-out-to-left-[0%] data-[state=closed]:slide-out-to-top-[0%]","data-[state=open]:slide-in-from-left-[0%] data-[state=open]:slide-in-from-top-[0%]","sm:rounded-lg md:w-full","bg-dash-sidebar"),{variants:{size:{tiny:"sm:align-middle sm:w-full sm:max-w-xs",small:"sm:align-middle sm:w-full sm:max-w-sm",medium:"sm:align-middle sm:w-full sm:max-w-lg",large:"sm:align-middle sm:w-full md:max-w-xl",xlarge:"sm:align-middle sm:w-full md:max-w-3xl",xxlarge:"sm:align-middle sm:w-full md:max-w-6xl",xxxlarge:"sm:align-middle sm:w-full md:max-w-7xl"}},defaultVariants:{size:"medium"}}),$=s.forwardRef(({className:e,children:s,size:a,dialogOverlayProps:n,centered:r=!0,...i},o)=>(0,t.jsx)(k,{children:(0,t.jsx)(I,{centered:r,...n,children:(0,t.jsx)(b,{ref:o,className:(0,q.cn)(P({size:a}),e),...i,children:s})})}));$.displayName=b.displayName;let L=({className:e,...s})=>(0,t.jsx)("div",{className:(0,q.cn)("flex flex-col space-y-2 text-center sm:text-left",e),...s});L.displayName="AlertDialogHeader";let O=({className:e,...s})=>(0,t.jsx)("div",{className:(0,q.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 border-t py-3 px-5",e),...s});O.displayName="AlertDialogFooter";let D=s.forwardRef(({className:e,...s},a)=>(0,t.jsx)(j,{ref:a,className:(0,q.cn)("text-base text-foreground border-b px-5 py-3",e),...s}));D.displayName=j.displayName;let M=s.forwardRef(({className:e,...s},a)=>(0,t.jsx)(S,{ref:a,className:(0,q.cn)("text-sm text-foreground-light px-5 py-3",e),...s}));M.displayName=S.displayName;let F=s.forwardRef(({className:e,...s},a)=>(0,t.jsx)(E,{ref:a,className:(0,q.cn)((0,C.buttonVariants)({type:"primary",size:"tiny"}),e),...s}));F.displayName=E.displayName;let Q=s.forwardRef(({className:e,...s},a)=>(0,t.jsx)(T,{ref:a,className:(0,q.cn)((0,C.buttonVariants)({type:"default",size:"tiny"}),"mt-2 sm:mt-0",e),...s}));Q.displayName=T.displayName,e.s(["AlertDialog",()=>m,"AlertDialogAction",()=>F,"AlertDialogCancel",()=>Q,"AlertDialogContent",()=>$,"AlertDialogDescription",()=>M,"AlertDialogFooter",()=>O,"AlertDialogHeader",()=>L,"AlertDialogTitle",()=>D,"AlertDialogTrigger",()=>p],232520)},888525,760255,284399,e=>{"use strict";var t=e.i(355901),s=e.i(714403);function a(e=[]){return{hypopg:e.find(e=>"hypopg"===e.name),indexAdvisor:e.find(e=>"index_advisor"===e.name)}}function n(e,t){return void 0===e||void 0===t||e<=0||e<=t?0:(e-t)/e*100}async function r({projectRef:e,connectionString:a,indexStatements:n,onSuccess:r,onError:i}){if(!e){let e=Error("Project ref is required");return i&&i(e),Promise.reject(e)}if(0===n.length){let e=Error("No index statements provided");return i&&i(e),Promise.reject(e)}try{return await (0,s.executeSql)({projectRef:e,connectionString:a,sql:n.join(";\n")+";"}),t.toast.success("Successfully created index"),r&&r(),Promise.resolve()}catch(e){return t.toast.error(`Failed to create index: ${e.message}`),i&&i(e),Promise.reject(e)}}function i(e,t){return!!(t&&e?.index_statements&&e.index_statements.length>0)}e.s(["calculateImprovement",()=>n,"createIndexes",()=>r,"getIndexAdvisorExtensions",()=>a,"hasIndexRecommendations",()=>i],760255);var o=e.i(450972),l=e.i(635494);function c(){let{data:e}=(0,l.useSelectedProjectQuery)(),{data:t}=(0,o.useDatabaseExtensionsQuery)({projectRef:e?.ref,connectionString:e?.connectionString}),{hypopg:s,indexAdvisor:n}=a(t??[]),r=!!s&&!!n,i=r&&null!==s.installed_version&&null!==n.installed_version;return{isIndexAdvisorAvailable:r,isIndexAdvisorEnabled:i}}e.s(["useIndexAdvisorStatus",()=>c],888525);var d=e.i(478902),u=e.i(389959),m=e.i(610144),p=e.i(232520),h=e.i(587433),_=e.i(837710),f=e.i(967052);e.s(["EnableIndexAdvisorButton",0,()=>{let e=(0,f.useTrack)(),{data:s}=(0,l.useSelectedProjectQuery)(),[n,r]=(0,u.useState)(!1),{data:i}=(0,o.useDatabaseExtensionsQuery)({projectRef:s?.ref,connectionString:s?.connectionString}),{hypopg:c,indexAdvisor:g}=a(i),{mutateAsync:x,isPending:y}=(0,m.useDatabaseExtensionEnableMutation)(),b=async()=>{if(void 0===s)return t.toast.error("Project is required");try{c?.installed_version===null&&await x({projectRef:s?.ref,connectionString:s?.connectionString,name:c.name,schema:c?.schema??"extensions",version:c.default_version}),g?.installed_version===null&&await x({projectRef:s?.ref,connectionString:s?.connectionString,name:g.name,schema:g?.schema??"extensions",version:g.default_version}),t.toast.success("Successfully enabled Index Advisor!"),r(!1)}catch(e){t.toast.error(`Failed to enable Index Advisor: ${e.message}`)}};return(0,d.jsxs)(p.AlertDialog,{open:n,onOpenChange:()=>r(!n),children:[(0,d.jsx)(p.AlertDialogTrigger,{asChild:!0,children:(0,d.jsx)(_.Button,{type:"primary",onClick:()=>e("index_advisor_banner_enable_button_clicked"),children:"Enable"})}),(0,d.jsxs)(p.AlertDialogContent,{children:[(0,d.jsxs)(p.AlertDialogHeader,{children:[(0,d.jsx)(p.AlertDialogTitle,{children:"Enable Index Advisor"}),(0,d.jsxs)(p.AlertDialogDescription,{children:["Index Advisor is a tool that helps you identify and simulate indexes that can improve query performance. To use Index Advisor, you need to enable the following Postgres extensions:",(0,d.jsxs)("ul",{className:"list-disc pl-6 py-4 flex flex-col gap-2",children:[(0,d.jsxs)("li",{children:[(0,d.jsx)(h.Badge,{className:"font-mono text-foreground",children:"index_advisor"})," - Recommends database indexes"]}),(0,d.jsxs)("li",{children:[(0,d.jsx)(h.Badge,{className:"font-mono text-foreground",children:"hypopg"})," - For hypothetical indexes simulation"]})]}),"These extensions help identify and simulate indexes that can improve query performance without having to create actual indexes."]})]}),(0,d.jsxs)(p.AlertDialogFooter,{children:[(0,d.jsx)(p.AlertDialogCancel,{children:"Cancel"}),(0,d.jsx)(p.AlertDialogAction,{onClick:t=>{t.preventDefault(),b(),e("index_advisor_dialog_enable_button_clicked")},disabled:y,children:y?"Enabling...":"Enable Extensions"})]})]})]})}],284399)},384429,e=>{"use strict";var t=e.i(478902),s=e.i(389959),a=e.i(753515),n=e.i(440401),r=e.i(701823),i=e.i(938933),o=e.i(140449);function l({autoComplete:e,autofocus:l,children:c,className:d,descriptionText:u,disabled:m,error:p,icon:h,id:_="",inputRef:f,label:g,afterLabel:x,beforeLabel:y,labelOptional:b,layout:v,name:j="",onChange:w,onBlur:S,placeholder:E,required:N,value:T,defaultValue:A,style:q,size:C="medium",borderless:R=!1,validation:k,...I}){let{formContextOnChange:P,values:$,errors:L,handleBlur:O,touched:D,fieldLevelValidation:M}=(0,o.useFormContext)();$&&!T&&(T=$[_]),p||(L&&!p&&(p=L[_||j]),p=D&&D[_||j]?p:void 0),(0,s.useEffect)(()=>{k&&M(_,k(T))},[]);let F=(0,i.default)("select"),Q=[F.container];d&&Q.push(d);let U=[F.base];return p&&U.push(F.variants.error),p||U.push(F.variants.standard),h&&U.push(F.with_icon[C]),C&&U.push(F.size[C]),m&&U.push(F.disabled),(0,t.jsx)(a.FormLayout,{label:g,afterLabel:x,beforeLabel:y,labelOptional:b,layout:v,id:_,error:p,descriptionText:u,className:d,style:q,size:C,children:(0,t.jsxs)("div",{className:F.container,children:[(0,t.jsx)("select",{id:_,name:j,"data-size":C,defaultValue:A,autoComplete:e,autoFocus:l,className:U.join(" "),onChange:function(e){w&&w(e),P&&P(e),k&&M(_,k(e.target.value))},onBlur:function(e){O&&O(e),S&&S(e)},ref:f,value:T,disabled:m,required:N,placeholder:E,...I,children:c}),h&&(0,t.jsx)(r.default,{size:C,icon:h}),p&&(0,t.jsx)("div",{className:F.actions_container,children:p&&(0,t.jsx)(n.default,{size:C})}),(0,t.jsx)("span",{className:F.chevron_container,children:(0,t.jsx)("svg",{className:F.chevron,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L10 5.414 7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3zm-3.707 9.293a1 1 0 011.414 0L10 14.586l2.293-2.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})})}l.Option=function({value:e,children:s,selected:a}){return(0,t.jsx)("option",{value:e,selected:a,children:s})},l.OptGroup=function({label:e,children:s}){return(0,t.jsx)("optgroup",{label:e,children:s})},e.s(["Select",0,l],384429)},819993,e=>{"use strict";let t=(0,e.i(388019).default)("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);e.s(["Link",()=>t],819993)},350046,e=>{"use strict";var t=e.i(478902),s=e.i(224521),a=e.i(88816),n=e.i(389959),r=e.i(843778);let i=s.Root,o=n.forwardRef(({className:e,...a},n)=>(0,t.jsx)(s.Item,{ref:n,className:(0,r.cn)("border-b",e),...a}));o.displayName="AccordionItem";let l=n.forwardRef(({className:e,children:n,hideIcon:i,...o},l)=>(0,t.jsx)(s.Header,{className:"flex",children:(0,t.jsxs)(s.Trigger,{ref:l,className:(0,r.cn)("flex flex-1 gap-2 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180 text-left",e),...o,children:[n,!i&&(0,t.jsx)(a.ChevronDown,{className:"h-4 w-4 transition-transform duration-200 shrink-0"})]})}));l.displayName=s.Trigger.displayName;let c=n.forwardRef(({className:e,children:a,...n},i)=>(0,t.jsx)(s.Content,{ref:i,className:(0,r.cn)("overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",e),...n,children:(0,t.jsx)("div",{className:"pb-4 pt-0",children:a})}));c.displayName=s.Content.displayName,e.s(["Accordion",()=>i,"AccordionContent",()=>c,"AccordionItem",()=>o,"AccordionTrigger",()=>l])},31227,154225,e=>{"use strict";var t=e.i(350046);e.s(["AccordionContent_Shadcn_",()=>t.AccordionContent],31227),e.s(["AccordionItem_Shadcn_",()=>t.AccordionItem],154225)},350341,e=>{"use strict";var t=e.i(350046);e.s(["Accordion_Shadcn_",()=>t.Accordion])},503256,e=>{"use strict";var t=e.i(389959);let s=t.forwardRef(function({title:e,titleId:s,...a},n){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},a),e?t.createElement("title",{id:s},e):null,t.createElement("path",{fillRule:"evenodd",d:"M15 8A7 7 0 1 1 1 8a7 7 0 0 1 14 0ZM9 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0ZM6.75 8a.75.75 0 0 0 0 1.5h.75v1.75a.75.75 0 0 0 1.5 0v-2.5A.75.75 0 0 0 8.25 8h-1.5Z",clipRule:"evenodd"}))});e.s(["InformationCircleIcon",0,s],503256)},849368,48202,e=>{"use strict";var t=e.i(242882),s=e.i(714403),a=e.i(246230);async function n({projectRef:e,connectionString:t,query:a}){if(!e)throw Error("Project ref is required");let n=a.replace(/'/g,"''"),{result:r}=await (0,s.executeSql)({projectRef:e,connectionString:t,sql:`select * from index_advisor('${n}');`});return r[0]}async function r({projectRef:e,connectionString:t,query:a}){if(!e)throw Error("Project ref is required");try{var n;let r,{result:i}=await (0,s.executeSql)({projectRef:e,connectionString:t,queryKey:["involved-indexes-explain-query"],sql:`
        create or replace function pg_temp.explain_query(query text) returns jsonb
        language plpgsql
        as $$
        declare
            explain_result jsonb;
            prepared_statement_name text := 'query_to_explain';
            explain_plan_statement text;
            n_args int;
        begin
            -- Remove comment lines (its common that they contain semicolons)
            query := trim(
                regexp_replace(
                    regexp_replace(
                        regexp_replace(query,'\\/\\*.+\\*\\/', '', 'g'),
                    '--[^\\r\\n]*', ' ', 'g'),
                '\\s+', ' ', 'g')
            );
      
            -- Remove trailing semicolon
            query := regexp_replace(query, ';\\s*$', '');

            -- Disallow multiple statements
            if query ilike '%;%' then
                raise exception 'Query must not contain a semicolon';
            end if;
        
            -- Hack to support PostgREST because the prepared statement for args incorrectly defaults to text
            query := replace(query, 'WITH pgrst_payload AS (SELECT $1 AS json_data)', 
                                    'WITH pgrst_payload AS (SELECT $1::json AS json_data)');
        
            -- Create a prepared statement for the given query
            deallocate all;
            execute format('prepare %I as %s', prepared_statement_name, query);
        
            -- Detect how many arguments are present in the prepared statement
            n_args = (
                select
                    coalesce(array_length(parameter_types, 1), 0)
                from
                    pg_prepared_statements
                where
                    name = prepared_statement_name
                limit
                    1
            );
        
            -- Create a SQL statement that can be executed to collect the explain plan
            explain_plan_statement = format(
                'set local plan_cache_mode = force_generic_plan; explain (format json) execute %I%s',
                prepared_statement_name,
                case
                    when n_args = 0 then ''
                    else format(
                        '(%s)', array_to_string(array_fill('null'::text, array[n_args]), ',')
                    )
                end
            );
        
            -- Execute the explain plan statement and get the result
            execute explain_plan_statement into explain_result;
        
            -- Clean up the prepared statement
            deallocate all;
        
            -- Return the explain result
            return explain_result;
        end;
        $$;

        select pg_temp.explain_query('${a}') as plans;
      `}),o=(n=i,r=[],!function e(t){null!==t&&"object"==typeof t&&("Index Name"in t&&r.push(t["Index Name"]),Object.values(t).forEach(t=>e(t)))}(n),r);if(o.length<=0)return[];let{result:l}=await (0,s.executeSql)({projectRef:e,connectionString:t,queryKey:["involved-indexes-names"],sql:`select schemaname as schema, tablename as table, indexname as name from pg_indexes where indexname in (${o.map(e=>`'${e}'`).join(", ")});`});return l}catch(e){return[]}}e.s(["useGetIndexAdvisorResult",0,({projectRef:e,connectionString:s,query:r},{enabled:i=!0,...o}={})=>(0,t.useQuery)({queryKey:a.databaseKeys.indexAdvisorFromQuery(e,r),queryFn:()=>n({projectRef:e,connectionString:s,query:r}),retry:!1,enabled:i&&void 0!==e&&void 0!==r&&(r.startsWith("select")||r.startsWith("SELECT"))||"string"==typeof r&&r.trim().toLowerCase().startsWith("with pgrst_source"),...o})],849368),e.s(["useGetIndexesFromSelectQuery",0,({projectRef:e,connectionString:s,query:n},{enabled:i=!0,...o}={})=>{let l=(n??"").trim().toLowerCase(),c=l.startsWith("select")||l.startsWith("with pgrst_source")||l.startsWith("with pgrst_payload");return(0,t.useQuery)({queryKey:a.databaseKeys.indexesFromQuery(e,n),queryFn:()=>r({projectRef:e,connectionString:s,query:n}),retry:!1,enabled:i&&void 0!==e&&void 0!==n&&c,...o})}],48202)},764275,e=>{"use strict";var t,s=((t={}).MOST_TIME_CONSUMING="most_time_consuming",t.MOST_FREQUENT="most_frequent",t.SLOWEST_EXECUTION="slowest_execution",t.UNIFIED="unified",t);let a=(e,t)=>`
select 
  id,
  pgl.timestamp as timestamp,
  'postgres' as log_type,
  CAST(pgl_parsed.sql_state_code AS STRING) as status,
  CASE
      WHEN pgl_parsed.error_severity = 'LOG' THEN 'success'
      WHEN pgl_parsed.error_severity = 'WARNING' THEN 'warning'
      WHEN pgl_parsed.error_severity = 'FATAL' THEN 'error'
      WHEN pgl_parsed.error_severity = 'ERROR' THEN 'error'
      ELSE null
  END as level,
  event_message as event_message
from postgres_logs as pgl
cross join unnest(pgl.metadata) as pgl_metadata
cross join unnest(pgl_metadata.parsed) as pgl_parsed
WHERE pgl.event_message LIKE '%[pg_stat_monitor]%'
  AND pgl.timestamp >= CAST('${e}' AS TIMESTAMP)
  AND pgl.timestamp <= CAST('${t}' AS TIMESTAMP)
ORDER BY timestamp DESC
`.trim();a(new Date(Date.now()-864e5).toISOString(),new Date().toISOString()),e.s(["QUERY_PERFORMANCE_CHART_TABS",0,[{id:"query_latency",label:"Query latency"},{id:"rows_read",label:"Rows read"},{id:"calls",label:"Calls"},{id:"cache_hits",label:"Cache hits"}],"QUERY_PERFORMANCE_COLUMNS",0,[{id:"query",name:"Query",description:void 0,minWidth:500},{id:"prop_total_time",name:"Time consumed",description:void 0,minWidth:150},{id:"calls",name:"Count",description:void 0,minWidth:100},{id:"max_time",name:"Max time",description:void 0,minWidth:100},{id:"mean_time",name:"Mean time",description:void 0,minWidth:100},{id:"min_time",name:"Min time",description:void 0,minWidth:100},{id:"rows_read",name:"Rows processed",description:void 0,minWidth:130},{id:"cache_hit_rate",name:"Cache hit rate",description:void 0,minWidth:130},{id:"rolname",name:"Role",description:void 0,minWidth:200}],"QUERY_PERFORMANCE_PRESET_MAP",0,{most_time_consuming:"mostTimeConsuming",most_frequent:"mostFrequentlyInvoked",slowest_execution:"slowestExecutionTime",unified:"unified"},"QUERY_PERFORMANCE_REPORT_TYPES",()=>s,"QUERY_PERFORMANCE_ROLE_DESCRIPTION",0,[{name:"postgres",description:"The default Postgres role. This has admin privileges."},{name:"anon",description:"For unauthenticated, public access. This is the role which the API (PostgREST) will use when a user is not logged in."},{name:"authenticator",description:'A special role for the API (PostgREST). It has very limited access, and is used to validate a JWT and then "change into" another role determined by the JWT verification.'},{name:"authenticated",description:'For "authenticated access." This is the role which the API (PostgREST) will use when a user is logged in.'},{name:"service_role",description:"For elevated access. This role is used by the API (PostgREST) to bypass Row Level Security."},{name:"supabase_auth_admin",description:"Used by the Auth middleware to connect to the database and run migration. Access is scoped to the auth schema."},{name:"supabase_storage_admin",description:"Used by the Auth middleware to connect to the database and run migration. Access is scoped to the storage schema."},{name:"dashboard_user",description:"For running commands via the Supabase UI."},{name:"supabase_admin",description:"An internal role Supabase uses for administrative tasks, such as running upgrades and automations."},{name:"pgbouncer",description:"PgBouncer is a lightweight connection pooler for PostgreSQL. Available on paid plans only."}],"getPgStatMonitorLogsQuery",0,a])},908942,e=>{"use strict";e.s(["useIndexInvalidation",()=>m]);var t=e.i(356003),s=e.i(898452),a=e.i(4196),n=e.i(389959),r=e.i(494031),i=e.i(937357),o=e.i(246230),l=e.i(635494),c=e.i(764275),d=e.i(888525),u=e.i(826843);function m(){let e=(0,s.useRouter)(),m=(0,t.useQueryClient)(),{data:p}=(0,l.useSelectedProjectQuery)(),{isIndexAdvisorEnabled:h}=(0,d.useIndexAdvisorStatus)(),[{preset:_,search:f,order:g,sort:x}]=(0,a.useQueryStates)({sort:a.parseAsString,search:a.parseAsString.withDefault(""),order:a.parseAsString,preset:a.parseAsString.withDefault("unified")}),{invalidate:y}=(0,u.useTableIndexAdvisor)(),b=c.QUERY_PERFORMANCE_PRESET_MAP[_],v=e?.query?.roles??[],j=(0,r.useQueryPerformanceQuery)({searchQuery:f,orderBy:x?{column:x,order:g}:void 0,preset:b,roles:"string"==typeof v?[v]:v,runIndexAdvisor:h});return(0,n.useCallback)(()=>{j.runQuery(),m.invalidateQueries({queryKey:o.databaseKeys.indexAdvisorFromQuery(p?.ref,"")}),m.invalidateQueries({queryKey:i.databaseIndexesKeys.list(p?.ref)}),y()},[j,m,p?.ref,y])}},961563,e=>{"use strict";var t=e.i(478902),s=e.i(215261),a=e.i(355901);e.i(128328);var n=e.i(158639),r=e.i(513826),i=e.i(610144),o=e.i(450972),l=e.i(635494),c=e.i(10429),d=e.i(206413),u=e.i(592360),m=e.i(178527),p=e.i(837710),h=e.i(592383),_=e.i(760255);e.s(["IndexAdvisorDisabledState",0,()=>{let{ref:e}=(0,n.useParams)(),{data:f}=(0,l.useSelectedProjectQuery)(),{data:g}=(0,o.useDatabaseExtensionsQuery)({projectRef:f?.ref,connectionString:f?.connectionString}),{hypopg:x,indexAdvisor:y}=(0,_.getIndexAdvisorExtensions)(g),{mutateAsync:b,isPending:v}=(0,i.useDatabaseExtensionEnableMutation)(),j=async()=>{if(void 0===f)return console.error("Project is required");try{x?.installed_version===null&&await b({projectRef:f?.ref,connectionString:f?.connectionString,name:x.name,schema:x?.schema??"extensions",version:x.default_version}),y?.installed_version===null&&await b({projectRef:f?.ref,connectionString:f?.connectionString,name:y.name,schema:y?.schema??"extensions",version:y.default_version}),a.toast.success("Successfully enabled index advisor!")}catch(e){a.toast.error(`Failed to enable index advisor: ${e.message}`)}};return(0,t.jsxs)(m.Alert_Shadcn_,{className:"mb-6",children:[(0,t.jsx)(u.AlertTitle_Shadcn_,{children:(0,t.jsx)(h.Markdown,{className:"text-foreground",content:void 0===y?"Newer version of Postgres required":"Postgres extensions `index_advisor` and `hypopg` required"})}),(0,t.jsx)(d.AlertDescription_Shadcn_,{children:(0,t.jsx)(h.Markdown,{content:void 0===y?"Upgrade to the latest version of Postgres to get recommendations on indexes for your queries":"These extensions can help in recommending database indexes to reduce the costs of your query."})}),(0,t.jsx)(d.AlertDescription_Shadcn_,{className:"mt-3",children:(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[void 0===y?(0,t.jsx)(p.Button,{asChild:!0,type:"default",children:(0,t.jsx)(s.default,{href:`/project/${e}/settings/infrastructure`,children:"Upgrade Postgres version"})}):(0,t.jsx)(p.Button,{type:"default",disabled:v,loading:v,onClick:()=>j(),children:"Enable extensions"}),(0,t.jsx)(r.DocsButton,{href:`${c.DOCS_URL}/guides/database/extensions/index_advisor`})]})})]})}])},593977,770235,e=>{"use strict";var t=e.i(478902),s=e.i(843778),a=e.i(760255);e.s(["IndexImprovementText",0,({indexStatements:e,totalCostBefore:n,totalCostAfter:r,className:i,...o})=>{let l=(0,a.calculateImprovement)(n,r);return(0,t.jsxs)("p",{className:(0,s.cn)("text-sm text-foreground-light mb-3",i),...o,children:["Query's performance can be improved by"," ",(0,t.jsxs)("span",{className:"text-brand",children:[l.toFixed(2),"%"]})," by creating this"," ",e.length>1?"indexes":"index",":"]})}],593977);var n=e.i(503256),r=e.i(177948),i=e.i(749844),o=e.i(613580);e.s(["QueryPanelContainer",0,({children:e,className:a})=>(0,t.jsx)("div",{className:(0,s.cn)("flex flex-col gap-y-0 py-4",a),children:e}),"QueryPanelScoreSection",0,({className:e,name:a,description:l,before:c,after:d,hideArrowMarkers:u=!1})=>(0,t.jsxs)("div",{className:(0,s.cn)("py-4 px-4 flex",e),children:[(0,t.jsxs)("div",{className:"flex gap-x-2 w-48",children:[(0,t.jsx)("span",{className:"text-sm",children:a}),(0,t.jsxs)(o.Tooltip,{children:[(0,t.jsx)(o.TooltipTrigger,{asChild:!0,className:"mt-1",children:(0,t.jsx)(n.InformationCircleIcon,{className:"transition text-foreground-muted w-3 h-3 data-[state=delayed-open]:text-foreground-light"})}),(0,t.jsx)(o.TooltipContent,{side:"top",className:"w-52 text-center",children:l})]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,t.jsxs)("div",{className:"flex gap-x-2 text-sm",children:[(0,t.jsx)("span",{className:"text-foreground-light w-20",children:"Currently:"}),(0,t.jsx)("span",{className:(0,s.cn)("font-mono",void 0!==c&&void 0!==d&&c!==d?"text-foreground-light":""),children:c})]}),void 0!==c&&void 0!==d&&c!==d&&(0,t.jsxs)("div",{className:"flex items-center gap-x-2 text-sm",children:[(0,t.jsx)("span",{className:"text-foreground-light w-20",children:"With index:"}),(0,t.jsx)("span",{className:"font-mono",children:d}),void 0!==c&&!u&&(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[d>c?(0,t.jsx)(i.ArrowUp,{size:14,className:"text-warning"}):(0,t.jsx)(r.ArrowDown,{size:14,className:"text-brand"}),"number"==typeof c&&0!==c&&!isNaN(c)&&isFinite(c)&&(0,t.jsxs)("span",{className:(0,s.cn)("font-mono tracking-tighter",d>c?"text-warning":"text-brand"),children:[((c-d)/c*100).toFixed(2),"%"]})]})]})]})]}),"QueryPanelSection",0,({children:e,className:a})=>(0,t.jsx)("div",{className:(0,s.cn)("px-6 flex flex-col gap-y-0",a),children:e})],770235)},826843,331906,e=>{"use strict";e.s(["TableIndexAdvisorProvider",()=>U,"useColumnHasIndexSuggestion",()=>Y,"useTableIndexAdvisor",()=>z],826843);var t=e.i(478902),s=e.i(356003),a=e.i(389959);e.s(["QueryIndexes",()=>$],331906);var n=e.i(370410),r=e.i(219195),i=e.i(350046),o=e.i(888525),l=e.i(567558),c=e.i(513826),d=e.i(450972),u=e.i(849368),m=e.i(48202),p=e.i(635494),h=e.i(10429),_=e.i(967052),f=e.i(31227),g=e.i(154225),x=e.i(350341),y=e.i(206413),b=e.i(592360),v=e.i(178527),j=e.i(837710),w=e.i(672044),S=e.i(774234),E=e.i(554855),N=e.i(925282),T=e.i(843778),A=e.i(108151),q=e.i(908942),C=e.i(284399),R=e.i(760255),k=e.i(961563),I=e.i(593977),P=e.i(770235);let $=({selectedRow:e,columnName:s,suggestedSelectQuery:$,onClose:L})=>{let{data:O}=(0,p.useSelectedProjectQuery)(),[D,M]=(0,a.useState)(!1),[F,Q]=(0,a.useState)(!1),U=(0,_.useTrack)(),[z,Y]=(0,a.useState)(!1),{data:H,isSuccess:B,isPending:K,isError:W,error:G}=(0,m.useGetIndexesFromSelectQuery)({projectRef:O?.ref,connectionString:O?.connectionString,query:e?.query}),{data:V,isPending:Z}=(0,d.useDatabaseExtensionsQuery)({projectRef:O?.ref,connectionString:O?.connectionString}),{isIndexAdvisorEnabled:X}=(0,o.useIndexAdvisorStatus)(),{data:J,error:ee,refetch:et,isError:es,isSuccess:ea,isLoading:en}=(0,u.useGetIndexAdvisorResult)({projectRef:O?.ref,connectionString:O?.connectionString,query:e?.query},{enabled:X}),{index_statements:er,startup_cost_after:ei,startup_cost_before:eo,total_cost_after:el,total_cost_before:ec}=J??{index_statements:[],total_cost_after:0,total_cost_before:0},ed=(0,R.hasIndexRecommendations)(J,ea);(0,R.calculateImprovement)(ec,el);let eu=(0,q.useIndexInvalidation)();(0,a.useEffect)(()=>{en||z||(U("index_advisor_tab_clicked",{hasRecommendations:ed,isIndexAdvisorEnabled:X}),Y(!0))},[en,ed,z,U,X]);let em=async()=>{if(0!==er.length){Q(!0),U("index_advisor_create_indexes_button_clicked");try{await (0,R.createIndexes)({projectRef:O?.ref,connectionString:O?.connectionString,indexStatements:er,onSuccess:()=>et()}),eu()}catch(e){console.error("Failed to create index:",e),Q(!1)}finally{Q(!1),L?.()}}};return Z||X?(0,t.jsxs)(P.QueryPanelContainer,{className:"h-full overflow-y-auto py-0 pt-4",children:[(s||$)&&(0,t.jsx)(P.QueryPanelSection,{className:"pt-2 pb-6 border-b",children:(0,t.jsxs)("div",{className:"flex flex-col gap-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"mb-2",children:"Recommendation reason"}),s&&(0,t.jsxs)("p",{className:"text-sm text-foreground-light",children:["Recommendation for column: ",(0,t.jsx)("span",{className:"font-mono",children:s})]})]}),$&&(0,t.jsxs)("div",{className:"flex flex-col gap-y-4",children:[(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"Based on the following query:"}),(0,t.jsx)(w.CodeBlock,{hideLineNumbers:!0,value:$,language:"sql",className:(0,T.cn)("max-w-full max-h-[200px]","!py-2 !px-2.5 prose dark:prose-dark","[&>code]:m-0 [&>code>span]:flex [&>code>span]:flex-wrap")})]})]})}),(0,t.jsxs)(P.QueryPanelSection,{className:"pt-2 mb-6",children:[(0,t.jsxs)("div",{className:"mb-4 flex flex-col gap-y-1",children:[(0,t.jsx)("h4",{className:"mb-2",children:"Indexes in use"}),(0,t.jsxs)("p",{className:"text-sm text-foreground-light",children:["This query is using the following index",(H??[]).length>1?"s":"",":"]})]}),K&&(0,t.jsx)(A.GenericSkeletonLoader,{}),W&&(0,t.jsx)(l.default,{projectRef:O?.ref,error:G,subject:"Failed to retrieve indexes in use"}),B&&(0,t.jsxs)("div",{children:[0===H.length&&(0,t.jsxs)("div",{className:"border rounded border-dashed flex flex-col items-center justify-center py-4 px-12 gap-y-1 text-center",children:[(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"No indexes are involved in this query"}),(0,t.jsx)("p",{className:"text-center text-xs text-foreground-lighter",children:"Indexes may not necessarily be used if they incur a higher cost when executing the query"})]}),H.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-x-4 bg-surface-100 border first:rounded-tl first:rounded-tr border-b-0 last:border-b last:rounded-b px-2 py-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)(r.Table2,{size:14,className:"text-foreground-light"}),(0,t.jsxs)("span",{className:"text-xs font-mono text-foreground-light",children:[e.schema,".",e.table]})]}),(0,t.jsx)("span",{className:"text-xs font-mono",children:e.name})]},e.name))]})]}),(0,t.jsx)(P.QueryPanelSection,{className:"flex flex-col gap-y-6 py-6 border-t",children:(0,t.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,t.jsx)("h4",{className:"mb-2",children:"New index recommendations"}),Z?(0,t.jsx)(A.GenericSkeletonLoader,{}):X?(0,t.jsxs)(t.Fragment,{children:[en&&(0,t.jsx)(A.GenericSkeletonLoader,{}),es&&(0,t.jsx)(l.default,{projectRef:O?.ref,error:ee,subject:"Failed to retrieve result from index advisor"}),ea&&(0,t.jsx)(t.Fragment,{children:0===(er??[]).length?(0,t.jsxs)(v.Alert_Shadcn_,{className:"[&>svg]:rounded-full",children:[(0,t.jsx)(n.Check,{}),(0,t.jsx)(b.AlertTitle_Shadcn_,{children:"This query is optimized"}),(0,t.jsx)(y.AlertDescription_Shadcn_,{children:"Recommendations for indexes will show here"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(I.IndexImprovementText,{indexStatements:er,totalCostBefore:ec,totalCostAfter:el,className:"text-sm text-foreground-light"}),(0,t.jsx)(w.CodeBlock,{hideLineNumbers:!0,value:er.join(";\n")+";",language:"sql",className:(0,T.cn)("max-w-full max-h-[310px]","!py-3 !px-3.5 prose dark:prose-dark transition","[&>code]:m-0 [&>code>span]:flex [&>code>span]:flex-wrap")}),(0,t.jsx)("p",{className:"text-sm text-foreground-light mt-3",children:"This recommendation serves to prevent your queries from slowing down as your application grows, and hence the index may not be used immediately after it's created (e.g If your table is still small at this time)."})]})})]}):(0,t.jsx)(k.IndexAdvisorDisabledState,{})]})}),X&&ed&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(P.QueryPanelSection,{className:"py-6 border-t",children:(0,t.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,t.jsx)("h4",{className:"mb-2",children:"Query costs"}),(0,t.jsxs)("div",{className:"border rounded-md flex flex-col bg-surface-100",children:[(0,t.jsx)(P.QueryPanelScoreSection,{name:"Total cost of query",description:"An estimate of how long it will take to return all the rows (Includes start up cost)",before:ec,after:el}),(0,t.jsxs)(N.Collapsible_Shadcn_,{open:D,onOpenChange:M,children:[(0,t.jsx)(S.CollapsibleContent_Shadcn_,{asChild:!0,className:"pb-3",children:(0,t.jsx)(P.QueryPanelScoreSection,{hideArrowMarkers:!0,className:"border-t",name:"Start up cost",description:"An estimate of how long it will take to fetch the first row",before:eo,after:ei})}),(0,t.jsxs)(E.CollapsibleTrigger_Shadcn_,{className:"text-xs py-1.5 border-t text-foreground-light bg-studio w-full rounded-b-md",children:["View ",D?"less":"more"]})]})]})]})}),(0,t.jsx)(P.QueryPanelSection,{className:"py-6 border-t",children:(0,t.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,t.jsx)("h4",{className:"mb-2",children:"FAQ"}),(0,t.jsxs)(x.Accordion_Shadcn_,{collapsible:!0,type:"single",className:"border rounded-md",children:[(0,t.jsxs)(g.AccordionItem_Shadcn_,{value:"1",children:[(0,t.jsx)(i.AccordionTrigger,{className:"px-4 py-3 text-sm font-normal text-foreground-light hover:text-foreground transition [&[data-state=open]]:text-foreground",children:"What units are cost in?"}),(0,t.jsx)(f.AccordionContent_Shadcn_,{className:"px-4 text-foreground-light",children:"Costs are in an arbitrary unit, and do not represent a unit of time. The units are anchored (by default) to a single sequential page read costing 1.0 units. They do, however, serve as a predictor of higher execution times."})]}),(0,t.jsxs)(g.AccordionItem_Shadcn_,{value:"2",className:"border-b-0",children:[(0,t.jsx)(i.AccordionTrigger,{className:"px-4 py-3 text-sm font-normal text-foreground-light hover:text-foreground transition [&[data-state=open]]:text-foreground",children:"How should I prioritize start up and total cost?"}),(0,t.jsxs)(f.AccordionContent_Shadcn_,{className:"px-4 text-foreground-light [&>div]:space-y-2",children:[(0,t.jsx)("p",{children:"This depends on the expected size of the result set from the query."}),(0,t.jsx)("p",{children:"For queries that return a small number or rows, the startup cost is more critical and minimizing startup cost can lead to faster response times, especially in interactive applications."}),(0,t.jsx)("p",{children:"For queries that return a large number of rows, the total cost becomes more important, and optimizing it will help in efficiently using resources and reducing overall query execution time."})]})]})]})]})})]}),X&&ed&&(0,t.jsxs)("div",{className:"bg-studio sticky bottom-0 border-t py-3 flex items-center justify-between px-5",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-y-0.5 text-xs",children:[(0,t.jsx)("span",{children:"Apply index to database"}),(0,t.jsx)("span",{className:"text-xs text-foreground-light",children:"This will run the SQL that is shown above"})]}),(0,t.jsx)(j.Button,{disabled:F,loading:F,type:"primary",onClick:()=>em(),children:"Create index"})]})]}):(0,t.jsx)(P.QueryPanelContainer,{className:"h-full",children:(0,t.jsx)(P.QueryPanelSection,{className:"pt-2",children:(0,t.jsxs)("div",{className:"border rounded border-dashed flex flex-col items-center justify-center py-4 px-12 gap-y-1 text-center",children:[(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"Enable Index Advisor"}),(0,t.jsx)("p",{className:"text-center text-xs text-foreground-lighter mb-2",children:"Recommends indexes to improve query performance."}),(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)(c.DocsButton,{href:`${h.DOCS_URL}/guides/database/extensions/index_advisor`}),(0,t.jsx)(C.EnableIndexAdvisorButton,{})]})]})})})};var L=e.i(246230),O=e.i(242882),D=e.i(714403);async function M({projectRef:e,connectionString:t,schema:s,table:a}){let n,r;if(!e)throw Error("Project ref is required");if(!s)throw Error("Schema is required");if(!a)throw Error("Table is required");let i=(n=s.replace(/'/g,"''"),r=a.replace(/'/g,"''"),`
-- Get top 5 SELECT queries involving this table and run through index_advisor
set search_path to public, extensions;

with top_queries as (
  select
    statements.query,
    statements.calls,
    statements.total_exec_time + statements.total_plan_time as total_time,
    statements.mean_exec_time + statements.mean_plan_time as mean_time
  from pg_stat_statements as statements
    inner join pg_authid as auth on statements.userid = auth.oid
  where 
    -- Filter for SELECT queries only (index_advisor only works with SELECT)
    (lower(statements.query) like 'select%' or lower(statements.query) like 'with pgrst%')
    -- Filter for queries involving our table (handles schema.table and just table references)
    and (
      lower(statements.query) like '%${n.toLowerCase()}.${r.toLowerCase()}%'
      or lower(statements.query) like '%from ${r.toLowerCase()}%'
      or lower(statements.query) like '%join ${r.toLowerCase()}%'
    )
    -- Exclude system queries
    and statements.query not like '%pg_catalog%'
    and statements.query not like '%information_schema%'
  order by statements.calls desc
  limit 5
)
select
  tq.query,
  tq.calls,
  tq.total_time,
  tq.mean_time,
  coalesce(ia.index_statements, '{}') as index_statements,
  coalesce((ia.startup_cost_before)::numeric, 0) as startup_cost_before,
  coalesce((ia.startup_cost_after)::numeric, 0) as startup_cost_after,
  coalesce((ia.total_cost_before)::numeric, 0) as total_cost_before,
  coalesce((ia.total_cost_after)::numeric, 0) as total_cost_after
from top_queries tq
left join lateral (
  select * from index_advisor(tq.query)
) ia on true;
`.trim()),{result:o}=await (0,D.executeSql)({projectRef:e,connectionString:t,sql:i}),l=(o||[]).filter(e=>e.index_statements&&e.index_statements.length>0).map(e=>{let t=e.total_cost_before>0?(e.total_cost_before-e.total_cost_after)/e.total_cost_before*100:0;return{query:e.query,calls:e.calls,total_time:e.total_time,mean_time:e.mean_time,index_statements:e.index_statements,startup_cost_before:e.startup_cost_before,startup_cost_after:e.startup_cost_after,total_cost_before:e.total_cost_before,total_cost_after:e.total_cost_after,improvement_percentage:Math.round(100*t)/100}}),c=function(e){let t=new Set;for(let s of e){let e=s.match(/USING\s+\w+\s*\(([^)]+)\)/i);e&&e[1].split(",").forEach(e=>{let s=e.trim().replace(/^"(.+)"$/,"$1");s&&t.add(s)})}return Array.from(t)}(l.flatMap(e=>e.index_statements));return{suggestions:l,columnsWithSuggestions:c}}var F=e.i(725137);let Q=(0,a.createContext)({isLoading:!1,isAvailable:!1,isEnabled:!1,columnsWithSuggestions:[],suggestions:[],openSheet:()=>{},getSuggestionsForColumn:()=>[],invalidate:async()=>{}});function U({children:e,schema:n,table:r}){let{data:i}=(0,p.useSelectedProjectQuery)(),{isIndexAdvisorAvailable:l,isIndexAdvisorEnabled:c}=(0,o.useIndexAdvisorStatus)(),d=(0,s.useQueryClient)(),[u,m]=(0,a.useState)(!1),[h,_]=(0,a.useState)(void 0),{data:f,isLoading:g}=function({projectRef:e,connectionString:t,schema:s,table:a},{enabled:n=!0,...r}={}){return(0,O.useQuery)({queryKey:L.databaseKeys.tableIndexAdvisor(e,s,a),queryFn:()=>M({projectRef:e,connectionString:t,schema:s,table:a}),enabled:n&&void 0!==e&&!!s&&!!a,retry:!1,staleTime:3e5,...r})}({projectRef:i?.ref,connectionString:i?.connectionString,schema:n,table:r},{enabled:c&&!!n&&!!r}),x=(0,a.useCallback)(e=>{_(e),m(!0)},[]),y=(0,a.useCallback)(()=>{m(!1),_(void 0)},[]),b=(0,a.useCallback)(e=>f?.suggestions?f.suggestions.filter(t=>t.index_statements.some(t=>{let s=t.match(/USING\s+\w+\s*\(([^)]+)\)/i);return!!s&&s[1].split(",").map(e=>e.trim().replace(/^"(.+)"$/,"$1")).includes(e)})):[],[f?.suggestions]),v=(0,a.useCallback)(async()=>{i?.ref&&n&&r&&await d.invalidateQueries({queryKey:L.databaseKeys.tableIndexAdvisor(i.ref,n,r)})},[d,i?.ref,n,r]),j=h?b(h)[0]:null,w={isLoading:g,isAvailable:l,isEnabled:c,columnsWithSuggestions:f?.columnsWithSuggestions??[],suggestions:f?.suggestions??[],openSheet:x,getSuggestionsForColumn:b,invalidate:v};return(0,t.jsxs)(Q.Provider,{value:w,children:[e,(0,t.jsx)(F.Sheet,{open:u,onOpenChange:e=>!e&&y(),children:(0,t.jsxs)(F.SheetContent,{className:"flex flex-col gap-0 p-0 sm:max-w-[500px]",children:[(0,t.jsx)(F.SheetHeader,{className:"border-b px-5 py-3",children:(0,t.jsx)(F.SheetTitle,{children:"Index Recommendation"})}),j&&(0,t.jsx)($,{selectedRow:{query:j.query},columnName:h,suggestedSelectQuery:j.query,onClose:y})]})})]})}function z(){return(0,a.useContext)(Q)}function Y(e){let{columnsWithSuggestions:t}=z();return t.includes(e)}},691337,e=>{"use strict";var t=e.i(755216),s=e.i(38429),a=e.i(356003),n=e.i(355901),r=e.i(714403),i=e.i(509847);async function o({projectRef:e,connectionString:s,payload:a}){let n=new Headers;s&&n.set("x-connection-encrypted",s);let{sql:i}=t.default.policies.create(a),{result:o}=await (0,r.executeSql)({projectRef:e,connectionString:s,sql:i,queryKey:["policy","create"]});return o}e.s(["createDatabasePolicy",()=>o,"useDatabasePolicyCreateMutation",0,({onSuccess:e,onError:t,...r}={})=>{let l=(0,a.useQueryClient)();return(0,s.useMutation)({mutationFn:e=>o(e),async onSuccess(t,s,a){let{projectRef:n}=s;await l.invalidateQueries({queryKey:i.databasePoliciesKeys.list(n)}),await e?.(t,s,a)},async onError(e,s,a){void 0===t?n.toast.error(`Failed to create database policy: ${e.message}`):t(e,s,a)},...r})}])},41921,e=>{"use strict";var t=e.i(694423),s=e.i(45674),a=e.i(408880),n=e.i(479084);e.i(38429),e.i(355901);var r=e.i(234745),i=e.i(10429);e.i(56031);var o=e.i(237948);async function l({tableName:e,schema:t,columns:s,projectRef:a,connectionString:n,orgSlug:l,message:c}){let d=await (0,r.fetchPost)(`${i.BASE_PATH}/api/ai/sql/policy`,{tableName:e,schema:t,columns:s,projectRef:a,connectionString:n,orgSlug:l,message:c});if("error"in d)throw new o.ResponseError(d.error.message,400);return d}let c=({schema:e,table:t,fkConstraints:s})=>s.filter(s=>s.source_schema===e&&s.source_table===t).flatMap(e=>e.source_columns.map((t,s)=>({source_schema:e.source_schema,source_table_name:e.source_table,source_column_name:t,target_table_schema:e.target_schema,target_table_name:e.target_table,target_column_name:e.target_columns[s]}))),d=async({table:e,columns:t,projectRef:s,connectionString:a})=>{if(!a)return[];try{return await l({tableName:e.name,schema:e.schema,columns:t.map(e=>e.name.trim()),projectRef:s,connectionString:a??""})}catch(e){return console.log("AI policy generation failed:",e),[]}},u=async({table:e,foreignKeyConstraints:t,columns:s,projectRef:a,connectionString:r,enableAi:i})=>{let o=(({table:e,foreignKeyConstraints:t})=>{try{let s=((e,t,s=3)=>{let a=c({schema:e.schema,table:e.name,fkConstraints:t}),n=[{table:e,path:[]}],r=new Set;for(r.add(`${e.schema}.${e.name}`);n.length>0;){let e=n.shift();if(!e)continue;let{table:i,path:o}=e;if(!(o.length>=s))for(let e of 0===o.length?a:c({schema:i.schema,table:i.name,fkConstraints:t})){if("auth"===e.target_table_schema&&"users"===e.target_table_name&&"id"===e.target_column_name)return[...o,e];let t=`${e.target_table_schema}.${e.target_table_name}`;r.has(t)||(n.push({table:{schema:e.target_table_schema,name:e.target_table_name},path:[...o,e]}),r.add(t))}}return null})(e,t);if(s?.length){let t,a;return t=(e=>{if(0===e.length)return"";if(1===e.length)return`(select auth.uid()) = ${(0,n.ident)(e[0].source_column_name)}`;let[t,...s]=e,a=`${(0,n.ident)(t.target_table_schema)}.${(0,n.ident)(t.target_table_name)}`,r=`${(0,n.ident)(t.source_schema)}.${(0,n.ident)(t.source_table_name)}`,i=e[e.length-1],o=s.slice(0,-1).map(e=>{let t=(0,n.ident)(e.target_table_schema),s=(0,n.ident)(e.target_table_name),a=(0,n.ident)(e.target_column_name),r=(0,n.ident)(e.source_schema),i=(0,n.ident)(e.source_table_name),o=(0,n.ident)(e.source_column_name);return`join ${t}.${s} on ${t}.${s}.${a} = ${r}.${i}.${o}`}).join("\n  ");return`exists (
  select 1 from ${a}
  ${o}
  where ${a}.${(0,n.ident)(t.target_column_name)} = ${r}.${(0,n.ident)(t.source_column_name)}
  and ${(0,n.ident)(i.source_schema)}.${(0,n.ident)(i.source_table_name)}.${(0,n.ident)(i.source_column_name)} = (select auth.uid())
)`})(s),a=s[0].source_column_name,["SELECT","INSERT","UPDATE","DELETE"].map(s=>{let r=`Enable ${s.toLowerCase()} access for users based on ${(0,n.ident)(a)}`,i=`CREATE POLICY "${r}" ON ${(0,n.ident)(e.schema)}.${(0,n.ident)(e.name)} AS PERMISSIVE FOR ${s} TO public`,o="INSERT"===s?`${i} WITH CHECK (${t});`:"UPDATE"===s?`${i} USING (${t}) WITH CHECK (${t});`:`${i} USING (${t});`,l="INSERT"===s?void 0:t,c="SELECT"===s||"DELETE"===s?void 0:t;return{name:r,sql:o,command:s,table:e.name,schema:e.schema,definition:l,check:c,action:"PERMISSIVE",roles:["public"]}})}}catch(e){}return[]})({table:e,foreignKeyConstraints:t});return o.length>0?o:i?await d({table:e,columns:s,projectRef:a,connectionString:r}):[]};e.s(["createPayloadForCreatePolicy",0,e=>{let{command:t,definition:s,check:a,roles:n}=e;return{...e,action:"PERMISSIVE",command:t||void 0,definition:s||void 0,check:a||void 0,roles:n.length>0?n:void 0}},"createPayloadForUpdatePolicy",0,(e,t)=>{let{definition:s,check:n}=e,r={...e,definition:s?s.replace(/\s+/g," ").trim():s,check:n?n.replace(/\s+/g," ").trim():n},i={id:t.id};return(0,a.default)(r.name,t.name)||(i.name=r.name),(0,a.default)(r.definition,t.definition)||(i.definition=r.definition||void 0),(0,a.default)(r.check,t.check)||(i.check=r.check||void 0),(0,a.default)(r.roles,t.roles)||(0===r.roles.length?i.roles=["public"]:i.roles=r.roles||void 0),i},"createSQLPolicy",0,(e,n)=>{let{definition:r,check:i}=e,o={...e,definition:r?r.replace(/\s+/g," ").trim():void 0===r?null:r,check:i?i.replace(/\s+/g," ").trim():void 0===i?null:i};if((0,s.default)(n))return(e=>{let{name:t,definition:s,check:a,command:n,schema:r,table:i}=e,o=0===e.roles.length?["public"]:e.roles;return{description:`Add policy for the ${n} operation under the policy "${t}"`,statement:`CREATE POLICY "${t}" ON "${r}"."${i}"
AS PERMISSIVE FOR ${n}
TO ${o.join(", ")}
${s?`USING (${s})`:""}
${a?`WITH CHECK (${a})`:""}`}})(o);if((0,a.default)(e,n))return{};let l={};return((0,a.default)(o.name,n.name)||(l.name=o.name),(0,a.default)(o.definition,n.definition)||(l.definition=o.definition),(0,a.default)(o.check,n.check)||(l.check=o.check),(0,a.default)(o.roles,n.roles)||(l.roles=o.roles),(0,s.default)(l))?{}:((e,s)=>{let{name:a,schema:n,table:r}=e,i=(0,t.default)(s,["definition"]),o=(0,t.default)(s,["check"]),l=(0,t.default)(s,["name"]),c=(0,t.default)(s,["roles"]),d=Object.keys(s),u=`Update policy's ${1===d.length?d[0]:`${d.slice(0,d.length-1).join(", ")} and ${d[d.length-1]}`} `,m=0===(s?.roles??[]).length?["public"]:s.roles,p=`ALTER POLICY "${a}" ON "${n}"."${r}"`;return{description:u,statement:["BEGIN;",...i?[`  ${p} USING (${s.definition});`]:[],...o?[`  ${p} WITH CHECK (${s.check});`]:[],...c?[`  ${p} TO ${m.join(", ")};`]:[],...l?[`  ${p} RENAME TO "${s.name}";`]:[],"COMMIT;"].join("\n")}})(o,l)},"generateStartingPoliciesForTable",0,u],41921)},848616,(e,t,s)=>{var a=e.r(730007);t.exports=function(e){return(null==e?0:e.length)?a(e,1):[]}},331077,e=>{"use strict";var t=e.i(478902),s=e.i(172650),a=e.i(848616),n=e.i(389959),r=e.i(753515),i=e.i(440401),o=e.i(701823),l=e.i(938933),c=e.i(843778),d=e.i(140449);let u=(0,n.createContext)({onChange:e=>{},selected:void 0});var m=e.i(370410);function p({children:e,className:m,buttonClassName:p,descriptionText:h,error:_,icon:f,id:g="",name:x="",label:y,labelOptional:b,layout:v,value:j,onChange:w,onFocus:S,onBlur:E,style:N,size:T="medium",defaultValue:A,validation:q,disabled:C,optionsWidth:R}){let[k,I]=(0,n.useState)(void 0),[P,$]=(0,n.useState)({}),L=(0,l.default)("listbox"),O=(0,n.useRef)(null),{formContextOnChange:D,values:M,errors:F,handleBlur:Q,touched:U,fieldLevelValidation:z}=(0,d.useFormContext)();M&&!j&&(j=M[g||x],A=M[g||x]),_||(F&&!_&&(_=F[g||x]),_=U&&U[g||x]?_:void 0),(0,n.useEffect)(()=>{void 0!==j&&I(j)},[j]),(0,n.useEffect)(()=>{function e(){document.documentElement.style.setProperty("--width-listbox",`${R||O.current?.offsetWidth}px`)}return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),(0,n.useEffect)(()=>{let t=(0,a.default)(e);function s(e){return t.find(t=>t.props.value===e)}if(j){I(j);let e=s(j);$(e?.props?e.props:void 0);return}if(k){let e=s(k);$(e?.props?e.props:void 0);return}if(!A)return void $(t[0]?.props);{I(A);let e=s(k);$(e?.props?e.props:void 0);return}},[k]);let Y=[L.container,L.base,p],H=[L.addOnBefore];return _&&Y.push(L.variants.error),_||Y.push(L.variants.standard),f&&H.push(L.with_icon[T]),T&&Y.push(L.size[T]),C&&Y.push(L.disabled),(0,t.jsx)(r.FormLayout,{label:y,labelOptional:b,layout:v,id:g,error:_,descriptionText:h,className:m,style:N,size:T,children:(0,t.jsxs)(s.Root,{children:[(0,t.jsx)(s.Trigger,{asChild:!0,disabled:C,children:(0,t.jsxs)("button",{"data-size":T,ref:O,className:(0,c.cn)(Y),onBlur:function(e){Q&&Q(e),E&&E(e)},onFocus:S,name:x,id:g,children:[(0,t.jsxs)("span",{className:(0,c.cn)(H),children:[f&&(0,t.jsx)(o.default,{size:T,icon:f}),P?.addOnBefore&&(0,t.jsx)(P.addOnBefore,{}),(0,t.jsx)("span",{className:L.label,children:P?.label})]}),(0,t.jsx)("span",{className:L.chevron_container,children:(0,t.jsx)("svg",{className:L.chevron,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L10 5.414 7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3zm-3.707 9.293a1 1 0 011.414 0L10 14.586l2.293-2.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})})}),_&&(0,t.jsx)("div",{className:L.actions_container,children:_&&(0,t.jsx)(i.default,{size:T})})]})}),(0,t.jsx)(s.Content,{sideOffset:6,loop:!0,side:"bottom",align:"center",className:L.options_container,children:(0,t.jsx)("div",{children:(0,t.jsx)(u.Provider,{value:{onChange:function(e){w&&w(e),I(e);let t={};t.target={type:"select",name:x,id:g,value:e,checked:void 0},D&&D(t),q&&z(g,q(e))},selected:k},children:e})})})]})})}p.Option=function({id:e,value:a,label:n,disabled:r=!1,children:i,className:o="",addOnBefore:d}){let p=(0,l.default)("listbox");return(0,t.jsx)(u.Consumer,{children:({onChange:n,selected:l})=>{let u=l===a;return(0,t.jsxs)(s.Item,{className:(0,c.cn)(p.option,u?p.option_active:" ",r?p.option_disabled:" ",o),onSelect:()=>r?{}:n(a),children:[(0,t.jsxs)("div",{className:p.option_inner,children:[d&&d({active:u,selected:l}),(0,t.jsx)("span",{children:"function"==typeof i?i({active:u,selected:l}):i})]}),u?(0,t.jsx)("span",{className:(0,c.cn)(p.option_check,u?p.option_check_active:""),children:(0,t.jsx)(m.Check,{className:p.option_check_icon,"aria-hidden":"true"})}):null]},e)}})},e.s(["Listbox",0,p],331077)},900114,e=>{"use strict";let t=(0,e.i(388019).default)("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);e.s(["default",()=>t])},667042,e=>{"use strict";var t=e.i(900114);e.s(["Database",()=>t.default])},610144,e=>{"use strict";var t=e.i(755216),s=e.i(479084),a=e.i(38429),n=e.i(356003),r=e.i(355901),i=e.i(78162),o=e.i(714403),l=e.i(667286);async function c({projectRef:e,connectionString:a,schema:n,name:r,version:i,cascade:l=!1,createSchema:c=!1}){let d=new Headers;a&&d.set("x-connection-encrypted",a);let{sql:u}=t.default.extensions.create({schema:n,name:r,version:i,cascade:l}),{result:m}=await (0,o.executeSql)({projectRef:e,connectionString:a,sql:c?`create schema if not exists ${(0,s.ident)(n)}; ${u}`:u,queryKey:["extension","create"]});return m}e.s(["useDatabaseExtensionEnableMutation",0,({onSuccess:e,onError:t,...s}={})=>{let o=(0,n.useQueryClient)();return(0,a.useMutation)({mutationFn:e=>c(e),async onSuccess(t,s,a){let{projectRef:n}=s;await Promise.all([o.invalidateQueries({queryKey:l.databaseExtensionsKeys.list(n)}),o.invalidateQueries({queryKey:i.configKeys.upgradeEligibility(n)})]),await e?.(t,s,a)},async onError(e,s,a){void 0===t?r.toast.error(`Failed to enable database extension: ${e.message}`):t(e,s,a)},...s})}])},971687,e=>{"use strict";let t=(0,e.i(388019).default)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>t],971687)},647307,e=>{"use strict";var t=e.i(755216),s=e.i(38429),a=e.i(356003),n=e.i(355901),r=e.i(714403),i=e.i(801834);async function o({name:e,projectRef:s,connectionString:a}){let n=t.default.schemas.create({name:e,owner:"postgres"}).sql,{result:i}=await (0,r.executeSql)({projectRef:s,connectionString:a,sql:n,queryKey:["schema","create"]});return i}e.s(["useSchemaCreateMutation",0,({onSuccess:e,onError:t,...r}={})=>{let l=(0,a.useQueryClient)();return(0,s.useMutation)({mutationFn:e=>o(e),async onSuccess(t,s,a){let{projectRef:n}=s;await (0,i.invalidateSchemasQuery)(l,n),await e?.(t,s,a)},async onError(e,s,a){void 0===t?n.toast.error(`Failed to create schema: ${e.message}`):t(e,s,a)},...r})}])},433857,e=>{"use strict";let t=(0,e.i(388019).default)("ListPlus",[["path",{d:"M11 12H3",key:"51ecnj"}],["path",{d:"M16 6H3",key:"1wxfjs"}],["path",{d:"M16 18H3",key:"12xzn7"}],["path",{d:"M18 9v6",key:"1twb98"}],["path",{d:"M21 12h-6",key:"bt1uis"}]]);e.s(["ListPlus",()=>t],433857)},412385,e=>{"use strict";var t=e.i(389959),s=e.i(323796);e.s(["useConfirmOnClose",0,({checkIsDirty:e,onClose:a})=>{let[n,r]=(0,t.useState)(!1),i=(0,s.default)(e),o=(0,s.default)(a),l=(0,t.useCallback)(()=>{i.current()?r(!0):o.current()},[]),c=(0,t.useCallback)(()=>{r(!1),o.current()},[]),d=(0,t.useCallback)(()=>{r(!1)},[]),u=(0,t.useMemo)(()=>({visible:n,onClose:c,onCancel:d}),[n,c,d]);return(0,t.useMemo)(()=>({confirmOnClose:l,modalProps:u}),[l,u])}])},45674,(e,t,s)=>{var a=e.r(467798),n=e.r(323472),r=e.r(276199),i=e.r(372797),o=e.r(140062),l=e.r(125581),c=e.r(584902),d=e.r(189082),u=Object.prototype.hasOwnProperty;t.exports=function(e){if(null==e)return!0;if(o(e)&&(i(e)||"string"==typeof e||"function"==typeof e.splice||l(e)||d(e)||r(e)))return!e.length;var t=n(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(c(e))return!a(e).length;for(var s in e)if(u.call(e,s))return!1;return!0}},28889,(e,t,s)=>{var a=e.r(995762),n=e.r(730007),r=e.r(110754),i=e.r(372797);t.exports=function(){var e=arguments.length;if(!e)return[];for(var t=Array(e-1),s=arguments[0],o=e;o--;)t[o-1]=arguments[o];return a(i(s)?r(s):[s],n(t,1))}},707409,e=>{"use strict";var t=e.i(28889),s=e.i(893524);let a=["int2","int4","int8","float4","float8","numeric","double precision"],n=["json","jsonb"],r=["text","varchar"],i=["timestamp","timestamptz"],o=["date"],l=["time","timetz"],c=(0,t.default)(i,o,l),d=["uuid","bool","vector","bytea"],u=(0,s.default)((0,t.default)(a,n,r,c,d));e.s(["DATETIME_TYPES",0,c,"DATE_TYPES",0,o,"JSON_TYPES",0,n,"NUMERICAL_TYPES",0,a,"OTHER_DATA_TYPES",0,d,"POSTGRES_DATA_TYPES",0,u,"POSTGRES_DATA_TYPE_OPTIONS",0,[{name:"int2",description:"Signed two-byte integer",type:"number"},{name:"int4",description:"Signed four-byte integer",type:"number"},{name:"int8",description:"Signed eight-byte integer",type:"number"},{name:"float4",description:"Single precision floating-point number (4 bytes)",type:"number"},{name:"float8",description:"Double precision floating-point number (8 bytes)",type:"number"},{name:"numeric",description:"Exact numeric of selectable precision",type:"number"},{name:"json",description:"Textual JSON data",type:"json"},{name:"jsonb",description:"Binary JSON data, decomposed",type:"json"},{name:"text",description:"Variable-length character string",type:"text"},{name:"varchar",description:"Variable-length character string",type:"text"},{name:"uuid",description:"Universally unique identifier",type:"text"},{name:"date",description:"Calendar date (year, month, day)",type:"time"},{name:"time",description:"Time of day (no time zone)",type:"time"},{name:"timetz",description:"Time of day, including time zone",type:"time"},{name:"timestamp",description:"Date and time (no time zone)",type:"time"},{name:"timestamptz",description:"Date and time, including time zone",type:"time"},{name:"bool",description:"Logical boolean (true/false)",type:"bool"},{name:"bytea",description:"Variable-length binary string",type:"others"}],"RECOMMENDED_ALTERNATIVE_DATA_TYPE",0,{varchar:{alternative:"text",reference:"https://wiki.postgresql.org/wiki/Don't_Do_This#Don.27t_use_varchar.28n.29_by_default"},json:{alternative:"jsonb",reference:"https://www.postgresql.org/docs/current/datatype-json.html"},timetz:{alternative:"timestamptz",reference:"https://wiki.postgresql.org/wiki/Don't_Do_This#Don.27t_use_timetz"},timestamp:{alternative:"timestamptz",reference:"https://wiki.postgresql.org/wiki/Don't_Do_This#Don.27t_use_timestamp_.28without_time_zone.29"}},"TEXT_TYPES",0,r,"TIMESTAMP_TYPES",0,i,"TIME_TYPES",0,l])},973512,832237,e=>{"use strict";var t=e.i(478902),s=e.i(246806),a=e.i(389959),n=e.i(837710);e.s(["ActionBar",0,({loading:e=!1,disableApply:r=!1,hideApply:i=!1,children:o,applyButtonLabel:l="Apply",backButtonLabel:c="Back",applyFunction:d,closePanel:u=s.default,formId:m})=>{let[p,h]=(0,a.useState)(!1),_=async()=>{h(!0),await new Promise(e=>d(e)),h(!1)};return(0,t.jsxs)("div",{className:"flex w-full justify-end space-x-3 border-t border-default px-3 py-4",children:[(0,t.jsx)(n.Button,{type:"default",htmlType:"button",onClick:u,disabled:p||e,children:c}),o,void 0!==d?(0,t.jsx)(n.Button,{onClick:_,disabled:r||p||e,loading:p||e,children:l}):i?(0,t.jsx)("div",{}):(0,t.jsx)(n.Button,{disabled:e||r,loading:e,"data-testid":"action-bar-save-row",htmlType:"submit",form:m,children:l})]})}],973512);var r=s,i=e.i(971687),o=e.i(370410),l=e.i(365257),c=e.i(17203),d=e.i(116746),u=e.i(433857),m=e.i(388019);let p=(0,m.default)("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),h=(0,m.default)("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);var _=e.i(215261),f=e.i(206413),g=e.i(592360),x=e.i(178527),y=e.i(703526),b=e.i(917007),v=e.i(920432),j=e.i(549815),w=e.i(911509),S=e.i(866205),E=e.i(877555),N=e.i(171997),T=e.i(9679),A=e.i(793912),q=e.i(135144),C=e.i(689805),R=e.i(396831),k=e.i(613580),I=e.i(843778),P=e.i(707409);e.s(["default",0,({value:e,className:s,enumTypes:m=[],disabled:$=!1,showLabel:L=!0,layout:O="horizontal",description:D,showRecommendation:M=!1,onOptionSelect:F=r.default,error:Q})=>{let[U,z]=(0,a.useState)(!1),Y=P.POSTGRES_DATA_TYPES.concat(m.map(e=>e.format.replaceAll('"',""))),H=!e||Y.includes(e),B=P.RECOMMENDED_ALTERNATIVE_DATA_TYPE[e],K="This column's data type cannot be changed via the Table Editor as it is not supported yet. You can do so through the SQL Editor instead.",W=e=>{switch(e){case"number":return(0,t.jsx)(d.Hash,{size:14,className:"text-foreground",strokeWidth:1.5});case"time":return(0,t.jsx)(i.Calendar,{size:14,className:"text-foreground",strokeWidth:1.5});case"text":return(0,t.jsx)(h,{size:14,className:"text-foreground",strokeWidth:1.5});case"json":case"jsonb":return(0,t.jsx)("div",{className:"text-foreground",style:{padding:"0px 1px"},children:"{ }"});case"bool":return(0,t.jsx)(p,{size:14,className:"text-foreground",strokeWidth:1.5});default:return(0,t.jsx)(u.ListPlus,{size:16,className:"text-foreground",strokeWidth:1.5})}};return H?$&&!L?(0,t.jsxs)(k.Tooltip,{children:[(0,t.jsx)(k.TooltipTrigger,{children:(0,t.jsx)(N.Input,{readOnly:!0,disabled:!0,label:L?"Type":"",layout:L?"horizontal":void 0,className:"md:gap-x-0",size:"small",value:e})}),!L&&D&&(0,t.jsx)(k.TooltipContent,{side:"bottom",children:(0,t.jsx)("div",{className:"w-80",children:D})})]}):(0,t.jsxs)("div",{className:(0,I.cn)("flex flex-col gap-y-2",s),children:[L&&(0,t.jsx)(T.Label_Shadcn_,{className:"text-foreground-light",children:"Type"}),(0,t.jsxs)(C.Popover_Shadcn_,{open:U,onOpenChange:z,children:[(0,t.jsx)(q.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(n.Button,{type:Q?"danger":"default",role:"combobox",size:"small","aria-expanded":U,className:(0,I.cn)("w-full justify-between",!e&&"text-foreground-lighter"),iconRight:(0,t.jsx)(l.ChevronsUpDown,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"}),children:e?(0,t.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,t.jsx)("span",{children:W((e=>{let t=P.POSTGRES_DATA_TYPE_OPTIONS.find(t=>t.name===e);if(t)return t;let s=m.find(t=>t.format===e);return s?{...s,type:"enum"}:void 0})(e)?.type??"")}),e.replaceAll('"',"")]}):"Choose a column type..."})}),(0,t.jsx)(A.PopoverContent_Shadcn_,{className:"w-[460px] p-0",side:"bottom",align:"center",children:(0,t.jsx)(R.ScrollArea,{className:"h-[335px]",children:(0,t.jsxs)(S.Command_Shadcn_,{children:[(0,t.jsx)(v.CommandInput_Shadcn_,{placeholder:"Search types...",className:"!bg-transparent focus:!shadow-none focus:!ring-0"}),(0,t.jsx)(y.CommandEmpty_Shadcn_,{children:"Type not found."}),(0,t.jsxs)(w.CommandList_Shadcn_,{children:[(0,t.jsx)(b.CommandGroup_Shadcn_,{children:P.POSTGRES_DATA_TYPE_OPTIONS.map(s=>(0,t.jsxs)(j.CommandItem_Shadcn_,{value:s.name,className:(0,I.cn)("relative",s.name===e?"bg-surface-200":""),onSelect:e=>{F(e),z(!1)},children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 pr-6",children:[(0,t.jsx)("span",{children:W(s.type)}),(0,t.jsx)("span",{className:"text-foreground",children:s.name}),(0,t.jsx)("span",{className:"text-foreground-lighter",children:s.description})]}),(0,t.jsx)("span",{className:"absolute right-3 top-2",children:s.name===e?(0,t.jsx)(o.Check,{className:"text-brand",size:14}):""})]},s.name))}),m.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.CommandItem_Shadcn_,{children:"Other types"}),(0,t.jsx)(b.CommandGroup_Shadcn_,{children:m.map(s=>(0,t.jsx)(j.CommandItem_Shadcn_,{value:s.format,className:(0,I.cn)("relative",s.format===e?"bg-surface-200":""),onSelect:e=>{F("public"===s.schema?e.replaceAll('"',""):e),z(!1)},children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{children:(0,t.jsx)(u.ListPlus,{size:16,className:"text-foreground",strokeWidth:1.5})}),(0,t.jsx)("span",{className:"text-foreground",children:s.format.replaceAll('"',"")}),void 0!==s.comment&&(0,t.jsx)("span",{title:s.comment??"",className:"text-foreground-lighter",children:s.comment}),s.format===e&&(0,t.jsx)("span",{className:"absolute right-3 top-2",children:(0,t.jsx)(o.Check,{className:"text-brand",size:14})})]})},s.id))})]})]})]})})})]}),M&&void 0!==B&&(0,t.jsxs)(x.Alert_Shadcn_,{variant:"warning",className:"mt-2",children:[(0,t.jsx)(E.CriticalIcon,{}),(0,t.jsxs)(g.AlertTitle_Shadcn_,{children:[" ","It is recommended to use"," ",(0,t.jsx)("code",{className:"text-code-inline",children:B.alternative})," instead"]}),(0,t.jsxs)(f.AlertDescription_Shadcn_,{children:[(0,t.jsxs)("p",{children:["Postgres recommends against using the data type"," ",(0,t.jsx)("code",{className:"text-code-inline",children:e})," unless you have a very specific use case."]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 mt-3",children:[(0,t.jsx)(n.Button,{asChild:!0,type:"default",icon:(0,t.jsx)(c.ExternalLink,{}),children:(0,t.jsx)(_.default,{href:B.reference,target:"_blank",rel:"noreferrer",children:"Read more"})}),(0,t.jsxs)(n.Button,{type:"primary",onClick:()=>F(B.alternative),children:["Use ",B.alternative]})]})]})]})]}):(0,t.jsxs)(k.Tooltip,{children:[(0,t.jsx)(k.TooltipTrigger,{children:(0,t.jsx)(N.Input,{readOnly:!0,disabled:!0,label:L?"Type":"",layout:L?O:void 0,className:"md:gap-x-0 [&>div>div]:text-left",size:"small",icon:W(P.POSTGRES_DATA_TYPE_OPTIONS.find(t=>t.name===e)?.type??""),value:e,descriptionText:L?K:void 0})}),!L&&(0,t.jsx)(k.TooltipContent,{side:"bottom",className:"w-80",children:K})]})}],832237)},170286,(e,t,s)=>{e.e,t.exports=function(){"use strict";var e={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},t=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|Q|YYYY|YY?|ww?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,s=/\d/,a=/\d\d/,n=/\d\d?/,r=/\d*[^-_:/,()\s\d]+/,i={},o=function(e){return(e*=1)+(e>68?1900:2e3)},l=function(e){return function(t){this[e]=+t}},c=[/[+-]\d\d:?(\d\d)?|Z/,function(e){(this.zone||(this.zone={})).offset=function(e){if(!e||"Z"===e)return 0;var t=e.match(/([+-]|\d\d)/g),s=60*t[1]+(+t[2]||0);return 0===s?0:"+"===t[0]?-s:s}(e)}],d=function(e){var t=i[e];return t&&(t.indexOf?t:t.s.concat(t.f))},u=function(e,t){var s,a=i.meridiem;if(a){for(var n=1;n<=24;n+=1)if(e.indexOf(a(n,0,t))>-1){s=n>12;break}}else s=e===(t?"pm":"PM");return s},m={A:[r,function(e){this.afternoon=u(e,!1)}],a:[r,function(e){this.afternoon=u(e,!0)}],Q:[s,function(e){this.month=3*(e-1)+1}],S:[s,function(e){this.milliseconds=100*e}],SS:[a,function(e){this.milliseconds=10*e}],SSS:[/\d{3}/,function(e){this.milliseconds=+e}],s:[n,l("seconds")],ss:[n,l("seconds")],m:[n,l("minutes")],mm:[n,l("minutes")],H:[n,l("hours")],h:[n,l("hours")],HH:[n,l("hours")],hh:[n,l("hours")],D:[n,l("day")],DD:[a,l("day")],Do:[r,function(e){var t=i.ordinal,s=e.match(/\d+/);if(this.day=s[0],t)for(var a=1;a<=31;a+=1)t(a).replace(/\[|\]/g,"")===e&&(this.day=a)}],w:[n,l("week")],ww:[a,l("week")],M:[n,l("month")],MM:[a,l("month")],MMM:[r,function(e){var t=d("months"),s=(d("monthsShort")||t.map(function(e){return e.slice(0,3)})).indexOf(e)+1;if(s<1)throw Error();this.month=s%12||s}],MMMM:[r,function(e){var t=d("months").indexOf(e)+1;if(t<1)throw Error();this.month=t%12||t}],Y:[/[+-]?\d+/,l("year")],YY:[a,function(e){this.year=o(e)}],YYYY:[/\d{4}/,l("year")],Z:c,ZZ:c};return function(s,a,n){n.p.customParseFormat=!0,s&&s.parseTwoDigitYear&&(o=s.parseTwoDigitYear);var r=a.prototype,l=r.parse;r.parse=function(s){var a=s.date,r=s.utc,o=s.args;this.$u=r;var c=o[1];if("string"==typeof c){var d=!0===o[2],u=!0===o[3],p=o[2];u&&(p=o[2]),i=this.$locale(),!d&&p&&(i=n.Ls[p]),this.$d=function(s,a,n,r){try{if(["x","X"].indexOf(a)>-1)return new Date(("X"===a?1e3:1)*s);var o=(function(s){var a,n;a=s,n=i&&i.formats;for(var r=(s=a.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(t,s,a){var r=a&&a.toUpperCase();return s||n[a]||e[a]||n[r].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(e,t,s){return t||s.slice(1)})})).match(t),o=r.length,l=0;l<o;l+=1){var c=r[l],d=m[c],u=d&&d[0],p=d&&d[1];r[l]=p?{regex:u,parser:p}:c.replace(/^\[|\]$/g,"")}return function(e){for(var t={},s=0,a=0;s<o;s+=1){var n=r[s];if("string"==typeof n)a+=n.length;else{var i=n.regex,l=n.parser,c=e.slice(a),d=i.exec(c)[0];l.call(t,d),e=e.replace(d,"")}}return function(e){var t=e.afternoon;if(void 0!==t){var s=e.hours;t?s<12&&(e.hours+=12):12===s&&(e.hours=0),delete e.afternoon}}(t),t}})(a)(s),l=o.year,c=o.month,d=o.day,u=o.hours,p=o.minutes,h=o.seconds,_=o.milliseconds,f=o.zone,g=o.week,x=new Date,y=d||(l||c?1:x.getDate()),b=l||x.getFullYear(),v=0;l&&!c||(v=c>0?c-1:x.getMonth());var j,w=u||0,S=p||0,E=h||0,N=_||0;return f?new Date(Date.UTC(b,v,y,w,S,E,N+60*f.offset*1e3)):n?new Date(Date.UTC(b,v,y,w,S,E,N)):(j=new Date(b,v,y,w,S,E,N),g&&(j=r(j).week(g).toDate()),j)}catch(e){return new Date("")}}(a,c,r,n),this.init(),p&&!0!==p&&(this.$L=this.locale(p).$L),(d||u)&&a!=this.format(c)&&(this.$d=new Date("")),i={}}else if(c instanceof Array)for(var h=c.length,_=1;_<=h;_+=1){o[1]=c[_-1];var f=n.apply(this,o);if(f.isValid()){this.$d=f.$d,this.$L=f.$L,this.init();break}_===h&&(this.$d=new Date(""))}else l.call(this,s)}}}()},101369,e=>{"use strict";var t=e.i(478902),s=e.i(843778);e.s(["default",0,({max:e=100,value:a=0,barClass:n="bg-foreground",bgClass:r="",type:i="vertical",borderClass:o="",labelBottom:l="",labelBottomClass:c="tabular-nums",labelTop:d="",labelTopClass:u=""})=>{if("horizontal"===i){let i=Number(a/e*100),m=`${i}%`,p=l||d;return(0,t.jsxs)("div",{className:"flex flex-col w-full",children:[p&&(0,t.jsxs)("div",{className:"flex align-baseline justify-between pb-1 space-x-8",children:[(0,t.jsx)("p",{className:(0,s.cn)("text-foreground text-sm truncate capitalize-sentence",d.length>0&&"max-w-[75%]",c),children:l}),(0,t.jsx)("p",{className:(0,s.cn)("text-foreground-light text-sm",u),children:d})]}),(0,t.jsx)("div",{className:`relative rounded h-1 overflow-hidden w-full border p-0 ${r||"bg-surface-400"} ${o||"border-none"}`,children:(0,t.jsx)("div",{className:`absolute rounded inset-x-0 bottom-0 h-1 ${n} transition-all`,style:{width:m}})})]})}{let s=Number(a/e*35);return s<2&&(s=2),(0,t.jsx)("div",{className:`relative rounded w-5 overflow-hidden border p-1 ${r||"bg-gray-400"} ${o||"border-none"}`,style:{height:35},children:(0,t.jsx)("div",{className:`absolute inset-x-0 bottom-0 w-5 ${n}`,style:{height:s}})})}}])},64102,e=>{"use strict";var t=e.i(478902),s=e.i(389959),a=e.i(843778);let n=()=>(0,t.jsxs)("div",{className:"flex w-full flex-col gap-2",children:[(0,t.jsx)("div",{className:"shimmering-loader h-2 w-1/3 rounded"}),(0,t.jsx)("div",{className:"flex flex-col justify-between space-y-2",children:(0,t.jsx)("div",{className:"shimmering-loader h-[34px] w-2/3 rounded"})})]});e.s(["FormSection",0,({children:e,id:s,header:a,disabled:n,className:r})=>{let i=["grid grid-cols-12 gap-6 px-[var(--card-padding-x)] py-4 md:py-8",`${n?" opacity-30":" opacity-100"}`,`${r}`];return(0,t.jsxs)("div",{id:s,className:i.join(" "),children:[a,e]})},"FormSectionContent",0,({children:e,loading:a=!0,loaders:r,fullWidth:i,className:o})=>(0,t.jsx)("div",{className:`
        relative col-span-12 flex flex-col gap-6 @lg:col-span-7
        ${i&&"!col-span-12"}
        ${o}
      `,children:a?r?Array(r).fill(0).map((e,s)=>(0,t.jsx)(n,{},s)):s.Children.map(e,(e,s)=>(0,t.jsx)(n,{},s)):e}),"FormSectionLabel",0,({children:e,className:s="",description:n})=>void 0!==n?(0,t.jsxs)("div",{className:(0,a.cn)("flex flex-col space-y-2 col-span-12 lg:col-span-5",s),children:[(0,t.jsx)("label",{className:"text-foreground text-sm",children:e}),n]}):(0,t.jsx)("label",{className:`text-foreground col-span-12 text-sm lg:col-span-5 ${s}`,children:e})])},653379,(e,t,s)=>{var a=e.r(70234);t.exports=function(e,t){return a(t,function(t){return e[t]})}},458389,(e,t,s)=>{var a=e.r(653379),n=e.r(937165);t.exports=function(e){return null==e?[]:a(e,n(e))}},992640,(e,t,s)=>{var a=e.r(91385),n=e.r(140062),r=e.r(14056),i=e.r(798705),o=e.r(458389),l=Math.max;t.exports=function(e,t,s,c){e=n(e)?e:o(e),s=s&&!c?i(s):0;var d=e.length;return s<0&&(s=l(d+s,0)),r(e)?s<=d&&e.indexOf(t,s)>-1:!!d&&a(e,t,s)>-1}},554222,e=>{"use strict";var t=e.i(478902),s=e.i(389959),a=e.i(355901),n=e.i(171997),r=e.i(539013),i=e.i(647307),o=e.i(635494);e.s(["SchemaEditor",0,({visible:e,onSuccess:l,closePanel:c})=>{let{data:d}=(0,o.useSelectedProjectQuery)(),[u,m]=(0,s.useState)({name:void 0}),[p,h]=(0,s.useState)(""),{mutateAsync:_,isPending:f}=(0,i.useSchemaCreateMutation)();(0,s.useEffect)(()=>{e&&(h(""),m({name:void 0}))},[e]);let g=async()=>{let e={};if(0===p.length&&(e.name="Please provide a name for your schema"),Object.keys(e).length>0)return m(e);if(void 0===d)return console.error("Project is required");try{await _({projectRef:d.ref,connectionString:d.connectionString,name:p}),l(p),a.toast.success(`Successfully created schema "${p}"`)}catch(e){a.toast.error(`Failed to create schema: ${e}`)}};return(0,t.jsx)(r.SidePanel,{size:"medium",visible:e,header:"Create a new schema",className:"transition-all duration-100 ease-in",onCancel:c,onConfirm:g,loading:f,cancelText:"Cancel",confirmText:"Save",children:(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(r.SidePanel.Content,{children:(0,t.jsx)("div",{className:"space-y-10 py-6",children:(0,t.jsx)(n.Input,{label:"Schema name",layout:"vertical",type:"text",error:u?.name,value:p,onChange:e=>h(e.target.value)})})})})},"SchemaEditor")}])},905596,e=>{"use strict";var t=e.i(478902),s=e.i(585102),a=e.i(389959),n=e.i(753515),r=e.i(938933),i=e.i(140449);e.s(["Toggle",0,function({disabled:e,id:o="",name:l="",layout:c="flex",error:d,descriptionText:u,label:m,afterLabel:p,beforeLabel:h,labelOptional:_,onChange:f,onBlur:g,defaultChecked:x,checked:y,className:b,align:v="left",size:j="medium",validation:w,labelLayout:S,...E}){let N=(0,r.default)("toggle"),{formContextOnChange:T,values:A,errors:q,handleBlur:C,touched:R,fieldLevelValidation:k}=(0,i.useFormContext)();A&&!y&&(y=A[o||l]);let[I,P]=(0,a.useState)((x||y)??!1),$=y??I;(0,a.useEffect)(()=>{P($)},[]),d||(q&&!d&&(d=q[o||l]),d=R&&R[o||l]?d:void 0);let L=[N.base,N.handle_container[j]];$&&L.push(N.active);let O=[N.handle.base,N.handle[j]];return $&&O.push(N.handle_active[j]),(0,t.jsx)(n.FormLayout,{className:b,label:m,afterLabel:p,beforeLabel:h,labelOptional:_,layout:c,id:o,error:d,align:v,descriptionText:u,size:j,labelLayout:S,nonBoxInput:!0,children:(0,t.jsx)("button",{type:"button",id:o,name:l,className:(0,s.default)(...L,e&&"opacity-50 cursor-default"),onClick:function(){f&&f(!$),P(!I);let e={};e.target={type:"checkbox",name:l,id:o,value:!$,checked:!$},T&&T(e),w&&k(o,w(!I))},disabled:e,onBlur:function(e){setTimeout(()=>{C&&C(e)},100),g&&g(e)},...E,children:(0,t.jsx)("span",{"aria-hidden":"true",className:O.join(" ")})})})}],905596)},383595,(e,t,s)=>{t.exports=function(e){return null===e}},197187,e=>{"use strict";let t=(0,e.i(388019).default)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);e.s(["default",()=>t])},532427,e=>{"use strict";var t=e.i(197187);e.s(["Filter",()=>t.default])},321605,25912,e=>{"use strict";var t=e.i(248593),s=e.i(242882),a=e.i(234745);let n={list:e=>["projects",e,"database-publications"]};async function r({projectRef:e,connectionString:s},n){if(!e)throw Error("projectRef is required");let r=new Headers;s&&r.set("x-connection-encrypted",s);let{data:i,error:o}=await (0,a.get)("/platform/pg-meta/{ref}/publications",{params:{header:{"x-connection-encrypted":s,"x-pg-application-name":t.DEFAULT_PLATFORM_APPLICATION_NAME},path:{ref:e}},headers:r,signal:n});return o&&(0,a.handleError)(o),i}e.s(["databasePublicationsKeys",0,n],25912),e.s(["useDatabasePublicationsQuery",0,({projectRef:e,connectionString:t},{enabled:a=!0,...i}={})=>(0,s.useQuery)({queryKey:n.list(e),queryFn:({signal:s})=>r({projectRef:e,connectionString:t},s),enabled:a&&void 0!==e,...i})],321605)},587768,e=>{"use strict";var t=e.i(755216),s=e.i(38429),a=e.i(356003),n=e.i(355901),r=e.i(714403),i=e.i(25912);async function o({projectRef:e,connectionString:s,id:a,tables:n,publish_insert:i,publish_update:o,publish_delete:l,publish_truncate:c}){let{sql:d}=t.default.publications.update(a,{tables:n,publish_insert:i,publish_update:o,publish_delete:l,publish_truncate:c}),{result:u}=await (0,r.executeSql)({projectRef:e,connectionString:s,sql:d,queryKey:["publication","update",a]});return u}e.s(["useDatabasePublicationUpdateMutation",0,({onSuccess:e,onError:t,...r}={})=>{let l=(0,a.useQueryClient)();return(0,s.useMutation)({mutationFn:e=>o(e),async onSuccess(t,s,a){let{projectRef:n}=s;await l.invalidateQueries({queryKey:i.databasePublicationsKeys.list(n)}),await e?.(t,s,a)},async onError(e,s,a){void 0===t?n.toast.error(`Failed to update database publication: ${e.message}`):t(e,s,a)},...r})}])},546024,e=>{"use strict";let t=(0,e.i(388019).default)("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);e.s(["Key",()=>t],546024)},199327,e=>{"use strict";let t=(0,e.i(388019).default)("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);e.s(["Home",()=>t],199327)},419524,e=>{"use strict";let t=(0,e.i(388019).default)("AlignLeft",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}],["line",{x1:"17",x2:"3",y1:"18",y2:"18",key:"1awlsn"}]]);e.s(["AlignLeft",()=>t],419524)},899850,e=>{"use strict";e.s(["COUNT_ESTIMATE_SQL",0,`
CREATE OR REPLACE FUNCTION pg_temp.count_estimate(
    query text
) RETURNS integer LANGUAGE plpgsql AS $$
DECLARE
    plan jsonb;
BEGIN
    EXECUTE 'EXPLAIN (FORMAT JSON)' || query INTO plan;
    RETURN plan->0->'Plan'->'Plan Rows';
END;
$$;
`.trim(),"THRESHOLD_COUNT",0,5e4])},494031,e=>{"use strict";var t=e.i(749199),s=e.i(820308),a=e.i(775159);e.s(["useQueryPerformanceQuery",0,({preset:e,orderBy:n,searchQuery:r="",roles:i,runIndexAdvisor:o=!1,minCalls:l,filterIndexAdvisor:c=!1})=>{let d=s.PRESET_CONFIG[a.Presets.QUERY_PERFORMANCE].queries[e],u=[void 0!==i&&i.length>0?`auth.rolname in (${i.map(e=>`'${e}'`).join(", ")})`:"",r.length>0?`statements.query ~* '${r}'`:"","number"==typeof l&&l>0?`statements.calls >= ${l}`:""].filter(e=>e.length>0).join(" AND "),m=n&&`ORDER BY ${n.column} ${n.order}`,p=d.sql([],u.length>0?`WHERE ${u}`:void 0,m,o,c);return(0,t.default)({sql:p,params:void 0,where:u,orderBy:m})}])},999918,e=>{"use strict";let t=(0,e.i(388019).default)("ShieldOff",[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71",key:"1jlk70"}],["path",{d:"M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264",key:"18rp1v"}]]);e.s(["ShieldOff",()=>t],999918)},181827,e=>{"use strict";var t=e.i(478902),s=e.i(156054);e.s(["MonacoEditor",0,({width:e,height:a,value:n,language:r,readOnly:i=!1,onChange:o,onMount:l})=>(0,t.jsx)(s.default,{width:e,height:a||"200px",theme:"supabase",wrapperProps:{className:"grid-monaco-editor-container"},className:"grid-monaco-editor",defaultLanguage:r||"plaintext",defaultValue:n,onChange:o,onMount:function(e){e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})});let t=e.getModel().getPositionAt(n?.length);e.setPosition(t),setTimeout(()=>{e?.focus()},0),l&&l(e)},options:{readOnly:i,tabSize:2,fontSize:13,minimap:{enabled:!1},glyphMargin:!1,folding:!1,lineNumbers:"off",lineNumbersMinChars:0,scrollBeyondLastLine:!1,wordWrap:"on",unusualLineTerminators:"off"}})])},93472,165610,e=>{"use strict";var t=e.i(478902),s=e.i(389959),a=e.i(938933);let n=(0,e.i(388019).default)("OctagonAlert",[["path",{d:"M12 16h.01",key:"1drbdi"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M15.312 2a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586l-4.688-4.688A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2z",key:"1fd625"}]]);e.s(["AlertOctagon",()=>n],165610);var r=e.i(872646),i=e.i(217444),o=e.i(833655),l=e.i(975924);let c={danger:(0,t.jsx)(n,{strokeWidth:1.5,size:18}),success:(0,t.jsx)(r.CheckCircle,{strokeWidth:1.5,size:18}),warning:(0,t.jsx)(i.AlertTriangle,{strokeWidth:1.5,size:18}),info:(0,t.jsx)(o.Info,{strokeWidth:1.5,size:18}),neutral:(0,t.jsx)(t.Fragment,{})};function d({variant:e="neutral",className:n,title:r,withIcon:i,closable:o,children:d,icon:u,actions:m}){let p=(0,a.default)("alert"),[h,_]=(0,s.useState)(!0),f=[p.base];f.push(p.variant[e].base),n&&f.push(n);let g=[p.description,p.variant[e].description],x=[p.close];return(0,t.jsx)(t.Fragment,{children:h&&(0,t.jsxs)("div",{className:f.join(" "),children:[i?(0,t.jsx)("div",{className:p.variant[e].icon,children:i&&c[e]}):null,u&&u,(0,t.jsxs)("div",{className:"flex flex-1 items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:[p.variant[e].header,p.header].join(" "),children:r}),(0,t.jsx)("div",{className:g.join(" "),children:d})]}),m]}),o&&(0,t.jsx)("button",{"aria-label":"Close alert",onClick:()=>_(!1),className:x.join(" "),children:(0,t.jsx)(l.X,{strokeWidth:2,size:16})})]})})}e.s(["Alert",()=>d],93472)},815545,e=>{"use strict";var t=e.i(478902),s=e.i(753515),a=e.i(938933),n=e.i(140449);let r=(0,e.i(389959).createContext)({parentCallback:e=>{},parentSize:""});function i({className:e,id:s="",name:i="",label:o,afterLabel:l,beforeLabel:c,description:d,checked:u,value:m,onChange:p,onBlur:h,size:_="medium",disabled:f=!1,...g}){let{formContextOnChange:x,values:y,handleBlur:b}=(0,n.useFormContext)(),v=(0,a.default)("checkbox");return(0,t.jsx)(r.Consumer,{children:({parentCallback:a,parentSize:n})=>{let r=s||i||(o?o.toLowerCase().replace(/^[^A-Z0-9]+/gi,"").replace(/ /g,"-"):void 0);_=n||_;let j=i||r,w=u??void 0,S=[v.container];return e&&S.push(e),y&&void 0===u&&(w=y[s||i]),(0,t.jsxs)("div",{className:S.join(" "),children:[(0,t.jsx)("input",{id:r,name:j,type:"checkbox",className:[v.base,v.size[_]].join(" "),onChange:function(e){a&&a(e),p&&p(e),x&&x(e)},onBlur:function(e){b&&setTimeout(()=>{b(e)},100),h&&h(e)},checked:w,value:m||r,disabled:f,...g}),(0,t.jsxs)("label",{className:[v.label.base,v.label[_]].join(" "),htmlFor:r,children:[(0,t.jsxs)("span",{children:[c&&(0,t.jsx)("span",{className:[v.label_before.base,v.label_before[_]].join(" "),children:c}),o,l&&(0,t.jsx)("span",{className:[v.label_after.base,v.label_after[_]].join(" "),children:l})]}),d&&(0,t.jsx)("p",{className:[v.description.base,v.description[_]].join(" "),children:d})]})]})}})}i.Group=function({id:e,layout:n="vertical",error:o,descriptionText:l,label:c,afterLabel:d,beforeLabel:u,labelOptional:m,children:p,className:h,options:_,onChange:f,size:g="medium"}){let x=(0,a.default)("checkbox");return(0,t.jsx)(s.FormLayout,{label:c,afterLabel:d,beforeLabel:u,labelOptional:m,layout:n,id:e,error:o,descriptionText:l,className:h,size:g,children:(0,t.jsx)(r.Provider,{value:{parentCallback:e=>{f&&f(e)},parentSize:g},children:(0,t.jsx)("div",{className:x.group,children:_?_.map(e=>(0,t.jsx)(i,{id:e.id,value:e.value,label:e.label,beforeLabel:e.beforeLabel,afterLabel:e.afterLabel,checked:e.checked,name:e.name,description:e.description,defaultChecked:e.defaultChecked},e.id)):p})})})},e.s(["Checkbox",0,i],815545)},415190,e=>{"use strict";var t=e.i(242882),s=e.i(714403),a=e.i(938343),n=e.i(305015);async function r({projectRef:e,connectionString:t,id:a},r){if(!a)throw Error("id is required");let i=a?(0,n.default)(`
    with base_table_info as (
        select
            c.oid::int8 as id,
            nc.nspname as schema,
            c.relname as name,
            c.relkind,
            c.relrowsecurity as rls_enabled,
            c.relforcerowsecurity as rls_forced,
            c.relreplident,
            c.relowner,
            obj_description(c.oid) as comment,
            fs.srvname as foreign_server_name,
            fdw.fdwname as foreign_data_wrapper_name,
            fdw_handler.proname as foreign_data_wrapper_handler
        from pg_class c
        join pg_namespace nc on nc.oid = c.relnamespace
        left join pg_foreign_table ft on ft.ftrelid = c.oid
        left join pg_foreign_server fs on fs.oid = ft.ftserver
        left join pg_foreign_data_wrapper fdw on fdw.oid = fs.srvfdw
        left join pg_proc fdw_handler on fdw.fdwhandler = fdw_handler.oid
        where c.oid = ${a}
            and not pg_is_other_temp_schema(nc.oid)
            and (
                pg_has_role(c.relowner, 'USAGE')
                or has_table_privilege(
                    c.oid,
                    'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER'
                )
                or has_any_column_privilege(c.oid, 'SELECT, INSERT, UPDATE, REFERENCES')
            )
    ),
    table_stats as (
        select
            b.id,
            case
                when b.relreplident = 'd' then 'DEFAULT'
                when b.relreplident = 'i' then 'INDEX'
                when b.relreplident = 'f' then 'FULL'
                else 'NOTHING'
            end as replica_identity,
            pg_total_relation_size(format('%I.%I', b.schema, b.name))::int8 as bytes,
            pg_size_pretty(pg_total_relation_size(format('%I.%I', b.schema, b.name))) as size,
            pg_stat_get_live_tuples(b.id) as live_rows_estimate,
            pg_stat_get_dead_tuples(b.id) as dead_rows_estimate
        from base_table_info b
        where b.relkind in ('r', 'p')
    ),
    primary_keys as (
        select
            i.indrelid as table_id,
            jsonb_agg(
                jsonb_build_object(
                    'schema', n.nspname,
                    'table_name', c.relname,
                    'table_id', i.indrelid::int8,
                    'name', a.attname
                )
                order by array_position(i.indkey, a.attnum)
            ) as primary_keys
        from pg_index i
        join pg_class c on i.indrelid = c.oid
        join pg_namespace n on c.relnamespace = n.oid
		join pg_attribute a on a.attrelid = c.oid and a.attnum = any(i.indkey)
        where i.indisprimary
        group by i.indrelid
    ),
    index_cols as (
        select
            i.indrelid as table_id,
            i.indkey,
            array_agg(
                a.attname
                order by array_position(i.indkey, a.attnum)
            ) as columns
        from pg_index i
        join pg_class c on i.indrelid = c.oid
        join pg_attribute a on a.attrelid = c.oid
            and a.attnum = any(i.indkey)
        where i.indisunique
            and i.indisprimary = false
        group by i.indrelid, i.indkey
    ),
    unique_indexes as (
        select
            ic.table_id,
            jsonb_agg(
                jsonb_build_object(
                    'schema', n.nspname,
                    'table_name', c.relname,
                    'table_id', ic.table_id::int8,
                    'columns', ic.columns
                )
            ) as unique_indexes
        from index_cols ic
        join pg_class c on c.oid = ic.table_id
        join pg_namespace n on n.oid = c.relnamespace
        group by ic.table_id
    ),
    relationships as (
        select
            c.conrelid as source_id,
            c.confrelid as target_id,
            jsonb_build_object(
                'id', c.oid::int8,
                'constraint_name', c.conname,
                'deletion_action', c.confdeltype,
                'update_action', c.confupdtype,
                'source_schema', nsa.nspname,
                'source_table_name', csa.relname,
                'source_column_name', sa.attname,
                'target_table_schema', nta.nspname,
                'target_table_name', cta.relname,
                'target_column_name', ta.attname
            ) as rel_info
        from pg_constraint c
        join pg_class csa on c.conrelid = csa.oid
        join pg_namespace nsa on csa.relnamespace = nsa.oid
        join pg_attribute sa on (sa.attrelid = c.conrelid and sa.attnum = any(c.conkey))
        join pg_class cta on c.confrelid = cta.oid
        join pg_namespace nta on cta.relnamespace = nta.oid
        join pg_attribute ta on (ta.attrelid = c.confrelid and ta.attnum = any(c.confkey))
        where c.contype = 'f'
    ),
    columns as (
        select
            a.attrelid as table_id,
            jsonb_agg(jsonb_build_object(
                'id', (a.attrelid || '.' || a.attnum),
                'table_id', c.oid::int8,
                'schema', nc.nspname,
                'table', c.relname,
                'ordinal_position', a.attnum,
                'name', a.attname,
                'default_value', case
                    when a.atthasdef then pg_get_expr(ad.adbin, ad.adrelid)
                    else null
                end,
                'data_type', case
                    when t.typtype = 'd' then
                        case
                            when bt.typelem <> 0::oid and bt.typlen = -1 then 'ARRAY'
                            when nbt.nspname = 'pg_catalog' then format_type(t.typbasetype, null)
                            else 'USER-DEFINED'
                        end
                    else
                        case
                            when t.typelem <> 0::oid and t.typlen = -1 then 'ARRAY'
                            when nt.nspname = 'pg_catalog' then format_type(a.atttypid, null)
                            else 'USER-DEFINED'
                        end
                end,
                'format', case
                    when t.typtype = 'e' then
                        case
                            when nt.nspname <> 'public' then concat(nt.nspname, '.', coalesce(bt.typname, t.typname))
                            else coalesce(bt.typname, t.typname)
                        end
                    else
                        coalesce(bt.typname, t.typname)
                end,
                'is_identity', a.attidentity in ('a', 'd'),
                'identity_generation', case a.attidentity
                    when 'a' then 'ALWAYS'
                    when 'd' then 'BY DEFAULT'
                    else null
                end,
                'is_generated', a.attgenerated in ('s'),
                'is_nullable', not (a.attnotnull or t.typtype = 'd' and t.typnotnull),
                'is_updatable', (
                    b.relkind in ('r', 'p') or
                    (b.relkind in ('v', 'f') and pg_column_is_updatable(b.id, a.attnum, false))
                ),
                'is_unique', uniques.table_id is not null,
                'check', check_constraints.definition,
                'comment', col_description(c.oid, a.attnum),
                'enums', coalesce(
                    (
                        select jsonb_agg(e.enumlabel order by e.enumsortorder)
                        from pg_catalog.pg_enum e
                        where e.enumtypid = coalesce(bt.oid, t.oid)
                            or e.enumtypid = coalesce(bt.typelem, t.typelem)
                    ),
                    '[]'::jsonb
                )
            ) order by a.attnum) as columns
        from pg_attribute a
        join base_table_info b on a.attrelid = b.id
        join pg_class c on a.attrelid = c.oid
        join pg_namespace nc on c.relnamespace = nc.oid
        left join pg_attrdef ad on (a.attrelid = ad.adrelid and a.attnum = ad.adnum)
        join pg_type t on a.atttypid = t.oid
        join pg_namespace nt on t.typnamespace = nt.oid
        left join pg_type bt on (t.typtype = 'd' and t.typbasetype = bt.oid)
        left join pg_namespace nbt on bt.typnamespace = nbt.oid
        left join (
            select
                conrelid as table_id,
                conkey[1] as ordinal_position
            from pg_catalog.pg_constraint
            where contype = 'u' and cardinality(conkey) = 1
            group by conrelid, conkey[1]
        ) as uniques on uniques.table_id = a.attrelid and uniques.ordinal_position = a.attnum
        left join (
            select distinct on (conrelid, conkey[1])
                conrelid as table_id,
                conkey[1] as ordinal_position,
                substring(
                    pg_get_constraintdef(oid, true),
                    8,
                    length(pg_get_constraintdef(oid, true)) - 8
                ) as definition
            from pg_constraint
            where contype = 'c' and cardinality(conkey) = 1
            order by conrelid, conkey[1], oid asc
        ) as check_constraints on check_constraints.table_id = a.attrelid
                            and check_constraints.ordinal_position = a.attnum
        where a.attnum > 0
        and not a.attisdropped
        group by a.attrelid
    )
    select
        case b.relkind
            when 'r' then jsonb_build_object(
                'entity_type', b.relkind,
                'id', b.id,
                'schema', b.schema,
                'name', b.name,
                'rls_enabled', b.rls_enabled,
                'rls_forced', b.rls_forced,
                'replica_identity', ts.replica_identity,
                'bytes', ts.bytes,
                'size', ts.size,
                'live_rows_estimate', ts.live_rows_estimate,
                'dead_rows_estimate', ts.dead_rows_estimate,
                'comment', b.comment,
                'primary_keys', coalesce(pk.primary_keys, '[]'::jsonb),
                'unique_indexes', coalesce(ui.unique_indexes, '[]'::jsonb),
                'relationships', coalesce(
                    (select jsonb_agg(r.rel_info)
                    from relationships r
                    where r.source_id = b.id or r.target_id = b.id),
                    '[]'::jsonb
                ),
                'columns', coalesce(c.columns, '[]'::jsonb)
            )
            when 'p' then jsonb_build_object(
                'entity_type', b.relkind,
                'id', b.id,
                'schema', b.schema,
                'name', b.name,
                'rls_enabled', b.rls_enabled,
                'rls_forced', b.rls_forced,
                'replica_identity', ts.replica_identity,
                'bytes', ts.bytes,
                'size', ts.size,
                'live_rows_estimate', ts.live_rows_estimate,
                'dead_rows_estimate', ts.dead_rows_estimate,
                'comment', b.comment,
                'primary_keys', coalesce(pk.primary_keys, '[]'::jsonb),
                'unique_indexes', coalesce(ui.unique_indexes, '[]'::jsonb),
                'relationships', coalesce(
                    (select jsonb_agg(r.rel_info)
                    from relationships r
                    where r.source_id = b.id or r.target_id = b.id),
                    '[]'::jsonb
                ),
                'columns', coalesce(c.columns, '[]'::jsonb)
            )
            when 'v' then jsonb_build_object(
                'entity_type', b.relkind,
                'id', b.id,
                'schema', b.schema,
                'name', b.name,
                'is_updatable', (pg_relation_is_updatable(b.id, false) & 20) = 20,
                'comment', b.comment,
                'columns', coalesce(c.columns, '[]'::jsonb)
            )
            when 'm' then jsonb_build_object(
                'entity_type', b.relkind,
                'id', b.id,
                'schema', b.schema,
                'name', b.name,
                'is_populated', true,
                'comment', b.comment,
                'columns', coalesce(c.columns, '[]'::jsonb)
            )
            when 'f' then jsonb_build_object(
                'entity_type', b.relkind,
                'id', b.id,
                'schema', b.schema,
                'name', b.name,
                'comment', b.comment,
                'foreign_server_name', b.foreign_server_name,
                'foreign_data_wrapper_name', b.foreign_data_wrapper_name,
                'foreign_data_wrapper_handler', b.foreign_data_wrapper_handler,
                'columns', coalesce(c.columns, '[]'::jsonb)
            )
        end as entity
    from base_table_info b
    left join table_stats ts on b.id = ts.id
    left join primary_keys pk on b.id = pk.table_id
    left join unique_indexes ui on b.id = ui.table_id
    left join columns c on b.id = c.table_id;
  `):"",{result:o}=await (0,s.executeSql)({projectRef:e,connectionString:t,sql:i,queryKey:["table-editor",a]},r);return o[0]?.entity??null}function i(e,{projectRef:t,connectionString:s,id:n}){return e.fetchQuery({queryKey:a.tableEditorKeys.tableEditor(t,n),queryFn:({signal:e})=>r({projectRef:t,connectionString:s,id:n},e)})}e.s(["getTableEditor",()=>r,"prefetchTableEditor",()=>i,"useTableEditorQuery",0,({projectRef:e,connectionString:s,id:n},{enabled:i=!0,...o}={})=>(0,t.useQuery)({queryKey:a.tableEditorKeys.tableEditor(e,n),queryFn:({signal:t})=>r({projectRef:e,connectionString:s,id:n},t),enabled:i&&void 0!==e&&void 0!==n&&!isNaN(n),refetchOnWindowFocus:!1,refetchOnMount:!1,staleTime:3e5,...o})],415190)},102631,e=>{"use strict";e.s(["generatePolicyUpdateSQL",0,e=>{let t="";return null!==e.definition&&void 0!==e.definition&&(t+=`using (${e.definition})${null===e.check||void 0===e.check?";":""}
`),null!==e.check&&void 0!==e.check&&(t+=`with check (${e.check});
`),`
alter policy "${e.name}" 
on "${e.schema}"."${e.table}"
to ${e.roles.join(", ")}
${t}
`.trim()}])},302372,e=>{"use strict";var t=e.i(242882),s=e.i(248593),a=e.i(234745),n=e.i(635494);e.i(10429);var r=e.i(837508),i=e.i(509847);async function o({projectRef:e,connectionString:t,schema:n},r,i){if(!e)throw Error("projectRef is required");let o=new Headers(i);t&&o.set("x-connection-encrypted",t);let{data:l,error:c}=await (0,a.get)("/platform/pg-meta/{ref}/policies",{params:{header:{"x-connection-encrypted":t,"x-pg-application-name":s.DEFAULT_PLATFORM_APPLICATION_NAME},path:{ref:e},query:{included_schemas:n||"",excluded_schemas:""}},headers:o,signal:r});return c&&(0,a.handleError)(c),l}e.s(["useDatabasePoliciesQuery",0,({projectRef:e,connectionString:s,schema:a},{enabled:l=!0,...c}={})=>{let{data:d}=(0,n.useSelectedProjectQuery)(),u=d?.status===r.PROJECT_STATUS.ACTIVE_HEALTHY;return(0,t.useQuery)({queryKey:i.databasePoliciesKeys.list(e,a),queryFn:({signal:t})=>o({projectRef:e,connectionString:s,schema:a},t),enabled:l&&void 0!==e&&u,...c})}])},938343,e=>{"use strict";e.s(["tableEditorKeys",0,{tableEditor:(e,t)=>["projects",e,"table-editor",t].filter(Boolean)}])},847278,e=>{"use strict";var t=e.i(755216),s=e.i(38429),a=e.i(356003),n=e.i(355901),r=e.i(915993),i=e.i(714403),o=e.i(938343),l=e.i(138658);async function c({projectRef:e,connectionString:s,id:a,name:n,schema:r,payload:o}){let{sql:l}=t.default.tables.update({id:a,name:n,schema:r},o),{result:c}=await (0,i.executeSql)({projectRef:e,connectionString:s,sql:l,queryKey:["table","update",a]});return c}e.s(["updateTable",()=>c,"useTableUpdateMutation",0,({onSuccess:e,onError:t,...i}={})=>{let d=(0,a.useQueryClient)();return(0,s.useMutation)({mutationFn:e=>c(e),async onSuccess(t,s,a){let{projectRef:n,schema:i,id:c}=s;await Promise.all([d.invalidateQueries({queryKey:o.tableEditorKeys.tableEditor(n,c)}),d.invalidateQueries({queryKey:l.tableKeys.list(n,i)}),d.invalidateQueries({queryKey:r.lintKeys.lint(n)})]),await e?.(t,s,a)},async onError(e,s,a){void 0===t?n.toast.error(`Failed to update database table: ${e.message}`):t(e,s,a)},...i})}])},790819,e=>{"use strict";e.s(["tableRowKeys",0,{tableRows:(e,{table:t,roleImpersonationState:s,...a}={})=>["projects",e,"table-rows",t?.id,"rows",{roleImpersonation:s?.role,...a}],tableRowsCount:(e,{table:t,...s}={})=>["projects",e,"table-rows",t?.id,"count",s],tableRowsAndCount:(e,t)=>["projects",e,"table-rows",t]}])},310959,e=>{"use strict";var t=e.i(479084),s=e.i(977540);let a=10240,n=50,r=["text","varchar","char","character varying","character"],i=["json","jsonb"],o=new Set(i),l=new Set([...r,...i,"bytea","xml","hstore","clob","vector","geometry","geography","tsvector","tsquery","daterange","tsrange","tstzrange","numrange","int4range","int8range","cube","ltree","lquery","jsonpath","citext"]);e.s(["MAX_ARRAY_SIZE",0,n,"MAX_CHARACTERS",0,a,"THRESHOLD_COUNT",0,1e5,"getTableRowsSql",0,({table:e,filters:i=[],sorts:c=[],page:d,limit:u,maxCharacters:m=a,maxArraySize:p=n,sortExcludedColumns:h=[]})=>{if(!e||!e.columns)return"";let _=new s.Query().from(e.name,e.schema).select();i.forEach(t=>{let s=e.columns?.find(e=>e.name===t.column),a=!s||r.includes(s.format);_=_.filter(t.column,t.operator,a||""!==t.value?t.value:null)});let f=e.live_rows_estimate||0;if(0===c.length&&f<=1e5&&e.columns.length>0){let t=((e,{excludedColumns:t=[]}={})=>{let s=e.primary_keys?.map(e=>e.name);if(s&&s.length>0&&!s.every(e=>t.includes(e)))return s;if(e.columns&&e.columns.length>0){let s=e.columns.filter(e=>!e.data_type.includes("json")&&!t.includes(e.name));if(s.length>0)return[s[0].name]}return[]})(e,{excludedColumns:h});t.length>0&&t.forEach(t=>{_=_.order(e.name,t)})}else c.forEach(e=>{_=_.order(e.table,e.column,e.ascending,e.nullsFirst)});let{from:g,to:x}=function(e,t=100){let s=e?e*t:0;return{from:s,to:e?s+t-1:t-1}}((d??1)-1,u),y=`with _base_query as (${_.range(g,x).toSql({isCTE:!1,isFinal:!1})})`,b=e.columns.sort((e,t)=>e.ordinal_position-t.ordinal_position).map(e=>({name:e.name,format:e.format.toLowerCase()})),v=e.columns.filter(e=>{let t;return t=e.format,l.has(t.toLowerCase())}).map(e=>e.name),j=b.map(({name:e})=>{let s=(0,t.ident)(e);return v.includes(e)?`case
        when octet_length(${s}::text) > ${m} 
        then left(${s}::text, ${m}) || '...'
        else ${s}::text
      end as ${s}`:s});e.columns.filter(e=>"array"===e.data_type.toLowerCase()).map(e=>({name:e.name,format:e.format.toLowerCase().slice(1)})).forEach(({name:e,format:s})=>{let a=j.findIndex(s=>s===(0,t.ident)(e)),n=o.has(s)?`${s}[]`:"text[]";a>=0&&(j[a]=`
        case 
          when octet_length(${(0,t.ident)(e)}::text) > ${m} 
          then
            case
              when array_ndims(${(0,t.ident)(e)}) = 1
              then
                (select array_cat(${(0,t.ident)(e)}[1:${p}]::${n}, ${"text[]"===n?"array['...']":"array['{\"truncated\": true}'::json]"}::${n}))::${n}
              else
                ${(0,t.ident)(e)}[1:${p}]::${n}
            end
          else ${(0,t.ident)(e)}::${n}
        end
      `)});let w=j.join(","),S=new s.Query().from("_base_query").select(w);return`${y}
  ${S.toSql({isCTE:!0,isFinal:!0})}`}])},46974,585673,e=>{"use strict";let t=["smallint","integer","bigint","decimal","numeric","real","double precision","serial","bigserial","int2","int4","int8","float4","float8","smallserial","serial2","serial4","serial8"];function s(e){return t.indexOf(e.toLowerCase())>-1}let a=["json","jsonb","array"];function n(e){return a.indexOf(e.toLowerCase())>-1}let r=["array"];function i(e){return r.indexOf(e.toLowerCase())>-1}let o=["uuid","text","character varying"];function l(e){return o.indexOf(e.toLowerCase())>-1}let c=["citext"];function d(e){return c.indexOf(e.toLowerCase())>-1}let u=["timestamp","timestamptz"];function m(e){return u.indexOf(e.toLowerCase())>-1}let p=["date"];function h(e){return p.indexOf(e.toLowerCase())>-1}let _=["time","timetz"];function f(e){return _.indexOf(e.toLowerCase())>-1}let g=["boolean","bool"];function x(e){return g.indexOf(e.toLowerCase())>-1}let y=["user-defined"];function b(e){return y.indexOf(e.toLowerCase())>-1}let v=["bytea"];function j(e){return v.indexOf(e.toLowerCase())>-1}function w(e){let{targetTableSchema:t,targetTableName:s,targetColumnName:a}=e?.foreignKey??{};return!!t&&!!s&&!!a}e.s(["isArrayColumn",()=>i,"isBinaryColumn",()=>j,"isBoolColumn",()=>x,"isCiTextColumn",()=>d,"isDateColumn",()=>h,"isDateTimeColumn",()=>m,"isEnumColumn",()=>b,"isForeignKeyColumn",()=>w,"isJsonColumn",()=>n,"isNumericalColumn",()=>s,"isTextColumn",()=>l,"isTimeColumn",()=>f],585673);var S=e.i(962217);function E(e,t){let a=e.columns.find(e=>e.name==t.column);if(a&&s(a.format)){let e=Number(t.value);if(!Number.isNaN(e)&&!(e>Number.MAX_SAFE_INTEGER))return Number(t.value)}return t.value}function N({table:e}){if(!(0,S.isTableLike)(e))return{error:{message:"Only table rows can be updated or deleted"}};let t=e.primary_keys;return t&&0!=t.length?{primaryKeys:t.map(e=>e.name)}:{error:{message:"Please add a primary key column to your table to update or delete rows"}}}e.s(["formatFilterValue",()=>E,"getPrimaryKeys",()=>N],46974)},941381,70756,e=>{"use strict";var t=e.i(478902),s=e.i(356003),a=e.i(898452),n=e.i(389959),r=e.i(19583),i=e.i(415190);e.i(967533);var o=e.i(977540),l=e.i(310959),c=e.i(242882);e.i(128328);var d=e.i(86086),u=e.i(311827),m=e.i(962217),p=e.i(908937),h=e.i(201461);e.i(56031);var _=e.i(237948),f=e.i(714403),g=e.i(790819),x=e.i(46974);async function y(e){return new Promise(t=>setTimeout(t,e))}async function b(e,t=3,s=1e3){for(let a=0;a<=t;a++)try{return await e()}catch(e){if(429===(e instanceof _.ResponseError?e.code:e.status)&&a<t){let t=function(e){if(e instanceof _.ResponseError)return e.retryAfter;let t=e.headers?.get("retry-after");if(t)return parseInt(t)}(e),n=t?1e3*t:s*Math.pow(2,a);await y(n);continue}throw e}throw Error("Max retries reached without success")}let v=({table:e,filters:t=[],sorts:s=[]})=>{let a,n,r,i,l,c=new o.Query,d=e.columns.filter(e=>(e?.enum??[]).length>0&&"array"===e.dataType.toLowerCase()).map(e=>`"${e.name}"::text[]`),m=c.from(e.name,e.schema??void 0).select(d.length>0?`*,${d.join(",")}`:"*");t.filter(e=>e.value&&""!==e.value).forEach(t=>{let s=(0,x.formatFilterValue)(e,t);m=m.filter(t.column,t.operator,s)});let p=!1,{cursorPaginationEligible:h,cursorPaginationNonEligible:_}=(a=[],n=[],(r=e.primaryKey)&&a.push(r),i=e.uniqueIndexes,(l=i?.filter(t=>t.every(t=>{let s=e.columns.find(e=>e.name===t);return!!s&&!s.isNullable})))&&a.push(...l),n.push(...e.columns.filter(e=>!e.dataType.includes("json")).map(e=>e.name)),{cursorPaginationEligible:a,cursorPaginationNonEligible:n}),f=e.type===u.ENTITY_TYPE.TABLE||e.type===u.ENTITY_TYPE.PARTITIONED_TABLE||e.type===u.ENTITY_TYPE.MATERIALIZED_VIEW;if(0===s.length)h.length>0?(p=h[0],h[0].forEach(t=>{m=m.order(e.name,t)})):(_.length>0&&(m=m.order(e.name,_[0])),f&&(m=m.order(e.name,"ctid")));else{s.forEach(e=>{m=m.order(e.table,e.column,e.ascending,e.nullsFirst)});let t=h[0];if(t){let a=new Set(s.filter(t=>t.table===e.name).map(e=>e.column));t.filter(e=>!a.has(e)).forEach(t=>{m=m.order(e.name,t)})}else f&&(m=m.order(e.name,"ctid"))}return{sql:m,cursorColumns:p}},j=async({projectRef:e,connectionString:t,table:s,filters:a=[],sorts:n=[],roleImpersonationState:r,progressCallback:i})=>{if(d.IS_PLATFORM&&!t)return console.error("Connection string is required"),[];let o=[],{sql:l,cursorColumns:c}=v({table:s,sorts:n,filters:a});if(c){let s=null;for(;;){let a=l.clone();s&&(a=a.filter(c,">",c.map(e=>s[e])));let n=(0,p.wrapWithRoleImpersonation)(a.range(0,499).toSql(),r);try{let{result:a}=await b(async()=>(0,f.executeSql)({projectRef:e,connectionString:t,sql:n}));for(let e of(o.push(...a),i?.(o.length),s={},c))s[e]=a[a.length-1]?.[e];if(a.length<500)break;await y(500)}catch(e){throw Error(`Error fetching all table rows: ${e instanceof Error?e.message:"Unknown error"}`)}}}else{let s=-1;for(;;){let a=500*(s+=1),n=(s+1)*500-1,c=(0,p.wrapWithRoleImpersonation)(l.range(a,n).toSql(),r);try{let{result:s}=await b(async()=>(0,f.executeSql)({projectRef:e,connectionString:t,sql:c}));if(o.push(...s),i?.(o.length),s.length<500)break;await y(500)}catch(e){throw Error(`Error fetching all table rows: ${e instanceof Error?e.message:"Unknown error"}`)}}}return o.filter(e=>1!==e[p.ROLE_IMPERSONATION_NO_RESULTS])};async function w({queryClient:e,projectRef:t,connectionString:s,tableId:a,roleImpersonationState:n,filters:o,sorts:c,limit:d,page:u},_){let g=await (0,i.prefetchTableEditor)(e,{projectRef:t,connectionString:s,id:a});if(!g)throw Error("Table not found");let x=(0,r.parseSupaTable)(g),y=o?.filter(e=>"="===e.operator||"is"===e.operator).flatMap(e=>e.column),b=(0,m.isMsSqlForeignTable)(g)?Array.from(new Set(y)):void 0,v=(0,p.wrapWithRoleImpersonation)((0,l.getTableRowsSql)({table:g,filters:o,sorts:c,limit:d,page:u,sortExcludedColumns:b}),n);try{let{result:e}=await (0,f.executeSql)({projectRef:t,connectionString:s,sql:v,queryKey:["table-rows",x?.id],isRoleImpersonationEnabled:(0,h.isRoleImpersonationEnabled)(n?.role)},_);return{rows:e.map((e,t)=>({idx:t,...e}))}}catch(e){throw Error(e instanceof Error?e.message:"Unknown error")}}function S(e,{projectRef:t,connectionString:s,tableId:a,...n}){return e.fetchQuery({queryKey:g.tableRowKeys.tableRows(t,{table:{id:a},...n}),queryFn:({signal:r})=>w({queryClient:e,projectRef:t,connectionString:s,tableId:a,...n},r)})}e.s(["executeWithRetry",()=>b,"fetchAllTableRows",0,j,"getAllTableRowsSql",0,v,"prefetchTableRows",()=>S,"useTableRowsQuery",0,({projectRef:e,connectionString:t,tableId:a,...n},{enabled:r=!0,...i}={})=>{let o=(0,s.useQueryClient)();return(0,c.useQuery)({queryKey:g.tableRowKeys.tableRows(e,{table:{id:a},...n}),queryFn:({signal:s})=>w({queryClient:o,projectRef:e,connectionString:t,tableId:a,...n},s),enabled:r&&void 0!==e&&void 0!==a,...i})}],70756);var E=e.i(635494),N=e.i(636047),T=e.i(85626);function A({queryClient:e,projectRef:t,connectionString:s,id:a,sorts:n,filters:o,roleImpersonationState:l}){return(0,i.prefetchTableEditor)(e,{projectRef:t,connectionString:s,id:a}).then(i=>{if(i){let c=(0,r.parseSupaTable)(i),{sorts:d=[],filters:u=[]}=(0,r.loadTableEditorStateFromLocalStorage)(t,i.name,i.schema)??{};S(e,{projectRef:t,connectionString:s,tableId:a,sorts:n??(0,r.formatSortURLParams)(c.name,d),filters:o??(0,r.formatFilterURLParams)(u),page:1,limit:N.TABLE_EDITOR_DEFAULT_ROWS_PER_PAGE,roleImpersonationState:l})}})}function q(){let e=(0,a.useRouter)(),t=(0,s.useQueryClient)(),{data:r}=(0,E.useSelectedProjectQuery)(),i=(0,h.useRoleImpersonationStateSnapshot)();return(0,n.useCallback)(({id:s,filters:a,sorts:n})=>{let o=s?Number(s):void 0;!r||!o||isNaN(o)||(e.prefetch(`/project/${r.ref}/editor/${o}`),A({queryClient:t,projectRef:r.ref,connectionString:r.connectionString,id:o,sorts:n,filters:a,roleImpersonationState:i}).catch(()=>{}))},[r,t,i,e])}function C({projectRef:e,id:s,sorts:a,filters:n,href:r,children:i,...o}){let l=q();return(0,t.jsx)(T.default,{href:r||`/project/${e}/editor/${s}`,prefetcher:()=>l({id:s,sorts:a,filters:n}),...o,children:i})}e.s(["EditorTablePageLink",()=>C,"prefetchEditorTablePage",()=>A,"usePrefetchEditorTablePage",()=>q],941381)}]);

//# debugId=18d32dc4-2904-7a63-57fd-dbcb8e5c8065
//# sourceMappingURL=e51901634ed6f241.js.map