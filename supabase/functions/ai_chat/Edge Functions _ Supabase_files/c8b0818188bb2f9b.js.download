;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="fef1ec97-085b-9aa5-f3d7-d04b2a321291")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,223600,e=>{"use strict";var t=e.i(478902),r=e.i(370410),a=e.i(816467),n=e.i(389959),l=e.i(837710),s=e.i(843778),o=e.i(375761);let i=(0,n.forwardRef)(({text:e,asyncText:i,iconOnly:c=!1,children:u,onClick:d,copyLabel:p="Copy",copiedLabel:h="Copied",...m},f)=>{let[g,x]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{if(!g)return;let e=setTimeout(()=>x(!1),2e3);return()=>clearTimeout(e)},[g]),(0,t.jsx)(l.Button,{ref:f,onClick:async t=>{let r=i?await i():e;x(!0),(0,o.copyToClipboard)(r),d?.(t)},...m,className:(0,s.cn)({"px-1":c},m.className),icon:g?(0,t.jsx)(r.Check,{strokeWidth:2,className:"text-brand"}):m.icon??(0,t.jsx)(a.Copy,{}),children:!c&&(0,t.jsx)(t.Fragment,{children:u??(g?h:p)})})});i.displayName="CopyButton",e.s(["default",0,i])},40892,e=>{"use strict";var t=e.i(478902),r=e.i(389959),a=e.i(843778),n=e.i(837710),l=e.i(253214);let s=(0,r.forwardRef)(({children:e,customFooter:s,description:o,hideFooter:i=!1,alignFooter:c="left",layout:u="horizontal",loading:d=!1,cancelText:p="Cancel",onConfirm:h=()=>{},onCancel:m=()=>{},confirmText:f="Confirm",showCloseButton:g=!0,footerBackground:x,variant:y="success",visible:v=!1,size:j="large",style:b,overlayStyle:S,contentStyle:C,triggerElement:N,header:w,modal:k,defaultOpen:O,...E},T)=>{let[I,_]=r.default.useState(!!v&&v);(0,r.useEffect)(()=>{_(v)},[v]);let D=s||(0,t.jsxs)("div",{className:"flex w-full space-x-2",style:{width:"100%",justifyContent:"vertical"===u?"center":"right"===c?"flex-end":"flex-start"},children:[(0,t.jsx)(n.Button,{type:"default",onClick:m,disabled:d,children:p}),(0,t.jsx)(n.Button,{onClick:h,disabled:d,loading:d,type:"danger"===y?"danger":"warning"===y?"warning":"primary",children:f})]});return(0,t.jsxs)(l.Dialog,{open:I,defaultOpen:O,onOpenChange:function(e){void 0===v||e?_(e):m()},modal:k,children:[N&&(0,t.jsx)(l.DialogTrigger,{children:N}),(0,t.jsxs)(l.DialogContent,{ref:T,hideClose:!g,...E,size:j,children:[w||o?(0,t.jsxs)(l.DialogHeader,{className:(0,a.cn)("border-b"),padding:"small",children:[w&&(0,t.jsx)(l.DialogTitle,{children:w}),o&&(0,t.jsx)(l.DialogDescription,{children:o})]}):null,e,!i&&(0,t.jsx)(l.DialogFooter,{padding:"small",children:D})]})]})}),o=(0,r.forwardRef)(({...e},r)=>(0,t.jsx)(l.DialogSection,{ref:r,...e,padding:"small",className:(0,a.cn)(e.className)})),i=(0,r.forwardRef)(({...e},r)=>(0,t.jsx)(l.DialogSectionSeparator,{ref:r,...e}));s.Content=o,s.Separator=i,e.s(["Modal",0,s],40892)},61187,e=>{"use strict";let t=(0,e.i(388019).default)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>t],61187)},520124,e=>{"use strict";var t=e.i(460988),r=e.i(389959);e.s(["useFillTimeseriesSorted",0,(...e)=>(0,r.useMemo)(()=>{let[r,a]=e;if(!r[0]?.[a])return{data:r,error:void 0,isError:!1};try{return{data:(0,t.fillTimeseries)(...e).sort((t,r)=>new Date(t[e[1]])-new Date(r[e[1]])),error:void 0,isError:!1}}catch(e){return{data:[],error:e,isError:!0}}},[JSON.stringify(e[0]),...e])])},330287,e=>{"use strict";var t=e.i(242882),r=e.i(234745),a=e.i(10429),n=e.i(346691);async function l({projectRef:e},t){if(!e)throw Error("Project ref is required");let{data:a,error:n}=await (0,r.get)("/platform/projects/{ref}/load-balancers",{params:{path:{ref:e}},signal:t});return n&&(0,r.handleError)(n),a}e.s(["useLoadBalancersQuery",0,({projectRef:e},{enabled:r=!0,...s}={})=>(0,t.useQuery)({queryKey:n.replicaKeys.loadBalancers(e),queryFn:({signal:t})=>l({projectRef:e},t),enabled:r&&void 0!==e&&a.IS_PLATFORM,...s})])},595127,e=>{"use strict";let t=(0,e.i(388019).default)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);e.s(["default",()=>t])},748356,e=>{"use strict";var t=e.i(478902),r=e.i(55956),a=e.i(613851),n=e.i(595127),n=n,l=e.i(389959),s=e.i(587433),o=e.i(737018),i=e.i(192451),c=e.i(215312),u=e.i(841183),d=e.i(280590),p=e.i(837710),h=e.i(299863),m=e.i(793912),f=e.i(135144),g=e.i(689805),x=e.i(843778),y=e.i(375761),v=e.i(993394);e.s(["LogsDatePicker",0,({onSubmit:e,helpers:j,value:b,buttonTriggerProps:S,popoverContentProps:C,hideWarnings:N,align:w="end"})=>{let[k,O]=(0,l.useState)(!1);(0,l.useEffect)(()=>{if(!k){T(b.from?new Date(b.from):null);let e=b.to?new Date(b.to):new Date;_(e),L(new Date(e));let t=b.from?new Date(b.from):null,r=b.to?new Date(b.to):null;M({HH:t?.getHours().toString().padStart(2,"0")||"00",mm:t?.getMinutes().toString().padStart(2,"0")||"00",ss:t?.getSeconds().toString().padStart(2,"0")||"00"});let a=new Date,n=a.getHours().toString().padStart(2,"0"),l=a.getMinutes().toString().padStart(2,"0"),s=a.getSeconds().toString().padStart(2,"0");F({HH:r?.getHours().toString().padStart(2,"0")||n,mm:r?.getMinutes().toString().padStart(2,"0")||l,ss:r?.getSeconds().toString().padStart(2,"0")||s})}},[k,b]);let[E,T]=(0,l.useState)(b.from?new Date(b.from):null),[I,_]=(0,l.useState)(b.to?new Date(b.to):new Date),[D,L]=(0,l.useState)(()=>b.to?new Date(b.to):new Date),[R,M]=(0,l.useState)({HH:E?.getHours().toString()||"00",mm:E?.getMinutes().toString()||"00",ss:E?.getSeconds().toString()||"00"}),[A,F]=(0,l.useState)({HH:I?.getHours().toString()||"23",mm:I?.getMinutes().toString()||"59",ss:I?.getSeconds().toString()||"59"}),[P,H]=(0,l.useState)(!1),[$,B]=(0,l.useState)(!1);function q(){navigator.clipboard.readText().then(e=>{try{let t=JSON.parse(e);if(!t.from||!t.to)return void console.warn("Invalid date range format in clipboard");let r=new Date(t.from),a=new Date(t.to);if(isNaN(r.getTime())||isNaN(a.getTime()))return void console.warn("Invalid date values in clipboard");T(r),_(a),L(new Date(a)),M({HH:r.getHours().toString(),mm:r.getMinutes().toString(),ss:r.getSeconds().toString()}),F({HH:a.getHours().toString(),mm:a.getMinutes().toString(),ss:a.getSeconds().toString()}),B(!0)}catch(e){console.warn("Failed to parse clipboard content as date range:",e)}}).catch(e=>{console.warn("Failed to read clipboard:",e)})}(0,l.useEffect)(()=>{P&&setTimeout(()=>{H(!1)},2e3)},[P]);let U=(0,l.useCallback)(()=>{if(!E||!I)return;let e=new Date(E),t=new Date(I);e.setHours(+R.HH,+R.mm,+R.ss),t.setHours(+A.HH,+A.mm,+A.ss),(0,y.copyToClipboard)(JSON.stringify({from:e.toISOString(),to:t.toISOString()})),H(!0)},[E,I,R,A]);(0,l.useEffect)(()=>{$&&setTimeout(()=>{B(!1)},2e3)},[$]),(0,l.useEffect)(()=>(k&&(document.addEventListener("paste",q),document.addEventListener("copy",U)),()=>{document.removeEventListener("paste",q),document.removeEventListener("copy",U)}),[k,E,I,U]);let z=Math.abs((0,r.default)(E).diff((0,r.default)(I),"days"))>v.LOGS_LARGE_DATE_RANGE_DAYS_THRESHOLD-1,{getEntitlementNumericValue:K}=(0,d.useCheckEntitlements)("log.retention_days"),W=K();return(0,t.jsxs)(g.Popover_Shadcn_,{open:k,onOpenChange:O,children:[(0,t.jsx)(f.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(p.Button,{type:"default",icon:(0,t.jsx)(a.Clock,{size:12}),...S,children:b.isHelper?b.text:`${(0,r.default)(b.from).format("DD MMM, HH:mm")} - ${(0,r.default)(b.to||new Date).format("DD MMM, HH:mm")}`})}),(0,t.jsxs)(m.PopoverContent_Shadcn_,{className:"flex w-full p-0",side:"bottom",align:w,portal:!0,...C,children:[(0,t.jsx)(i.RadioGroup,{onValueChange:t=>{let r=j.find(e=>e.text===t);e&&r&&e({to:r.calcTo(),from:r.calcFrom(),isHelper:!0,text:r.text}),O(!1)},value:b.isHelper?b.text:"",className:"border-r p-2 flex flex-col gap-px",children:j.map(e=>(0,t.jsxs)(o.Label,{className:(0,x.cn)("[&:has([data-state=checked])]:bg-background-overlay-hover [&:has([data-state=checked])]:text-foreground px-4 py-1.5 text-foreground-light flex items-center gap-2 hover:bg-background-overlay-hover hover:text-foreground transition-all rounded-sm text-xs w-full",{"cursor-not-allowed pointer-events-none opacity-50":e.disabled}),children:[(0,t.jsx)(i.RadioGroupItem,{hidden:!0,value:e.text,disabled:e.disabled,"aria-disabled":e.disabled},e.text),e.text,!(!e||!e.availableIn?.length||!W||Math.abs((0,r.default)().diff((0,r.default)(e.calcFrom()),"day"))<=W)&&1?(0,t.jsx)(s.Badge,{children:e.availableIn?.[0]||""}):null]},e.text))}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex p-2 gap-2 items-center",children:[(0,t.jsxs)("div",{className:"flex flex-grow *:flex-grow gap-2 font-mono",children:[(0,t.jsx)(u.TimeSplitInput,{type:"start",startTime:R,endTime:A,time:R,setTime:M,setStartTime:M,setEndTime:F,startDate:E,endDate:I}),(0,t.jsx)(u.TimeSplitInput,{type:"end",startTime:R,endTime:A,time:A,setTime:F,setStartTime:M,setEndTime:F,startDate:E,endDate:I})]}),(0,t.jsx)("div",{className:"flex-shrink",children:(0,t.jsx)(c.ButtonTooltip,{tooltip:{content:{text:"Clear time range"}},icon:(0,t.jsx)(n.default,{size:14}),type:"text",size:"tiny",className:"px-1.5",onClick:()=>{M({HH:"00",mm:"00",ss:"00"}),F({HH:"00",mm:"00",ss:"00"})}})})]}),(0,t.jsx)("div",{className:"p-2 border-t",children:(0,t.jsx)(h.Calendar,{mode:"range",month:D,onMonthChange:e=>L(new Date(e)),selected:{from:E??void 0,to:I??void 0},onSelect:e=>{!function(e){let[t,r]=e;T(t),_(r)}([e?.from??null,e?.to??null])}})}),z&&!N&&(0,t.jsxs)("div",{className:"text-xs px-3 py-1.5 border-y bg-warning-300 text-warning-foreground border-warning-500 text-warning",children:["Large ranges may result in memory errors for ",(0,t.jsx)("br",{})," big projects."]}),(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2 p-2 border-t",children:[E&&I?(0,t.jsx)(p.Button,{type:"text",size:"tiny",onClick:U,className:(0,x.cn)({"text-brand-600":P||$}),children:P?"Copied!":$?"Pasted!":"Copy range"}):null,(0,t.jsx)(p.Button,{type:"default",onClick:()=>{let e=new Date;L(e),T(new Date(e)),_(new Date(e))},children:"Today"}),(0,t.jsx)(p.Button,{onClick:function(){let t=E||new Date,r=I||new Date,a=new Date(t.setHours(+R.HH,+R.mm,+R.ss)),n=new Date(r.setHours(+A.HH,+A.mm,+A.ss));e({from:a.toISOString(),to:n.toISOString(),isHelper:!1}),O(!1)},children:"Apply"})]})]})]})]})}],748356)},979377,e=>{"use strict";var t=e.i(478902),r=e.i(215261),a=e.i(265735),n=e.i(837710),l=e.i(40892),s=e.i(993394);e.s(["default",0,({show:e,setShowUpgradePrompt:o,title:i="Log retention",description:c="Logs can be retained up to a duration of 3 months depending on the plan that your project is on.",source:u="logsRetentionUpgradePrompt"})=>{let{data:d}=(0,a.useSelectedOrganizationQuery)();return(0,t.jsxs)(l.Modal,{hideFooter:!0,visible:e,size:"medium",header:i,onCancel:()=>o(!1),children:[(0,t.jsx)(l.Modal.Content,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("p",{className:"text-sm",children:c}),(0,t.jsxs)("div",{className:"border-control bg-surface-300 rounded border",children:[(0,t.jsxs)("div",{className:"flex items-center px-4 pt-2 pb-1",children:[(0,t.jsx)("p",{className:"text-foreground-light w-[40%] text-sm",children:"Plan"}),(0,t.jsx)("p",{className:"text-foreground-light w-[60%] text-sm",children:"Retention duration"})]}),(0,t.jsxs)("div",{className:"py-1",children:[(0,t.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,t.jsx)("p",{className:"w-[40%] text-sm",children:"Free"}),(0,t.jsx)("p",{className:"w-[60%] text-sm",children:s.TIER_QUERY_LIMITS.FREE.text})]}),(0,t.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,t.jsx)("p",{className:"w-[40%] text-sm",children:"Pro"}),(0,t.jsx)("p",{className:"w-[60%] text-sm",children:s.TIER_QUERY_LIMITS.PRO.text})]}),(0,t.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,t.jsx)("p",{className:"w-[40%] text-sm",children:"Team"}),(0,t.jsx)("p",{className:"w-[60%] text-sm",children:s.TIER_QUERY_LIMITS.TEAM.text})]}),(0,t.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,t.jsx)("p",{className:"w-[40%] text-sm",children:"Enterprise"}),(0,t.jsx)("p",{className:"w-[60%] text-sm",children:s.TIER_QUERY_LIMITS.ENTERPRISE.text})]})]})]})]})}),(0,t.jsx)(l.Modal.Separator,{}),(0,t.jsxs)(l.Modal.Content,{className:"flex justify-end gap-3",children:[(0,t.jsx)(n.Button,{type:"default",onClick:()=>o(!1),children:"Close"}),(0,t.jsx)(n.Button,{asChild:!0,size:"tiny",children:(0,t.jsx)(r.default,{href:`/org/${d?.slug}/billing?panel=subscriptionPlan&source=${u}`,children:"Upgrade"})})]})]})}])},218786,e=>{"use strict";var t=e.i(478902);e.i(223600),e.i(460988);var r=e.i(867637),a=e.i(833655);e.i(55956);var n=e.i(843778);function l(e){let t=JSON.stringify(e,null,2);return(t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(e){var t="number text-tomato-900";return/^"/.test(e)?t=/:$/.test(e)?"key text-foreground":"string text-brand-600":/true|false/.test(e)?t="boolean text-blue-900":/null/.test(e)&&(t="null text-amber-1100"),'<span class="'+t+'">'+e+"</span>"}).split(`
`).map(e=>`<span class="line text-xs">${e}</span>`).join("\n")}e.s(["ResponseCodeFormatter",0,({value:e})=>{if(!e)return(0,t.jsx)("div",{children:(0,t.jsx)("label",{className:"text-xs text-border-stronger",children:"No data"})});let r=({children:e,className:r})=>(0,t.jsx)("div",{className:"flex h-full items-center",children:(0,t.jsx)("div",{className:(0,n.cn)("relative flex h-6 items-center rounded-md justify-center px-2 py-1 text-center",r),children:(0,t.jsx)("label",{className:"block font-mono text-sm",children:e})})});switch(e.toString().split("")[0]){case"1":return(0,t.jsx)(r,{children:e});case"2":return(0,t.jsx)(r,{className:"bg-surface-100 text-brand",children:e});case"5":return(0,t.jsx)(r,{className:"bg-red-300 text-red-1100",children:e});case"4":case"3":return(0,t.jsx)(r,{className:"bg-amber-300 text-amber-1100",children:e});default:return(0,t.jsx)(r,{className:"bg-surface-100 text-foreground-lighter",children:e})}},"RowLayout",0,({children:e})=>(0,t.jsx)("div",{className:"flex h-full w-full items-center gap-4",children:e}),"SeverityFormatter",0,({value:e,uppercase:n=!0})=>{if(!e)return(0,t.jsx)("div",{children:(0,t.jsx)("label",{className:"text-xs text-border-stronger",children:"No data"})});let l=e.toUpperCase(),s=n?l:e,o=({className:e,children:r})=>(0,t.jsx)("div",{className:`w-24 flex items-center h-full ${e}`,children:r});switch(l){case"UNCAUGHTEXCEPTION":case"PANIC":case"FATAL":case"ERROR":return(0,t.jsxs)(o,{className:"gap-1",children:[(0,t.jsx)("div",{className:" p-0.5 rounded !text-red-900",children:(0,t.jsx)(r.AlertCircle,{size:14,strokeWidth:2})}),(0,t.jsx)("span",{className:"!text-red-900 !block titlecase",children:s})]});case"INFO":case"DEBUG":return(0,t.jsxs)(o,{className:"gap-1",children:[(0,t.jsx)("div",{className:" p-0.5 rounded !text-blue-900",children:(0,t.jsx)(r.AlertCircle,{size:14,strokeWidth:2})}),(0,t.jsx)("span",{className:"!text-blue-900 !block titlecase",children:s})]});case"LOG":return(0,t.jsxs)(o,{className:"gap-1",children:[(0,t.jsx)("div",{className:" p-0.5 rounded !text-blue-900",children:(0,t.jsx)(a.Info,{size:14,strokeWidth:2})}),(0,t.jsx)("span",{className:"!text-blue-900 !block titlecase",children:s})]});case"WARNING":return(0,t.jsxs)(o,{className:"gap-1",children:[(0,t.jsx)("div",{className:" p-0.5 rounded !text-amber-900",children:(0,t.jsx)(r.AlertCircle,{size:14,strokeWidth:2})}),(0,t.jsx)("span",{className:"!text-amber-900 !block titlecase",children:s})]});default:return(0,t.jsx)(o,{children:(0,t.jsx)("div",{className:"relative rounded px-2 py-1 text-center h-6 flex justify-center items-center bg-surface-100",children:(0,t.jsx)("label",{className:"block font-mono text-sm text-foreground-lighter",children:s})})})}},"TextFormatter",0,({value:e,className:r})=>(0,t.jsx)("span",{className:(0,n.cn)("font-mono text-xs truncate select-text cursor-text",r),children:e}),"jsonSyntaxHighlight",()=>l])},238921,e=>{"use strict";var t=e.i(478902),r=e.i(55956),a=e.i(389959),n=e.i(151675),l=e.i(942032),s=e.i(30772),o=e.i(214765),i=e.i(941327),c=e.i(462273),u=e.i(843778);let d="hsl(var(--background-overlay-hover))",p="hsl(var(--brand-default))",h="hsl(var(--destructive-default))",m="hsl(var(--warning-default))";e.s(["LogsBarChart",0,({data:e,onBarClick:f,EmptyState:g,DateTimeFormat:x="MMM D, YYYY, hh:mma",isFullHeight:y=!1})=>{let[v,j]=(0,a.useState)(null);if(0===e.length)return g||null;let b=(0,r.default)(e[0].timestamp).format(x),S=(0,r.default)(e[e?.length-1]?.timestamp).format(x);return(0,t.jsxs)("div",{"data-testid":"logs-bar-chart",className:(0,u.cn)("flex flex-col gap-y-3",y?"h-full":"h-24"),children:[(0,t.jsx)(c.ChartContainer,{className:"h-full",config:{error_count:{label:"Errors"},ok_count:{label:"Ok"},warning_count:{label:"Warnings"}},children:(0,t.jsxs)(s.BarChart,{data:e,onMouseMove:e=>{e.activeTooltipIndex!==v&&j(e.activeTooltipIndex)},onMouseLeave:()=>j(null),onClick:e=>{let t=e?.activePayload?.[0]?.payload;f&&f(t,e)},children:[(0,t.jsx)(i.YAxis,{tick:!1,width:0,axisLine:{stroke:d},tickLine:{stroke:d}}),(0,t.jsx)(o.XAxis,{dataKey:"timestamp",interval:e.length-2,tick:!1,axisLine:{stroke:d},tickLine:{stroke:d}}),(0,t.jsx)(c.ChartTooltip,{content:(0,t.jsx)(c.ChartTooltipContent,{className:"text-foreground-light -mt-5",labelFormatter:e=>(0,r.default)(e).format(x)})}),(0,t.jsx)(n.Bar,{dataKey:"error_count",fill:h,maxBarSize:24,stackId:"stack",children:e?.map((e,r)=>(0,t.jsx)(l.Cell,{className:"cursor-pointer transition-colors",fill:v===r||null===v?h:"hsl(var(--destructive-500))"},`error-${r}`))}),(0,t.jsx)(n.Bar,{dataKey:"warning_count",fill:m,maxBarSize:24,stackId:"stack",children:e?.map((e,r)=>(0,t.jsx)(l.Cell,{className:"cursor-pointer transition-colors",fill:v===r||null===v?m:"hsl(var(--warning-500))"},`warning-${r}`))}),(0,t.jsx)(n.Bar,{dataKey:"ok_count",fill:p,maxBarSize:24,stackId:"stack",children:e?.map((e,r)=>(0,t.jsx)(l.Cell,{className:"cursor-pointer transition-colors",fill:v===r||null===v?p:"hsl(var(--brand-500))"},`success-${r}`))})]})}),e&&(0,t.jsxs)("div",{className:"text-foreground-lighter -mt-10 flex items-center justify-between text-[10px] font-mono",children:[(0,t.jsx)("span",{children:b}),(0,t.jsx)("span",{children:S})]})]})}])},450049,e=>{"use strict";var t=e.i(867088),r=e.i(242882),a=e.i(55956),n=e.i(389959),l=e.i(993394),s=e.i(460988),o=e.i(234745),i=e.i(520124),c=e.i(281192);e.s(["default",0,function({projectRef:e,table:u,filterOverride:d,limit:p}){let h,m,f=(0,l.getDefaultHelper)(l.PREVIEWER_DATEPICKER_HELPERS),[g,x]=(0,n.useState)(new Date().toISOString()),{timestampStart:y,timestampEnd:v,filters:j,search:b}=(0,c.useLogsUrlState)(),S=(0,n.useMemo)(()=>y||f.calcFrom(),[y,f]),C=(0,n.useMemo)(()=>v||f.calcTo(),[v,f]),N=(0,n.useMemo)(()=>({...j,...d,...b?{search_query:b}:{}}),[JSON.stringify(j),JSON.stringify(d),b]),w=(0,n.useMemo)(()=>({iso_timestamp_start:S,iso_timestamp_end:C,sql:(0,s.genDefaultQuery)(u,N,p)}),[S,C,u,N,p]),k=(0,n.useMemo)(()=>["projects",e,"logs",w],[e,w]),{data:O,isSuccess:E,isLoading:T,isRefetching:I,error:_,fetchNextPage:D,isFetchingNextPage:L,refetch:R}=(0,t.useInfiniteQuery)({queryKey:k,queryFn:async({signal:t,pageParam:r})=>{let{data:a,error:n}=await (0,o.get)("/platform/projects/{ref}/analytics/endpoints/logs.all",{params:{path:{ref:e},query:{...w,iso_timestamp_end:r||w.iso_timestamp_end}},signal:t});if(n)throw n;return a},refetchOnWindowFocus:!1,initialPageParam:void 0,getNextPageParam(e){if((e.result?.length??0)===0)return;let t=e.result.length,{timestamp:r}=e.result[t-1];return a.default.utc(Number(r/1e3)).toISOString()}}),{logData:M,error:A,oldestTimestamp:F}=(0,n.useMemo)(()=>{let e=[],t=_?_.message:null;O?.pages?.forEach(r=>{r?.result&&(e=[...e,...r.result]),!t&&r?.error&&(t=r.error)});let r=e.length>0?e[e.length-1]?.timestamp:void 0;return{logData:e,error:t,oldestTimestamp:r}},[O?.pages]),P=(0,n.useMemo)(()=>(0,s.genCountQuery)(u,N),[u,N]),H=(0,n.useMemo)(()=>["projects",e,"logs-count",{projectRef:e,sql:P,iso_timestamp_start:g,iso_timestamp_end:C,table:u,mergedFilters:N}],[e,P,g,C,u,N]),{data:$}=(0,r.useQuery)({queryKey:H,queryFn:async({signal:t})=>{let{data:r,error:a}=await (0,o.get)("/platform/projects/{ref}/analytics/endpoints/logs.all",{params:{path:{ref:e},query:{sql:P,iso_timestamp_start:g,iso_timestamp_end:C}},signal:t});if(a)throw a;return r},refetchOnWindowFocus:!1,refetchInterval:6e4,enabled:!!(!A&&O&&O?.pages?.length>0)}),B=$?.result?.[0]?.count??0,q=(0,n.useMemo)(()=>(0,s.genChartQuery)(u,w,N),[u,w,N]),U=(0,n.useMemo)(()=>["projects",e,"logs-chart",{projectRef:e,sql:q,iso_timestamp_start:S,iso_timestamp_end:C}],[e,q,S,C]),{data:z,refetch:K}=(0,r.useQuery)({queryKey:U,queryFn:async({signal:t})=>{let{data:r,error:a}=await (0,o.get)("/platform/projects/{ref}/analytics/endpoints/logs.all",{params:{path:{ref:e},query:{iso_timestamp_start:S,iso_timestamp_end:C,sql:q}},signal:t});if(a)throw a;return r},refetchOnWindowFocus:!1}),W=(0,n.useCallback)(async()=>{x(new Date().toISOString()),K(),R()},[R,K]),G=(h=z?.result??[],m="timestamp",(0,n.useMemo)(()=>0!==h.length&&(0,s.isUnixMicro)(h[0][m])?h?.map(e=>(e[m]=(0,s.unixMicroToIsoTimestamp)(e[m]),e)):h,[JSON.stringify(h)])),{data:V,error:Q}=(0,i.useFillTimeseriesSorted)(G,"timestamp","count",0,S,C||new Date().toISOString());return{newCount:B,logData:M,isSuccess:E,isLoading:T||I,isLoadingOlder:L,error:A||Q,filters:N,params:w,oldestTimestamp:F?String(F):void 0,eventChartData:V,refresh:W,loadOlder:()=>D()}}],450049)},555979,e=>{"use strict";var t=e.i(478902),r=e.i(55956),a=e.i(388019);let n=(0,a.default)("Rewind",[["polygon",{points:"11 19 2 12 11 5 11 19",key:"14yba5"}],["polygon",{points:"22 19 13 12 22 5 22 19",key:"1pi1cj"}]]);var l=e.i(898452),s=e.i(389959);e.i(128328);var o=e.i(657588),i=e.i(158639),c=e.i(543851),u=e.i(890054),d=e.i(61187),p=e.i(366652),h=e.i(454931),m=e.i(975924),f=e.i(215261),g=e.i(215312),x=e.i(282492),y=e.i(106579),v=e.i(330287),j=e.i(10429),b=e.i(837710),S=e.i(171997),C=e.i(613580),N=e.i(843778),w=e.i(748356),k=e.i(993394),O=e.i(767073),E=e.i(737018),T=e.i(237002);let I=({options:e,filters:r,onFiltersChange:a,buttonClassName:n,align:l="start",isLoading:o=!1})=>{let i=e.key,[c,u]=(0,s.useState)(!1),[d,p]=(0,s.useState)(r),h=()=>u(!c),m=(0,s.useMemo)(()=>{let e=d[i];return!!("object"==typeof e&&Object.values(e).some(Boolean))},[d,i]);return(0,s.useEffect)(()=>{c||p(r)},[c,r]),(0,t.jsxs)(O.Popover,{open:c,onOpenChange:h,children:[(0,t.jsx)(O.PopoverTrigger,{asChild:!0,children:(0,t.jsx)(b.Button,{type:m?"default":"outline",onClick:h,className:(0,N.cn)("min-w-20 border-dashed",{"border-solid":m},n),children:(0,t.jsx)("span",{children:e.label})})}),(0,t.jsx)(O.PopoverContent,{align:l,className:"p-0 w-60",portal:!0,children:(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),a(d),u(!1)},children:[e.options.map((r,a)=>(0,t.jsxs)(E.Label,{htmlFor:`${e.key}.${r.key}`,className:"flex items-start hover:bg-overlay-hover overflow-hidden p-2 m-1 rounded-sm gap-3 transition-all duration-150 ease-in-out",children:[(0,t.jsx)("div",{children:(0,t.jsx)(T.Checkbox,{value:e.key,id:`${e.key}.${r.key}`,checked:!!d?.[e.key]?.[r.key],onCheckedChange:t=>{p({...d,[e.key]:{...d[e.key],[r.key]:t}})}})}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{children:r.label}),(0,t.jsx)("span",{className:"text-sm text-foreground-lighter",children:r.description})]})]},r.key)),(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2 border-t border-default p-2",children:[(0,t.jsx)(b.Button,{size:"tiny",type:"default",onClick:()=>{p({[i]:{}}),a({...r,[i]:{}})},htmlType:"button",children:"Clear"}),(0,t.jsx)(b.Button,{loading:o,type:"primary",htmlType:"submit",children:"Apply"})]})]})})]})},_=({isLoading:e,newCount:r,onRefresh:a,onSearch:n=()=>{},defaultSearchValue:o="",onExploreClick:O,queryUrl:E,condensedLayout:T,isShowingEventChart:_,onToggleEventChart:D,csvData:L,onFiltersChange:R,filters:M,table:A,onSelectedDatabaseChange:F,className:P,selectedDatePickerValue:H,setSelectedDatePickerValue:$})=>{let B=(0,l.useRouter)(),{ref:q}=(0,i.useParams)(),[U,z]=(0,s.useState)(""),K=B.pathname.split("/").pop(),{data:W}=(0,v.useLoadBalancersQuery)({projectRef:q}),G=j.IS_PLATFORM&&k.LOG_ROUTES_WITH_REPLICA_SUPPORT.includes(B.pathname),V=U!==o,Q=e=>n("search-input-change",{query:e});return(0,s.useEffect)(()=>{U!==o&&z(o)},[o]),(0,t.jsxs)("div",{className:(0,N.cn)("flex w-full items-center justify-between overflow-x-scroll no-scrollbar",T?" p-3":"",P),children:[(0,t.jsxs)("div",{className:"flex flex-row items-center gap-x-2 mr-2",children:[(0,t.jsx)("form",{id:"log-panel-search",onSubmit:e=>{e.preventDefault(),Q(U)},children:(0,t.jsx)(S.Input,{className:"w-60",size:"tiny",placeholder:"Search events",onChange:e=>z(e.target.value),onBlur:e=>{z(e.target.value),Q(e.target.value)},icon:(0,t.jsx)("div",{className:"text-foreground-lighter",children:(0,t.jsx)(p.Search,{size:14})}),value:U,actions:(0,t.jsxs)("div",{className:"flex items-center gap-x-1 mr-0.5",children:[V&&(0,t.jsx)(g.ButtonTooltip,{icon:(0,t.jsx)("span",{children:"â†²"}),type:"text",className:"px-1 h-[20px]",onClick:()=>Q(U),tooltip:{content:{side:"bottom",text:"Search for events"}}}),U.length>0&&(0,t.jsx)(g.ButtonTooltip,{icon:(0,t.jsx)(m.X,{}),type:"text",className:"p-[1px] h-[20px]",onClick:()=>Q(""),tooltip:{content:{side:"bottom",text:"Clear search"}}})]})})}),(0,t.jsxs)(C.Tooltip,{children:[(0,t.jsx)(C.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(b.Button,{title:"refresh",type:"default",className:"px-1.5",icon:(0,t.jsxs)("div",{className:"relative",children:[r>0&&(0,t.jsxs)("div",{className:"absolute -top-3 right-3 flex items-center justify-center",children:[(0,t.jsx)("div",{className:"absolute z-20",children:(0,t.jsx)("p",{style:{fontSize:"0.6rem"},className:"text-white",children:r>1e3?`${Math.floor(r/100)/10}K`:r})}),(0,t.jsx)("div",{className:"h-4 w-4 animate-ping rounded-full bg-green-800 opacity-60"}),(0,t.jsx)("div",{className:"z-60 absolute top-0 right-0 h-full w-full rounded-full bg-green-900 opacity-80"})]}),(0,t.jsx)(d.RefreshCw,{})]}),loading:e,disabled:e,onClick:a})}),(0,t.jsx)(C.TooltipContent,{side:"bottom",className:"text-xs",children:"Refresh logs"})]}),(0,t.jsx)(w.LogsDatePicker,{helpers:k.PREVIEWER_DATEPICKER_HELPERS,onSubmit:e=>{n("datepicker-change",{to:e.to,from:e.from}),$(e)},value:H}),void 0!==k.FILTER_OPTIONS[A]&&(0,t.jsx)("div",{className:"flex items-center",children:k.FILTER_OPTIONS[A]&&Object.values(k.FILTER_OPTIONS[A]).map((e,r)=>{let a=[];Object.values(k.FILTER_OPTIONS[A]).length>=2&&(0===r?a.push("rounded-tr-none rounded-br-none"):r===Object.values(k.FILTER_OPTIONS[A]).length-1?a.push("rounded-tl-none rounded-bl-none"):a.push("rounded-none"));let n=Object.values(k.FILTER_OPTIONS[A]).length-1;return(0,t.jsx)(I,{buttonClassName:a.join(" "),options:e,onFiltersChange:R,filters:M,align:0===r?"start":r===n?"end":"center"},`${e.key}-filter`)})}),(0,t.jsx)("div",{className:"flex items-center space-x-2",children:(0,t.jsx)(b.Button,{type:"default",onClick:()=>D(),icon:_?(0,t.jsx)(c.Eye,{}):(0,t.jsx)(u.EyeOff,{}),children:"Chart"})}),!!L&&(0,t.jsx)(y.DownloadResultsButton,{iconOnly:!0,type:"default",align:"center",results:L??[],fileName:`supabase-${K}-${q}.csv`})]}),G?(0,t.jsxs)("div",{className:"flex items-center justify-center gap-x-2",children:[(0,t.jsxs)(C.Tooltip,{children:[(0,t.jsx)(C.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(b.Button,{asChild:!0,className:"px-1.5",type:"default",icon:(0,t.jsx)(h.Terminal,{}),children:(0,t.jsx)(f.default,{href:E})})}),(0,t.jsx)(C.TooltipContent,{side:"bottom",className:"text-xs",children:"Open query in Logs Explorer"})]}),(0,t.jsx)(x.default,{onSelectId:F,additionalOptions:A===k.LogsTableName.EDGE&&(W??[]).length>0?[{id:`${q}-all`,name:"API Load Balancer"}]:[]})]}):(0,t.jsx)(b.Button,{asChild:!0,type:"default",onClick:O,children:(0,t.jsx)(f.default,{href:E,children:"Explore via query"})})]})};var D=e.i(744244),L=e.i(427432),R=e.i(150671),M=e.i(450049),A=e.i(281192),F=e.i(783804),P=e.i(242882),H=e.i(460988),$=e.i(234745),B=e.i(912793);let q=function({projectRef:e,id:t,queryType:r,paramsToMerge:a}){let n=r?k.LOGS_TABLES[r]:void 0,l=t&&n?(0,H.genSingleLogQuery)(n,t):"",s={...a,sql:l},o=!!(t&&n),{logsMetadata:i}=(0,B.useIsFeatureEnabled)(["logs:metadata"]),{data:c,error:u,isPending:d,isRefetching:p,refetch:h}=(0,P.useQuery)({queryKey:["projects",e,"single-log",t,r],queryFn:async({signal:t})=>{let{data:r,error:a}=await (0,$.get)("/platform/projects/{ref}/analytics/endpoints/logs.all",{params:{path:{ref:e},query:s},signal:t});if(a)throw a;return r},enabled:o,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1}),m=u?u.message:null,f=c?.result?c.result[0]:void 0;return{data:f?{...f,metadata:i?f?.metadata:void 0}:void 0,isLoading:o&&d||p,error:m,refresh:()=>h()}};var U=e.i(265735),z=e.i(169240),K=e.i(189329),W=e.i(238921),G=e.i(651068),V=e.i(299863),Q=e.i(378277),Y=e.i(689805),J=e.i(793912),X=O;let Z=(0,a.default)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);function ee(e){return"logicalOperator"in e}function et(e,t){if(0===t.length)return e;let[r,...a]=t,n=e.conditions[r];return n?0===a.length?ee(n)?n:null:ee(n)?et(n,a):null:null}function er(e,t){if(0===t.length)return null;let[r,...a]=t,n=e.conditions[r];return n?0===a.length?ee(n)?null:n:ee(n)?er(n,a):null:null}function ea(e){return"object"==typeof e&&null!==e&&"component"in e}function en(e){if(!e||Array.isArray(e)||ea(e)||"function"!=typeof e)return!1;let t=e.toString();return"AsyncFunction"===e.constructor.name||t.startsWith("async ")||t.includes("async function")}function el(e,t){if(1===t.length)return{...e,conditions:e.conditions.filter((e,r)=>r!==t[0])};let[r,...a]=t;return{...e,conditions:e.conditions.map((e,t)=>t===r?el(e,a):e)}}function es(e,t,r){if(0===t.length)return{...e,conditions:[...e.conditions,{propertyName:r.name,value:"",operator:r.operators?.[0]||"="}]};let[a,...n]=t;return{...e,conditions:e.conditions.map((e,t)=>t===a?es(e,n,r):e)}}function eo(e,t){return(0,s.useCallback)(r=>{setTimeout(()=>{let r=document.activeElement;r&&e.current&&e.current.contains(r)||r&&r.closest("[data-radix-popper-content-wrapper]")||t()},0)},[e,t])}function ei(e,t,r){let[a,n]=(0,s.useState)(0);(0,s.useEffect)(()=>{a>e-1&&n(e>0?e-1:0)},[e,a]);let l=(0,s.useCallback)(l=>{if("ArrowDown"===l.key){l.preventDefault(),n(t=>t<e-1?t+1:t);return}if("ArrowUp"===l.key){l.preventDefault(),n(e=>e>0?e-1:0);return}if("Enter"===l.key){l.preventDefault(),t(a);return}r&&r(l)},[e,a,t,r]),o=(0,s.useCallback)(()=>n(0),[]);return{highlightedIndex:a,setHighlightedIndex:n,handleKeyDown:l,reset:o}}var ec=e.i(866205),eu=e.i(703526),ed=e.i(917007),ep=e.i(549815),eh=e.i(911509);function em({items:e,highlightedIndex:r,onSelect:a,includeIcon:n=!0}){return(0,t.jsx)(ec.Command_Shadcn_,{children:(0,t.jsxs)(eh.CommandList_Shadcn_,{children:[(0,t.jsx)(eu.CommandEmpty_Shadcn_,{children:"No results found."}),(0,t.jsx)(ed.CommandGroup_Shadcn_,{children:e.map((e,l)=>(0,t.jsxs)(ep.CommandItem_Shadcn_,{value:e.value,onSelect:()=>a(e),className:`text-xs ${l===r?"bg-surface-400":""}`,children:[n&&e.icon,e.label]},`${e.value}-${e.label}`))})]})})}function ef({condition:e,filterProperties:r,id:a,isActive:n,isOperatorActive:l,isLoading:o,onOperatorChange:i,onValueChange:c,onOperatorFocus:u,onValueFocus:d,onBlur:p,onLabelClick:h,onKeyDown:f,onRemove:g,rootFilters:x,path:y,propertyOptionsCache:v,loadingOptions:j,aiApiUrl:S,onSelectMenuItem:C,setActiveInput:N}){let w=(0,s.useRef)(null),k=(0,s.useRef)(null),O=(0,s.useRef)(null),E=r.find(t=>t.name===e.propertyName),[T,I]=(0,s.useState)(!1);(0,s.useEffect)(()=>{n&&k.current?k.current.focus():l&&w.current&&w.current.focus()},[n,l]);let _=eo(O,p),D=eo(O,p);if(!E)return null;let L=(0,s.useMemo)(()=>(function(e,t,r){if(!e)return[];let a=er(t,e.path),n=r.find(e=>e.name===a?.propertyName),l=a?.operator?.toUpperCase()||"";return(n?.operators||["="]).filter(e=>e.toUpperCase().includes(l)).map(e=>({value:e,label:e}))})({type:"operator",path:y},x,r),[y,x,r]),R=(0,s.useMemo)(()=>(function(e,t,r,a,n,l){if(!e)return[];let s=er(t,e.path),o=r.find(e=>e.name===s?.propertyName),i=[];return o&&(!Array.isArray(o.options)&&ea(o.options)?i.push({value:"custom",label:o.options.label||"Custom...",isCustom:!0,customOption:o.options.component}):n[o.name]?i.push({value:"loading",label:"Loading options..."}):Array.isArray(o.options)?i.push(...function(e,t){let r=[];for(let a of e)if("string"==typeof a)a.toLowerCase().includes(t.toLowerCase())&&r.push({value:a,label:a});else"object"==typeof a&&null!==a&&"value"in a&&"label"in a?a.label.toLowerCase().includes(t.toLowerCase())&&r.push({value:a.value,label:a.label}):ea(a)&&(a.label?.toLowerCase().includes(t.toLowerCase())??!0)&&r.push({value:"custom",label:a.label||"Custom...",isCustom:!0,customOption:a.component});return r}(o.options,l)):a[o.name]&&i.push(...a[o.name].options.map(e=>"string"==typeof e?{value:e,label:e}:{value:e.value,label:e.label}))),i})({type:"value",path:y},x,r,v,j,(e.value??"").toString()),[y,x,r,v,j,e.value]),M=(0,s.useMemo)(()=>R.find(e=>e.isCustom&&e.customOption),[R]);(0,s.useEffect)(()=>{!n||o||R.length>0&&R.every(e=>e.isCustom)&&!T&&I(!0)},[n,o,R,T]);let{highlightedIndex:A,handleKeyDown:F,reset:P}=ei(L.length,e=>{L[e]&&C(L[e])}),{highlightedIndex:H,handleKeyDown:$,reset:B}=ei(R.length,e=>{let t=R[e];t&&(t.isCustom?I(!0):C(t))},f);return(0,s.useEffect)(()=>{l||P()},[l,P]),(0,s.useEffect)(()=>{n||B()},[n,B]),(0,t.jsxs)("div",{ref:O,className:"flex items-center rounded px-2 h-6 bg-muted border group shrink-0",children:[(0,t.jsx)("span",{className:"text-xs font-medium mr-1 cursor-pointer shrink-0 whitespace-nowrap",onClick:h,children:E.label}),(0,t.jsxs)(Y.Popover_Shadcn_,{open:l&&!o&&L.length>0,children:[(0,t.jsx)(X.PopoverAnchor,{asChild:!0,children:(0,t.jsx)(Q.Input_Shadcn_,{ref:w,type:"text",value:e.operator,onChange:e=>i(e.target.value),onFocus:u,onBlur:_,onKeyDown:F,className:"border-none bg-transparent p-0 text-xs focus:outline-none focus:ring-0 focus:shadow-none focus-visible:ring-0 focus-visible:ring-offset-0 h-6 mr-1 text-foreground-light",style:{width:`${Math.max(e.operator.length,1)}ch`,minWidth:"1ch"},disabled:o,"aria-label":`Operator for ${E.label}`})}),(0,t.jsx)(J.PopoverContent_Shadcn_,{className:"min-w-[220px] p-0",align:"start",side:"bottom",portal:!0,onOpenAutoFocus:e=>e.preventDefault(),onCloseAutoFocus:e=>e.preventDefault(),onInteractOutside:e=>{let t=e.target;O.current&&!O.current.contains(t)&&p()},children:(0,t.jsx)(em,{items:L,highlightedIndex:A,onSelect:C,includeIcon:!1})})]}),(0,t.jsxs)(Y.Popover_Shadcn_,{open:n&&!o&&(T||R.length>0),children:[(0,t.jsx)(X.PopoverAnchor,{asChild:!0,children:(0,t.jsx)(Q.Input_Shadcn_,{ref:k,type:"text",value:(e.value??"").toString(),onChange:e=>c(e.target.value),onFocus:d,onBlur:D,onKeyDown:$,className:"border-none bg-transparent p-0 text-xs focus:outline-none focus:ring-0 focus:shadow-none focus-visible:ring-0 focus-visible:ring-offset-0 h-6 mr-1",style:{width:`${Math.max((e.value??"").toString().length,1)}ch`,minWidth:"1ch"},disabled:o,"aria-label":`Value for ${E.label}`})}),(0,t.jsx)(J.PopoverContent_Shadcn_,{className:"min-w-[220px] w-fit p-0",align:"start",onOpenAutoFocus:e=>e.preventDefault(),onCloseAutoFocus:e=>e.preventDefault(),onInteractOutside:e=>{let t=e.target;O.current&&!O.current.contains(t)&&p()},children:T&&M&&M.customOption?M.customOption({onChange:e=>{c(e),I(!1),setTimeout(()=>{N({type:"group",path:y.slice(0,-1)})},0)},onCancel:()=>{I(!1),g()},search:(e.value??"").toString()}):(0,t.jsx)(em,{items:R,highlightedIndex:H,onSelect:e=>e.isCustom?I(!0):C(e),includeIcon:!0})})]}),(0,t.jsx)(b.Button,{type:"text",size:"tiny",icon:(0,t.jsx)(m.X,{strokeWidth:1.5,size:12,className:"group-hover:text-foreground text-foreground-light"}),onClick:g,className:"group hover:text-foreground !hover:bg-surface-600 p-0","aria-label":`Remove ${E.label} filter`})]})}var X=O;function eg({group:e,path:r,isLoading:a,rootFilters:n,activeInput:l,filterProperties:o,onOperatorChange:i,onValueChange:c,onOperatorFocus:u,onValueFocus:d,onBlur:p,onLabelClick:h,onKeyDown:m,onGroupFreeformChange:f,onGroupFreeformFocus:g,groupFreeformValue:x,isGroupFreeformActive:y,onLogicalOperatorChange:v,supportsOperators:j=!1,onRemove:b,propertyOptionsCache:S,loadingOptions:C,aiApiUrl:N,onSelectMenuItem:w,setActiveInput:k}){let[O,E]=(0,s.useState)(""),T=(0,s.useRef)(null),I=(0,s.useRef)(null),[_,D]=(0,s.useState)(!1),L=y&&l?.type==="group"&&r.length===l.path.length&&r.every((e,t)=>e===l.path[t]);(0,s.useEffect)(()=>{""===x&&E("")},[x]),(0,s.useEffect)(()=>{L&&T.current&&T.current.focus()},[L]);let R=eo(I,p),M=()=>{v?.(r)},A=()=>{D(!0)},F=()=>{D(!1)},P=(0,s.useMemo)(()=>(function(e){let{filterProperties:t,inputValue:r,aiApiUrl:a,supportsOperators:n}=e,l=[];return l.push(...t.filter(e=>e.label.toLowerCase().includes(r.toLowerCase())).map(e=>({value:e.name,label:e.label}))),n&&l.push({value:"group",label:"New Group"}),r.trim().length>0&&a&&l.push({value:"ai-filter",label:"Filter by AI",icon:s.createElement(Z,{className:"mr-2 h-4 w-4",strokeWidth:1.25})}),l})({filterProperties:o,inputValue:(L?x:O)||"",aiApiUrl:N,supportsOperators:j}),[o,L,x,O,N,j]),H=(0,s.useMemo)(()=>{if(0===r.length)return!0;let e=r.slice(0,-1),t=n;for(let r=0;r<e.length;r++){let a=e[r],n=t?.conditions?.[a];if(!n||!("logicalOperator"in n))return!1;t=n}return r[r.length-1]===(t?.conditions??[]).length-1},[r,n]),{highlightedIndex:$,handleKeyDown:B,reset:q}=ei(P.length,e=>{P[e]&&w(P[e])},m);return(0,s.useEffect)(()=>{L||q()},[L,q]),(0,t.jsx)("div",{ref:I,className:`flex items-center gap-1 rounded ${r.length>0?"before:content-['('] before:text-foreground-muted after:content-[')'] after:text-foreground-muted":""} ${H?"flex-1 min-w-0":""}`,children:(0,t.jsxs)("div",{className:`flex items-center gap-1 ${H?"flex-1 min-w-0":""}`,children:[e.conditions.map((O,E)=>{let T=[...r,E];return(0,t.jsxs)(s.default.Fragment,{children:[E>0&&j&&(0,t.jsx)("span",{className:`text-xs font-medium cursor-pointer ${_?"bg-surface-400 text-foreground dark:bg-surface-400":"text-foreground-muted"}`,onClick:M,onMouseEnter:A,onMouseLeave:F,children:e.logicalOperator}),"logicalOperator"in O?(0,t.jsx)(eg,{filterProperties:o,group:O,path:T,isLoading:a,rootFilters:n,activeInput:l,onOperatorChange:i,onValueChange:c,onOperatorFocus:u,onValueFocus:d,onBlur:p,onLabelClick:h,onKeyDown:m,onGroupFreeformChange:f,onGroupFreeformFocus:g,groupFreeformValue:x,isGroupFreeformActive:y,onLogicalOperatorChange:v,supportsOperators:j,onRemove:b,propertyOptionsCache:S,loadingOptions:C,aiApiUrl:N,onSelectMenuItem:w,setActiveInput:k}):(0,t.jsx)(ef,{id:`filter-${T.join("-")}`,condition:O,isActive:!!l&&"value"===l.type&&T.length===l.path.length&&T.every((e,t)=>e===l.path[t]),isOperatorActive:!!l&&"operator"===l.type&&T.length===l.path.length&&T.every((e,t)=>e===l.path[t]),isLoading:a,onOperatorChange:e=>i(T,e),filterProperties:o,onValueChange:e=>c(T,e),onOperatorFocus:()=>u(T),onValueFocus:()=>d(T),onBlur:p,onLabelClick:()=>h(T),onKeyDown:m,onRemove:()=>b(T),rootFilters:n,path:T,propertyOptionsCache:S,loadingOptions:C,aiApiUrl:N,onSelectMenuItem:w,setActiveInput:k})]},E)}),(0,t.jsxs)(Y.Popover_Shadcn_,{open:L&&!a&&P.length>0,children:[(0,t.jsx)(X.PopoverAnchor,{asChild:!0,children:(0,t.jsx)(Q.Input_Shadcn_,{ref:T,type:"text",value:L?x:O,onChange:e=>{E(e.target.value),f(r,e.target.value)},onFocus:()=>g(r),onBlur:R,onKeyDown:B,className:`border-none bg-transparent p-0 text-xs focus:outline-none focus:ring-0 focus:shadow-none focus-visible:ring-0 focus-visible:ring-offset-0 h-6 ${H?"w-full flex-1 min-w-0":""}`,placeholder:0===r.length&&0===e.conditions.length?"Search or filter...":"+",disabled:a,style:H?{width:"100%",minWidth:0}:{width:`${Math.max((L?x:O).length||1,0===r.length&&0===e.conditions.length?18:1)}ch`,minWidth:0===r.length&&0===e.conditions.length?"18ch":"1ch"}})}),(0,t.jsx)(J.PopoverContent_Shadcn_,{className:"min-w-[220px] p-0",align:"start",side:"bottom",portal:!0,onOpenAutoFocus:e=>e.preventDefault(),onCloseAutoFocus:e=>e.preventDefault(),onInteractOutside:e=>{let t=e.target;I.current&&!I.current.contains(t)&&p()},children:(0,t.jsx)(em,{items:P,highlightedIndex:$,onSelect:w,includeIcon:!0})})]})]})})}function ex({filterProperties:e,filters:r,onFilterChange:a,freeformText:n,onFreeformTextChange:l,aiApiUrl:o,className:i,supportsOperators:c=!1}){let u=(0,s.useRef)(null),{isLoading:d,setIsLoading:h,error:m,setError:f,isCommandMenuVisible:g,setIsCommandMenuVisible:x,hideTimeoutRef:y,activeInput:v,setActiveInput:j,newPathRef:b}=function(){let[e,t]=(0,s.useState)(!1),[r,a]=(0,s.useState)(null),[n,l]=(0,s.useState)(0),[o,i]=(0,s.useState)(!1),c=(0,s.useRef)(null),[u,d]=(0,s.useState)(null),p=(0,s.useRef)([]),[h,m]=(0,s.useState)(null),[f,g]=(0,s.useState)(!1),[x,y]=(0,s.useState)(null),v=(0,s.useCallback)(()=>{a(null),l(0),i(!1),d(null),m(null),g(!1),y(null),c.current&&clearTimeout(c.current)},[]);return{isLoading:e,setIsLoading:t,error:r,setError:a,selectedCommandIndex:n,setSelectedCommandIndex:l,isCommandMenuVisible:o,setIsCommandMenuVisible:i,hideTimeoutRef:c,activeInput:u,setActiveInput:d,newPathRef:p,dialogContent:h,setDialogContent:m,isDialogOpen:f,setIsDialogOpen:g,pendingPath:x,setPendingPath:y,resetState:v}}(),{loadingOptions:S,propertyOptionsCache:C,loadPropertyOptions:w,optionsError:k,setOptionsError:O}=function(){let[e,t]=(0,s.useState)({}),[r,a]=(0,s.useState)({}),[n,l]=(0,s.useState)(null),o=(0,s.useRef)(null),i=(0,s.useCallback)(async(n,s="")=>{if(!n.options||Array.isArray(n.options)||!en(n.options))return;let i=r[n.name];i&&i.searchValue===s||(o.current&&clearTimeout(o.current),o.current=setTimeout(async()=>{if(!e[n.name])try{t(e=>({...e,[n.name]:!0}));let e=n.options,r=(await e(s)).map(e=>"string"==typeof e?{label:e,value:e}:e);a(e=>({...e,[n.name]:{options:r,searchValue:s}}))}catch(e){console.error(`Error loading options for ${n.name}:`,e),l(`Failed to load options for ${n.label}`)}finally{t(e=>({...e,[n.name]:!1}))}},300))},[e,r]);return(0,s.useEffect)(()=>()=>{o.current&&clearTimeout(o.current)},[]),{loadingOptions:e,propertyOptionsCache:r,loadPropertyOptions:i,optionsError:n,setOptionsError:l}}(),{handleAIFilter:E}=function({activeInput:e,aiApiUrl:t,freeformText:r,filterProperties:a,activeFilters:n,onFilterChange:l,onFreeformTextChange:o,setIsLoading:i,setError:c,setIsCommandMenuVisible:u}){return{handleAIFilter:(0,s.useCallback)(async()=>{if(e&&"group"===e.type&&t){i(!0),c(null);try{let s=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:r,filterProperties:a,currentPath:e.path})});if(!s.ok){let e=await s.json();throw Error(e.error||"AI filtering failed")}let i=await s.json();if(!i||!Array.isArray(i.conditions))throw Error("Invalid response from AI filter");let c={logicalOperator:i.logicalOperator||"AND",conditions:function e(t,r){return t.map(t=>{if(ee(t))return{logicalOperator:t.logicalOperator,conditions:e(t.conditions,r)};{let e=r.find(e=>e.name===t.propertyName);if(!e)throw Error(`Invalid property: ${t.propertyName}`);return{propertyName:e.name,value:t.value,operator:t.operator||"="}}})}(i.conditions,a)},d=function e(t,r,a){if(0===r.length)return a;let[n,...l]=r;return{...t,conditions:t.conditions.map((t,r)=>r===n?e(t,l,a):t)}}(n,e.path,c);l(d),o(""),u(!1)}catch(e){console.error("Error in AI filtering:",e),c(e.message||"AI filtering failed. Please try again."),o("")}finally{i(!1)}}},[e,t,r,a,n,l,o,i,c,u])}}({activeInput:v,aiApiUrl:o,freeformText:n,filterProperties:e,activeFilters:r,onFilterChange:a,onFreeformTextChange:l,setIsLoading:h,setError:f,setIsCommandMenuVisible:x}),T=(0,s.useCallback)((t,n)=>{let l=function e(t,r,a){if(1===r.length)return{...t,conditions:t.conditions.map((e,t)=>t===r[0]?{...e,value:a}:e)};let[n,...l]=r;return{...t,conditions:t.conditions.map((t,r)=>r===n&&ee(t)?e(t,l,a):t)}}(r,t,n);a(l);let s=er(l,t);if(s){let t=e.find(e=>e.name===s.propertyName);t&&t.options&&!Array.isArray(t.options)&&en(t.options)&&w(t,n)}},[r,a,e,w]),I=(0,s.useCallback)((e,t)=>{a(function e(t,r,a){if(1===r.length)return{...t,conditions:t.conditions.map((e,t)=>t===r[0]?{...e,operator:a}:e)};let[n,...l]=r;return{...t,conditions:t.conditions.map((t,r)=>r===n&&ee(t)?e(t,l,a):t)}}(r,e,t))},[r,a]),{handleItemSelect:_}=function({activeInput:e,setActiveInput:t,activeFilters:r,onFilterChange:a,filterProperties:n,freeformText:l,onFreeformTextChange:o,handleInputChange:i,handleOperatorChange:c,newPathRef:u,handleAIFilter:d}){let p=(0,s.useCallback)(e=>{a(el(r,e))},[r,a]),h=(0,s.useCallback)(t=>{let r=t.value;"ai-filter"===t.value?d():"group"===t.value?m():e?.type==="value"?f(t):e?.type==="operator"?g(r):e?.type==="group"&&x(r)},[e,r,n,l,d,i,c]),m=(0,s.useCallback)(()=>{if(e&&"group"===e.type){let n=e.path,l=et(r,n);l&&(a(function e(t,r){if(0===r.length)return{...t,conditions:[...t.conditions,{logicalOperator:"AND",conditions:[]}]};let[a,...n]=r;return{...t,conditions:t.conditions.map((t,r)=>r===a?e(t,n):t)}}(r,n)),u.current=[...n,l.conditions.length],setTimeout(()=>{t({type:"group",path:u.current})},0),o(""))}},[e,r,a,t,o]),f=(0,s.useCallback)(r=>{if(!e||"value"!==e.type)return;let a=e.path;i(a,r.value),setTimeout(()=>{t({type:"group",path:a.slice(0,-1)})},0)},[e,i,t,p]),g=(0,s.useCallback)(r=>{e&&"operator"===e.type&&(c(e.path,r),t(null))},[e,c,t]),x=(0,s.useCallback)(t=>{if(!e||"group"!==e.type)return;let a=n.find(e=>e.name===t);if(!a)return void console.error(`Invalid property: ${t}`);let l=e.path,s=et(r,l);s&&(a.options&&!Array.isArray(a.options)&&ea(a.options)?y(a,l,s):v(a,l,s),o(""))},[e,n,r,a,o]),y=(0,s.useCallback)((e,n,l)=>{a(es(r,n,e));let s=[...n,l.conditions.length];setTimeout(()=>{t({type:"value",path:s})},0)},[r,a,t,p]),v=(0,s.useCallback)((e,n,l)=>{a(es(r,n,e));let s=[...n,l.conditions.length];setTimeout(()=>{t({type:"value",path:s})},0)},[r,a,t]);return{handleItemSelect:h}}({activeInput:v,setActiveInput:j,activeFilters:r,onFilterChange:a,filterProperties:e,freeformText:n,onFreeformTextChange:l,handleInputChange:T,handleOperatorChange:I,newPathRef:b,handleAIFilter:E}),{handleKeyDown:D}=function({activeInput:e,setActiveInput:t,activeFilters:r,onFilterChange:a}){let n=(0,s.useCallback)(e=>{a(el(r,e))},[r,a]),l=(0,s.useCallback)(e=>{a(el(r,e))},[r,a]),o=(0,s.useCallback)(r=>{"Backspace"===r.key?i(r):" "===r.key&&e?.type==="value"?(r.preventDefault(),t({type:"group",path:[]})):"ArrowLeft"===r.key?f(r):"ArrowRight"===r.key?g(r):"Escape"===r.key&&t(null)},[e,r]),i=(0,s.useCallback)(a=>{if(e?.type==="operator")return;let s=""===a.target.value;if(e?.type==="group"&&s){a.preventDefault();let s=et(r,e.path);s&&s.conditions.length>0?(n([...e.path,s.conditions.length-1]),t({type:"group",path:e.path})):s&&0===s.conditions.length&&(l(e.path),e.path.length>0?t({type:"group",path:e.path.slice(0,-1)}):t(null))}else if(e?.type==="value"&&s){let l=er(r,e.path);l&&!l.value&&(a.preventDefault(),n(e.path),t({type:"group",path:e.path.slice(0,-1)}))}},[e,r,n,l,t]),c=(0,s.useCallback)(e=>{let[t,a]=[e.slice(0,-1),e[e.length-1]];if(a>0){let e=[...t,a-1],n=et(r,t),l=n?.conditions[a-1];if(l&&!("logicalOperator"in l))return e;if(l&&"logicalOperator"in l)return p(e)}return t.length>0?c(t):null},[r]),u=(0,s.useCallback)(e=>{let[t,a]=[e.slice(0,-1),e[e.length-1]],n=et(r,t);if(n&&a<n.conditions.length-1){let e=[...t,a+1];return"logicalOperator"in n.conditions[a+1]?d(e):e}return t.length>0?u(t):null},[r]),d=(0,s.useCallback)(e=>{let t=et(r,e);return t&&0!==t.conditions.length?"logicalOperator"in t.conditions[0]?d([...e,0]):[...e,0]:null},[r]),p=(0,s.useCallback)(e=>{let t=et(r,e);if(!t||0===t.conditions.length)return null;let a=t.conditions[t.conditions.length-1],n=t.conditions.length-1;return"logicalOperator"in a?p([...e,n]):[...e,n]},[r]),h=(0,s.useCallback)(e=>{let t=et(r,e);if(t&&t.conditions.length>0)return p(e);if(e.length>0){let t=e.slice(0,-1),a=e[e.length-1];if(a>0){let e=[...t,a-1],n=et(r,t),l=n?.conditions[a-1];if(l)if("logicalOperator"in l)return p(e);else return e}return h(t)}return null},[r,p]),m=(0,s.useCallback)(e=>{if(e.length>0){let t=e.slice(0,-1),a=e[e.length-1],n=et(r,t);if(n&&a<n.conditions.length-1){let e=[...t,a+1];return"logicalOperator"in n.conditions[a+1]?d(e):e}return m(t)}return null},[r,d]),f=(0,s.useCallback)(r=>{if(0===r.target.selectionStart){if(r.preventDefault(),e?.type==="value"){let r=c(e.path);r&&t({type:"value",path:r})}else if(e?.type==="group"){let r=h(e.path);r&&t({type:"value",path:r})}}},[e,c,h,t]),g=(0,s.useCallback)(a=>{let n=a.target;if(n.selectionStart===n.value.length){if(a.preventDefault(),e?.type==="value"){let a=e.path.slice(0,-1),n=e.path[e.path.length-1],l=et(r,a);if(l&&n<l.conditions.length-1)if("logicalOperator"in l.conditions[n+1]){let e=d([...a,n+1]);e&&t({type:"value",path:e})}else t({type:"value",path:[...a,n+1]});else t({type:"group",path:a})}else if(e?.type==="group"){let r=m(e.path);r&&t({type:"value",path:r})}}},[e,r,et,d,m,t]);return{handleKeyDown:o}}({activeInput:v,setActiveInput:j,activeFilters:r,onFilterChange:a}),L=(0,s.useCallback)(t=>{j({type:"value",path:t}),x(!0),y.current&&clearTimeout(y.current);let a=er(r,t);if(a){let t=e.find(e=>e.name===a.propertyName);t&&t.options&&!Array.isArray(t.options)&&en(t.options)&&w(t,a.value?.toString()||"")}},[r,e,w]),R=(0,s.useCallback)(e=>{j({type:"operator",path:e}),x(!0),y.current&&clearTimeout(y.current)},[]),M=(0,s.useCallback)(e=>{j({type:"group",path:e}),x(!0),y.current&&clearTimeout(y.current)},[]),A=(0,s.useCallback)(()=>{y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{let e=document.activeElement;e&&u.current&&u.current.contains(e)||(x(!1),j(null))},0)},[x,j]),F=(0,s.useCallback)((e,t)=>{l(t)},[]),P=(0,s.useCallback)(e=>{j({type:"value",path:e})},[]),H=(0,s.useCallback)(e=>{a(function e(t,r){if(0===r.length)return{...t,logicalOperator:"AND"===t.logicalOperator?"OR":"AND"};let[a,...n]=r;return{...t,conditions:t.conditions.map((t,r)=>r===a&&ee(t)?e(t,n):t)}}(r,e))},[r,a]),$=(0,s.useCallback)(e=>{a(el(r,e)),j(null)},[r,a,j]);return(0,t.jsxs)("div",{ref:u,className:"w-full space-y-2 relative","data-filterbar-root":!0,children:[(0,t.jsxs)("div",{className:(0,N.cn)("relative flex items-center gap-2 w-full border rounded-md h-10 bg-foreground/[.026] cursor-text p-0 px-2 overflow-auto",i),children:[(0,t.jsx)(p.Search,{className:"text-foreground-muted w-4 h-4 sticky left-0 shrink-0"}),(0,t.jsx)("div",{className:"flex-1 flex flex-wrap items-center gap-1 h-full",children:(0,t.jsx)(eg,{group:r,rootFilters:r,filterProperties:e,path:[],isLoading:d,activeInput:v,onOperatorChange:I,onValueChange:T,onOperatorFocus:R,onValueFocus:L,onBlur:A,onLabelClick:P,onKeyDown:D,onGroupFreeformChange:F,onGroupFreeformFocus:M,groupFreeformValue:n,isGroupFreeformActive:v?.type==="group",onLogicalOperatorChange:c?H:void 0,supportsOperators:c,onRemove:$,propertyOptionsCache:C,loadingOptions:S,aiApiUrl:o,onSelectMenuItem:e=>_(e),setActiveInput:j})})]}),(m||k)&&(0,t.jsx)("div",{className:"text-red-500 text-xs mt-1",children:m||k})]})}function ey({onChange:e,onCancel:a}){let[n,l]=(0,s.useState)();return(0,t.jsxs)("div",{className:"w-full space-y-4",children:[(0,t.jsx)(V.Calendar,{initialFocus:!0,mode:"range",defaultMonth:n?.from,selected:n,onSelect:l,numberOfMonths:2}),(0,t.jsxs)("div",{className:"flex justify-end gap-2 py-3 px-4 border-t",children:[(0,t.jsx)(b.Button,{type:"default",onClick:a,children:"Cancel"}),(0,t.jsx)(b.Button,{type:"primary",onClick:()=>{if(n?.from){let t=(0,r.default)(n.from).toISOString(),a=n.to?(0,r.default)(n.to).toISOString():(0,r.default)().toISOString();e(`${t}|${a}`)}},children:"Apply"})]})]})}let ev=({isLoading:e,newCount:a,onRefresh:n,onSearch:o=()=>{},defaultSearchValue:p="",defaultFromValue:m,defaultToValue:g,onExploreClick:y,queryUrl:S,condensedLayout:w,isShowingEventChart:O,onToggleEventChart:E,csvData:T,onFiltersChange:I,filters:_,table:D,onSelectedDatabaseChange:L,className:R,selectedDatePickerValue:M,setSelectedDatePickerValue:A})=>{let F=(0,l.useRouter)(),{ref:P}=(0,i.useParams)();F.pathname.split("/").pop();let{data:H}=(0,v.useLoadBalancersQuery)({projectRef:P}),$=j.IS_PLATFORM&&k.LOG_ROUTES_WITH_REPLICA_SUPPORT.includes(F.pathname),B=(0,s.useMemo)(()=>{let e=k.FILTER_OPTIONS[D];if(!e)return[];let a=[];return a.push({label:"Time Range",name:"timerange",type:"string",operators:["="],options:[{label:"Last 15 minutes",value:`${(0,r.default)().subtract(15,"minute").toISOString()}|${(0,r.default)().toISOString()}`},{label:"Last 30 minutes",value:`${(0,r.default)().subtract(30,"minute").toISOString()}|${(0,r.default)().toISOString()}`},{label:"Last hour",value:`${(0,r.default)().subtract(1,"hour").toISOString()}|${(0,r.default)().toISOString()}`},{label:"Last 3 hours",value:`${(0,r.default)().subtract(3,"hour").toISOString()}|${(0,r.default)().toISOString()}`},{label:"Last 24 hours",value:`${(0,r.default)().subtract(24,"hour").toISOString()}|${(0,r.default)().toISOString()}`},{label:"Custom Range...",component:e=>(0,t.jsx)(ey,{...e})}]}),Object.entries(e).forEach(([e,t])=>{a.push({label:t.label,name:t.key,type:"string",operators:["="],options:t.options.map(e=>({label:e.label,value:e.key,description:e.description}))})}),a},[D]),q=(0,s.useMemo)(()=>{let e=[];return(m||g)&&!_.timerange&&e.push({propertyName:"timerange",operator:"=",value:`${m||""}|${g||""}`}),Object.entries(_).forEach(([t,r])=>{if("search_query"!==t)if("object"==typeof r&&null!==r){if(0===Object.keys(r).length)return void e.push({propertyName:t,operator:"=",value:""});Object.entries(r).forEach(([r,a])=>{a&&e.push({propertyName:t,operator:"=",value:r})})}else null!=r&&e.push({propertyName:t,operator:"=",value:String(r)})}),{logicalOperator:"AND",conditions:e}},[_,m,g]);return(0,t.jsx)("div",{className:(0,N.cn)("flex w-full flex-col gap-2",w?" p-3":"",R),children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-x-2",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)(ex,{filterProperties:B,filters:q,onFilterChange:e=>{let t={},r=!1;e.conditions.forEach(e=>{if(!("propertyName"in e))return;let a=e.propertyName;if(a)if("timerange"===a)if(r=!0,e.value){let r=String(e.value),[a,n]=r.split("|");t.timerange={[r]:!0},o("datepicker-change",{from:a,to:n})}else t.timerange={},o("datepicker-change",{from:"",to:""});else{if(t[a]||(t[a]={}),!e.value)return;if("string"==typeof e.value){let r=t[a],n="object"!=typeof r||null===r||Array.isArray(r)?{}:{...r};n[e.value]=!0,t[a]=n}}}),r||o("datepicker-change",{from:"",to:""}),I(t)},freeformText:p,onFreeformTextChange:e=>o("search-input-change",{query:e})})}),(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)(b.Button,{title:"refresh",type:"default",className:"px-1.5",icon:(0,t.jsxs)("div",{className:"relative",children:[a>0&&(0,t.jsxs)("div",{className:"absolute -top-3 right-3 flex items-center justify-center",children:[(0,t.jsx)("div",{className:"absolute z-20",children:(0,t.jsx)("p",{style:{fontSize:"0.6rem"},className:"text-white",children:a>1e3?`${Math.floor(a/100)/10}K`:a})}),(0,t.jsx)("div",{className:"h-4 w-4 animate-ping rounded-full bg-green-800 opacity-60"}),(0,t.jsx)("div",{className:"z-60 absolute top-0 right-0 h-full w-full rounded-full bg-green-900 opacity-80"})]}),(0,t.jsx)(d.RefreshCw,{})]}),loading:e,disabled:e,onClick:n}),(0,t.jsx)(b.Button,{type:"default",onClick:()=>E(),icon:O?(0,t.jsx)(c.Eye,{}):(0,t.jsx)(u.EyeOff,{}),children:"Chart"}),$?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(C.Tooltip,{children:[(0,t.jsx)(C.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(b.Button,{asChild:!0,className:"px-1.5",type:"default",icon:(0,t.jsx)(h.Terminal,{}),children:(0,t.jsx)(f.default,{href:S})})}),(0,t.jsx)(C.TooltipContent,{side:"bottom",className:"text-xs",children:"Open query in Logs Explorer"})]}),(0,t.jsx)(x.default,{onSelectId:L,additionalOptions:D===k.LogsTableName.EDGE&&(H??[]).length>0?[{id:`${P}-all`,name:"API Load Balancer"}]:[]})]}):(0,t.jsx)(b.Button,{asChild:!0,type:"default",onClick:y,children:(0,t.jsx)(f.default,{href:S,children:"Explore via query"})})]})]})})};var ej=e.i(979377),eb=e.i(280590);e.s(["LogsPreviewer",0,({projectRef:e,queryType:a,filterOverride:c,condensedLayout:u=!1,tableName:d,children:p,EmptyState:h,filterPanelClassName:m})=>{let f=(0,o.useFlag)("universalFilterBar"),g=(0,l.useRouter)(),{db:x}=(0,i.useParams)(),{data:y}=(0,U.useSelectedOrganizationQuery)(),v=(0,K.useDatabaseSelectorStateSnapshot)(),[j,S]=(0,s.useState)(!0),[C,N]=(0,s.useState)(function(){let e=g.query.iso_timestamp_start,t=g.query.iso_timestamp_end;if(e&&t)return{to:t,from:e,text:`${(0,r.default)(e).format("DD MMM, HH:mm")} - ${(0,r.default)(t).format("DD MMM, HH:mm")}`,isHelper:!1};let a=k.PREVIEWER_DATEPICKER_HELPERS.find(e=>e.default);return{to:a.calcTo(),from:a.calcFrom(),text:a.text,isHelper:!0}}()),{search:w,setSearch:O,timestampStart:E,timestampEnd:T,setTimeRange:I,filters:P,setFilters:$}=(0,A.useLogsUrlState)();(0,s.useEffect)(()=>{E&&T&&N({to:T,from:E,text:`${(0,r.default)(E).format("DD MMM, HH:mm")} - ${(0,r.default)(T).format("DD MMM, HH:mm")}`,isHelper:!1})},[E,T]);let[B,V]=(0,F.useSelectedLog)(),{data:Q,isSuccess:Y}=(0,R.useReadReplicasQuery)({projectRef:e}),J=d||k.LOGS_TABLES[a],{error:X,logData:Z,params:ee,newCount:et,isLoading:er,eventChartData:ea,isLoadingOlder:en,loadOlder:el,refresh:es}=(0,M.default)({projectRef:e,table:J,filterOverride:c}),{data:eo,isLoading:ei,error:ec}=q({projectRef:e,id:B??void 0,queryType:a,paramsToMerge:ee}),{showUpgradePrompt:eu,setShowUpgradePrompt:ed}=(0,z.useUpgradePrompt)(E),{getEntitlementNumericValue:ep}=(0,eb.useCheckEntitlements)("log.retention_days"),eh=ep(),em=async(e,{query:t,to:r,from:a})=>{"search-input-change"===e?(O(t||""),V(null)):"event-chart-bar-click"===e?I(a||"",r||""):"datepicker-change"===e&&((0,H.maybeShowUpgradePromptIfNotEntitled)(a||"",eh)?ed(!eu):I(a||"",r||""))};(0,s.useEffect)(()=>{E&&(0,H.maybeShowUpgradePromptIfNotEntitled)(E,eh)&&ed(!eu)},[E,y]),(0,s.useEffect)(()=>{void 0!==x?void 0!==Q?.find(e=>e.identifier===x)&&v.setSelectedDatabaseId(x):void 0!==v.selectedDatabaseId&&v.selectedDatabaseId!==e&&(k.LOG_ROUTES_WITH_REPLICA_SUPPORT.includes(g.pathname)?g.push({pathname:g.pathname,query:{...g.query,db:v.selectedDatabaseId}}):v.setSelectedDatabaseId(e))},[x,Y]);let ef={className:m,csvData:Z,isLoading:er,newCount:et,onRefresh:()=>{if(C.isHelper){let e=k.PREVIEWER_DATEPICKER_HELPERS.find(e=>e.text===C.text);e&&I(e.calcFrom(),T)}es()},onSearch:em,defaultSearchValue:w,defaultToValue:T,defaultFromValue:E,queryUrl:`/project/${e}/logs/explorer?q=${encodeURIComponent(ee.sql||"")}&its=${encodeURIComponent(E)}&ite=${encodeURIComponent(T)}`,onSelectTemplate:e=>{$({...P,search_query:e.searchString})},filters:P,onFiltersChange:$,table:J,condensedLayout:u,isShowingEventChart:j,onToggleEventChart:()=>S(!j),onSelectedDatabaseChange:t=>{$({...P,database:t!==e?t:void 0});let{db:r,...a}=g.query;g.push({pathname:g.pathname,query:t!==e?{...g.query,db:t}:a})},selectedDatePickerValue:C,setSelectedDatePickerValue:N};return(0,t.jsxs)("div",{className:"flex-1 flex flex-col h-full",children:[f?(0,t.jsx)(ev,{...ef}):(0,t.jsx)(_,{...ef}),p,(0,t.jsx)("div",{className:"transition-all duration-500 "+(j&&Z.length>0?"mb-2 mt-1 opacity-100":"h-0 opacity-0"),children:(0,t.jsx)("div",{className:u?"px-3":"",children:j&&(0,t.jsx)(W.LogsBarChart,{data:ea,onBarClick:e=>{var t;let a,n,l,s;if(!e?.timestamp)return;let{start:o,end:i}=(t=e.timestamp,l=(0,r.default)(t).toISOString(),(s=(T?(0,r.default)(T):(0,r.default)()).diff((0,r.default)(E),"hour",!0))>=12?(a=.5,n="hour"):s>=1?(a=2.5,n="minute"):s>=1/30?(a=1,n="minute"):(a=7.5,n="second"),{start:(0,r.default)(l).subtract(a,n).toISOString(),end:(0,r.default)(l).add(a,n).toISOString()});em("event-chart-bar-click",{query:P.search_query?.toString(),to:i,from:o})},EmptyState:(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-[67px]",children:[(0,t.jsx)("p",{className:"text-foreground-light text-xs",children:"No data"}),(0,t.jsx)("p",{className:"text-foreground-lighter text-xs",children:"It may take up to 24 hours for data to refresh"})]})})})}),(0,t.jsxs)("div",{className:"relative flex flex-col flex-grow flex-1 overflow-auto",children:[(0,t.jsx)(L.default,{active:er}),(0,t.jsx)(D.default,{active:er,children:(0,t.jsx)(G.default,{projectRef:e,isLoading:er,data:Z,queryType:a,isHistogramShowing:j,onHistogramToggle:()=>S(!j),error:X,EmptyState:h,onSelectedLogChange:e=>V(e?.id??null),selectedLog:eo,isSelectedLogLoading:ei,selectedLogError:ec??void 0})})]}),!X&&Z.length>0&&(0,t.jsxs)("div",{className:"border-t flex flex-row items-center gap-3 p-2",children:[(0,t.jsx)(b.Button,{onClick:el,icon:(0,t.jsx)(n,{}),type:"default",loading:en,disabled:en,children:"Load older"}),(0,t.jsxs)("div",{className:"text-sm text-foreground-lighter",children:["Showing ",(0,t.jsx)("span",{className:"font-mono",children:Z.length})," results"]}),(0,t.jsx)("div",{className:"flex flex-row justify-end mt-2",children:(0,t.jsx)(ej.default,{show:eu,setShowUpgradePrompt:ed})})]})]})}],555979)}]);

//# debugId=fef1ec97-085b-9aa5-f3d7-d04b2a321291
//# sourceMappingURL=dfb06a5cddaf0b59.js.map