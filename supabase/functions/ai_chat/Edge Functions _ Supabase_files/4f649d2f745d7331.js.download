;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="791241ef-89df-ca3f-ae0d-07a7d4561289")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,693241,e=>{"use strict";var t=e.i(478902),a=e.i(710483);let s=({resourceText:e,isFullPage:s=!1})=>{let i=()=>(0,t.jsx)(a.Admonition,{type:"warning",title:`You need additional permissions to ${e}`,description:"Contact your organization owner or administrator for assistance."});return s?(0,t.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,t.jsx)("div",{className:"max-w-lg",children:(0,t.jsx)(i,{})})}):(0,t.jsx)(i,{})};e.s(["NoPermission",0,s,"default",0,s])},102703,e=>{"use strict";var t=e.i(478902),a=e.i(17203),s=e.i(180148),i=e.i(699879),n=e.i(215261),r=e.i(389959),l=e.i(837710);let o=(0,r.forwardRef)(({icon:e,title:o,description:c,url:u,urlLabel:d="Read more",defaultVisibility:m=!1,hideCollapse:p=!1,button:_,className:h="",block:b=!1},f)=>{let[g,A]=(0,r.useState)(m);return(0,t.jsx)("div",{ref:f,role:"alert",className:`${b?"block w-full":""}
      block w-full rounded-md border bg-surface-300/25 py-3 ${h}`,children:(0,t.jsxs)("div",{className:"flex flex-col px-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex w-full space-x-3 items-center",children:[e&&(0,t.jsx)("span",{className:"text-foreground-lighter",children:e}),(0,t.jsx)("div",{className:"flex-grow",children:(0,t.jsx)("h5",{className:"text-foreground",children:o})})]}),c&&!p?(0,t.jsx)("div",{className:"cursor-pointer text-foreground-lighter",onClick:()=>A(!g),children:g?(0,t.jsx)(i.Minimize2,{size:14,strokeWidth:1.5}):(0,t.jsx)(s.Maximize2,{size:14,strokeWidth:1.5})}):null]}),(c||u||_)&&(0,t.jsxs)("div",{className:`flex flex-col space-y-3 overflow-hidden transition-all ${g?"mt-3":""}`,style:{maxHeight:500*!!g},children:[(0,t.jsx)("div",{className:"text-foreground-light text-sm",children:c}),u&&(0,t.jsx)("div",{children:(0,t.jsx)(l.Button,{asChild:!0,type:"default",icon:(0,t.jsx)(a.ExternalLink,{}),children:(0,t.jsx)(n.default,{href:u,target:"_blank",rel:"noreferrer",children:d})})}),_&&(0,t.jsx)("div",{children:_})]})]})})});o.displayName="InformationBox",e.s(["default",0,o])},450972,e=>{"use strict";var t=e.i(248593),a=e.i(242882),s=e.i(234745),i=e.i(635494);e.i(10429);var n=e.i(837508),r=e.i(667286);async function l({projectRef:e,connectionString:a},i,n){if(!e)throw Error("projectRef is required");let r=new Headers(n);a&&r.set("x-connection-encrypted",a);let{data:l,error:o}=await (0,s.get)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":a,"x-pg-application-name":t.DEFAULT_PLATFORM_APPLICATION_NAME},path:{ref:e}},headers:r,signal:i});return o&&(0,s.handleError)(o),l}e.s(["useDatabaseExtensionsQuery",0,({projectRef:e,connectionString:t},{enabled:s=!0,...o}={})=>{let{data:c}=(0,i.useSelectedProjectQuery)(),u=c?.status===n.PROJECT_STATUS.ACTIVE_HEALTHY;return(0,a.useQuery)({queryKey:r.databaseExtensionsKeys.list(e),queryFn:({signal:a})=>l({projectRef:e,connectionString:t},a),enabled:s&&void 0!==e&&u,...o})}])},12214,e=>{"use strict";var t=e.i(615515);let a=e=>Object.fromEntries(e.map(e=>e.split("=")));function s(e,t){if("wasm_fdw_handler"===e.handlerName){let s=a(t?.server_options??[]);return e.server.options.find(e=>"fdw_package_name"===e.name)?.defaultValue===s.fdw_package_name}return e.handlerName===t?.handler}function i(e){return t.WRAPPERS.find(t=>s(t,e))}e.s(["convertKVStringArrayToJson",0,a,"formatWrapperTables",0,(e,a)=>(e?.tables??[]).map(s=>{let i=0,n=Object.fromEntries(s.options.map(e=>e.split("=")));switch(e.handler){case t.WRAPPER_HANDLERS.STRIPE:i=a?.tables.findIndex(e=>e.options.find(e=>"object"===e.name)?.defaultValue===n.object)??0;break;case t.WRAPPER_HANDLERS.FIREBASE:i="auth/users"===n.object?a?.tables.findIndex(e=>e.options.find(e=>"auth/users"===e.defaultValue))??0:a?.tables.findIndex(e=>"Firestore Collection"===e.label)??0;case t.WRAPPER_HANDLERS.S3:case t.WRAPPER_HANDLERS.AIRTABLE:case t.WRAPPER_HANDLERS.LOGFLARE:case t.WRAPPER_HANDLERS.BIG_QUERY:case t.WRAPPER_HANDLERS.CLICK_HOUSE:}return{...n,index:i,id:s.id,columns:s.columns,is_new_schema:!1,schema:s.schema,schema_name:s.schema,table_name:s.name}}),"getWrapperMetaForWrapper",()=>i,"makeValidateRequired",0,e=>{let t=new Set(e.filter(e=>e.required).map(e=>e.name)),a=new Set(Array.from(t).filter(e=>e.includes("."))),s=Array.from(a);return e=>Object.fromEntries(Object.entries(e).flatMap(([e,t])=>Array.isArray(t)?[[e,t],...t.map((t,a)=>[`${e}.${a}`,t])]:[[e,t]]).filter(([e,i])=>{let[n,r]=e.split(".");if(void 0!==r&&t.has(n)&&Object.keys(i).some(e=>a.has(`${n}.${e}`))){let e=s.find(e=>e.startsWith(`${n}.`));return!!e&&!i[e.split(".")[1]]}return t.has(n)&&(Array.isArray(i)?i.length<1:!i)}).map(([e])=>"table_name"===e?[e,"Please provide a name for your table"]:"columns"===e?[e,"Please select at least one column"]:[e,"This field is required"]))},"wrapperMetaComparator",()=>s])},584258,e=>{"use strict";e.s(["fdwKeys",0,{list:e=>["projects",e,"fdws"]}])},298625,e=>{"use strict";var t=e.i(242882),a=e.i(714403),s=e.i(584258);async function i({projectRef:e,connectionString:t},s){let i=`
    select
      s.oid as "id",
      w.fdwname as "name",
      s.srvname as "server_name",
      s.srvoptions as "server_options",
      c.proname as "handler",
      (
        select jsonb_agg(
          jsonb_build_object(
            'id', c.oid::bigint,
            'schema', relnamespace::regnamespace::text,
            'name', c.relname,
            'columns', (
              select jsonb_agg(
                jsonb_build_object(
                  'name', a.attname,
                  'type', pg_catalog.format_type(a.atttypid, a.atttypmod)
                )
              )
              from pg_catalog.pg_attribute a
              where a.attrelid = c.oid and a.attnum > 0 and not a.attisdropped
            ),
            'options', t.ftoptions
          )
        )
        from pg_catalog.pg_class c
        join pg_catalog.pg_foreign_table t on c.oid = t.ftrelid
        where c.oid = any (select t.ftrelid from pg_catalog.pg_foreign_table t where t.ftserver = s.oid)
      ) as "tables"
    from pg_catalog.pg_foreign_server s
    join pg_catalog.pg_foreign_data_wrapper w on s.srvfdw = w.oid
    join pg_catalog.pg_proc c on w.fdwhandler = c.oid;
  `,{result:n}=await (0,a.executeSql)({projectRef:e,connectionString:t,sql:i,queryKey:["fdws"]},s);return n}e.s(["getFDWs",()=>i,"useFDWsQuery",0,({projectRef:e,connectionString:a},{enabled:n=!0,...r}={})=>(0,t.useQuery)({queryKey:s.fdwKeys.list(e),queryFn:({signal:t})=>i({projectRef:e,connectionString:a},t),enabled:n&&void 0!==e,...r})])},796238,e=>{"use strict";let t=(0,e.i(388019).default)("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);e.s(["Layers",()=>t],796238)},300424,e=>{"use strict";var t=e.i(478902),a=e.i(902858),s=e.i(370410),i=e.i(365257),n=e.i(479232),r=e.i(389959),l=e.i(801834),o=e.i(2579),c=e.i(635494),u=e.i(206413),d=e.i(592360),m=e.i(178527),p=e.i(837710),_=e.i(703526),h=e.i(917007),b=e.i(920432),f=e.i(549815),g=e.i(911509),A=e.i(996960),y=e.i(866205),x=e.i(793912),C=e.i(135144),E=e.i(689805),N=e.i(396831),v=e.i(903248);e.s(["default",0,({className:e,disabled:w=!1,size:S="tiny",showError:j=!0,selectedSchemaName:k,supportSelectAll:O=!1,excludedSchemas:T=[],onSelectSchema:L,onSelectCreateSchema:R,portal:B=!0,align:F="start"})=>{let[D,I]=(0,r.useState)(!1),{can:P}=(0,o.useAsyncCheckPermissions)(a.PermissionAction.TENANT_SQL_ADMIN_WRITE,"schemas"),{data:M}=(0,c.useSelectedProjectQuery)(),{data:q,isPending:U,isSuccess:z,isError:Y,error:$,refetch:W}=(0,l.useSchemasQuery)({projectRef:M?.ref,connectionString:M?.connectionString}),X=(q||[]).filter(e=>!T.includes(e.name)).sort((e,t)=>e.name.localeCompare(t.name));return(0,t.jsxs)("div",{className:e,children:[U&&(0,t.jsx)(p.Button,{type:"default",className:"w-full [&>span]:w-full",size:S,disabled:!0,children:(0,t.jsx)(v.Skeleton,{className:"w-full h-3 bg-foreground-muted"})},"schema-selector-skeleton"),j&&Y&&(0,t.jsxs)(m.Alert_Shadcn_,{variant:"warning",className:"!px-3 !py-3",children:[(0,t.jsx)(d.AlertTitle_Shadcn_,{className:"text-xs text-amber-900",children:"Failed to load schemas"}),(0,t.jsxs)(u.AlertDescription_Shadcn_,{className:"text-xs mb-2 break-words",children:["Error: ",$?.message]}),(0,t.jsx)(p.Button,{type:"default",size:"tiny",onClick:()=>W(),children:"Reload schemas"})]}),z&&(0,t.jsxs)(E.Popover_Shadcn_,{open:D,onOpenChange:I,modal:!1,children:[(0,t.jsx)(C.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(p.Button,{size:S,disabled:w,type:"default","data-testid":"schema-selector",className:"w-full [&>span]:w-full !pr-1 space-x-1",iconRight:(0,t.jsx)(i.ChevronsUpDown,{className:"text-foreground-muted",strokeWidth:2,size:14}),children:k?(0,t.jsxs)("div",{className:"w-full flex gap-1",children:[(0,t.jsx)("p",{className:"text-foreground-lighter",children:"schema"}),(0,t.jsx)("p",{className:"text-foreground",children:"*"===k?"All schemas":k})]}):(0,t.jsx)("div",{className:"w-full flex gap-1",children:(0,t.jsx)("p",{className:"text-foreground-lighter",children:"Choose a schema..."})})})}),(0,t.jsx)(x.PopoverContent_Shadcn_,{className:"p-0 min-w-[200px] pointer-events-auto",side:"bottom",align:F,portal:B,sameWidthAsTrigger:!0,children:(0,t.jsxs)(y.Command_Shadcn_,{children:[(0,t.jsx)(b.CommandInput_Shadcn_,{placeholder:"Find schema..."}),(0,t.jsxs)(g.CommandList_Shadcn_,{children:[(0,t.jsx)(_.CommandEmpty_Shadcn_,{children:"No schemas found"}),(0,t.jsx)(h.CommandGroup_Shadcn_,{children:(0,t.jsxs)(N.ScrollArea,{className:(X||[]).length>7?"h-[210px]":"",children:[O&&(0,t.jsxs)(f.CommandItem_Shadcn_,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{L("*"),I(!1)},onClick:()=>{L("*"),I(!1)},children:[(0,t.jsx)("span",{children:"All schemas"}),"*"===k&&(0,t.jsx)(s.Check,{className:"text-brand",strokeWidth:2,size:16})]},"select-all"),X?.map(e=>(0,t.jsxs)(f.CommandItem_Shadcn_,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{L(e.name),I(!1)},onClick:()=>{L(e.name),I(!1)},children:[(0,t.jsx)("span",{children:e.name}),k===e.name&&(0,t.jsx)(s.Check,{className:"text-brand",strokeWidth:2,size:16})]},e.id))]})}),void 0!==R&&P&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(A.CommandSeparator_Shadcn_,{}),(0,t.jsx)(h.CommandGroup_Shadcn_,{children:(0,t.jsxs)(f.CommandItem_Shadcn_,{className:"cursor-pointer flex items-center gap-x-2 w-full",onSelect:()=>{R(),I(!1)},onClick:()=>{R(),I(!1)},children:[(0,t.jsx)(n.Plus,{size:12}),"Create a new schema"]})})]})]})]})})]})]})}])},983783,e=>{"use strict";var t=e.i(4196),a=e.i(389959);e.i(128328);var s=e.i(947748),i=e.i(158639);e.s(["useQuerySchemaState",0,()=>{var e;let{ref:n}=(0,i.useParams)(),r=n&&n.length>0&&window.localStorage.getItem(s.LOCAL_STORAGE_KEYS.LAST_SELECTED_SCHEMA(n))||"public",[l,o]=(e=(0,a.useMemo)(()=>r,[n]),(0,t.useQueryState)("schema",t.parseAsString.withDefault(e).withOptions({clearOnDefault:!1})));return(0,a.useEffect)(()=>{n&&n.length>0&&window.localStorage.setItem(s.LOCAL_STORAGE_KEYS.LAST_SELECTED_SCHEMA(n),l)},[l,n]),{selectedSchema:l,setSelectedSchema:o}}])},892277,e=>{"use strict";var t=e.i(478902),a=e.i(389959),s=e.i(837710),i=e.i(253214),n=e.i(392491),r=e.i(710483);let l=({onClose:e})=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.DialogHeader,{children:(0,t.jsx)(i.DialogTitle,{children:"Schemas managed by Supabase"})}),(0,t.jsx)(i.DialogSectionSeparator,{}),(0,t.jsxs)(i.DialogSection,{className:"space-y-2 prose",children:[(0,t.jsx)("p",{className:"text-sm",children:"The following schemas are managed by Supabase and are currently protected from write access through the dashboard."}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:n.INTERNAL_SCHEMAS.map(e=>(0,t.jsx)("code",{className:"text-xs",children:e},e))}),(0,t.jsx)("p",{className:"text-sm !mt-4",children:"These schemas are critical to the functionality of your Supabase project and hence we highly recommend not altering them."}),(0,t.jsx)("p",{className:"text-sm",children:"You can, however, still interact with those schemas through the SQL Editor although we advise you only do so if you know what you are doing."})]}),(0,t.jsx)(i.DialogFooter,{children:(0,t.jsx)("div",{className:"flex items-center justify-end space-x-2",children:(0,t.jsx)(s.Button,{type:"default",onClick:e,children:"Understood"})})})]});e.s(["ProtectedSchemaWarning",0,({size:e="md",schema:o,entity:c})=>{let[u,d]=(0,a.useState)(!1),{isSchemaLocked:m,reason:p,fdwType:_}=(0,n.useIsProtectedSchema)({schema:o});return m?(0,t.jsx)(r.Admonition,{showIcon:"sm"!==e,layout:"sm"===e?"vertical":"horizontal",type:"note",title:"sm"===e?"Viewing protected schema":`Viewing ${c} from a protected schema`,description:"fdw"===p&&"iceberg"===_?(0,t.jsxs)("p",{children:["The ",(0,t.jsx)("code",{className:"text-code-inline",children:o})," schema is used by Supabase to connect to analytics buckets and is read-only through the dashboard."]}):"fdw"===p&&"s3_vectors"===_?(0,t.jsxs)("p",{children:["The ",(0,t.jsx)("code",{className:"text-code-inline",children:o})," schema is used by Supabase to connect to vector buckets and is read-only through the dashboard."]}):(0,t.jsxs)("p",{children:["The ",(0,t.jsx)("code",{className:"text-code-inline",children:o})," schema is managed by Supabase and is read-only through the dashboard."]}),actions:("fdw"!==p||"iceberg"!==_&&"s3_vectors"!==_)&&(0,t.jsxs)(i.Dialog,{open:u,onOpenChange:d,children:[(0,t.jsx)(i.DialogTrigger,{asChild:!0,children:(0,t.jsx)(s.Button,{type:"default",size:"tiny",onClick:()=>d(!0),children:"Learn more"})}),(0,t.jsx)(i.DialogContent,{children:(0,t.jsx)(l,{onClose:()=>d(!1)})})]})}):null}])},525070,e=>{"use strict";var t=e.i(478902);let a=(0,e.i(388019).default)("BookOpenText",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}],["path",{d:"M6 8h2",key:"30oboj"}],["path",{d:"M6 12h2",key:"32wvfc"}],["path",{d:"M16 8h2",key:"msurwy"}],["path",{d:"M16 12h2",key:"7q9ll5"}]]);e.i(128328);var s=e.i(158639),i=e.i(162082),n=e.i(265735),r=e.i(876298),l=e.i(215312);e.s(["APIDocsButton",0,({section:e,source:o})=>{let c=(0,r.useAppStateSnapshot)(),{ref:u}=(0,s.useParams)(),{data:d}=(0,n.useSelectedOrganizationQuery)(),{mutate:m}=(0,i.useSendEventMutation)();return(0,t.jsx)(l.ButtonTooltip,{size:"tiny",type:"default",onClick:()=>{e&&c.setActiveDocsSection(e),c.setShowProjectApiDocs(!0),m({action:"api_docs_opened",properties:{source:o},groups:{project:u??"Unknown",organization:d?.slug??"Unknown"}})},icon:(0,t.jsx)(a,{}),className:"h-7 w-7",tooltip:{content:{side:"bottom",text:"API Docs"}}})}],525070)},686415,e=>{"use strict";var t=e.i(478902),a=e.i(389959),s=e.i(793912),i=e.i(135144),n=e.i(689805),r=e.i(843778),l=e.i(215312),o=e.i(88816),c=e.i(659016),u=e.i(201461),d=e.i(883668),m=e.i(71011);let p=({user:e})=>{let a=(0,m.getAvatarUrl)(e),s=(0,m.getDisplayName)(e,e.email??e.phone??e.id??"Unknown");return(0,t.jsxs)("div",{className:"flex gap-1 items-center pl-0.5 pr-1.5 h-[21px] bg-surface-200 rounded-full overflow-hidden",children:[a?(0,t.jsx)("img",{className:"rounded-full w-[18px] h-[18px]",src:a,alt:s}):(0,t.jsx)("div",{className:"rounded-full w-[18px] h-[18px] bg-surface-100 border flex items-center justify-center text-light",children:(0,t.jsx)(c.User,{size:12,strokeWidth:2})}),(0,t.jsx)("span",{className:"truncate max-w-[84px]",children:s})]})},_=({sub:e})=>(0,t.jsxs)("div",{className:"flex gap-1 items-center pl-0.5 pr-1.5 h-[21px] bg-surface-200 rounded-full overflow-hidden",children:[(0,t.jsx)("div",{className:"rounded-full w-[18px] h-[18px] bg-surface-100 border flex items-center justify-center text-light",children:(0,t.jsx)(c.User,{size:12,strokeWidth:2})}),(0,t.jsx)("span",{className:"truncate max-w-[84px]",children:e})]});e.s(["RoleImpersonationPopover",0,({portal:e=!0,serviceRoleLabel:c,variant:m="regular",align:h="end",disallowAuthenticatedOption:b=!1,disabled:f=!1,disabledTooltip:g})=>{let A=(0,u.useRoleImpersonationStateSnapshot)(),[y,x]=(0,a.useState)(!1),C=A.role?.role??c??"service role";return(0,t.jsxs)(n.Popover_Shadcn_,{open:y,onOpenChange:x,children:[(0,t.jsx)(i.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(l.ButtonTooltip,{size:"tiny",type:"default",className:(0,r.cn)("h-[26px] pr-3 gap-0","connected-on-right"===m&&"rounded-r-none border-r-0","connected-on-left"===m&&"rounded-l-none border-l-0","connected-on-both"===m&&"rounded-none border-x-0"),disabled:f,tooltip:{content:{side:"bottom",text:g,className:"text-center w-72"}},children:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{className:"text-foreground-muted",children:"Role"}),(0,t.jsx)("span",{children:C}),A.role?.type==="postgrest"&&"authenticated"===A.role.role&&(0,t.jsxs)(t.Fragment,{children:["native"===A.role.userType&&A.role.user?(0,t.jsx)(p,{user:A.role.user}):"external"===A.role.userType&&A.role.externalAuth?(0,t.jsx)(_,{sub:A.role.externalAuth.sub}):null,(0,t.jsx)("span",{className:"text-xs text-foreground-lighter font-light",children:"aal2"===A.role.aal?"AAL2":"AAL1"})]}),(0,t.jsx)(o.ChevronDown,{className:"text-muted",strokeWidth:1,size:12})]})})}),(0,t.jsx)(s.PopoverContent_Shadcn_,{portal:e,className:"p-0 w-[592px] overflow-hidden",side:"bottom",align:h,children:(0,t.jsx)(d.RoleImpersonationSelector,{serviceRoleLabel:c,disallowAuthenticatedOption:b})})]})}])},448761,457395,e=>{"use strict";var t=e.i(10429);let a=[{id:1,type:"template",title:"Create table",description:'Basic table template. Change "table_name" to the name you prefer.',sql:`create table table_name (
  id bigint generated by default as identity primary key,
  inserted_at timestamp with time zone default timezone('utc'::text, now()) not null,
  updated_at timestamp with time zone default timezone('utc'::text, now()) not null,
  data jsonb,
  name text
);`},{id:2,type:"template",title:"Add view",description:"Template to add a view. Make sure to change the table and column names to ones that already exist.",sql:`CREATE VIEW countries_view AS
SELECT id, continent
FROM countries;`},{id:3,type:"template",title:"Add column",description:"Template to add a column. Make sure to change the name and type.",sql:`alter table table_name
add column new_column_name data_type;`},{id:4,type:"template",title:"Add comments",description:"Templates to add a comment to either a table or a column.",sql:`comment on table table_name is 'Table description';
comment on column table_name.column_name is 'Column description';`},{id:5,type:"template",title:"Show extensions",description:"Get a list of extensions in your database and status.",sql:`select
  name, comment, default_version, installed_version
from
  pg_available_extensions
order by
  name asc;`},{id:6,type:"template",title:"Show version",description:"Get your Postgres version.",sql:`select * from
  (select version()) as version,
  (select current_setting('server_version_num')) as version_number;`},{id:7,type:"template",title:"Show active connections",description:"Get the number of active and max connections.",sql:`select * from
(select count(pid) as active_connections FROM pg_stat_activity where state = 'active') active_connections,
(select setting as max_connections from pg_settings where name = 'max_connections') max_connections;`},{id:8,type:"template",title:"Automatically update timestamps",description:"Update a column timestamp on every update.",sql:`
create extension if not exists moddatetime schema extensions;

-- assuming the table name is "todos", and a timestamp column "updated_at"
-- this trigger will set the "updated_at" column to the current timestamp for every update
create trigger
  handle_updated_at before update
on todos
for each row execute
  procedure moddatetime(updated_at);
  `.trim()},{id:9,type:"template",title:"Increment field value",description:"Update a field with incrementing value using stored procedure.",sql:`
create function increment(row_id int)
returns void as
$$
  update table_name
  set field_name = field_name + 1
  where id = row_id;
$$
language sql volatile;

-- you can call the function from your browser with supabase-js
-- const { data, error } = await supabase.rpc('increment', { row_id: 2 })
  `.trim()},{id:10,type:"template",title:"pg_stat_statements report",description:"Select from pg_stat_statements and view recent queries",sql:`-- pg_stat_statements report

-- A limit of 100 has been added below

select
    auth.rolname,
    statements.query,
    statements.calls,
    -- -- Postgres 13, 14
    statements.total_exec_time + statements.total_plan_time as total_time,
    statements.min_exec_time + statements.min_plan_time as min_time,
    statements.max_exec_time + statements.max_plan_time as max_time,
    statements.mean_exec_time + statements.mean_plan_time as mean_time,
    -- -- Postgres <= 12
    -- total_time,
    -- min_time,
    -- max_time,
    -- mean_time,
    statements.rows / statements.calls as avg_rows,
    statements.wal_bytes,
    statements.wal_records
  from pg_stat_statements as statements
    inner join pg_authid as auth on statements.userid = auth.oid
  order by
    total_time desc
  limit
    100;`},{id:11,type:"quickstart",title:"Colors",description:"Create a table with a list of colors and their hex values.",sql:`-- Information from Wikipedia "List of Colors"
CREATE TYPE public.color_source AS ENUM (
    '99COLORS_NET',
    'ART_PAINTS_YG07S',
    'BYRNE',
    'CRAYOLA',
    'CMYK_COLOR_MODEL',
    'COLORCODE_IS',
    'COLORHEXA',
    'COLORXS',
    'CORNELL_UNIVERSITY',
    'COLUMBIA_UNIVERSITY',
    'DUKE_UNIVERSITY',
    'ENCYCOLORPEDIA_COM',
    'ETON_COLLEGE',
    'FANTETTI_AND_PETRACCHI',
    'FINDTHEDATA_COM',
    'FERRARIO_1919',
    'FEDERAL_STANDARD_595',
    'FLAG_OF_INDIA',
    'FLAG_OF_SOUTH_AFRICA',
    'GLAZEBROOK_AND_BALDRY',
    'GOOGLE',
    'HEXCOLOR_CO',
    'ISCC_NBS',
    'KELLY_MOORE',
    'MATTEL',
    'MAERZ_AND_PAUL',
    'MILK_PAINT',
    'MUNSELL_COLOR_WHEEL',
    'NATURAL_COLOR_SYSTEM',
    'PANTONE',
    'PLOCHERE',
    'POURPRE_COM',
    'RAL',
    'RESENE',
    'RGB_COLOR_MODEL',
    'THOM_POOLE',
    'UNIVERSITY_OF_ALABAMA',
    'UNIVERSITY_OF_CALIFORNIA_DAVIS',
    'UNIVERSITY_OF_CAMBRIDGE',
    'UNIVERSITY_OF_NORTH_CAROLINA',
    'UNIVERSITY_OF_TEXAS_AT_AUSTIN',
    'X11_WEB',
    'XONA_COM'
);

create table public.colors (
  id bigint generated by default as identity primary key,
  name text,
  hex text not null,
  red int2,
  green int2,
  blue int2,
  hue int2,
  sat_hsl int2,
  light_hsl int2,
  sat_hsv int2,
  val_hsv int2,
  source color_source
);

comment on table colors is 'Full list of colors (based on various sources)';
comment on column colors.name is 'Name of the color';
comment on column colors.hex is 'Hex tripliets of the color for HTML web colors';
comment on column colors.red is 'Red in RGB (%)';
comment on column colors.green is 'Green in RGB (%)';
comment on column colors.blue is 'Blue in RGB (%)';
comment on column colors.hue is 'Hue in HSL (\xb0)';
comment on column colors.sat_hsl is 'Saturation in HSL (%)';
comment on column colors.light_hsl is 'Light in HSL (%)';
comment on column colors.sat_hsv is 'Saturation in HSV (%)';
comment on column colors.val_hsv is 'Value in HSV (%)';
comment on column colors.source is 'Source of information on the color';

insert into public.colors (name, hex, red, green, blue, hue, sat_hsl, light_hsl, sat_hsv, val_hsv, source) values
  ('Absolute Zero', '#0048BA', 0, 28, 73, 217, 100, 37, 100, 73, 'CRAYOLA'),
  ('Acid green', '#B0BF1A', 69, 75, 10, 65, 76, 43, 76, 75, 'ART_PAINTS_YG07S'),
  ('Aero', '#7CB9E8', 49, 73, 91, 206, 70, 70, 47, 91, 'MAERZ_AND_PAUL'),
  ('African violet', '#B284BE', 70, 52, 75, 288, 31, 63, 31.5, '75', 'PANTONE'),
  ('Air superiority blue', '#72A0C1', 45, 63, 76, 205, 39, 60, 41, 76, 'FEDERAL_STANDARD_595'),
  ('Alice blue', '#F0F8FF', 94, 97, 100, 208, 100, 97, 6, 100, 'X11_WEB'),
  ('Alizarin', '#DB2D43', 86, 18, 26, 352, 71, 52, 79, 86, 'MAERZ_AND_PAUL'),
  ('Alloy orange', '#C46210', 77, 38, 6, 27, 85, 42, 92, 77, 'CRAYOLA'),
  ('Almond', '#EED9C4', 93, 85, 77, 30, 55, 85, 18, 93, 'CRAYOLA'),
  ('Amaranth deep purple', '#9F2B68', 62, 17, 41, 328, 57, 40, 73, 62, 'MAERZ_AND_PAUL'),
  ('Amaranth pink', '#F19CBB', 95, 61, 73, 338, 75, 78, 35, 95, 'MAERZ_AND_PAUL'),
  ('Amaranth purple', '#AB274F', 67, 15, 31, 342, 63, 41, 77, 67, 'MAERZ_AND_PAUL'),
  ('Amazon', '#3B7A57', 23, 48, 34, 147, 35, 36, 52, 48, 'XONA_COM'),
  ('Amber', '#FFBF00', 100, 75, 0, 45, 100, 50, 100, 100, 'RGB_COLOR_MODEL'),
  ('Amethyst', '#9966CC', 60, 40, 80, 270, 50, 60, 50, 80, 'X11_WEB'),
  ('Android green', '#3DDC84', 24, 86, 53, 148, 69, 55, 72, 86, 'GOOGLE'),
  ('Antique brass', '#C88A65', 78, 54, 40, 22, 47, 59, 49, 78, 'CRAYOLA'),
  ('Antique bronze', '#665D1E', 40, 36, 12, 53, 55, 26, 71, 40, 'ISCC_NBS'),
  ('Antique fuchsia', '#915C83', 57, 36, 51, 316, 22, 46, 37, 57, 'PLOCHERE'),
  ('Antique ruby', '#841B2D', 52, 11, 18, 350, 66, 31, 80, 52, 'ISCC_NBS'),
  ('Antique white', '#FAEBD7', 98, 92, 84, 34, 78, 91, 14, 98, 'X11_WEB'),
  ('Apricot', '#FBCEB1', 98, 81, 69, 24, 90, 84, 29, 98, 'MAERZ_AND_PAUL'),
  ('Aqua', '#00FFFF', 0, 100, 100, 180, 100, 50, 100, 100, 'X11_WEB'),
  ('Aquamarine', '#7FFFD4', 50, 100, 83, 160, 100, 75, 50, 100, 'X11_WEB'),
  ('Arctic lime', '#D0FF14', 82, 100, 8, 72, 100, 54, 92, 100, 'CRAYOLA'),
  ('Artichoke green', '#4B6F44', 29, 44, 27, 110, 24, 35, 39, 44, 'PANTONE'),
  ('Arylide yellow', '#E9D66B', 91, 84, 42, 51, 74, 67, 54, 91, 'COLORHEXA'),
  ('Ash gray', '#B2BEB5', 70, 75, 71, 135, 9, 72, 6, 75, 'ISCC_NBS'),
  ('Atomic tangerine', '#FF9966', 100, 60, 40, 20, 100, 70, 60, 100, 'CRAYOLA'),
  ('Aureolin', '#FDEE00', 99, 93, 0, 56, 100, 50, 100, 99, 'X11_WEB'),
  ('Azure', '#007FFF', 0, 50, 100, 210, 100, 50, 100, 100, 'RGB_COLOR_MODEL'),
  ('Azure (X11/web color)', '#F0FFFF', 94, 100, 100, 180, 100, 97, 6, 100, 'X11_WEB'),
  ('Baby blue', '#89CFF0', 54, 81, 94, 199, 77, 74, 43, 94, 'MAERZ_AND_PAUL'),
  ('Baby blue eyes', '#A1CAF1', 63, 79, 95, 209, 74, 79, 33, 95, 'PLOCHERE'),
  ('Baby pink', '#F4C2C2', 96, 76, 76, 0, 69, 86, 20, 96, 'ISCC_NBS'),
  ('Baby powder', '#FEFEFA', 100, 100, 98, 60, 67, 99, 2, 100, 'CRAYOLA'),
  ('Baker-Miller pink', '#FF91AF', 100, 57, 69, 344, 100, 78, 43, 100, 'BYRNE'),
  ('Banana Mania', '#FAE7B5', 98, 91, 71, 43, 87, 85, 28, 98, 'CRAYOLA'),
  ('Barbie Pink', '#DA1884', 85, 9, 52, 327, 80, 48, 89, 85, 'MATTEL'),
  ('Barn red', '#7C0A02', 49, 4, 1, 4, 97, 25, 98, 49, 'MILK_PAINT'),
  ('Battleship grey', '#848482', 52, 52, 51, 60, 1, 51, 2, 52, 'ISCC_NBS'),
  ('Beau blue', '#BCD4E6', 74, 83, 90, 206, 46, 82, 18, 90, 'PLOCHERE'),
  ('Beaver', '#9F8170', 62, 51, 44, 22, 20, 53, 30, 62, 'CRAYOLA'),
  ('Beige', '#F5F5DC', 96, 96, 86, 60, 56, 91, 10, 96, 'X11_WEB'),
  ('B''dazzled blue', '#2E5894', 18, 35, 58, 215, 53, 38, 69, 58, 'CRAYOLA'),
  ('Big dip o''ruby', '#9C2542', 61, 15, 26, 345, 62, 38, 76, 61, 'CRAYOLA'),
  ('Bisque', '#FFE4C4', 100, 89, 77, 33, 100, 88, 23, 100, 'X11_WEB'),
  ('Bistre', '#3D2B1F', 24, 17, 12, 24, 33, 18, 49, 24, '99COLORS_NET'),
  ('Bistre brown', '#967117', 59, 44, 9, 43, 73, 34, 85, 59, 'ISCC_NBS'),
  ('Bitter lemon', '#CAE00D', 79, 88, 5, 66, 89, 47, 94, 88, 'XONA_COM'),
  ('Black', '#000000', 0, 0, 0, 0, 0, 0, 0, 0, 'RGB_COLOR_MODEL'),
  ('Black bean', '#3D0C02', 24, 5, 1, 10, 94, 12, 97, 24, 'XONA_COM'),
  ('Black coral', '#54626F', 33, 38, 44, 209, 14, 38, 24, 44, 'CRAYOLA'),
  ('Black olive', '#3B3C36', 23, 24, 21, 70, 5, 22, 10, 24, 'RAL'),
  ('Black Shadows', '#BFAFB2', 75, 69, 70, 349, 11, 72, 8, 75, 'CRAYOLA'),
  ('Blanched almond', '#FFEBCD', 100, 92, 80, 36, 100, 90, 20, 100, 'X11_WEB'),
  ('Blast-off bronze', '#A57164', 65, 44, 39, 12, 27, 52, 39, 65, 'CRAYOLA'),
  ('Bleu de France', '#318CE7', 19, 55, 91, 210, 79, 55, 79, 91, 'POURPRE_COM'),
  ('Blizzard blue', '#ACE5EE', 67, 90, 93, 188, 66, 80, 28, 93, 'CRAYOLA'),
  ('Blood red', '#660000', 40, 0, 0, 0, 100, 20, 100, 40, 'THOM_POOLE'),
  ('Blue', '#0000FF', 0, 0, 100, 240, 100, 50, 100, 100, 'X11_WEB'),
  ('Blue (Crayola)', '#1F75FE', 12, 46, 100, 217, 99, 56, 88, 100, 'CRAYOLA'),
  ('Blue (Munsell)', '#0093AF', 0, 58, 69, 190, 100, 34, 100, 69, 'MUNSELL_COLOR_WHEEL'),
  ('Blue (NCS)', '#0087BD', 0, 53, 74, 197, 100, 37, 100, 74, 'NATURAL_COLOR_SYSTEM'),
  ('Blue (Pantone)', '#0018A8', 0, 9, 66, 231, 100, 33, 100, 66, 'PANTONE'),
  ('Blue (pigment)', '#333399', 20, 20, 60, 240, 50, 40, 67, 60, 'CMYK_COLOR_MODEL'),
  ('Blue bell', '#A2A2D0', 64, 64, 82, 240, 33, 73, 22, 82, 'CRAYOLA'),
  ('Blue-gray (Crayola)', '#6699CC', 40, 60, 80, 210, 50, 60, 50, 80, 'CRAYOLA'),
  ('Blue jeans', '#5DADEC', 36, 68, 93, 206, 79, 65, 61, 93, 'CRAYOLA'),
  ('Blue sapphire', '#126180', 7, 38, 50, 197, 75, 29, 86, 50, 'PANTONE'),
  ('Blue-violet', '#8A2BE2', 54, 17, 89, 271, 76, 53, 81, 89, 'X11_WEB'),
  ('Blue yonder', '#5072A7', 31, 45, 65, 217, 35, 48, 52, 65, 'PANTONE'),
  ('Bluetiful', '#3C69E7', 24, 41, 91, 224, 78, 57, 74, 91, 'CRAYOLA'),
  ('Blush', '#DE5D83', 87, 36, 51, 342, 66, 62, 58, 87, 'CRAYOLA'),
  ('Bole', '#79443B', 47, 27, 23, 9, 34, 35, 51, 47, 'ISCC_NBS'),
  ('Bone', '#E3DAC9', 89, 85, 79, 39, 32, 84, 11, 89, 'KELLY_MOORE'),
  ('Brick red', '#CB4154', 80, 25, 33, 352, 57, 53, 68, 80, 'CRAYOLA'),
  ('Bright lilac', '#D891EF', 85, 57, 94, 285, 75, 75, 39, 94, 'CRAYOLA'),
  ('Bright yellow (Crayola)', '#FFAA1D', 100, 67, 11, 37, 100, 56, 89, 100, 'CRAYOLA'),
  ('British racing green', '#004225', 0, 26, 15, 154, 100, 13, 100, 26, 'COLORHEXA'),
  ('Bronze', '#CD7F32', 80, 50, 20, 30, 61, 50, 76, 80, 'MAERZ_AND_PAUL'),
  ('Brown', '#964B00', 59, 29, 0, 30, 100, 29, 100, 59, 'COLORXS'),
  ('Brown sugar', '#AF6E4D', 69, 43, 30, 20, 39, 49, 56, 69, 'CRAYOLA'),
  ('Bud green', '#7BB661', 48, 71, 38, 102, 37, 55, 47, 71, 'PANTONE'),
  ('Buff', '#FFC680', 100, 78, 50, 33, 100, 75, 50, 100, 'MAERZ_AND_PAUL'),
  ('Burgundy', '#800020', 50, 0, 13, 345, 100, 25, 100, 50, 'MAERZ_AND_PAUL'),
  ('Burlywood', '#DEB887', 87, 72, 53, 34, 57, 70, 39, 87, 'X11_WEB'),
  ('Burnished brown', '#A17A74', 63, 48, 45, 8, 19, 54, 28, 63, 'CRAYOLA'),
  ('Burnt orange', '#CC5500', 80, 33, 0, 25, 100, 40, 100, 80, 'UNIVERSITY_OF_TEXAS_AT_AUSTIN'),
  ('Burnt sienna', '#E97451', 91, 45, 32, 14, 78, 62, 65, 91, 'FERRARIO_1919'),
  ('Burnt umber', '#8A3324', 54, 20, 14, 9, 59, 34, 74, 54, 'XONA_COM'),
  ('Byzantine', '#BD33A4', 74, 20, 64, 311, 58, 47, 73, 74, 'MAERZ_AND_PAUL'),
  ('Byzantium', '#702963', 44, 16, 39, 311, 46, 30, 63, 44, 'ISCC_NBS'),
  ('Cadet blue', '#5F9EA0', 37, 62, 63, 182, 26, 50, 41, 63, 'X11_WEB'),
  ('Cadet grey', '#91A3B0', 57, 64, 69, 205, 16, 63, 18, 69, 'ISCC_NBS'),
  ('Cadmium green', '#006B3C', 0, 42, 24, 154, 100, 21, 100, 42, 'ISCC_NBS'),
  ('Cadmium orange', '#ED872D', 93, 53, 18, 28, 84, 55, 81, 93, 'ISCC_NBS'),
  ('Caf\xe9 au lait', '#A67B5B', 65, 48, 36, 26, 30, 50, 45, 65, 'ISCC_NBS'),
  ('Caf\xe9 noir', '#4B3621', 29, 21, 13, 30, 39, 21, 56, 29, 'ISCC_NBS'),
  ('Cambridge blue', '#A3C1AD', 64, 76, 68, 140, 20, 70, 16, 76, 'UNIVERSITY_OF_CAMBRIDGE'),
  ('Camel', '#C19A6B', 76, 60, 42, 33, 41, 59, 45, 76, 'ISCC_NBS'),
  ('Cameo pink', '#EFBBCC', 94, 73, 80, 340, 62, 84, 22, 94, 'ISCC_NBS'),
  ('Canary', '#FFFF99', 100, 100, 60, 60, 100, 80, 40, 100, 'CRAYOLA'),
  ('Canary yellow', '#FFEF00', 100, 94, 0, 56, 100, 50, 100, 100, 'CMYK_COLOR_MODEL'),
  ('Candy pink', '#E4717A', 89, 44, 48, 355, 68, 67, 50, 89, 'ISCC_NBS'),
  ('Cardinal', '#C41E3A', 77, 12, 23, 350, 74, 44, 85, 77, 'MAERZ_AND_PAUL'),
  ('Caribbean green', '#00CC99', 0, 80, 60, 165, 100, 40, 100, 80, 'CRAYOLA'),
  ('Carmine', '#960018', 59, 0, 9, 350, 100, 29, 100, 59, 'POURPRE_COM'),
  ('Carmine (M&P)', '#D70040', 84, 0, 25, 342, 100, 42, 100, 84, 'MAERZ_AND_PAUL'),
  ('Carnation pink', '#FFA6C9', 100, 65, 79, 336, 100, 83, 35, 100, 'CRAYOLA'),
  ('Carnelian', '#B31B1B', 70, 11, 11, 0, 74, 40, 85, 70, 'CORNELL_UNIVERSITY'),
  ('Carolina blue', '#56A0D3', 34, 63, 83, 204, 59, 58, 59, 83, 'UNIVERSITY_OF_NORTH_CAROLINA'),
  ('Carrot orange', '#ED9121', 93, 57, 13, 33, 85, 53, 86, 93, 'MAERZ_AND_PAUL'),
  ('Catawba', '#703642', 44, 21, 26, 348, 35, 33, 52, 44, 'MAERZ_AND_PAUL'),
  ('Cedar Chest', '#C95A49', 79, 35, 29, 8, 54, 54, 64, 79, 'CRAYOLA'),
  ('Celadon', '#ACE1AF', 67, 88, 69, 123, 47, 78, 24, 88, 'ENCYCOLORPEDIA_COM'),
  ('Celeste', '#B2FFFF', 70, 100, 100, 180, 100, 85, 30, 100, 'FANTETTI_AND_PETRACCHI'),
  ('Cerise', '#DE3163', 87, 19, 39, 343, 72, 53, 78, 87, 'MAERZ_AND_PAUL'),
  ('Cerulean', '#007BA7', 0, 48, 65, 196, 100, 33, 100, 65, 'MAERZ_AND_PAUL'),
  ('Cerulean blue', '#2A52BE', 16, 32, 75, 224, 64, 46, 78, 75, 'MAERZ_AND_PAUL'),
  ('Cerulean frost', '#6D9BC3', 43, 61, 76, 208, 42, 60, 44, 76, 'CRAYOLA'),
  ('Cerulean (Crayola)', '#1DACD6', 11, 67, 84, 194, 76, 48, 86, 84, 'CRAYOLA'),
  ('Cerulean (RGB)', '#0040FF', 0, 25, 100, 225, 100, 50, 100, 100, null),
  ('Champagne', '#F7E7CE', 97, 91, 81, 37, 72, 89, 17, 97, 'MAERZ_AND_PAUL'),
  ('Champagne pink', '#F1DDCF', 95, 87, 81, 25, 55, 88, 14, 95, 'PANTONE'),
  ('Charcoal', '#36454F', 21, 27, 31, 204, 19, 26, 32, 31, 'ISCC_NBS'),
  ('Charm pink', '#E68FAC', 90, 56, 67, 340, 64, 73, 38, 90, 'PLOCHERE'),
  ('Chartreuse (web)', '#80FF00', 50, 100, 0, 90, 100, 50, 100, 100, 'RGB_COLOR_MODEL'),
  ('Cherry blossom pink', '#FFB7C5', 100, 72, 77, 348, 100, 86, 28, 100, 'MAERZ_AND_PAUL'),
  ('Chestnut', '#954535', 58, 27, 21, 10, 48, 40, 64, 58, 'MAERZ_AND_PAUL'),
  ('Chili red', '#E23D28', 89, 24, 16, 5, 76, 52, 183, 125, 'FLAG_OF_SOUTH_AFRICA'),
  ('China pink', '#DE6FA1', 87, 44, 63, 333, 63, 65, 50, 87, 'PLOCHERE'),
  ('Chinese red', '#AA381E', 67, 22, 12, 11, 70, 39, 82, 67, 'ISCC_NBS'),
  ('Chinese violet', '#856088', 52, 38, 53, 296, 17, 46, 29, 53, 'PANTONE'),
  ('Chinese yellow', '#FFB200', 100, 70, 0, 42, 100, 50, 100, 100, 'ISCC_NBS'),
  ('Chocolate (traditional)', '#7B3F00', 48, 25, 0, 31, 100, 24, 100, 48, 'MAERZ_AND_PAUL'),
  ('Chocolate (web)', '#D2691E', 82, 41, 12, 25, 75, 47, 86, 82, 'X11_WEB'),
  ('Cinereous', '#98817B', 60, 51, 48, 12, 12, 54, 19, 60, 'MAERZ_AND_PAUL'),
  ('Cinnabar', '#E34234', 89, 26, 20, 5, 76, 55, 77, 89, 'MAERZ_AND_PAUL'),
  ('Cinnamon Satin', '#CD607E', 80, 38, 49, 343, 52, 59, 53, 80, 'CRAYOLA'),
  ('Citrine', '#E4D00A', 89, 82, 4, 54, 92, 47, 96, 89, 'MAERZ_AND_PAUL'),
  ('Citron', '#9FA91F', 62, 66, 12, 64, 69, 39, 82, 66, 'XONA_COM'),
  ('Claret', '#7F1734', 50, 9, 20, 343, 69, 29, 82, 50, 'XONA_COM'),
  ('Coffee', '#6F4E37', 44, 31, 22, 25, 34, 33, 50, 44, 'ISCC_NBS'),
  ('Columbia Blue', '#B9D9EB', 73, 85, 92, 202, 56, 82, 21, 92, 'COLUMBIA_UNIVERSITY'),
  ('Congo pink', '#F88379', 97, 51, 47, 5, 90, 72, 51, 97, 'ISCC_NBS'),
  ('Cool grey', '#8C92AC', 55, 57, 67, 229, 16, 61, 19, 67, 'ISCC_NBS'),
  ('Copper', '#B87333', 72, 45, 20, 29, 57, 46, 72, 72, 'MAERZ_AND_PAUL'),
  ('Copper (Crayola)', '#DA8A67', 85, 54, 40, 18, 61, 63, 53, 85, 'CRAYOLA'),
  ('Copper penny', '#AD6F69', 68, 44, 41, 5, 29, 55, 39, 68, 'CRAYOLA'),
  ('Copper red', '#CB6D51', 80, 43, 32, 14, 54, 56, 60, 80, 'ISCC_NBS'),
  ('Copper rose', '#996666', 60, 40, 40, 0, 20, 50, 33, 60, '99COLORS_NET'),
  ('Coquelicot', '#FF3800', 100, 22, 0, 13, 100, 50, 100, 100, 'COLORHEXA'),
  ('Coral', '#FF7F50', 100, 50, 31, 16, 100, 66, 69, 100, 'X11_WEB'),
  ('Coral pink', '#F88379', 97, 51, 47, 5, 90, 72, 51, 97, 'ISCC_NBS'),
  ('Cordovan', '#893F45', 54, 25, 27, 355, 37, 39, 54, 54, 'PANTONE'),
  ('Corn', '#FBEC5D', 98, 93, 36, 54, 95, 68, 63, 98, 'MAERZ_AND_PAUL'),
  ('Cornflower blue', '#6495ED', 39, 58, 93, 219, 79, 66, 58, 93, 'X11_WEB'),
  ('Cornsilk', '#FFF8DC', 100, 97, 86, 48, 100, 93, 14, 100, 'X11_WEB'),
  ('Cosmic cobalt', '#2E2D88', 18, 18, 53, 241, 50, 36, 67, 53, 'CRAYOLA'),
  ('Cosmic latte', '#FFF8E7', 100, 97, 91, 43, 100, 95, 9, 100, 'GLAZEBROOK_AND_BALDRY'),
  ('Coyote brown', '#81613C', 51, 38, 24, 32, 37, 37, 52, 51, 'COLORCODE_IS'),
  ('Cotton candy', '#FFBCD9', 100, 74, 85, 334, 100, 87, 26, 100, 'CRAYOLA'),
  ('Cream', '#FFFDD0', 100, 99, 82, 57, 100, 91, 18, 100, 'MAERZ_AND_PAUL'),
  ('Crimson', '#DC143C', 86, 8, 24, 348, 83, 47, 91, 86, 'X11_WEB'),
  ('Crimson (UA)', '#9E1B32', 62, 11, 20, 349, 71, 36, 83, 62, 'UNIVERSITY_OF_ALABAMA'),
  ('Cultured Pearl', '#F5F5F5', 96, 96, 96, 0, 0, 96, 0, 96, 'CRAYOLA'),
  ('Cyan', '#00FFFF', 0, 100, 100, 180, 100, 50, 100, 100, 'X11_WEB'),
  ('Cyan (process)', '#00B7EB', 0, 72, 92, 193, 100, 46, 100, 92, 'CMYK_COLOR_MODEL'),
  ('Cyber grape', '#58427C', 35, 26, 49, 263, 31, 37, 47, 49, 'CRAYOLA'),
  ('Cyber yellow', '#FFD300', 100, 83, 0, 50, 100, 50, 100, 100, 'PANTONE'),
  ('Cyclamen', '#F56FA1', 96, 44, 63, 338, 87, 70, 54, 96, 'CRAYOLA'),
  ('Dandelion', '#FED85D', 100, 85, 36, 46, 99, 68, 63, 100, 'CRAYOLA'),
  ('Dark brown', '#654321', 40, 26, 13, 30, 51, 26, 67, 40, 'X11_WEB'),
  ('Dark byzantium', '#5D3954', 36, 22, 33, 315, 24, 29, 39, 36, 'ISCC_NBS'),
  ('Dark cyan', '#008B8B', 0, 55, 55, 180, 100, 27, 100, 55, 'X11_WEB'),
  ('Dark electric blue', '#536878', 33, 41, 47, 206, 18, 40, 31, 47, 'ISCC_NBS'),
  ('Dark goldenrod', '#B8860B', 72, 53, 4, 43, 89, 38, 94, 72, 'X11_WEB'),
  ('Dark green (X11)', '#006400', 0, 39, 0, 120, 100, 20, 100, 39, 'X11_WEB'),
  ('Dark jungle green', '#1A2421', 10, 14, 13, 162, 16, 12, 28, 14, 'ISCC_NBS'),
  ('Dark khaki', '#BDB76B', 74, 72, 42, 56, 38, 58, 43, 74, 'X11_WEB'),
  ('Dark lava', '#483C32', 28, 24, 20, 27, 18, 24, 31, 28, 'ISCC_NBS'),
  ('Dark liver (horses)', '#543D37', 33, 24, 22, 12, 21, 27, 35, 33, 'UNIVERSITY_OF_CALIFORNIA_DAVIS'),
  ('Dark magenta', '#8B008B', 55, 0, 55, 300, 100, 27, 100, 55, 'X11_WEB'),
  ('Dark olive green', '#556B2F', 33, 42, 18, 82, 39, 30, 56, 42, 'X11_WEB'),
  ('Dark orange', '#FF8C00', 100, 55, 0, 33, 100, 50, 100, 100, 'X11_WEB'),
  ('Dark orchid', '#9932CC', 60, 20, 80, 280, 61, 50, 75, 80, 'X11_WEB'),
  ('Dark purple', '#301934', 19, 10, 20, 291, 35, 15, 51, 20, 'ISCC_NBS'),
  ('Dark red', '#8B0000', 55, 0, 0, 0, 100, 27, 100, 55, 'X11_WEB'),
  ('Dark salmon', '#E9967A', 91, 59, 48, 15, 72, 70, 48, 91, 'X11_WEB'),
  ('Dark sea green', '#8FBC8F', 56, 74, 56, 120, 25, 65, 24, 74, 'X11_WEB'),
  ('Dark sienna', '#3C1414', 24, 8, 8, 0, 50, 16, 67, 24, 'ISCC_NBS'),
  ('Dark sky blue', '#8CBED6', 55, 75, 84, 199, 47, 69, 35, 84, 'PANTONE'),
  ('Dark slate blue', '#483D8B', 28, 24, 55, 248, 39, 39, 56, 55, 'X11_WEB'),
  ('Dark slate gray', '#2F4F4F', 18, 31, 31, 180, 25, 25, 41, 31, 'X11_WEB'),
  ('Dark spring green', '#177245', 9, 45, 27, 150, 66, 27, 80, 45, 'X11_WEB'),
  ('Dark turquoise', '#00CED1', 0, 81, 82, 181, 100, 41, 100, 82, 'X11_WEB'),
  ('Dark violet', '#9400D3', 58, 0, 83, 282, 100, 41, 100, 83, 'X11_WEB'),
  ('Davy''s grey', '#555555', 33, 33, 33, 0, 0, 33, 0, 33, 'ISCC_NBS'),
  ('Deep cerise', '#DA3287', 85, 20, 53, 330, 69, 53, 77, 85, 'CRAYOLA'),
  ('Deep champagne', '#FAD6A5', 98, 84, 65, 35, 90, 81, 34, 98, 'ISCC_NBS'),
  ('Deep chestnut', '#B94E48', 73, 31, 28, 3, 45, 50, 61, 73, 'CRAYOLA'),
  ('Deep jungle green', '#004B49', 0, 29, 29, 178, 100, 15, 100, 29, 'ISCC_NBS'),
  ('Deep pink', '#FF1493', 100, 8, 58, 328, 100, 54, 92, 100, 'X11_WEB'),
  ('Deep saffron', '#FF9933', 100, 60, 20, 30, 100, 60, 80, 100, 'FLAG_OF_INDIA'),
  ('Deep sky blue', '#00BFFF', 0, 75, 100, 195, 100, 50, 100, 100, 'X11_WEB'),
  ('Deep Space Sparkle', '#4A646C', 29, 39, 42, 194, 19, 36, 31, 42, 'CRAYOLA'),
  ('Deep taupe', '#7E5E60', 49, 37, 38, 356, 15, 43, 25, 49, 'PANTONE'),
  ('Denim', '#1560BD', 8, 38, 74, 213, 80, 41, 89, 74, 'CRAYOLA'),
  ('Denim blue', '#2243B6', 13, 26, 71, 227, 69, 42, 81, 71, 'CRAYOLA'),
  ('Desert', '#C19A6B', 76, 60, 42, 33, 41, 59, 45, 76, 'ISCC_NBS'),
  ('Desert sand', '#EDC9AF', 93, 79, 69, 25, 63, 81, 26, 93, 'CRAYOLA'),
  ('Dim gray', '#696969', 41, 41, 41, 0, 0, 41, 0, 41, 'X11_WEB'),
  ('Dodger blue', '#1E90FF', 12, 56, 100, 210, 100, 56, 88, 100, 'X11_WEB'),
  ('Drab dark brown', '#4A412A', 29, 25, 16, 43, 28, 23, 43, 29, 'PANTONE'),
  ('Duke blue', '#00009C', 0, 0, 61, 240, 100, 31, 100, 61, 'DUKE_UNIVERSITY'),
  ('Dutch white', '#EFDFBB', 94, 87, 73, 42, 62, 84, 22, 94, 'RESENE'),
  ('Ebony', '#555D50', 33, 36, 31, 97, 8, 34, 14, 36, 'MAERZ_AND_PAUL'),
  ('Ecru', '#C2B280', 76, 70, 50, 45, 35, 63, 34, 76, 'ISCC_NBS'),
  ('Eerie black', '#1B1B1B', 11, 11, 11, 0, 0, 11, 0, 11, 'CRAYOLA'),
  ('Eggplant', '#614051', 38, 25, 32, 329, 21, 32, 34, 38, 'CRAYOLA'),
  ('Eggshell', '#F0EAD6', 94, 92, 84, 46, 46, 89, 11, 94, 'ISCC_NBS'),
  ('Electric lime', '#CCFF00', 80, 100, 0, 72, 100, 50, 100, 100, 'CRAYOLA'),
  ('Electric purple', '#BF00FF', 75, 0, 100, 285, 100, 50, 100, 100, 'X11_WEB'),
  ('Electric violet', '#8F00FF', 56, 0, 100, 274, 100, 50, 100, 100, 'ISCC_NBS'),
  ('Emerald', '#50C878', 31, 78, 47, 140, 52, 55, 60, 78, 'MAERZ_AND_PAUL'),
  ('Eminence', '#6C3082', 42, 19, 51, 284, 46, 35, 63, 51, 'XONA_COM'),
  ('English lavender', '#B48395', 71, 51, 58, 338, 25, 61, 27, 71, 'PANTONE'),
  ('English red', '#AB4B52', 67, 29, 32, 356, 39, 48, 56, 67, 'ISCC_NBS'),
  ('English vermillion', '#CC474B', 80, 28, 29, 358, 57, 54, 65, 80, 'CRAYOLA'),
  ('English violet', '#563C5C', 34, 24, 36, 289, 21, 30, 35, 36, 'ISCC_NBS'),
  ('Erin', '#00FF40', 0, 100, 25, 135, 100, 50, 100, 100, 'MAERZ_AND_PAUL'),
  ('Eton blue', '#96C8A2', 59, 78, 64, 134, 31, 69, 25, 78, 'ETON_COLLEGE'),
  ('Fallow', '#C19A6B', 76, 60, 42, 33, 41, 59, 45, 76, 'ISCC_NBS'),
  ('Falu red', '#801818', 50, 9, 9, 0, 68, 30, 81, 50, 'COLORHEXA'),
  ('Fandango', '#B53389', 71, 20, 54, 320, 56, 46, 72, 71, 'MAERZ_AND_PAUL'),
  ('Fandango pink', '#DE5285', 87, 32, 52, 338, 68, 60, 63, 87, 'PANTONE'),
  ('Fawn', '#E5AA70', 90, 67, 44, 30, 69, 67, 51, 90, 'X11_WEB'),
  ('Fern green', '#4F7942', 31, 47, 26, 106, 29, 37, 45, 47, 'MAERZ_AND_PAUL'),
  ('Field drab', '#6C541E', 42, 33, 12, 42, 57, 27, 72, 42, 'ISCC_NBS'),
  ('Fiery rose', '#FF5470', 100, 33, 44, 350, 100, 67, 67, 100, 'CRAYOLA'),
  ('Finn', '#683068', 41, 19, 41, 300, 37, 30, 54, 41, 'HEXCOLOR_CO'),
  ('Firebrick', '#B22222', 70, 13, 13, 0, 68, 42, 81, 70, 'X11_WEB'),
  ('Fire engine red', '#CE2029', 81, 13, 16, 357, 73, 47, 84, 81, 'FINDTHEDATA_COM'),
  ('Flame', '#E25822', 89, 35, 13, 17, 77, 51, 85, 89, 'ISCC_NBS'),
  ('Flax', '#EEDC82', 93, 86, 51, 50, 76, 72, 45, 93, 'MAERZ_AND_PAUL'),
  ('Flirt', '#A2006D', 64, 0, 43, 320, 100, 32, 100, 64, 'XONA_COM'),
  ('Floral white', '#FFFAF0', 100, 98, 94, 40, 100, 97, 6, 100, 'X11_WEB'),
  ('Forest green (web)', '#228B22', 13, 55, 13, 120, 61, 34, 76, 55, 'X11_WEB'),
  ('French beige', '#A67B5B', 65, 48, 36, 26, 30, 50, 45, 65, 'ISCC_NBS'),
  ('French bistre', '#856D4D', 52, 43, 30, 34, 27, 41, 42, 52, 'POURPRE_COM'),
  ('French blue', '#0072BB', 0, 45, 73, 203, 100, 37, 100, 73, 'MAERZ_AND_PAUL'),
  ('French fuchsia', '#FD3F92', 99, 25, 57, 334, 98, 62, 75, 99, 'POURPRE_COM'),
  ('French lilac', '#86608E', 53, 38, 56, 290, 19, 47, 32, 56, 'ISCC_NBS'),
  ('French lime', '#9EFD38', 62, 99, 22, 89, 98, 61, 78, 99, 'POURPRE_COM'),
  ('French mauve', '#D473D4', 83, 45, 83, 300, 53, 64, 46, 83, 'POURPRE_COM'),
  ('French pink', '#FD6C9E', 99, 42, 62, 339, 97, 71, 57, 99, 'POURPRE_COM'),
  ('French raspberry', '#C72C48', 78, 17, 28, 349, 64, 48, 78, 78, 'POURPRE_COM'),
  ('French sky blue', '#77B5FE', 47, 71, 100, 212, 99, 73, 53, 100, 'POURPRE_COM'),
  ('French violet', '#8806CE', 53, 2, 81, 279, 94, 42, 97, 81, 'POURPRE_COM'),
  ('Frostbite', '#E936A7', 91, 21, 65, 322, 80, 56, 77, 91, 'CRAYOLA'),
  ('Fuchsia', '#FF00FF', 100, 0, 100, 300, 100, 50, 100, 100, 'X11_WEB'),
  ('Fuchsia (Crayola)', '#C154C1', 76, 33, 76, 300, 47, 54, 56, 76, 'CRAYOLA'),
  ('Fulvous', '#E48400', 89, 52, 0, 35, 100, 45, 100, 89, '99COLORS_NET'),
  ('Fuzzy Wuzzy', '#87421F', 53, 26, 12, 20, 63, 33, 77, 53, 'CRAYOLA');
`.trim()},{id:12,type:"quickstart",title:"Slack Clone",description:"Build a basic slack clone with Row Level Security.",sql:`
--
-- For use with https://github.com/supabase/supabase/tree/master/examples/slack-clone/nextjs-slack-clone

-- Custom types
create type public.app_permission as enum ('channels.delete', 'messages.delete');
create type public.app_role as enum ('admin', 'moderator');
create type public.user_status as enum ('ONLINE', 'OFFLINE');

-- USERS
create table public.users (
  id          uuid not null primary key, -- UUID from auth.users
  username    text,
  status      user_status default 'OFFLINE'::public.user_status
);
comment on table public.users is 'Profile data for each user.';
comment on column public.users.id is 'References the internal Supabase Auth user.';

-- CHANNELS
create table public.channels (
  id            bigint generated by default as identity primary key,
  inserted_at   timestamp with time zone default timezone('utc'::text, now()) not null,
  slug          text not null unique,
  created_by    uuid references public.users not null
);
comment on table public.channels is 'Topics and groups.';

-- MESSAGES
create table public.messages (
  id            bigint generated by default as identity primary key,
  inserted_at   timestamp with time zone default timezone('utc'::text, now()) not null,
  message       text,
  user_id       uuid references public.users not null,
  channel_id    bigint references public.channels on delete cascade not null
);
comment on table public.messages is 'Individual messages sent by each user.';

-- USER ROLES
create table public.user_roles (
  id        bigint generated by default as identity primary key,
  user_id   uuid references public.users on delete cascade not null,
  role      app_role not null,
  unique (user_id, role)
);
comment on table public.user_roles is 'Application roles for each user.';

-- ROLE PERMISSIONS
create table public.role_permissions (
  id           bigint generated by default as identity primary key,
  role         app_role not null,
  permission   app_permission not null,
  unique (role, permission)
);
comment on table public.role_permissions is 'Application permissions for each role.';

-- authorize with role-based access control (RBAC)
create function public.authorize(
  requested_permission app_permission,
  user_id uuid
)
returns boolean as
$$
  declare
    bind_permissions int;
  begin
    select
      count(*)
    from public.role_permissions
    inner join public.user_roles on role_permissions.role = user_roles.role
    where
      role_permissions.permission = authorize.requested_permission and
      user_roles.user_id = authorize.user_id
    into bind_permissions;

    return bind_permissions > 0;
  end;
$$
language plpgsql security definer;

-- Secure the tables
alter table public.users
  enable row level security;
alter table public.channels
  enable row level security;
alter table public.messages
  enable row level security;
alter table public.user_roles
  enable row level security;
alter table public.role_permissions
  enable row level security;

create policy "Allow logged-in read access" on public.users
  for select using (auth.role() = 'authenticated');
create policy "Allow individual insert access" on public.users
  for insert with check ((select auth.uid()) = id);
create policy "Allow individual update access" on public.users
  for update using ( (select auth.uid()) = id );
create policy "Allow logged-in read access" on public.channels
  for select using (auth.role() = 'authenticated');
create policy "Allow individual insert access" on public.channels
  for insert with check ((select auth.uid()) = created_by);
create policy "Allow individual delete access" on public.channels
  for delete using ((select auth.uid()) = created_by);
create policy "Allow authorized delete access" on public.channels
  for delete using (authorize('channels.delete', auth.uid()));
create policy "Allow logged-in read access" on public.messages
  for select using (auth.role() = 'authenticated');
create policy "Allow individual insert access" on public.messages
  for insert with check ((select auth.uid()) = user_id);
create policy "Allow individual update access" on public.messages
  for update using ((select auth.uid()) = user_id);
create policy "Allow individual delete access" on public.messages
  for delete using ((select auth.uid()) = user_id);
create policy "Allow authorized delete access" on public.messages
  for delete using (authorize('messages.delete', auth.uid()));
create policy "Allow individual read access" on public.user_roles
  for select using ((select auth.uid()) = user_id);

-- Send "previous data" on change
alter table public.users
  replica identity full;
alter table public.channels
  replica identity full;
alter table public.messages
  replica identity full;

-- inserts a row into public.users and assigns roles
create function public.handle_new_user()
returns trigger
set search_path = ''
as $$
  declare is_admin boolean;
  begin
    insert into public.users (id, username)
    values (new.id, new.email);

    select count(*) = 1 from auth.users into is_admin;

    if position('+supaadmin@' in new.email) > 0 then
      insert into public.user_roles (user_id, role) values (new.id, 'admin');
    elsif position('+supamod@' in new.email) > 0 then
      insert into public.user_roles (user_id, role) values (new.id, 'moderator');
    end if;

    return new;
  end;
$$ language plpgsql security definer;

-- trigger the function every time a user is created
create trigger on_auth_user_created
  after insert on auth.users
  for each row execute procedure public.handle_new_user();

/**
 * REALTIME SUBSCRIPTIONS
 * Only allow realtime listening on public tables.
 */

begin;
  -- remove the realtime publication
  drop publication if exists supabase_realtime;

  -- re-create the publication but don't enable it for any tables
  create publication supabase_realtime;
commit;

-- add tables to the publication
alter publication supabase_realtime add table public.channels;
alter publication supabase_realtime add table public.messages;
alter publication supabase_realtime add table public.users;

-- DUMMY DATA
insert into public.users (id, username)
values
    ('8d0fd2b3-9ca7-4d9e-a95f-9e13dded323e', 'supabot');

insert into public.channels (slug, created_by)
values
    ('public', '8d0fd2b3-9ca7-4d9e-a95f-9e13dded323e'),
    ('random', '8d0fd2b3-9ca7-4d9e-a95f-9e13dded323e');

insert into public.messages (message, channel_id, user_id)
values
    ('Hello World ', 1, '8d0fd2b3-9ca7-4d9e-a95f-9e13dded323e'),
    ('Perfection is attained, not when there is nothing more to add, but when there is nothing left to take away.', 2, '8d0fd2b3-9ca7-4d9e-a95f-9e13dded323e');

insert into public.role_permissions (role, permission)
values
    ('admin', 'channels.delete'),
    ('admin', 'messages.delete'),
    ('moderator', 'messages.delete');
`.trim()},{id:13,type:"quickstart",title:"Todo List",description:"Build a basic todo list with Row Level Security.",sql:`
--
-- For use with:
-- https://github.com/supabase/supabase/tree/master/examples/todo-list/sveltejs-todo-list or
-- https://github.com/supabase/examples-archive/tree/main/supabase-js-v1/todo-list
--

create table todos (
  id bigint generated by default as identity primary key,
  user_id uuid references auth.users not null,
  task text check (char_length(task) > 3),
  is_complete boolean default false,
  inserted_at timestamp with time zone default timezone('utc'::text, now()) not null
);
alter table todos enable row level security;
create policy "Individuals can create todos." on todos for
    insert with check (auth.uid() = user_id);
create policy "Individuals can view their own todos. " on todos for
    select using ((select auth.uid()) = user_id);
create policy "Individuals can update their own todos." on todos for
    update using ((select auth.uid()) = user_id);
create policy "Individuals can delete their own todos." on todos for
    delete using ((select auth.uid()) = user_id);
`.trim()},{id:14,type:"quickstart",title:"Stripe Subscriptions",description:"Starter template for the Next.js Stripe Subscriptions Starter.",sql:`
/**
* USERS
* Note: This table contains user data. Users should only be able to view and update their own data.
*/
create table users (
  -- UUID from auth.users
  id uuid references auth.users not null primary key,
  full_name text,
  avatar_url text,
  -- The customer's billing address, stored in JSON format.
  billing_address jsonb,
  -- Stores your customer's payment instruments.
  payment_method jsonb
);
alter table users
  enable row level security;
create policy "Can view own user data." on users
  for select using ((select auth.uid()) = id);
create policy "Can update own user data." on users
  for update using ((select auth.uid()) = id);

/**
* This trigger automatically creates a user entry when a new user signs up via Supabase Auth.
*/
create function public.handle_new_user()
returns trigger
set search_path = ''
as $$
  begin
    insert into public.users (id, full_name, avatar_url)
    values (new.id, new.raw_user_meta_data->>'full_name', new.raw_user_meta_data->>'avatar_url');
    return new;
  end;
$$
language plpgsql security definer;

create trigger on_auth_user_created
  after insert on auth.users
  for each row
    execute procedure public.handle_new_user();

/**
* CUSTOMERS
* Note: this is a private table that contains a mapping of user IDs to Stripe customer IDs.
*/
create table customers (
  -- UUID from auth.users
  id uuid references auth.users not null primary key,
  -- The user's customer ID in Stripe. User must not be able to update this.
  stripe_customer_id text
);
alter table customers enable row level security;
-- No policies as this is a private table that the user must not have access to.

/**
* PRODUCTS
* Note: products are created and managed in Stripe and synced to our DB via Stripe webhooks.
*/
create table products (
  -- Product ID from Stripe, e.g. prod_1234.
  id text primary key,
  -- Whether the product is currently available for purchase.
  active boolean,
  -- The product's name, meant to be displayable to the customer. Whenever this product is sold via a subscription, name will show up on associated invoice line item descriptions.
  name text,
  -- The product's description, meant to be displayable to the customer. Use this field to optionally store a long form explanation of the product being sold for your own rendering purposes.
  description text,
  -- A URL of the product image in Stripe, meant to be displayable to the customer.
  image text,
  -- Set of key-value pairs, used to store additional information about the object in a structured format.
  metadata jsonb
);
alter table products
  enable row level security;
create policy "Allow public read-only access." on products
  for select using (true);

/**
* PRICES
* Note: prices are created and managed in Stripe and synced to our DB via Stripe webhooks.
*/
create type pricing_type as enum ('one_time', 'recurring');
create type pricing_plan_interval as enum ('day', 'week', 'month', 'year');
create table prices (
  -- Price ID from Stripe, e.g. price_1234.
  id text primary key,
  -- The ID of the prduct that this price belongs to.
  product_id text references products,
  -- Whether the price can be used for new purchases.
  active boolean,
  -- A brief description of the price.
  description text,
  -- The unit amount as a positive integer in the smallest currency unit (e.g., 100 cents for US$1.00 or 100 for \xa5100, a zero-decimal currency).
  unit_amount bigint,
  -- Three-letter ISO currency code, in lowercase.
  currency text check (char_length(currency) = 3),
  -- One of \`one_time\` or \`recurring\` depending on whether the price is for a one-time purchase or a recurring (subscription) purchase.
  type pricing_type,
  -- The frequency at which a subscription is billed. One of \`day\`, \`week\`, \`month\` or \`year\`.
  interval pricing_plan_interval,
  -- The number of intervals (specified in the \`interval\` attribute) between subscription billings. For example, \`interval=month\` and \`interval_count=3\` bills every 3 months.
  interval_count integer,
  -- Default number of trial days when subscribing a customer to this price using [\`trial_from_plan=true\`](https://stripe.com/docs/api#create_subscription-trial_from_plan).
  trial_period_days integer,
  -- Set of key-value pairs, used to store additional information about the object in a structured format.
  metadata jsonb
);
alter table prices
  enable row level security;
create policy "Allow public read-only access." on prices
  for select using (true);

/**
* SUBSCRIPTIONS
* Note: subscriptions are created and managed in Stripe and synced to our DB via Stripe webhooks.
*/
create type subscription_status as enum ('trialing', 'active', 'canceled', 'incomplete', 'incomplete_expired', 'past_due', 'unpaid');
create table subscriptions (
  -- Subscription ID from Stripe, e.g. sub_1234.
  id text primary key,
  user_id uuid references auth.users not null,
  -- The status of the subscription object, one of subscription_status type above.
  status subscription_status,
  -- Set of key-value pairs, used to store additional information about the object in a structured format.
  metadata jsonb,
  -- ID of the price that created this subscription.
  price_id text references prices,
  -- Quantity multiplied by the unit amount of the price creates the amount of the subscription. Can be used to charge multiple seats.
  quantity integer,
  -- If true the subscription has been canceled by the user and will be deleted at the end of the billing period.
  cancel_at_period_end boolean,
  -- Time at which the subscription was created.
  created timestamp with time zone default timezone('utc'::text, now()) not null,
  -- Start of the current period that the subscription has been invoiced for.
  current_period_start timestamp with time zone default timezone('utc'::text, now()) not null,
  -- End of the current period that the subscription has been invoiced for. At the end of this period, a new invoice will be created.
  current_period_end timestamp with time zone default timezone('utc'::text, now()) not null,
  -- If the subscription has ended, the timestamp of the date the subscription ended.
  ended_at timestamp with time zone default timezone('utc'::text, now()),
  -- A date in the future at which the subscription will automatically get canceled.
  cancel_at timestamp with time zone default timezone('utc'::text, now()),
  -- If the subscription has been canceled, the date of that cancellation. If the subscription was canceled with \`cancel_at_period_end\`, \`canceled_at\` will still reflect the date of the initial cancellation request, not the end of the subscription period when the subscription is automatically moved to a canceled state.
  canceled_at timestamp with time zone default timezone('utc'::text, now()),
  -- If the subscription has a trial, the beginning of that trial.
  trial_start timestamp with time zone default timezone('utc'::text, now()),
  -- If the subscription has a trial, the end of that trial.
  trial_end timestamp with time zone default timezone('utc'::text, now())
);
alter table subscriptions
  enable row level security;
create policy "Can only view own subs data." on subscriptions
  for select using ((select auth.uid()) = user_id);

/**
 * REALTIME SUBSCRIPTIONS
 * Only allow realtime listening on public tables.
 */
drop publication if exists supabase_realtime;
create publication supabase_realtime
  for table products, prices;
`.trim()},{id:15,type:"quickstart",title:"User Management Starter",description:"Sets up a public Profiles table which you can access with your API.",sql:`
-- Create a table for public profiles
create table profiles (
  id uuid references auth.users on delete cascade not null primary key,
  updated_at timestamp with time zone,
  username text unique,
  full_name text,
  avatar_url text,
  website text,

  constraint username_length check (char_length(username) >= 3)
);
-- Set up Row Level Security (RLS)
-- See ${t.DOCS_URL}/guides/auth/row-level-security for more details.
alter table profiles
  enable row level security;

create policy "Public profiles are viewable by everyone." on profiles
  for select using (true);

create policy "Users can insert their own profile." on profiles
  for insert with check ((select auth.uid()) = id);

create policy "Users can update own profile." on profiles
  for update using ((select auth.uid()) = id);

-- This trigger automatically creates a profile entry when a new user signs up via Supabase Auth.
-- See ${t.DOCS_URL}/guides/auth/managing-user-data#using-triggers for more details.
create function public.handle_new_user()
returns trigger
set search_path = ''
as $$
begin
  insert into public.profiles (id, full_name, avatar_url)
  values (new.id, new.raw_user_meta_data->>'full_name', new.raw_user_meta_data->>'avatar_url');
  return new;
end;
$$ language plpgsql security definer;
create trigger on_auth_user_created
  after insert on auth.users
  for each row execute procedure public.handle_new_user();

-- Set up Storage!
insert into storage.buckets (id, name)
  values ('avatars', 'avatars');

-- Set up access controls for storage.
-- See ${t.DOCS_URL}/guides/storage#policy-examples for more details.
create policy "Avatar images are publicly accessible." on storage.objects
  for select using (bucket_id = 'avatars');

create policy "Anyone can upload an avatar." on storage.objects
  for insert with check (bucket_id = 'avatars');
`.trim()},{id:16,type:"quickstart",title:"NextAuth Schema Setup",description:"Sets up a the Schema and Tables for the NextAuth Supabase Adapter.",sql:`
--
-- Name: next_auth; Type: SCHEMA;
--
CREATE SCHEMA next_auth;

GRANT USAGE ON SCHEMA next_auth TO service_role;
GRANT ALL ON SCHEMA next_auth TO postgres;

--
-- Create users table
--
CREATE TABLE IF NOT EXISTS next_auth.users
(
    id uuid NOT NULL DEFAULT gen_random_uuid(),
    name text,
    email text,
    "emailVerified" timestamp with time zone,
    image text,
    CONSTRAINT users_pkey PRIMARY KEY (id),
    CONSTRAINT email_unique UNIQUE (email)
);

GRANT ALL ON TABLE next_auth.users TO postgres;
GRANT ALL ON TABLE next_auth.users TO service_role;

--- uid() function to be used in RLS policies
CREATE FUNCTION next_auth.uid() RETURNS uuid
    LANGUAGE sql STABLE
    AS $$
  select
    coalesce(
        nullif(current_setting('request.jwt.claim.sub', true), ''),
        (nullif(current_setting('request.jwt.claims', true), '')::jsonb ->> 'sub')
    )::uuid
$$;

--
-- Create sessions table
--
CREATE TABLE IF NOT EXISTS  next_auth.sessions
(
    id uuid NOT NULL DEFAULT gen_random_uuid(),
    expires timestamp with time zone NOT NULL,
    "sessionToken" text NOT NULL,
    "userId" uuid,
    CONSTRAINT sessions_pkey PRIMARY KEY (id),
    CONSTRAINT sessionToken_unique UNIQUE ("sessionToken"),
    CONSTRAINT "sessions_userId_fkey" FOREIGN KEY ("userId")
        REFERENCES  next_auth.users (id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE CASCADE
);

GRANT ALL ON TABLE next_auth.sessions TO postgres;
GRANT ALL ON TABLE next_auth.sessions TO service_role;

--
-- Create accounts table
--
CREATE TABLE IF NOT EXISTS  next_auth.accounts
(
    id uuid NOT NULL DEFAULT gen_random_uuid(),
    type text NOT NULL,
    provider text NOT NULL,
    "providerAccountId" text NOT NULL,
    refresh_token text,
    access_token text,
    expires_at bigint,
    token_type text,
    scope text,
    id_token text,
    session_state text,
    oauth_token_secret text,
    oauth_token text,
    "userId" uuid,
    CONSTRAINT accounts_pkey PRIMARY KEY (id),
    CONSTRAINT provider_unique UNIQUE (provider, "providerAccountId"),
    CONSTRAINT "accounts_userId_fkey" FOREIGN KEY ("userId")
        REFERENCES  next_auth.users (id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE CASCADE
);

GRANT ALL ON TABLE next_auth.accounts TO postgres;
GRANT ALL ON TABLE next_auth.accounts TO service_role;

--
-- Create verification_tokens table
--
CREATE TABLE IF NOT EXISTS  next_auth.verification_tokens
(
    identifier text,
    token text,
    expires timestamp with time zone NOT NULL,
    CONSTRAINT verification_tokens_pkey PRIMARY KEY (token),
    CONSTRAINT token_unique UNIQUE (token),
    CONSTRAINT token_identifier_unique UNIQUE (token, identifier)
);

GRANT ALL ON TABLE next_auth.verification_tokens TO postgres;
GRANT ALL ON TABLE next_auth.verification_tokens TO service_role;
`.trim()},{id:17,type:"template",title:"Most frequently invoked",description:"Most frequently called queries in your database.",sql:`-- Most frequently called queries

-- A limit of 100 has been added below

select
    auth.rolname,
    statements.query,
    statements.calls,
    -- -- Postgres 13, 14, 15
    statements.total_exec_time + statements.total_plan_time as total_time,
    statements.min_exec_time + statements.min_plan_time as min_time,
    statements.max_exec_time + statements.max_plan_time as max_time,
    statements.mean_exec_time + statements.mean_plan_time as mean_time,
    -- -- Postgres <= 12
    -- total_time,
    -- min_time,
    -- max_time,
    -- mean_time,
    statements.rows / statements.calls as avg_rows

  from pg_stat_statements as statements
    inner join pg_authid as auth on statements.userid = auth.oid
  order by
    statements.calls desc
  limit
    100;`},{id:18,type:"template",title:"Most time consuming",description:"Aggregate time spent on a query type.",sql:`-- Most time consuming queries

-- A limit of 100 has been added below

select
    auth.rolname,
    statements.query,
    statements.calls,
    statements.total_exec_time + statements.total_plan_time as total_time,
    to_char(((statements.total_exec_time + statements.total_plan_time)/sum(statements.total_exec_time + statements.total_plan_time) over()) * 100, 'FM90D0') || '%' as prop_total_time
  from pg_stat_statements as statements
    inner join pg_authid as auth on statements.userid = auth.oid
  order by
    total_time desc
  limit
    100;`},{id:19,type:"template",title:"Slowest execution time",description:"Slowest queries based on max execution time.",sql:`-- Slowest queries by max execution time

-- A limit of 100 has been added below

select
    auth.rolname,
    statements.query,
    statements.calls,
    -- -- Postgres 13, 14, 15
    statements.total_exec_time + statements.total_plan_time as total_time,
    statements.min_exec_time + statements.min_plan_time as min_time,
    statements.max_exec_time + statements.max_plan_time as max_time,
    statements.mean_exec_time + statements.mean_plan_time as mean_time,
    -- -- Postgres <= 12
    -- total_time,
    -- min_time,
    -- max_time,
    -- mean_time,
    statements.rows / statements.calls as avg_rows
  from pg_stat_statements as statements
    inner join pg_authid as auth on statements.userid = auth.oid
  order by
    max_time desc
  limit
    100;`},{id:20,type:"template",title:"Hit rate",description:"See your cache and index hit rate.",sql:`-- Cache and index hit rate

select
    'index hit rate' as name,
    (sum(idx_blks_hit)) / nullif(sum(idx_blks_hit + idx_blks_read),0) as ratio
  from pg_statio_user_indexes
  union all
  select
    'table hit rate' as name,
    sum(heap_blks_hit) / nullif(sum(heap_blks_hit) + sum(heap_blks_read),0) as ratio
  from pg_statio_user_tables;`},{id:21,type:"quickstart",title:"OpenAI Vector Search",description:"Template for the Next.js OpenAI Doc Search Starter.",sql:`
-- Enable pg_vector extension
create extension if not exists vector with schema public;

-- Create tables
create table "public"."nods_page" (
  id bigserial primary key,
  parent_page_id bigint references public.nods_page,
  path text not null unique,
  checksum text,
  meta jsonb,
  type text,
  source text
);
alter table "public"."nods_page" enable row level security;

create table "public"."nods_page_section" (
  id bigserial primary key,
  page_id bigint not null references public.nods_page on delete cascade,
  content text,
  token_count int,
  embedding vector(1536),
  slug text,
  heading text
);
alter table "public"."nods_page_section" enable row level security;

-- Create embedding similarity search functions
create or replace function match_page_sections(embedding vector(1536), match_threshold float, match_count int, min_content_length int)
returns table (id bigint, page_id bigint, slug text, heading text, content text, similarity float)
language plpgsql
as $$
#variable_conflict use_variable
begin
  return query
  select
    nods_page_section.id,
    nods_page_section.page_id,
    nods_page_section.slug,
    nods_page_section.heading,
    nods_page_section.content,
    (nods_page_section.embedding <#> embedding) * -1 as similarity
  from nods_page_section

  -- We only care about sections that have a useful amount of content
  where length(nods_page_section.content) >= min_content_length

  -- The dot product is negative because of a Postgres limitation, so we negate it
  and (nods_page_section.embedding <#> embedding) * -1 > match_threshold

  -- OpenAI embeddings are normalized to length 1, so
  -- cosine similarity and dot product will produce the same results.
  -- Using dot product which can be computed slightly faster.
  --
  -- For the different syntaxes, see https://github.com/pgvector/pgvector
  order by nods_page_section.embedding <#> embedding

  limit match_count;
end;
$$;

create or replace function get_page_parents(page_id bigint)
returns table (id bigint, parent_page_id bigint, path text, meta jsonb)
language sql
as $$
  with recursive chain as (
    select *
    from nods_page
    where id = page_id

    union all

    select child.*
      from nods_page as child
      join chain on chain.parent_page_id = child.id
  )
  select id, parent_page_id, path, meta
  from chain;
$$;
`.trim()},{id:22,type:"template",title:"Replication status report",description:"See the status of your replication slots and replication lag.",sql:`-- Replication status report

SELECT
  s.slot_name,
  s.active,
  COALESCE(r.state, 'N/A') as state,
  COALESCE(r.client_addr, null) as replication_client_address,
  GREATEST(0, ROUND((redo_lsn-restart_lsn)/1024/1024/1024, 2)) as replication_lag_gb
FROM pg_control_checkpoint(), pg_replication_slots s
LEFT JOIN pg_stat_replication r ON (r.pid = s.active_pid);
`},{id:23,type:"quickstart",title:"LangChain",description:"LangChain is a popular framework for working with AI, Vectors, and embeddings.",sql:`
-- Enable the pgvector extension to work with embedding vectors
create extension vector;

-- Create a table to store your documents
create table documents (
  id bigserial primary key,
  content text, -- corresponds to Document.pageContent
  metadata jsonb, -- corresponds to Document.metadata
  embedding vector(1536) -- 1536 works for OpenAI embeddings, change if needed
);

-- Create a function to search for documents
create function match_documents (
  query_embedding vector(1536),
  match_count int default null,
  filter jsonb DEFAULT '{}'
) returns table (
  id bigint,
  content text,
  metadata jsonb,
  similarity float
)
language plpgsql
as $$
#variable_conflict use_column
begin
  return query
  select
    id,
    content,
    metadata,
    1 - (documents.embedding <=> query_embedding) as similarity
  from documents
  where metadata @> filter
  order by documents.embedding <=> query_embedding
  limit match_count;
end;
$$;
`.trim()},{id:24,type:"template",title:"Install dbdev",description:"dbdev is a client for installing Trusted Language Extensions (TLE) into your database.",sql:`
/*---------------------
---- install dbdev ----
-----------------------
Requires:
  - pg_tle: https://github.com/aws/pg_tle
  - pgsql-http: https://github.com/pramsey/pgsql-http

Warning:
Restoring a logical backup of a database with a TLE installed can fail.
For this reason, dbdev should only be used with databases with physical backups enabled.
*/
create extension if not exists http with schema extensions;
create extension if not exists pg_tle;
select pgtle.uninstall_extension_if_exists('supabase-dbdev');
drop extension if exists "supabase-dbdev";
select
    pgtle.install_extension(
        'supabase-dbdev',
        resp.contents ->> 'version',
        'PostgreSQL package manager',
        resp.contents ->> 'sql'
    )
from http(
    (
        'GET',
        'https://api.database.dev/rest/v1/'
        || 'package_versions?select=sql,version'
        || '&package_name=eq.supabase-dbdev'
        || '&order=version.desc'
        || '&limit=1',
        array[
            ('apiKey', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhtdXB0cHBsZnZpaWZyYndtbXR2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODAxMDczNzIsImV4cCI6MTk5NTY4MzM3Mn0.z2CN0mvO2No8wSi46Gw59DFGCTJrzM0AQKsu_5k134s')::http_header
        ],
        null,
        null
    )
) x,
lateral (
    select
        ((row_to_json(x) -> 'content') #>> '{}')::json -> 0
) resp(contents);
create extension "supabase-dbdev";
select dbdev.install('supabase-dbdev');
drop extension if exists "supabase-dbdev";
create extension "supabase-dbdev";
`.trim()},{id:25,type:"template",title:"Large objects",description:"List large objects (tables/indexes) in your database.",sql:`SELECT
    SCHEMA_NAME,
    relname,
    table_size
  FROM
    (SELECT
      pg_catalog.pg_namespace.nspname AS SCHEMA_NAME,
      relname,
      pg_relation_size(pg_catalog.pg_class.oid) AS table_size
    FROM pg_catalog.pg_class
    JOIN pg_catalog.pg_namespace ON relnamespace = pg_catalog.pg_namespace.oid
    ) t
  WHERE SCHEMA_NAME NOT LIKE 'pg_%'
  ORDER BY table_size DESC
  LIMIT 25`.trim()},{id:26,type:"template",title:"Limit MFA verification attempts to one in 2 seconds",description:"Create an Auth hook that limits the number of failed MFA verification attempts to one in 2 seconds.",sql:`
create function public.hook_mfa_verification_attempt(event jsonb)
  returns jsonb
  language plpgsql
as $$
  declare
    last_failed_at timestamp;
  begin
    if event->'valid' is true then
      -- code is valid, accept it
      return jsonb_build_object('decision', 'continue');
    end if;

    select last_failed_at into last_failed_at
      from public.mfa_failed_verification_attempts
      where
        user_id = (event->'user_id')::uuid
          and
        factor_id = event->'factor_id';

    if last_failed_at is not null and now() - last_failed_at < interval '2 seconds' then
      -- last attempt was done too quickly
      return jsonb_build_object(
        'error', jsonb_build_object(
          'http_code', 429,
          'message',   'Please wait a moment before trying again.'
        )
      );
    end if;

    -- record this failed attempt
    insert into public.mfa_failed_verification_attempts
      (
        user_id,
        factor_id,
        last_refreshed_at
      )
      values
      (
        event->'user_id',
        event->'factor_id',
        now()
      )
      on conflict do update
        set last_refreshed_at = now();

    -- finally let Supabase Auth do the default behavior for a failed attempt
    return jsonb_build_object('decision', 'continue');
  end;
$$;

-- Assign appropriate permissions and revoke access
grant execute
  on function public.hook_mfa_verification_attempt
  to supabase_auth_admin;

grant all
  on table public.mfa_failed_verification_attempts
  to supabase_auth_admin;

revoke execute
  on function public.hook_mfa_verification_attempt
  from authenticated, anon, public;

revoke all
  on table public.mfa_failed_verification_attempts
  from authenticated, anon, public;

grant usage on schema public to supabase_auth_admin;`.trim()},{id:27,type:"template",title:"Add Auth Hook (Password Verification Attempt)",description:"Create an Auth Hook that limits number of failed password verification attempts to one in 10 seconds",sql:`
create function public.hook_password_verification_attempt(event jsonb)
returns jsonb
language plpgsql
as $$
  declare
    last_failed_at timestamp;
  begin
    if event->'valid' is true then
      -- password is valid, accept it
      return jsonb_build_object('decision', 'continue');
    end if;

    select last_failed_at into last_failed_at
      from public.password_failed_verification_attempts
      where
        user_id = (event->'user_id')::uuid;

    if last_failed_at is not null and now() - last_failed_at < interval '10 seconds' then
      -- last attempt was done too quickly
      return jsonb_build_object(
        'error', jsonb_build_object(
          'http_code', 429,
          'message',   'Please wait a moment before trying again.'
        )
      );
    end if;

    -- record this failed attempt
    insert into public.password_failed_verification_attempts
      (
        user_id,
        last_failed_at
      )
      values
      (
        event->'user_id',
        now()
      )
      on conflict do update
        set last_failed_at = now();

    -- finally let Supabase Auth do the default behavior for a failed attempt
    return jsonb_build_object('decision', 'continue');
  end;
$$;

-- Assign appropriate permissions
grant execute
  on function public.hook_password_verification_attempt
  to supabase_auth_admin;

grant all
  on table public.password_failed_verification_attempts
  to supabase_auth_admin;

revoke execute
  on function public.hook_password_verification_attempt
  from authenticated, anon, public;

revoke all
  on table public.password_failed_verification_attempts
  from authenticated, anon, public;

grant usage on schema public to supabase_auth_admin;`.trim()},{id:28,type:"template",title:"Add Auth Hook (Custom Access Token)",description:"Create an Auth Hook to add custom claims to your Auth Token",sql:`
-- Assumes that there is an is_admin flag on the profiles table.
create or replace function public.custom_access_token_hook(event jsonb)
returns jsonb
language plpgsql
as $$
  declare
    claims jsonb;
    is_admin boolean;
  begin
    -- Check if the user is marked as admin in the profiles table
    select is_admin into is_admin from profiles where user_id = (event->>'user_id')::uuid;

    -- Proceed only if the user is an admin
    if is_admin then
      claims := event->'claims';

      -- Check if 'user_metadata' exists in claims
      if jsonb_typeof(claims->'user_metadata') is null then
        -- If 'user_metadata' does not exist, create an empty object
        claims := jsonb_set(claims, '{user_metadata}', '{}');
      end if;

      -- Set a claim of 'admin'
      claims := jsonb_set(claims, '{user_metadata, admin}', 'true');

      -- Update the 'claims' object in the original event
      event := jsonb_set(event, '{claims}', claims);
    end if;

    -- Return the modified or original event
    return event;
  end;
$$;

grant execute
  on function public.custom_access_token_hook
  to supabase_auth_admin;

revoke execute
  on function public.custom_access_token_hook
  from authenticated, anon, public;

grant usage on schema public to supabase_auth_admin;`.trim()},{id:29,type:"template",title:"Add Auth Hook (General)",description:"Create an Auth Hook",sql:`
create or replace function public.custom_access_token_hook(event jsonb)
returns jsonb
language plpgsql
as $$
declare
  -- Insert variables here
begin
  -- Insert logic here
  return event;
end;
$$;
-- Permissions for the hook
grant execute on function public.custom_access_token_hook to supabase_auth_admin;
revoke execute on function public.custom_access_token_hook from authenticated, anon, public;
    `}];e.s(["SQL_TEMPLATES",0,a],448761);var s=e.i(478902),i=e.i(587433),n=e.i(627069);e.s(["ActionCard",0,e=>(0,s.jsx)(n.Card,{className:"grow bg-surface-100 p-3 transition-colors hover:bg-surface-200 border border-light hover:border-default cursor-pointer",onClick:e.onClick,children:(0,s.jsxs)("div",{className:"relative flex items-start gap-3",children:[e.isBeta&&(0,s.jsx)(i.Badge,{className:"absolute -right-5 -top-5 bg-surface-300 bg-opacity-100 text-xs text-foreground",children:"Coming soon"}),(0,s.jsx)("div",{className:`rounded-full ${e.bgColor} w-8 h-8 flex items-center justify-center flex-shrink-0`,children:e.icon}),(0,s.jsxs)("div",{className:"flex flex-col gap-0",children:[(0,s.jsx)("h3",{className:"text-sm text-foreground mb-0",children:e.title}),(0,s.jsx)("p",{className:"text-xs text-foreground-light",children:e.description})]})]})})],457395)},42081,e=>{"use strict";let t="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__;e.s(["DEBUG_BUILD",()=>t])},672296,e=>{"use strict";function t(e){return e.split("#")[0]}function a(e,t={}){let{maxDepth:s=3,redaction:i="[REDACTED]",truncationNotice:n="[REDACTED: max depth reached]",sensitiveKeys:r=[]}=t,l=new Set(["password","passwd","pwd","pass","secret","token","id_token","access_token","refresh_token","apikey","api_key","api-key","apiKey","key","privatekey","private_key","client_secret","clientSecret","auth","authorization","ssh_key","sshKey","bearer","session","cookie","csrf","xsrf","ip","ip_address","ipAddress","aws_access_key_id","aws_secret_access_key","gcp_service_account_key",...r].map(e=>e.toLowerCase())),o=[{re:/\b(?:(?:25[0-5]|2[0-4]\d|1?\d?\d)\.){3}(?:25[0-5]|2[0-4]\d|1?\d?\d)\b/g,reason:"ip"},{re:/\b(?:[A-Fa-f0-9]{1,4}:){2,7}[A-Fa-f0-9]{1,4}\b/g,reason:"ip6"},{re:/\b(AKI|ASI)A[0-9A-Z]{16}\b/g,reason:"aws_access_key_id"},{re:/\b[0-9A-Za-z/+]{40}\b/g,reason:"aws_secret_access_key_like"},{re:/\bBearer\s+[A-Za-z0-9\-._~+/]+=*\b/g,reason:"bearer"},{re:/\b[A-Za-z0-9-_]+?\.[A-Za-z0-9-_]+?\.[A-Za-z0-9-_]+?\b/g,reason:"jwt_like"},{re:/\b[A-Za-z0-9_\-]{24,64}\b/g,reason:"long_token"}],c=new WeakMap;function u(e){let t=e;for(let{re:e}of o)t=t.replace(e,i);return t}function d(e){return l.has(String(e).toLowerCase())}return e.map(e=>(function e(t,a){if(null==t||"number"==typeof t||"boolean"==typeof t||"bigint"==typeof t)return t;if("string"==typeof t)return u(t);if("function"==typeof t)return"[Function]";if(t instanceof Date)return t.toISOString();if(t instanceof RegExp)return t.toString();if(ArrayBuffer.isView(t)&&!(t instanceof DataView))return`[TypedArray byteLength=${t.byteLength}]`;if(t instanceof ArrayBuffer)return`[ArrayBuffer byteLength=${t.byteLength}]`;if(a>=s)return n;if("object"==typeof t){if(c.has(t))return"[Circular]";if(Array.isArray(t)){let s=[];c.set(t,s);for(let i=0;i<t.length;i++)s[i]=e(t[i],a+1);return s}if(function(e){if(null===e||"object"!=typeof e)return!1;let t=Object.getPrototypeOf(e);return t===Object.prototype||null===t}(t)){let s={};for(let[n,r]of(c.set(t,s),Object.entries(t)))d(n)?s[n]=i:s[n]=e(r,a+1);return s}if(t instanceof Map){let s=[];for(let[n,r]of(c.set(t,s),t.entries())){let t=d(n)?i:e(n,a+1),l=d(n)?i:e(r,a+1);s.push([t,l])}return s}if(t instanceof Set){let s=[];for(let i of(c.set(t,s),t.values()))s.push(e(i,a+1));return s}if(t instanceof URL)return t.toString();if(t instanceof Error){let e={name:t.name,message:u(t.message),stack:n};return c.set(t,e),e}try{return u(String(t))}catch{return u(Object.prototype.toString.call(t))}}return u(String(t))})(e,0))}e.s(["sanitizeArrayOfObjects",()=>a,"sanitizeUrlHashParams",()=>t])},765672,e=>{"use strict";var t,a,s=e.i(478902),i=e.i(902858),n=e.i(55956),r=e.i(551456),l=e.i(219195),o=e.i(215261),c=e.i(898452),u=e.i(389959),d=e.i(355901);e.i(128328);var m=e.i(158639),p=e.i(448761),_=e.i(888738),h=e.i(602089),b=e.i(837710),f=e.i(378277),g=e.i(843778),A=e.i(613580);let y=(0,e.i(388019).default)("Columns3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),x=["Recipe sharing app","Event ticketing system","Fitness tracker","Learning management platform"];var C=e.i(234745),E=e.i(124416),N=e.i(10429),v=((t={}).AI="ai",t.TEMPLATE="template",t),w=((a={}).CONTROL="control",a.AI="ai",a.TEMPLATES="templates",a.ASSISTANT="assistant",a);let S=e=>null!=e,j=e=>{let t;if((t=e).isPrimary||"id"===t.name)return"Primary key"},k=e=>({bigint:"int8",integer:"int4",smallint:"int2",boolean:"bool",text:"text",varchar:"varchar",uuid:"uuid",timestamp:"timestamp",timestamptz:"timestamptz","timestamp with time zone":"timestamptz",date:"date",time:"time",timetz:"timetz","time with time zone":"timetz",json:"json",jsonb:"jsonb",numeric:"numeric",real:"float4","double precision":"float8",bytea:"bytea"})[e.toLowerCase()]||"text",O=e=>Array.isArray(e.tables)?e.tables.map((e,t)=>{if(!e)return null;let a="string"==typeof e.name&&e.name.trim().length>0?e.name:`table_${t+1}`,s=(Array.isArray(e.columns)?e.columns:[]).map((e,t)=>{if(!e)return null;let a="string"==typeof e.name&&e.name.trim().length>0?e.name:`column_${t+1}`;return{name:a,type:k("string"==typeof e.type&&e.type.trim().length>0?e.type:"text"),nullable:e.isNullable??void 0,unique:e.isUnique??void 0,default:e.defaultValue??void 0,description:j({...e,name:a}),isPrimary:e.isPrimary||"id"===a||void 0}}).filter(S);return 0!==s.length||e.name?{tableName:a,fields:s,rationale:"string"==typeof e.description?e.description:void 0,source:v.AI}:null}).filter(S):[],T=e=>{try{return JSON.parse(e)}catch{return null}};function L(e){let t=e.fields.map((t,a)=>{let s=!0===t.isPrimary||"id"===t.name,i="id"===t.name&&t.type.toLowerCase().includes("int")&&!t.default,n=t.default?String(t.default):null;return{id:`column-${a}`,name:t.name,format:t.type,defaultValue:n,isNullable:!1!==t.nullable,isUnique:t.unique??!1,isIdentity:i,isPrimaryKey:s,comment:t.description||"",isNewColumn:!0,table:e.tableName,schema:"public",check:null,isArray:!1,isEncrypted:!1}});return{name:e.tableName,comment:e.rationale||"",columns:t}}var R=e.i(967052);let B=({onSelectTable:e,disabled:t})=>{let[a,i]=(0,u.useState)(""),n=(0,u.useRef)(null),r=(0,R.useTrack)(),{generateTables:o,isGenerating:c,error:m,prompt:p,tables:_,setPrompt:w}=(()=>{let[e,t]=(0,u.useState)(!1),[a,s]=(0,u.useState)(null),[i,n]=(0,E.useLocalStorage)("table-quickstart-ai-results",{prompt:"",tables:[]}),r=(0,u.useRef)(null),l=(0,u.useRef)(!0);(0,u.useEffect)(()=>(l.current=!0,()=>{l.current=!1,r.current&&r.current.abort()}),[]);let o=(0,u.useCallback)(async e=>{if(r.current&&r.current.abort(),e.length>500){let e="Your description is too long. Try shortening it to under 500 characters.";return s(e),d.toast.error("Description too long",{description:e}),[]}let a=new AbortController;r.current=a,t(!0),s(null),n({prompt:e,tables:[]});try{let t=await (0,C.constructHeaders)();t.set("Content-Type","application/json");let i=await (0,C.fetchHandler)(`${N.BASE_PATH}/api/ai/table-quickstart/generate-schemas`,{method:"POST",headers:t,body:JSON.stringify({prompt:e}),signal:a.signal});if(!i.ok){let e=await i.json().catch(()=>({error:"Unable to generate table schema. Try again with a different description."})),t=e?.error||"Unable to generate table schema. Try again with a different description.";return l.current&&s(t),d.toast.error("Unable to generate tables",{description:t}),[]}if(!i.body)throw Error("Response body is null");let r=i.body.getReader(),o=new TextDecoder,c="",u={};try{for(;;){let{done:t,value:a}=await r.read();if(t)break;if((c+=o.decode(a,{stream:!0})).length>51200)throw Error("Response too large");let s=T(c);if(s){Object.assign(u,s);let t=O(u);l.current&&t.length>0&&n({prompt:e,tables:t})}}}finally{r.releaseLock()}c+=o.decode();let m=T(c),p=m?m.tables.map(e=>({tableName:e.name,fields:e.columns.map(e=>({name:e.name,type:k(e.type),nullable:e.isNullable??void 0,unique:e.isUnique??void 0,default:e.defaultValue??void 0,description:j(e),isPrimary:e.isPrimary||"id"===e.name||void 0})),rationale:e.description,source:v.AI})):O(u);return l.current&&(s(null),n({prompt:e,tables:p})),p}catch(t){if(t instanceof Error&&"AbortError"===t.name)return[];let e=t instanceof Error?t.message:"Unable to generate tables. Please try again.";return l.current&&s(e),d.toast.error("Unable to generate tables",{description:e}),[]}finally{l.current&&t(!1),r.current=null}},[]),c=(0,u.useCallback)(()=>{r.current&&(r.current.abort(),r.current=null),t(!1),s(null),n({prompt:"",tables:[]})},[]),m=(0,u.useCallback)(e=>{n(t=>({...t,prompt:e}))},[n]);return{generateTables:o,isGenerating:e,error:a,prompt:i.prompt,tables:i.tables,setPrompt:m,clearTables:c}})(),S=p??"",B=_??[];(0,u.useEffect)(()=>{n.current&&n.current.focus()},[]),(0,u.useEffect)(()=>{S&&B.length>0&&i(S)},[]);let F=(0,u.useCallback)(t=>{r("table_quickstart_template_clicked",{tableName:t.tableName,columnCount:t.fields.length,source:"ai"}),e(L(t)),d.toast.success(`Applied ${t.tableName} template. You can customize the fields below.`,{duration:3e3})},[e,r]),D=(0,u.useCallback)(async({promptOverride:e,wasQuickIdea:t=!1}={})=>{let a=e??S;if(a.trim()&&!c){r("table_quickstart_ai_prompt_submitted",{promptLength:a.length,wasQuickIdea:t});try{let e=await o(a);r("table_quickstart_ai_generation_completed",{success:e.length>0,tablesGenerated:e.length,promptLength:a.length}),i(a)}catch(e){r("table_quickstart_ai_generation_completed",{success:!1,tablesGenerated:0,promptLength:a.length,errorMessage:e instanceof Error?e.message:"Unknown error"})}}},[S,o,c,r]),I=(0,u.useCallback)(e=>{r("table_quickstart_quick_idea_clicked",{ideaText:e}),w(e),D({promptOverride:e,wasQuickIdea:!0})},[D,w,r]);return(0,s.jsxs)("div",{className:"rounded-lg border border-default bg-surface-100 p-6 transition-all hover:border-foreground-muted",children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(h.AiIconAnimation,{size:16,loading:!1}),(0,s.jsx)("h3",{className:"text-base font-medium",children:"Generate tables with AI"})]}),(0,s.jsx)("p",{className:"text-sm text-foreground-lighter",children:"Describe your app and AI will create a complete table schema."})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(f.Input_Shadcn_,{ref:n,placeholder:"Describe your app (e.g., 'recipe sharing app')",value:S,onChange:e=>w(e.target.value),onKeyDown:e=>{"Enter"===e.key&&!e.shiftKey&&(e.preventDefault(),S.trim()&&D())},disabled:c||t,"aria-label":"Table description for AI generation",className:"pr-24"}),(0,s.jsx)(b.Button,{type:"default",size:"tiny",disabled:!S.trim()||c||t,onClick:()=>D(),icon:(0,s.jsx)(h.AiIconAnimation,{loading:c}),className:"absolute right-1 top-1/2 -translate-y-1/2 !space-x-1",children:c?"Generating...":S===a&&B.length>0?"Regenerate":"Generate"})]}),m&&(0,s.jsx)("div",{className:"text-sm text-red-600",role:"alert",children:m}),0===B.length&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-xs text-foreground-light mb-2",children:"Quick ideas:"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:x.map(e=>(0,s.jsxs)("button",{onClick:()=>I(e),disabled:c||t,"aria-label":`Generate table for ${e}`,className:(0,g.cn)("flex items-center gap-1.5 px-2 py-1 rounded-md text-xs border border-default","hover:border-foreground-muted hover:bg-surface-200","disabled:opacity-50 disabled:cursor-not-allowed","transition-all"),children:[(0,s.jsx)(h.AiIconAnimation,{size:12}),(0,s.jsx)("span",{children:e})]},e))})]}),B.length>0&&(0,s.jsx)("div",{className:"grid gap-2",children:B.map(e=>(0,s.jsx)("button",{onClick:()=>F(e),disabled:t,"aria-label":`Select ${e.tableName} template with ${e.fields.length} fields`,className:(0,g.cn)("text-left p-3 rounded-md border transition-colors w-full bg-surface-100","border-light hover:border-default hover:bg-surface-200 cursor-pointer","disabled:opacity-50 disabled:cursor-not-allowed"),children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"rounded-full bg-alternative border w-8 h-8 flex items-center justify-center flex-shrink-0",children:(0,s.jsx)(l.Table2,{size:16,className:"text-foreground"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-foreground mb-0",children:e.tableName}),e.rationale&&(0,s.jsx)("div",{className:"text-xs text-foreground-light mt-0.5",children:e.rationale})]}),(0,s.jsxs)(A.Tooltip,{children:[(0,s.jsx)(A.TooltipTrigger,{asChild:!0,children:(0,s.jsxs)("div",{className:"flex items-center gap-1 text-sm text-foreground-muted ml-3",children:[(0,s.jsx)(y,{size:14,"aria-hidden":"true"}),(0,s.jsx)("span",{children:e.fields.length})]})}),(0,s.jsxs)(A.TooltipContent,{children:[e.fields.length," ",1===e.fields.length?"column":"columns"]})]})]})},`ai:${e.tableName}`))})]})]})};var F=e.i(796238);let D={"Social Network":[{tableName:"profiles",fields:[{name:"id",type:"uuid",nullable:!1,isPrimary:!0,default:"gen_random_uuid()"},{name:"user_id",type:"uuid",nullable:!1,unique:!0},{name:"username",type:"text",nullable:!0,unique:!0},{name:"display_name",type:"text",nullable:!0},{name:"avatar_url",type:"text",nullable:!0},{name:"bio",type:"text",nullable:!0},{name:"location",type:"text",nullable:!0},{name:"website",type:"text",nullable:!0},{name:"created_at",type:"timestamptz",nullable:!1,default:"now()"},{name:"updated_at",type:"timestamptz",nullable:!1,default:"now()"}],rationale:"Stores user profile details such as name, avatar, and bio",source:v.TEMPLATE},{tableName:"posts",fields:[{name:"id",type:"uuid",nullable:!1,isPrimary:!0,default:"gen_random_uuid()"},{name:"author_id",type:"uuid",nullable:!1},{name:"content",type:"text",nullable:!1},{name:"image_url",type:"text",nullable:!0},{name:"likes_count",type:"int4",nullable:!1,default:"0"},{name:"comments_count",type:"int4",nullable:!1,default:"0"},{name:"created_at",type:"timestamptz",nullable:!1,default:"now()"},{name:"updated_at",type:"timestamptz",nullable:!1,default:"now()"}],rationale:"Stores user posts, images, and engagement counts",source:v.TEMPLATE},{tableName:"follows",fields:[{name:"id",type:"uuid",nullable:!1,isPrimary:!0,default:"gen_random_uuid()"},{name:"follower_id",type:"uuid",nullable:!1},{name:"following_id",type:"uuid",nullable:!1},{name:"created_at",type:"timestamptz",nullable:!1,default:"now()"}],rationale:"Tracks relationships between followers and followed users",source:v.TEMPLATE}],"E-commerce":[{tableName:"products",fields:[{name:"id",type:"uuid",nullable:!1,isPrimary:!0,default:"gen_random_uuid()"},{name:"name",type:"text",nullable:!1},{name:"slug",type:"text",nullable:!1,unique:!0},{name:"description",type:"text",nullable:!0},{name:"price",type:"numeric",nullable:!1},{name:"compare_at_price",type:"numeric",nullable:!0},{name:"cost",type:"numeric",nullable:!0},{name:"sku",type:"text",nullable:!0,unique:!0},{name:"barcode",type:"text",nullable:!0},{name:"stock_quantity",type:"int4",nullable:!1,default:"0"},{name:"weight",type:"numeric",nullable:!0},{name:"published",type:"bool",nullable:!1,default:"false"},{name:"created_at",type:"timestamptz",nullable:!1,default:"now()"},{name:"updated_at",type:"timestamptz",nullable:!1,default:"now()"}],rationale:"Stores product details, pricing, and stock levels",source:v.TEMPLATE},{tableName:"orders",fields:[{name:"id",type:"uuid",nullable:!1,isPrimary:!0,default:"gen_random_uuid()"},{name:"order_number",type:"text",nullable:!1,unique:!0},{name:"customer_id",type:"uuid",nullable:!1},{name:"status",type:"text",nullable:!1,default:"pending"},{name:"subtotal",type:"numeric",nullable:!1},{name:"tax",type:"numeric",nullable:!1,default:"0"},{name:"shipping",type:"numeric",nullable:!1,default:"0"},{name:"total",type:"numeric",nullable:!1},{name:"notes",type:"text",nullable:!0},{name:"created_at",type:"timestamptz",nullable:!1,default:"now()"},{name:"updated_at",type:"timestamptz",nullable:!1,default:"now()"}],rationale:"Manages customer orders, payment totals, and statuses",source:v.TEMPLATE},{tableName:"cart_items",fields:[{name:"id",type:"uuid",nullable:!1,isPrimary:!0,default:"gen_random_uuid()"},{name:"user_id",type:"uuid",nullable:!1},{name:"product_id",type:"uuid",nullable:!1},{name:"quantity",type:"int4",nullable:!1,default:"1"},{name:"added_at",type:"timestamptz",nullable:!1,default:"now()"}],rationale:"Tracks products added to customer shopping carts",source:v.TEMPLATE}],Blog:[{tableName:"articles",fields:[{name:"id",type:"uuid",nullable:!1,isPrimary:!0,default:"gen_random_uuid()"},{name:"title",type:"text",nullable:!1},{name:"slug",type:"text",nullable:!1,unique:!0},{name:"content",type:"text",nullable:!0},{name:"excerpt",type:"text",nullable:!0},{name:"cover_image",type:"text",nullable:!0},{name:"author_id",type:"uuid",nullable:!1},{name:"status",type:"text",nullable:!1,default:"'draft'"},{name:"published_at",type:"timestamptz",nullable:!0},{name:"created_at",type:"timestamptz",nullable:!1,default:"now()"},{name:"updated_at",type:"timestamptz",nullable:!1,default:"now()"}],rationale:"Stores blog posts with author, status, and publish dates",source:v.TEMPLATE},{tableName:"categories",fields:[{name:"id",type:"uuid",nullable:!1,isPrimary:!0,default:"gen_random_uuid()"},{name:"name",type:"text",nullable:!1},{name:"slug",type:"text",nullable:!1,unique:!0},{name:"description",type:"text",nullable:!0},{name:"color",type:"text",nullable:!0},{name:"created_at",type:"timestamptz",nullable:!1,default:"now()"}],rationale:"Organizes articles into categories or tags for filtering",source:v.TEMPLATE},{tableName:"comments",fields:[{name:"id",type:"uuid",nullable:!1,isPrimary:!0,default:"gen_random_uuid()"},{name:"article_id",type:"uuid",nullable:!1},{name:"author_name",type:"text",nullable:!1},{name:"author_email",type:"text",nullable:!1},{name:"content",type:"text",nullable:!1},{name:"approved",type:"bool",nullable:!1,default:"false"},{name:"created_at",type:"timestamptz",nullable:!1,default:"now()"}],rationale:"Stores reader comments and approval status for moderation",source:v.TEMPLATE}],"To-Do List":[{tableName:"tasks",fields:[{name:"id",type:"uuid",nullable:!1,isPrimary:!0,default:"gen_random_uuid()"},{name:"title",type:"text",nullable:!1},{name:"description",type:"text",nullable:!0},{name:"completed",type:"bool",nullable:!1,default:"false"},{name:"priority",type:"text",nullable:!0,default:"medium"},{name:"due_date",type:"date",nullable:!0},{name:"user_id",type:"uuid",nullable:!1},{name:"list_id",type:"uuid",nullable:!0},{name:"created_at",type:"timestamptz",nullable:!1,default:"now()"},{name:"updated_at",type:"timestamptz",nullable:!1,default:"now()"}],rationale:"Stores user tasks with priorities, due dates, and status",source:v.TEMPLATE},{tableName:"lists",fields:[{name:"id",type:"uuid",nullable:!1,isPrimary:!0,default:"gen_random_uuid()"},{name:"name",type:"text",nullable:!1},{name:"description",type:"text",nullable:!0},{name:"color",type:"text",nullable:!0},{name:"icon",type:"text",nullable:!0},{name:"user_id",type:"uuid",nullable:!1},{name:"created_at",type:"timestamptz",nullable:!1,default:"now()"},{name:"updated_at",type:"timestamptz",nullable:!1,default:"now()"}],rationale:"Groups tasks into named lists for better organization",source:v.TEMPLATE},{tableName:"subtasks",fields:[{name:"id",type:"uuid",nullable:!1,isPrimary:!0,default:"gen_random_uuid()"},{name:"task_id",type:"uuid",nullable:!1},{name:"title",type:"text",nullable:!1},{name:"completed",type:"bool",nullable:!1,default:"false"},{name:"position",type:"int4",nullable:!1,default:"0"},{name:"created_at",type:"timestamptz",nullable:!1,default:"now()"}],rationale:"Tracks smaller subtasks linked to a main task",source:v.TEMPLATE}],Analytics:[{tableName:"events",fields:[{name:"id",type:"uuid",nullable:!1,isPrimary:!0,default:"gen_random_uuid()"},{name:"user_id",type:"uuid",nullable:!0},{name:"session_id",type:"text",nullable:!0},{name:"event_type",type:"text",nullable:!1},{name:"properties",type:"jsonb",nullable:!0},{name:"user_agent",type:"text",nullable:!0},{name:"ip_address",type:"text",nullable:!0},{name:"created_at",type:"timestamptz",nullable:!1,default:"now()"}],rationale:"Captures user events and properties for analytics tracking",source:v.TEMPLATE},{tableName:"page_views",fields:[{name:"id",type:"uuid",nullable:!1,isPrimary:!0,default:"gen_random_uuid()"},{name:"user_id",type:"uuid",nullable:!0},{name:"session_id",type:"text",nullable:!0},{name:"path",type:"text",nullable:!1},{name:"referrer",type:"text",nullable:!0},{name:"duration",type:"int4",nullable:!0},{name:"created_at",type:"timestamptz",nullable:!1,default:"now()"}],rationale:"Tracks user page views, referrers, and session info",source:v.TEMPLATE},{tableName:"metrics",fields:[{name:"id",type:"uuid",nullable:!1,isPrimary:!0,default:"gen_random_uuid()"},{name:"metric_name",type:"text",nullable:!1},{name:"value",type:"numeric",nullable:!1},{name:"tags",type:"jsonb",nullable:!0},{name:"timestamp",type:"timestamptz",nullable:!1,default:"now()"},{name:"aggregation_period",type:"text",nullable:!0},{name:"created_at",type:"timestamptz",nullable:!1,default:"now()"}],rationale:"Stores aggregated metrics and KPIs with timestamps",source:v.TEMPLATE}]},I=Object.keys(D),P=({onSelectTemplate:e,disabled:t})=>{let[a,i]=(0,u.useState)(null),n=(0,R.useTrack)();(0,u.useEffect)(()=>{null===a&&I.length>0&&i(I[0])},[a]);let r=(0,u.useCallback)(e=>{i(e),n("table_quickstart_category_clicked",{categoryName:e})},[n]),o=(0,u.useCallback)(t=>{n("table_quickstart_template_clicked",{tableName:t.tableName,columnCount:t.fields.length,source:"templates",categoryName:a??"Unknown"}),e(L(t)),d.toast.success(`Applied ${t.tableName} template. You can customize the fields below.`,{duration:3e3})},[e,n,a]),c=a&&D[a]||[];return(0,s.jsxs)("div",{className:"rounded-lg border border-default bg-surface-100 p-6 transition-all hover:border-foreground-muted",children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(F.Layers,{size:16,className:"text-foreground"}),(0,s.jsx)("h3",{className:"text-base font-medium",children:"Table quickstarts"})]}),(0,s.jsx)("p",{className:"text-sm text-foreground-lighter",children:"Select a pre-built schema to get started quickly."})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:I.map(e=>(0,s.jsx)("button",{onClick:()=>r(e),disabled:t,role:"tab","aria-selected":a===e,"aria-label":`${e} templates category`,className:(0,g.cn)("px-3 py-1.5 rounded-md text-sm capitalize border transition-all",a===e?"border-foreground bg-surface-200 text-foreground":"border-default hover:border-foreground-muted hover:bg-surface-100 text-foreground-light","disabled:opacity-50 disabled:cursor-not-allowed"),children:e},e))}),c.length>0&&(0,s.jsx)("div",{className:"grid gap-2 pt-1",children:c.map(e=>(0,s.jsx)("button",{onClick:()=>o(e),disabled:t,"aria-label":`Select ${e.tableName} template with ${e.fields.length} fields`,className:(0,g.cn)("text-left p-3 rounded-md border transition-colors w-full bg-surface-100","border-light hover:border-default hover:bg-surface-200 cursor-pointer","disabled:opacity-50 disabled:cursor-not-allowed"),children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"rounded-full bg-alternative border w-8 h-8 flex items-center justify-center flex-shrink-0",children:(0,s.jsx)(l.Table2,{size:16,className:"text-foreground"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-foreground mb-0",children:e.tableName}),e.rationale&&(0,s.jsx)("div",{className:"text-xs text-foreground-light mt-0.5",children:e.rationale})]}),(0,s.jsxs)(A.Tooltip,{children:[(0,s.jsx)(A.TooltipTrigger,{asChild:!0,children:(0,s.jsxs)("div",{className:"flex items-center gap-1 text-sm text-foreground-muted ml-3",children:[(0,s.jsx)(y,{size:14,"aria-hidden":"true"}),(0,s.jsx)("span",{children:e.fields.length})]})}),(0,s.jsxs)(A.TooltipContent,{children:[e.fields.length," ",1===e.fields.length?"column":"columns"]})]})]})},`${a}:${e.tableName}`))})]})]})};var M=e.i(162082),q=e.i(2579),U=e.i(265735),z=e.i(635494),Y=e.i(761755),$=e.i(48189),W=e.i(432478),X=e.i(317040),H=e.i(739409),G=e.i(636047),Z=e.i(441081),V=e.i(63519),K=e.i(792459),Q=e.i(283606),J=e.i(314805),ee=e.i(408279),et=e.i(500850),ea=e.i(795826),es=e.i(457395),ei=e.i(809323),en=e.i(265100),er=e.i(528462),el=e.i(19583);function eo(){let{ref:e}=(0,m.useParams)(),t=(0,V.useTabsStateSnapshot)(),a=(0,ea.useEditorType)();if(!t?.recentItems||!e)return null;let i=(a?t.recentItems.filter(e=>V.editorEntityTypes[a].includes(e.type)):[...t.recentItems]).sort((e,t)=>t.timestamp-e.timestamp);return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h2",{className:"text-sm text-foreground",children:"Recent items"}),(0,s.jsx)("div",{className:"flex flex-col gap-0",children:0===i.length?(0,s.jsxs)(en.motion.div,{layout:!0,initial:!1,className:"flex flex-col items-center justify-center p-8 text-center border rounded-md border-muted gap-3",children:[(0,s.jsx)(er.EntityTypeIcon,{type:"r"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-foreground-light",children:"No recent items yet"}),(0,s.jsx)("p",{className:"text-xs text-foreground-lighter",children:"Items will appear here as you browse through your project"})]})]}):(0,s.jsx)(ei.AnimatePresence,{children:(0,s.jsx)("div",{className:"grid grid-cols-1 gap-12 gap-y-0",children:i.map((t,a)=>(0,s.jsx)(en.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{delay:.012*a,duration:.15},children:(0,s.jsxs)(o.default,{href:`/project/${e}/${"sql"===t.type?`sql/${t.metadata?.sqlId}`:"r"===t.type||"v"===t.type||"m"===t.type||"f"===t.type||"p"===t.type?`editor/${t.metadata?.tableId}?schema=${t.metadata?.schema}&${el.LOAD_TAB_FROM_CACHE_PARAM}=true`:`explorer/${t.type}/${t.metadata?.schema}/${t.metadata?.name}`}`,className:"flex items-center gap-4 rounded-lg bg-surface-100 py-2 transition-colors hover:bg-surface-200",children:[(0,s.jsx)("div",{className:"flex h-6 w-6 items-center justify-center rounded bg-surface-100 border",children:(0,s.jsx)(er.EntityTypeIcon,{type:t.type})}),(0,s.jsxs)("div",{className:"flex flex-1 gap-5 items-center",children:[(0,s.jsxs)("span",{className:"text-sm text-foreground",children:[(0,s.jsx)("span",{className:"text-foreground-lighter",children:t.metadata?.schema}),t.metadata?.schema&&(0,s.jsx)("span",{className:"text-foreground-light",children:"."}),(0,s.jsx)("span",{className:"text-foreground",children:t.label||"Untitled"})]}),(0,s.jsx)("div",{className:"bg-border-muted flex grow h-px"}),(0,s.jsx)("span",{className:"text-xs text-foreground-lighter",children:(0,n.default)(t.timestamp).fromNow()})]})]})},t.id))})})})]})}var ec=e.i(215618),eu=e.i(983783),ed=e.i(392491);function em(){let e=(0,c.useRouter)(),{ref:t}=(0,m.useParams)(),a=(0,ea.useEditorType)(),{profile:f}=(0,W.useProfile)(),{data:A}=(0,U.useSelectedOrganizationQuery)(),{data:y}=(0,z.useSelectedProjectQuery)(),{selectedSchema:x}=(0,eu.useQuerySchemaState)(),{isSchemaLocked:C}=(0,ed.useIsProtectedSchema)({schema:x}),E=(0,G.useTableEditorStateSnapshot)(),N=(0,H.useSqlEditorV2StateSnapshot)(),v=(0,V.useTabsStateSnapshot)(),S=(0,X.useAiAssistantStateSnapshot)(),{openSidebar:j}=(0,Z.useSidebarManagerSnapshot)(),[k,O]=(0,u.useState)(!1),[T]=(0,r.default)(p.SQL_TEMPLATES,{type:"template"}),[L]=(0,r.default)(p.SQL_TEMPLATES,{type:"quickstart"}),F=(0,u.useRef)(!1),{mutate:D}=(0,M.useSendEventMutation)(),I=(0,R.useTrack)(),{can:ei}=(0,q.useAsyncCheckPermissions)(i.PermissionAction.CREATE,"user_content",{resource:{type:"sql",owner_id:f?.id},subject:{id:f?.id}}),en=(0,Y.usePHFlag)("tableQuickstart"),er=(0,u.useMemo)(()=>!!y?.inserted_at&&7>(0,n.default)().diff((0,n.default)(y.inserted_at),"day"),[y?.inserted_at]),el="sql"!==a&&er&&en&&en!==w.CONTROL?en:null,em="sql"!==a&&er&&!1!==en&&void 0!==en;(0,u.useEffect)(()=>{em&&!F.current&&(F.current=!0,I("table_quickstart_opened",{variant:en}))},[em,en,I]);let ep=C?[]:[{icon:(0,s.jsx)(l.Table2,{className:"h-4 w-4 text-foreground",strokeWidth:1.5}),title:"Create a table",description:"Design and create a new database table",bgColor:"bg-blue-500",isBeta:!1,onClick:()=>E.onAddTable()}],e_=[{icon:(0,s.jsx)(K.SQL_ICON,{className:(0,g.cn)("fill-foreground","w-4 h-4"),strokeWidth:1.5}),title:"New SQL Snippet",description:"Execute SQL queries",bgColor:"bg-green-500",isBeta:!1,onClick:()=>e.push(`/project/${t}/sql/new`)}],eh=async(a,s)=>{if(!t)return console.error("Project ref is required");if(!y)return console.error("Project is required");if(!f)return console.error("Profile is required");if(!ei)return(0,d.toast)("Your queries will not be saved as you do not have sufficient permissions");try{let i=(0,_.createSqlSnippetSkeletonV2)({id:(0,$.uuidv4)(),name:s,sql:a,owner_id:f?.id,project_id:y?.id});N.addSnippet({projectRef:t,snippet:i}),N.addNeedsSaving(i.id);let n=(0,V.createTabId)("sql",{id:i.id});v.addTab({id:n,type:"sql",label:s,metadata:{sqlId:i.id}}),e.push(`/project/${t}/sql/${i.id}`)}catch(e){d.toast.error(`Failed to create new query: ${e.message}`)}};return(0,s.jsxs)("div",{className:"bg-surface-100 h-full overflow-y-auto py-12",children:[(0,s.jsxs)("div",{className:"mx-auto max-w-2xl flex flex-col gap-10 px-10",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[("sql"===a?e_:ep).map((e,t)=>(0,s.jsx)(es.ActionCard,{...e},`action-card-${t}`)),el===w.ASSISTANT&&(0,s.jsx)(es.ActionCard,{icon:(0,s.jsx)(h.AiIconAnimation,{size:16,loading:k}),title:"Create with Assistant",description:"Use AI to design your database table",bgColor:"bg-brand-200",onClick:()=>{if(!k){O(!0);try{if(j(ec.SIDEBAR_KEYS.AI_ASSISTANT),!S.newChat({name:"Create a database table"}))throw I("table_quickstart_assistant_opened",{chatCreated:!1}),Error("Failed to create chat");let e={id:(0,$.uuidv4)(),role:"user",parts:[{type:"text",text:"Help me create a new database table for my project"}]},t={id:(0,$.uuidv4)(),role:"assistant",parts:[{type:"text",text:"I'll help you create a database table. Please tell me:\n\n1. What does your application do?\n2. What kind of data do you want to store?\n\nI'll suggest a table structure that fits your requirements and help you create it directly in your database."}]};S.saveMessage([e,t]),I("table_quickstart_assistant_opened",{chatCreated:!0})}catch(t){console.error("Failed to open AI assistant:",t);let e=t instanceof Error?t.message:"Unknown error";d.toast.error(`Unable to open AI assistant: ${e}`)}finally{O(!1)}}}})]}),el===w.AI&&(0,s.jsx)(B,{onSelectTable:e=>E.onAddTable(e)}),el===w.TEMPLATES&&(0,s.jsx)(P,{onSelectTemplate:e=>E.onAddTable(e)}),(0,s.jsx)(eo,{})]}),"sql"===a&&(0,s.jsx)("div",{className:"flex flex-col gap-4 mx-auto py-10",children:(0,s.jsxs)(et.Tabs_Shadcn_,{defaultValue:"templates",children:[(0,s.jsxs)(J.TabsList_Shadcn_,{className:"mx-auto justify-center gap-5",children:[(0,s.jsx)(ee.TabsTrigger_Shadcn_,{value:"templates",children:"Templates"}),(0,s.jsx)(ee.TabsTrigger_Shadcn_,{value:"quickstarts",children:"Quickstarts"})]}),(0,s.jsxs)(Q.TabsContent_Shadcn_,{value:"templates",className:"max-w-5xl mx-auto py-5",children:[(0,s.jsx)("div",{className:"grid grid-cols-3 gap-4 px-8",children:T.slice(0,9).map((e,a)=>(0,s.jsx)(es.ActionCard,{onClick:()=>{eh(e.sql,e.title),D({action:"sql_editor_template_clicked",properties:{templateName:e.title},groups:{project:t??"Unknown",organization:A?.slug??"Unknown"}})},bgColor:"bg-alternative border",...e,icon:(0,s.jsx)(K.SQL_ICON,{className:(0,g.cn)("fill-foreground","w-4 h-4"),strokeWidth:1.5})},`action-card-${a}`))}),(0,s.jsx)("div",{className:"flex justify-center mt-5",children:(0,s.jsx)(b.Button,{asChild:!0,type:"default",children:(0,s.jsx)(o.default,{href:`/project/${t}/sql/templates`,children:"View more templates"})})})]}),(0,s.jsxs)(Q.TabsContent_Shadcn_,{value:"quickstarts",className:"max-w-5xl mx-auto py-5",children:[(0,s.jsx)("div",{className:"grid grid-cols-3 gap-4 px-8",children:L.map((e,a)=>(0,s.jsx)(es.ActionCard,{onClick:()=>{eh(e.sql,e.title),D({action:"sql_editor_quickstart_clicked",properties:{quickstartName:e.title},groups:{project:t??"Unknown",organization:A?.slug??"Unknown"}})},bgColor:"bg-alternative border",...e,icon:(0,s.jsx)(K.SQL_ICON,{className:(0,g.cn)("fill-foreground","w-4 h-4"),strokeWidth:1.5})},`action-card-${a}`))}),(0,s.jsx)("div",{className:"flex justify-center mt-5",children:(0,s.jsx)(b.Button,{asChild:!0,type:"default",children:(0,s.jsx)(o.default,{href:`/project/${t}/sql/quickstarts`,children:"View more templates"})})})]})]})})]})}e.s(["NewTab",()=>em],765672)},830033,e=>{"use strict";var t=e.i(478902),a=e.i(898452),s=e.i(389959);e.i(128328);var i=e.i(158639),n=e.i(19583),r=e.i(565066),l=e.i(448710),o=e.i(569715),c=e.i(111331),u=e.i(207831),d=e.i(765672),m=e.i(990510),p=e.i(983783),_=e.i(63519);let h=()=>{let e=(0,a.useRouter)(),{ref:l}=(0,i.useParams)(),o=(0,_.useTabsStateSnapshot)(),{selectedSchema:c}=(0,p.useQuerySchemaState)(),{history:u,isHistoryLoaded:h}=(0,m.useDashboardHistory)();return(0,s.useEffect)(()=>{if(h){let t=u.editor,a=o.openTabs.find(e=>_.editorEntityTypes.table.includes(o.tabsMap[e]?.type));if(void 0!==t)e.push(`/project/${l}/editor/${u.editor}?${n.LOAD_TAB_FROM_CACHE_PARAM}=true`);else if(a){let t=o.tabsMap[a];t&&e.push(`/project/${l}/editor/${t.metadata?.tableId}?${n.LOAD_TAB_FROM_CACHE_PARAM}=true`)}}},[h]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.NewTab,{}),(0,t.jsx)(r.SidePanelEditor,{onTableCreated:t=>{e.push(`/project/${l}/editor/${t.id}${c?`?schema=${c}`:""}`)}})]})};h.getLayout=e=>(0,t.jsx)(l.DefaultLayout,{children:(0,t.jsx)(o.EditorBaseLayout,{productMenu:(0,t.jsx)(u.TableEditorMenu,{}),product:"Table Editor",productMenuClassName:"overflow-y-hidden",children:(0,t.jsx)(c.TableEditorLayout,{children:e})})}),e.s(["default",0,h])},309956,(e,t,a)=>{let s="/project/[ref]/editor";(window.__NEXT_P=window.__NEXT_P||[]).push([s,()=>e.r(830033)]),t.hot&&t.hot.dispose(function(){window.__NEXT_P.push([s])})},111410,e=>{e.v(t=>Promise.all(["static/chunks/a428d2b7e6671266.js","static/chunks/92a7c4be60dd12e3.js"].map(t=>e.l(t))).then(()=>t(677146)))},883471,e=>{e.v(t=>Promise.all(["static/chunks/69b2faaedd35af23.js"].map(t=>e.l(t))).then(()=>t(518769)))},587525,e=>{e.v(t=>Promise.all(["static/chunks/da2f61ca91d09b7f.js"].map(t=>e.l(t))).then(()=>t(127351)))},168845,e=>{e.v(t=>Promise.all(["static/chunks/99714db866f77205.js"].map(t=>e.l(t))).then(()=>t(238625)))},591393,e=>{e.v(t=>Promise.all(["static/chunks/e9ad074e72197584.js"].map(t=>e.l(t))).then(()=>t(217383)))},379416,e=>{e.v(t=>Promise.all(["static/chunks/d690909a90d04a2e.js"].map(t=>e.l(t))).then(()=>t(931066)))},15732,e=>{e.v(t=>Promise.all(["static/chunks/0d5256e667945be4.js"].map(t=>e.l(t))).then(()=>t(760545)))},957083,e=>{e.v(t=>Promise.all(["static/chunks/e7d07ff1ae210964.js"].map(t=>e.l(t))).then(()=>t(667558)))},207969,e=>{e.v(t=>Promise.all(["static/chunks/8dd7282c22f923f6.js"].map(t=>e.l(t))).then(()=>t(427328)))},992842,e=>{e.v(t=>Promise.all(["static/chunks/d064a48a1c7cf778.js"].map(t=>e.l(t))).then(()=>t(793794)))},239573,e=>{e.v(t=>Promise.all(["static/chunks/edc5d84148401903.js"].map(t=>e.l(t))).then(()=>t(210246)))},963685,e=>{e.v(t=>Promise.all(["static/chunks/92b20126e5ca0919.js"].map(t=>e.l(t))).then(()=>t(983756)))},665811,e=>{e.v(t=>Promise.all(["static/chunks/e37e25f8b82619ef.js"].map(t=>e.l(t))).then(()=>t(544836)))},369256,e=>{e.v(t=>Promise.all(["static/chunks/8296dc618dae72f0.js"].map(t=>e.l(t))).then(()=>t(930239)))},16037,e=>{e.v(t=>Promise.all(["static/chunks/3251b4bc539a554b.js"].map(t=>e.l(t))).then(()=>t(397698)))},616788,e=>{e.v(t=>Promise.all(["static/chunks/c6b81ab43a1d5d23.js"].map(t=>e.l(t))).then(()=>t(7346)))},315750,e=>{e.v(t=>Promise.all(["static/chunks/32c236321136eb7c.js"].map(t=>e.l(t))).then(()=>t(531289)))},460510,e=>{e.v(t=>Promise.all(["static/chunks/d91062943e6a7c30.js"].map(t=>e.l(t))).then(()=>t(276898)))},550265,e=>{e.v(t=>Promise.all(["static/chunks/75ff0e62b8a31d26.js"].map(t=>e.l(t))).then(()=>t(259714)))},830960,e=>{e.v(t=>Promise.all(["static/chunks/b44aa26556fee7df.js"].map(t=>e.l(t))).then(()=>t(882885)))},336744,e=>{e.v(t=>Promise.all(["static/chunks/2b0767b5c008139a.js"].map(t=>e.l(t))).then(()=>t(955268)))},63631,e=>{e.v(t=>Promise.all(["static/chunks/21a4706e1f02d90b.js"].map(t=>e.l(t))).then(()=>t(853630)))},912072,e=>{e.v(t=>Promise.all(["static/chunks/c17c80e5efc43419.js"].map(t=>e.l(t))).then(()=>t(311301)))},730314,e=>{e.v(t=>Promise.all(["static/chunks/dcadd9d46d72282e.js","static/chunks/df8f2d32c834951d.js","static/chunks/82dddbda1a808189.js","static/chunks/d3a06a9a43f3833e.js","static/chunks/87b9766a4d16d1da.js","static/chunks/cc8130a84ee9bc2c.css"].map(t=>e.l(t))).then(()=>t(686651)))}]);

//# debugId=791241ef-89df-ca3f-ae0d-07a7d4561289
//# sourceMappingURL=2184320105fdd8b6.js.map