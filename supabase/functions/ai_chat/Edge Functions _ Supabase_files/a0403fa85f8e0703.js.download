;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="9af3b73b-d8f6-4721-ce1c-5afa1b52aae6")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,351895,e=>{"use strict";var s=e.i(38429),i=e.i(355901),a=e.i(234745);async function t({ref:e,identifier:s}){let i={};void 0!==s&&(i.database_identifier=s);let{data:t,error:r}=await (0,a.post)("/platform/projects/{ref}/restart",{params:{path:{ref:e}},body:i});return r&&(0,a.handleError)(r),t}e.s(["useProjectRestartMutation",0,({onSuccess:e,onError:a,...r}={})=>(0,s.useMutation)({mutationFn:e=>t(e),async onSuccess(s,i,a){await e?.(s,i,a)},async onError(e,s,t){void 0===a?i.toast.error(`Failed to restart project: ${e.message}`):a(e,s,t)},...r})])},427887,10800,544985,403354,555254,410043,623058,552401,498275,128,e=>{"use strict";let s=(0,e.i(388019).default)("Earth",[["path",{d:"M21.54 15H17a2 2 0 0 0-2 2v4.54",key:"1djwo0"}],["path",{d:"M7 3.34V5a3 3 0 0 0 3 3a2 2 0 0 1 2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2c0-1.1.9-2 2-2h3.17",key:"1tzkfa"}],["path",{d:"M11 21.95V18a2 2 0 0 0-2-2a2 2 0 0 1-2-2v-1a2 2 0 0 0-2-2H2.05",key:"14pb5j"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);e.s(["Globe2",()=>s],427887);var i,a=e.i(242882),t=e.i(234745),r=e.i(346691),n=((i={}).InProgress="in_progress",i.Completed="completed",i.Failed="failed",i);async function l({projectRef:e},s){if(!e)throw Error("Project ref is required");let{data:i,error:a}=await (0,t.get)("/platform/projects/{ref}/databases-statuses",{params:{path:{ref:e}},signal:s});return a&&(0,t.handleError)(a),i}let o=({projectRef:e},{enabled:s=!0,...i}={})=>(0,a.useQuery)({queryKey:r.replicaKeys.statuses(e),queryFn:({signal:s})=>l({projectRef:e},s),enabled:s&&void 0!==e,...i});e.s(["ReplicaInitializationStatus",()=>n,"useReadReplicasStatusesQuery",0,o],10800),e.i(744541);var d=e.i(478902),c=e.i(88816),p=e.i(215261),u=e.i(389959),h=e.i(355901),m=e.i(902858);e.i(128328);var x=e.i(158639),g=e.i(961753),f=e.i(819591),j=e.i(196621),y=e.i(513826),b=e.i(605317),_=e.i(38429);async function A({ref:e}){let{data:s,error:i}=await (0,t.post)("/platform/database/{ref}/backups/enable-physical-backups",{params:{path:{ref:e}}});return i&&(0,t.handleError)(i),s}var S=e.i(390473),N=e.i(164045),v=e.i(356003);async function E({projectRef:e,region:s}){let{data:i,error:a}=await (0,t.post)("/v1/projects/{ref}/read-replicas/setup",{params:{path:{ref:e}},body:{read_replica_region:s}});return a&&(0,t.handleError)(a),i}var R=e.i(150671),I=e.i(144676),T=e.i(265735),C=e.i(635494),w=e.i(10429),P=e.i(837508),D=e.i(48189);e.i(427138);var L=e.i(434934),k=e.i(206413),B=e.i(592360),O=e.i(178527),M=e.i(837710),$=e.i(774234),U=e.i(554855),H=e.i(925282),z=e.i(331077),G=e.i(539013),V=e.i(492418),W=e.i(877555),F=e.i(843778),Y=e.i(72187);async function Q({projectRef:e,identifier:s}){let{data:i,error:a}=await (0,t.post)("/v1/projects/{ref}/read-replicas/remove",{params:{path:{ref:e}},body:{database_identifier:s}});return a&&(0,t.handleError)(a),i}e.s(["default",0,({visible:e,selectedDefaultRegion:s,onSuccess:i,onClose:a})=>{let{ref:t}=(0,x.useParams)(),{data:n}=(0,C.useSelectedProjectQuery)(),{data:l}=(0,T.useSelectedOrganizationQuery)(),{data:o}=(0,R.useReadReplicasQuery)({projectRef:t}),{data:Q,isSuccess:q}=(0,I.useProjectAddonsQuery)({projectRef:t}),{data:K}=(0,b.useDiskAttributesQuery)({projectRef:t}),Z=(0,u.useMemo)(()=>!["team","enterprise","platform"].includes(l?.plan.id??""),[l]),{data:X}=(0,S.useOverdueInvoicesQuery)({enabled:Z}),J=(X??[]).filter(e=>e.organization_id===n?.organization_id).length>0&&Z,ee=(0,C.useIsAwsK8sCloudProvider)(),[es]=Object.entries(L.AWS_REGIONS).find(([e,s])=>s===P.AWS_REGIONS_DEFAULT)??["ap-southeast-1"],ei=Q?.selected_addons.find(e=>"compute_instance"===e.type)?.variant.identifier??"ci_micro",{size_gb:ea,type:et,throughput_mbps:er,iops:en}=K?.attributes??{},el=n?.cloud_provider==="AWS",eo=(ea??0)*1.25*(f.DISK_PRICING[et]?.storage??0),ed=(0,g.calculateIOPSPrice)({oldStorageType:et,newStorageType:et,oldProvisionedIOPS:0,newProvisionedIOPS:en??0,numReplicas:0}).newPrice,ec="gp3"===et?(0,g.calculateThroughputPrice)({storageType:et,newThroughput:er??0,oldThroughput:0,numReplicas:0}).newPrice:0,[ep,eu]=(0,u.useState)(!1),[eh,em]=(0,u.useState)(es),[ex,eg]=(0,u.useState)(ei),{data:ef,isSuccess:ej}=(0,N.useProjectDetailQuery)({ref:t},{refetchInterval:ep,refetchOnWindowFocus:!1});(0,u.useEffect)(()=>{ej&&ef.is_physical_backups_enabled&&eu(!1)},[ef?.is_physical_backups_enabled,ej]);let{mutate:ey,isPending:eb}=(({onSuccess:e,onError:s,...i}={})=>(0,_.useMutation)({mutationFn:e=>A(e),async onSuccess(s,i,a){await e?.(s,i,a)},async onError(e,i,a){void 0===s?h.toast.error(`Failed to enable physical backups: ${e.message}`):s(e,i,a)},...i}))({onSuccess:()=>{h.toast.success("Physical backups are currently being enabled, please check back in a few minutes!"),eu(5e3)}}),{mutate:e_,isPending:eA}=(({onSuccess:e,onError:s,...i}={})=>{let a=(0,v.useQueryClient)();return(0,_.useMutation)({mutationFn:e=>E(e),async onSuccess(s,i,t){let{projectRef:n}=i;await a.invalidateQueries({queryKey:r.replicaKeys.list(n)}),await e?.(s,i,t)},async onError(e,i,a){void 0===s?h.toast.error(`Failed to set up read replica: ${e.message}`):s(e,i,a)},...i})})({onSuccess:()=>{let e=Y.AVAILABLE_REPLICA_REGIONS.find(e=>e.key===eh)?.name;h.toast.success(`Spinning up new replica in ${e??" Unknown"}...`),i(),a()}}),eS=Number((n?.dbVersion??"").split("supabase-postgres-")[1]?.split(".")[0]),eN=["ci_micro","ci_small","ci_medium","ci_large"].includes(ex)?R.MAX_REPLICAS_BELOW_XL:R.MAX_REPLICAS_ABOVE_XL,ev=(o??[]).filter(e=>e.identifier!==t).length>=eN,eE=l?.plan.id==="free",eR=n?.cloud_provider==="AWS",eI=n?.is_physical_backups_enabled,eT=Q?.selected_addons.find(e=>"compute_instance"===e.type),eC=l?.plan.id==="pro"&&!l.usage_billing_enabled,ew=eT?.variant.identifier!==void 0&&eT?.variant.identifier!=="ci_micro",eP=!ev&&eS>=15&&eR&&!eE&&eI&&void 0!==eT&&!J&&!ee&&!eC,eD=(Q?.available_addons.find(e=>"compute_instance"===e.type)?.variants??[]).find(e=>e.identifier===ex),eL=Math.floor((eD?.price??0)*730),ek=Y.AVAILABLE_REPLICA_REGIONS,eB=async()=>{let e=L.AWS_REGIONS[eh].code;if(!t)return console.error("Project is required");if(!e)return h.toast.error("Unable to deploy replica: Unsupported region selected");let s=o?.find(e=>e.identifier===t);e_({projectRef:t,region:e,size:s?.size??"t4g.small"})};return(0,u.useEffect)(()=>{e&&q&&(void 0!==s?em(s):es&&em(es),void 0!==ei&&eg(ei))},[e,q]),(0,d.jsx)(G.SidePanel,{visible:e,onCancel:a,loading:eA,disabled:!eP,className:(0,F.cn)(el?"max-w-[500px]":""),header:"Deploy a new read replica",onConfirm:()=>eB(),confirmText:"Deploy replica",children:(0,d.jsxs)(G.SidePanel.Content,{className:"flex flex-col py-4 gap-y-4",children:[J?(0,d.jsxs)(O.Alert_Shadcn_,{children:[(0,d.jsx)(W.WarningIcon,{}),(0,d.jsx)(B.AlertTitle_Shadcn_,{children:"Your organization has overdue invoices"}),(0,d.jsxs)(k.AlertDescription_Shadcn_,{children:[(0,d.jsx)("span",{children:"Please resolve all outstanding invoices first before deploying a new read replica"}),(0,d.jsx)("div",{className:"mt-3",children:(0,d.jsx)(M.Button,{asChild:!0,type:"default",children:(0,d.jsx)(p.default,{href:`/org/${l?.slug}/billing#invoices`,children:"View invoices"})})})]})]}):eR?ee?(0,d.jsxs)(O.Alert_Shadcn_,{children:[(0,d.jsx)(W.WarningIcon,{}),(0,d.jsx)(B.AlertTitle_Shadcn_,{children:"Read replicas are not supported for AWS (Revamped) projects"}),(0,d.jsx)(k.AlertDescription_Shadcn_,{children:(0,d.jsx)("span",{children:"Projects provisioned by other cloud providers currently will not be able to use read replicas"})})]}):eS<15?(0,d.jsxs)(O.Alert_Shadcn_,{children:[(0,d.jsx)(W.WarningIcon,{}),(0,d.jsx)(B.AlertTitle_Shadcn_,{children:"Read replicas can only be deployed with projects on Postgres version 15 and above"}),(0,d.jsx)(k.AlertDescription_Shadcn_,{children:"If you'd like to use read replicas, please contact us via support"}),(0,d.jsx)(k.AlertDescription_Shadcn_,{className:"mt-2",children:(0,d.jsx)(M.Button,{type:"default",children:(0,d.jsx)(j.SupportLink,{queryParams:{projectRef:t,category:m.SupportCategories.SALES_ENQUIRY,subject:"Enquiry on read replicas",message:`Project DB version: ${n?.dbVersion}`},children:"Contact support"})})})]}):ew?eI?eC?(0,d.jsxs)(O.Alert_Shadcn_,{children:[(0,d.jsx)(W.WarningIcon,{}),(0,d.jsx)(B.AlertTitle_Shadcn_,{children:"Spend cap needs to be disabled to deploy replicas"}),(0,d.jsxs)(k.AlertDescription_Shadcn_,{children:[(0,d.jsx)("span",{children:"Launching a replica incurs additional disk size that will exceed the plan's quota. Disable the spend cap first to allow overages before launching a replica."}),(0,d.jsx)("div",{className:"flex items-center gap-x-2 mt-3",children:(0,d.jsx)(M.Button,{asChild:!0,type:"default",children:(0,d.jsx)(p.default,{href:`/org/${l?.slug}/billing?panel=costControl`,children:"Disable spend cap"})})})]})]}):ev?(0,d.jsxs)(O.Alert_Shadcn_,{children:[(0,d.jsx)(W.WarningIcon,{}),(0,d.jsxs)(B.AlertTitle_Shadcn_,{children:["You can only deploy up to ",eN," read replicas at once"]}),(0,d.jsx)(k.AlertDescription_Shadcn_,{children:"If you'd like to spin up another read replica, please drop an existing replica first."}),eN===R.MAX_REPLICAS_BELOW_XL&&(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)(k.AlertDescription_Shadcn_,{children:[(0,d.jsxs)("span",{children:["Alternatively, you may deploy up to"," ",(0,d.jsx)("span",{className:"text-foreground",children:R.MAX_REPLICAS_ABOVE_XL})," replicas if your project is on an XL compute or higher."]}),(0,d.jsx)("div",{className:"flex items-center gap-x-2 mt-3",children:(0,d.jsx)(M.Button,{asChild:!0,type:"default",children:(0,d.jsx)(p.default,{href:eE?`/org/${l?.slug}/billing?panel=subscriptionPlan&source=deployNewReplicaPanelMaxReplicas`:`/project/${t}/settings/compute-and-disk`,children:"Upgrade compute size"})})})]})})]}):null:(0,d.jsxs)(O.Alert_Shadcn_,{children:[(0,d.jsx)(W.WarningIcon,{}),(0,d.jsx)(B.AlertTitle_Shadcn_,{children:!1!==ep?"Physical backups are currently being enabled":"Physical backups are required to deploy replicas"}),!1===ep&&(0,d.jsx)(k.AlertDescription_Shadcn_,{className:"mb-2",children:"Physical backups are used under the hood to spin up read replicas for your project."}),(0,d.jsx)(k.AlertDescription_Shadcn_,{children:!1!==ep?"This warning will go away once physical backups have been enabled - check back in a few minutes!":"Enabling physical backups will take a few minutes, after which you will be able to deploy read replicas."}),!1!==ep?(0,d.jsx)(k.AlertDescription_Shadcn_,{className:"mt-2",children:"You may start deploying read replicas thereafter once this is completed."}):(0,d.jsxs)(k.AlertDescription_Shadcn_,{className:"flex items-center gap-x-2 mt-3",children:[(0,d.jsx)(M.Button,{type:"default",loading:eb,disabled:eb,onClick:()=>{t&&ey({ref:t})},children:"Enable physical backups"}),(0,d.jsx)(y.DocsButton,{abbrev:!1,href:`${w.DOCS_URL}/guides/platform/read-replicas#how-are-read-replicas-made`})]})]}):(0,d.jsxs)(O.Alert_Shadcn_,{children:[(0,d.jsx)(W.WarningIcon,{}),(0,d.jsx)(B.AlertTitle_Shadcn_,{children:"Project required to at least be on a Small compute"}),(0,d.jsxs)(k.AlertDescription_Shadcn_,{children:[(0,d.jsx)("span",{children:"This is to ensure that read replicas can keep up with the primary databases' activities."}),(0,d.jsxs)("div",{className:"flex items-center gap-x-2 mt-3",children:[(0,d.jsx)(M.Button,{asChild:!0,type:"default",children:(0,d.jsx)(p.default,{href:eE?`/org/${l?.slug}/billing?panel=subscriptionPlan&source=deployNewReplicaPanelSmallCompute`:`/project/${t}/settings/compute-and-disk`,children:eE?"Upgrade to Pro":"Change compute size"})}),(0,d.jsx)(y.DocsButton,{abbrev:!1,href:`${w.DOCS_URL}/guides/platform/read-replicas#prerequisites`})]})]})]}):(0,d.jsxs)(O.Alert_Shadcn_,{children:[(0,d.jsx)(W.WarningIcon,{}),(0,d.jsx)(B.AlertTitle_Shadcn_,{children:"Read replicas are only supported for projects provisioned via AWS"}),(0,d.jsxs)(k.AlertDescription_Shadcn_,{children:[(0,d.jsx)("span",{children:"Projects provisioned by other cloud providers currently will not be able to use read replicas"}),(0,d.jsx)(y.DocsButton,{abbrev:!1,className:"mt-3",href:`${w.DOCS_URL}/guides/platform/read-replicas#prerequisites`})]})]}),(0,d.jsxs)("div",{className:"flex flex-col gap-y-6 mt-2",children:[(0,d.jsx)(z.Listbox,{size:"small",id:"region",name:"region",disabled:!eP,value:eh,onChange:em,label:"Select a region to deploy your read replica in",children:ek.map(e=>(0,d.jsx)(z.Listbox.Option,{label:e.name,value:e.key,addOnBefore:()=>(0,d.jsx)("img",{alt:"region icon",className:"w-5 rounded-sm",src:`${w.BASE_PATH}/img/regions/${e.region}.svg`}),children:(0,d.jsxs)("p",{className:"flex items-center gap-x-2",children:[(0,d.jsx)("span",{children:e.name}),(0,d.jsx)("span",{className:"text-xs text-foreground-lighter font-mono",children:e.region})]})},e.key))}),(0,d.jsxs)("div",{className:"flex flex-col gap-y-2",children:[el?(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)(H.Collapsible_Shadcn_,{children:[(0,d.jsxs)(U.CollapsibleTrigger_Shadcn_,{className:"w-full flex items-center justify-between [&[data-state=open]>svg]:!-rotate-180",children:[(0,d.jsxs)("p",{className:"text-sm text-left",children:["New replica will cost an additional"," ",(0,d.jsxs)("span",{translate:"no",children:[(0,D.formatCurrency)(eL+eo+Number(ed)+Number(ec)),"/month"]})]}),(0,d.jsx)(c.ChevronDown,{size:14,className:"transition"})]}),(0,d.jsxs)($.CollapsibleContent_Shadcn_,{className:"flex flex-col gap-y-1 mt-1",children:[(0,d.jsx)("p",{className:"text-foreground-light text-sm",children:"Read replicas will match the compute size of your primary database and will include 25% more disk size than the primary database to accommodate WAL files."}),(0,d.jsx)("p",{className:"text-foreground-light text-sm",children:"The additional cost for the replica breaks down to:"}),(0,d.jsxs)(V.Table,{children:[(0,d.jsx)(V.TableHeader,{className:"font-mono uppercase text-xs [&_th]:h-auto [&_th]:pb-2 [&_th]:pt-4",children:(0,d.jsxs)(V.TableRow,{children:[(0,d.jsx)(V.TableHead,{className:"w-[140px] pl-0",children:"Item"}),(0,d.jsx)(V.TableHead,{children:"Description"}),(0,d.jsx)(V.TableHead,{className:"text-right pr-0",children:"Cost (/month)"})]})}),(0,d.jsxs)(V.TableBody,{className:"[&_td]:py-0 [&_tr]:h-[50px] [&_tr]:border-dotted",children:[(0,d.jsxs)(V.TableRow,{children:[(0,d.jsx)(V.TableCell,{className:"pl-0",children:"Compute size"}),(0,d.jsx)(V.TableCell,{children:eD?.name}),(0,d.jsx)(V.TableCell,{className:"text-right font-mono pr-0",translate:"no",children:(0,D.formatCurrency)(eL)})]}),(0,d.jsxs)(V.TableRow,{children:[(0,d.jsx)(V.TableCell,{className:"pl-0",children:"Disk size"}),(0,d.jsxs)(V.TableCell,{children:[((ea??0)*1.25).toLocaleString()," GB (",et,")"]}),(0,d.jsx)(V.TableCell,{className:"text-right font-mono pr-0",translate:"no",children:(0,D.formatCurrency)(eo)})]}),(0,d.jsxs)(V.TableRow,{children:[(0,d.jsx)(V.TableCell,{className:"pl-0",children:"IOPS"}),(0,d.jsxs)(V.TableCell,{children:[en?.toLocaleString()," IOPS"]}),(0,d.jsx)(V.TableCell,{className:"text-right font-mono pr-0",translate:"no",children:(0,D.formatCurrency)(+ed)})]}),"gp3"===et&&(0,d.jsxs)(V.TableRow,{children:[(0,d.jsx)(V.TableCell,{className:"pl-0",children:"Throughput"}),(0,d.jsxs)(V.TableCell,{children:[er?.toLocaleString()," MB/s"]}),(0,d.jsx)(V.TableCell,{className:"text-right font-mono pr-0",children:(0,D.formatCurrency)(+ec)})]})]})]})]})]})}):(0,d.jsxs)("p",{className:"text-foreground-light text-sm",children:["Read replicas will be on the same compute size as your primary database. Deploying a read replica on the"," ",(0,d.jsx)("span",{className:"text-foreground",children:eD?.name})," size incurs additional"," ",(0,d.jsx)("span",{className:"text-foreground",translate:"no",children:eD?.price_description}),"."]}),(0,d.jsxs)("p",{className:"text-foreground-light text-sm",children:["Read more about"," ",(0,d.jsx)(p.default,{href:`${w.DOCS_URL}/guides/platform/manage-your-usage/read-replicas`,target:"_blank",rel:"noreferrer",className:"underline hover:text-foreground transition",children:"billing"})," ","for read replicas."]})]})]})]})})}],544985);let q=({onSuccess:e,onError:s,...i}={})=>{let a=(0,v.useQueryClient)();return(0,_.useMutation)({mutationFn:e=>Q(e),async onSuccess(s,i,t){let{projectRef:n,invalidateReplicaQueries:l}=i;l&&await Promise.all([a.invalidateQueries({queryKey:r.replicaKeys.list(n)}),a.invalidateQueries({queryKey:r.replicaKeys.loadBalancers(n)})]),await e?.(s,i,t)},async onError(e,i,a){void 0===s?h.toast.error(`Failed to remove read replica: ${e.message}`):s(e,i,a)},...i})};var K=e.i(466472);e.s(["default",0,({visible:e,onSuccess:s,onCancel:i})=>{let{ref:a}=(0,x.useParams)(),t=(0,v.useQueryClient)(),{data:n}=(0,R.useReadReplicasQuery)({projectRef:a}),{mutateAsync:l,isPending:o}=q(),c=async()=>{if(!a)return console.error("Project is required");if(void 0===n)return console.error("Unable to retrieve replicas");1===n.length&&(0,h.toast)("Your project has no read replicas");let e=n.filter(e=>e.identifier!==a);try{await Promise.all(e.map(e=>l({projectRef:a,identifier:e.identifier,invalidateReplicaQueries:!1}))),h.toast.success("Tearing down all read replicas"),await Promise.all([t.invalidateQueries({queryKey:r.replicaKeys.list(a)}),t.invalidateQueries({queryKey:r.replicaKeys.loadBalancers(a)})]),s(),i()}catch(e){h.toast.error("Failed to drop all replicas")}};return(0,d.jsxs)(K.default,{variant:"destructive",size:"medium",loading:o,visible:e,title:"Confirm to drop all read replicas?",confirmLabel:"Drop all replicas",confirmLabelLoading:"Dropping all replicas",onCancel:()=>i(),onConfirm:()=>c(),alert:{title:"This action cannot be undone",description:"You may still deploy new replicas in this region thereafter"},children:[(0,d.jsx)("p",{className:"text-sm",children:"Before deleting all replicas, consider:"}),(0,d.jsx)("ul",{className:"text-sm text-foreground-light list-disc pl-6",children:(0,d.jsx)("li",{children:"Network traffic from this region may slow down"})})]})}],403354);var Z=e.i(940009);e.s(["default",0,({selectedReplica:e,onSuccess:s,onCancel:i})=>{let{ref:a}=(0,x.useParams)(),t=(0,Z.formatDatabaseID)(e?.identifier??""),{mutate:r,isPending:n}=q({onSuccess:()=>{h.toast.success(`Tearing down read replica (ID: ${t})`),s(),i()}}),l=async()=>a?void 0===e?h.toast.error("No replica selected"):void r({projectRef:a,identifier:e.identifier,invalidateReplicaQueries:!0}):console.error("Project is required");return(0,d.jsxs)(K.default,{variant:"destructive",size:"medium",loading:n,visible:void 0!==e,title:`Confirm to drop selected replica? (ID: ${t})`,confirmLabel:"Drop replica",confirmLabelLoading:"Dropping replica",onCancel:()=>i(),onConfirm:()=>l(),alert:{title:"This action cannot be undone",description:"You may still deploy a new replica in this region thereafter"},children:[(0,d.jsx)("p",{className:"text-sm",children:"Before deleting this replica, consider:"}),(0,d.jsx)("ul",{className:"text-sm text-foreground-light py-1 list-disc mx-4 space-y-1",children:(0,d.jsx)("li",{children:"Network traffic from this region may slow down, especially if you have no other replicas in this region"})})]})}],555254);var X=e.i(774803),J=e.i(264903),ee=e.i(714403);async function es({projectRef:e,connectionString:s,id:i},a){let t=`
select 
  case
    when (select count(*) from pg_stat_wal_receiver) = 1 and pg_last_wal_receive_lsn() = pg_last_wal_replay_lsn()
    then 0
    else coalesce(extract(epoch from now() - pg_last_xact_replay_timestamp()),0)
  end as physical_replica_lag_second
  `,{result:r}=await (0,ee.executeSql)({projectRef:e,connectionString:s,sql:t,queryKey:["replica-lag",i]},a);return Number((r[0]??null)?.physical_replica_lag_second??0)}var ei=e.i(613580);e.s(["SmoothstepEdge",0,({id:e,sourceX:s,sourceY:i,targetX:t,targetY:n,sourcePosition:l,targetPosition:o,style:c={},markerEnd:p,data:u})=>{let{ref:h}=(0,x.useParams)(),{status:m,identifier:g,connectionString:f}=u||{},j=(0,Z.formatDatabaseID)(g??""),[y,b,_]=(0,J.getSmoothStepPath)({sourceX:s,sourceY:i,sourcePosition:l,targetX:t,targetY:n,targetPosition:o}),{data:A,isPending:S,isError:N}=(({projectRef:e,connectionString:s,id:i},{enabled:t=!0,...n}={})=>(0,a.useQuery)({queryKey:r.replicaKeys.replicaLag(e,i),queryFn:({signal:a})=>es({projectRef:e,connectionString:s,id:i},a),enabled:t&&void 0!==e&&void 0!==i,...n}))({id:g,projectRef:h,connectionString:f},{enabled:m===Y.REPLICA_STATUS.ACTIVE_HEALTHY}),v=Number(A?.toFixed(2)??0).toLocaleString();return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(J.BaseEdge,{path:y,markerEnd:p,style:c}),void 0!==u&&!N&&m===Y.REPLICA_STATUS.ACTIVE_HEALTHY&&(0,d.jsx)(J.EdgeLabelRenderer,{children:(0,d.jsxs)(ei.Tooltip,{children:[(0,d.jsx)(ei.TooltipTrigger,{asChild:!0,children:(0,d.jsx)("div",{className:"bg-surface-100 px-1.5 py-0.5 rounded absolute nodrag nopan",style:{transform:`translate(-50%, -50%) translate(${b}px,${_}px)`,pointerEvents:"all"},children:S?(0,d.jsx)(X.Loader2,{size:12,className:"animate-spin"}):(0,d.jsxs)("p",{className:"font-mono text-xs",children:[v,"s"]})})}),(0,d.jsx)(ei.TooltipContent,{side:"bottom",align:"center",children:S?`Checking replication lag for replica ID: ${j}`:`Replication lag (seconds) for replica ID: ${j}`})]})})]})}],410043);var ea=e.i(971104),et=e.i(876553);let er=e=>{let s=~~(e/3600),i=Math.floor(e%3600/60),a=Math.floor(e%60);return`${s>0?`${s}h`:""} ${i>0?`${i}m`:""} ${a>0?`${a}s`:""}`.trim()};e.s(["addRegionNodes",0,(e,s)=>{let i=[],a=e.filter(e=>"READ_REPLICA"===e.type);return Object.entries((0,et.default)(a,e=>e.data.region.key)).map(([e,s])=>{let a=Y.AVAILABLE_REPLICA_REGIONS.find(s=>s.key===e),t=s.map(e=>e.position.x),r=s.map(e=>e.position.y),n=Math.min(...t),l={id:e,position:{x:n-10,y:Math.max(...r)-10},width:Math.max(...t)-n+Y.NODE_WIDTH/2,type:"REGION",data:{region:a,numReplicas:s.length}};i.push(l)}),{nodes:[...i,...e],edges:s}},"formatSeconds",0,er,"generateNodes",0,({primary:e,replicas:s,loadBalancers:i,onSelectRestartReplica:a,onSelectDropReplica:t})=>{let r={x:0,y:0},n=(0,et.default)(s,e=>{let s=Y.AVAILABLE_REPLICA_REGIONS.find(s=>e.region.includes(s.region));return s?.key}),l=i.find(s=>s.databases.some(s=>s.identifier===e.identifier)),o=void 0!==l?{position:r,id:"load-balancer",type:"LOAD_BALANCER",data:{numDatabases:l.databases.length}}:void 0,d=Object.keys(L.AWS_REGIONS).map(e=>({key:e,name:L.AWS_REGIONS?.[e].displayName,region:L.AWS_REGIONS?.[e].code,coordinates:Y.AWS_REGIONS_COORDINATES[e]})).find(s=>e.region.includes(s.region));return[...void 0!==o?[o]:[],{position:r,id:e.identifier,type:"PRIMARY",data:{id:e.identifier,region:"FLY"===e.cloud_provider?{name:"Singapore (sin)",key:"SOUTHEAST_ASIA"}:d??{name:e.region},provider:e.cloud_provider,inserted_at:e.inserted_at,computeSize:e.size,status:e.status,numReplicas:s.length,numRegions:Object.keys(n).length,hasLoadBalancer:void 0!==l}},...s.sort((e,s)=>e.region>s.region?1:-1).map(e=>{let s=Y.AVAILABLE_REPLICA_REGIONS.find(s=>e.region.includes(s.region));return{position:r,id:e.identifier,type:"READ_REPLICA",data:{id:e.identifier,region:s,provider:e.cloud_provider,inserted_at:e.inserted_at,computeSize:e.size,status:e.status,onSelectRestartReplica:()=>a(e),onSelectDropReplica:()=>t(e)}}})]},"getDagreGraphLayout",0,(e,s)=>{let i=new ea.default.graphlib.Graph;return i.setDefaultEdgeLabel(()=>({})),i.setGraph({rankdir:"TB",ranksep:160,nodesep:Y.NODE_SEP}),e.forEach(e=>{i.setNode(e.id,{width:Y.NODE_WIDTH/2,height:"load-balancer"===e.id?-70:Y.NODE_ROW_HEIGHT/2})}),s.forEach(e=>i.setEdge(e.source,e.target)),ea.default.layout(i),e.forEach(e=>{let s=i.node(e.id);return e.targetPosition=J.Position.Top,e.sourcePosition=J.Position.Bottom,e.position={x:s.x-s.width/2,y:s.y-s.height/2},e}),{nodes:e,edges:s}}],623058);var en=e.i(55956),el=e.i(667042),eo=e.i(471880),ed=e.i(382490),ec=e.i(471998),ep=e.i(4196),eu=e.i(423782),eh=e.i(101369),em=e.i(276093),ex=e.i(2579),eg=e.i(912793),ef=e.i(189329),ej=e.i(587433),ey=e.i(874311);e.s(["LoadBalancerNode",0,({data:e})=>{let{ref:s}=(0,x.useParams)(),{numDatabases:i}=e;return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"flex flex-col rounded bg-surface-100 border border-default",children:(0,d.jsxs)("div",{className:"flex items-start justify-between p-3 gap-x-4",style:{width:Y.NODE_WIDTH/2-10},children:[(0,d.jsxs)("div",{className:"flex gap-x-3",children:[(0,d.jsx)("div",{className:"min-w-8 h-8 bg-blue-600 border border-blue-800 rounded-md flex items-center justify-center",children:(0,d.jsx)(el.Database,{size:16})}),(0,d.jsxs)("div",{className:"flex flex-col gap-y-0.5",children:[(0,d.jsx)("p",{className:"text-sm",children:"API Load Balancer"}),(0,d.jsxs)("p",{className:"text-sm text-foreground-light",children:["Distributes incoming API requests across"," ",(0,d.jsxs)("span",{className:"text-foreground",children:[i," databases"]})]})]})]}),(0,d.jsxs)(ey.DropdownMenu,{children:[(0,d.jsx)(ey.DropdownMenuTrigger,{asChild:!0,children:(0,d.jsx)(M.Button,{type:"text",icon:(0,d.jsx)(ec.MoreVertical,{}),className:"px-1"})}),(0,d.jsx)(ey.DropdownMenuContent,{className:"w-40",side:"bottom",align:"end",children:(0,d.jsx)(ey.DropdownMenuItem,{asChild:!0,className:"gap-x-2",children:(0,d.jsx)(p.default,{href:`/project/${s}/settings/api?source=load-balancer`,children:"View API URL"})})})]})]})}),(0,d.jsx)(J.Handle,{type:"source",position:J.Position.Bottom,style:{background:"transparent"}})]})},"PrimaryNode",0,({data:e})=>{let{provider:s,region:i,computeSize:a,numReplicas:t,numRegions:r,hasLoadBalancer:n}=e,{projectHomepageShowInstanceSize:l}=(0,eg.useIsFeatureEnabled)(["project_homepage:show_instance_size"]),{infraAwsNimbusLabel:o}=(0,em.useCustomContent)(["infra:aws_nimbus_label"]);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(J.Handle,{type:"target",position:J.Position.Top,className:n?"":"opacity-0",style:{background:"transparent"}}),(0,d.jsxs)("div",{className:"flex flex-col rounded bg-surface-100 border border-default",children:[(0,d.jsxs)("div",{className:"flex items-start justify-between p-3",style:{width:Y.NODE_WIDTH/2-10},children:[(0,d.jsxs)("div",{className:"flex gap-x-3",children:[(0,d.jsx)("div",{className:"w-8 h-8 bg-brand-500 border border-brand-600 rounded-md flex items-center justify-center",children:(0,d.jsx)(el.Database,{size:16})}),(0,d.jsxs)("div",{className:"flex flex-col gap-y-0.5",children:[(0,d.jsx)("p",{className:"text-sm",children:"Primary Database"}),(0,d.jsx)("p",{className:"flex items-center gap-x-1",children:(0,d.jsx)("span",{className:"text-sm text-foreground-light",children:i.name})}),(0,d.jsxs)("p",{className:"flex items-center gap-x-1",children:[(0,d.jsx)("span",{className:"text-sm text-foreground-light",children:"AWS_NIMBUS"===s?o:s}),l&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("span",{className:"text-sm text-foreground-light",children:"•"}),(0,d.jsx)("span",{className:"text-sm text-foreground-light",children:a})]})]})]})]}),(0,d.jsx)("img",{alt:"region icon",className:"w-8 rounded-sm mt-0.5",src:`${w.BASE_PATH}/img/regions/${i.region}.svg`})]}),t>0&&(0,d.jsx)("div",{className:"border-t p-3 py-2",children:(0,d.jsxs)("p",{className:"text-sm text-foreground-light",children:[(0,d.jsxs)("span",{className:"text-foreground",children:[t," replica",t>1?"s":""]})," ","deployed across"," ",(0,d.jsxs)("span",{className:"text-foreground",children:[r," region",r>1?"s":""]})]})})]}),(0,d.jsx)(J.Handle,{type:"source",position:J.Position.Bottom,className:0===t?"opacity-0":"",style:{background:"transparent"}})]})},"RegionNode",0,({data:e})=>{let{region:s,numReplicas:i}=e,a=20+(Y.NODE_WIDTH/2-10)*i+(i-1)*(Y.NODE_SEP+10);return(0,d.jsx)("div",{className:"relative flex justify-between rounded bg-black/10 border border-default border-white/10 border-2 p-3",style:{width:a,height:162},children:(0,d.jsxs)("div",{className:"absolute bottom-2 flex items-center justify-between gap-x-2",children:[(0,d.jsx)("img",{alt:"region icon",className:"w-5 rounded-sm",src:`${w.BASE_PATH}/img/regions/${s.region}.svg`}),(0,d.jsx)("p",{className:"text-sm",children:s.name})]})})},"ReplicaNode",0,({data:e})=>{let{id:s,provider:i,region:a,computeSize:t,status:r,inserted_at:l,onSelectRestartReplica:c,onSelectResizeReplica:u,onSelectDropReplica:h}=e,{ref:g}=(0,x.useParams)(),f=(0,ef.useDatabaseSelectorStateSnapshot)(),{can:j}=(0,ex.useAsyncCheckPermissions)(m.PermissionAction.CREATE,"projects"),{projectHomepageShowInstanceSize:y}=(0,eg.useIsFeatureEnabled)(["project_homepage:show_instance_size"]),[,b]=(0,ep.useQueryState)("showConnect",ep.parseAsBoolean.withDefault(!1)),{data:_}=o({projectRef:g}),{replicaInitializationStatus:A}=(_??[]).find(e=>e.identifier===s)||{},{status:S,progress:N,estimations:v,error:E}=A??{status:void 0,progress:void 0,estimations:void 0,error:void 0},R=(0,en.default)(l).format("DD MMM YYYY"),I=(void 0!==N?Number(N.split("_")[0]):0)/(Object.keys(Y.INIT_PROGRESS).length-1),T=[Y.REPLICA_STATUS.UNKNOWN,Y.REPLICA_STATUS.COMING_UP,Y.REPLICA_STATUS.GOING_DOWN,Y.REPLICA_STATUS.RESTORING,Y.REPLICA_STATUS.RESTARTING,Y.REPLICA_STATUS.RESIZING,Y.REPLICA_STATUS.INIT_READ_REPLICA].includes(r)||S===n.InProgress,{infraAwsNimbusLabel:C}=(0,em.useCustomContent)(["infra:aws_nimbus_label"]);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(J.Handle,{type:"target",position:J.Position.Top,style:{background:"transparent"}}),(0,d.jsxs)("div",{className:"flex justify-between items-start rounded bg-surface-100 border border-default p-3",style:{width:Y.NODE_WIDTH/2-10},children:[(0,d.jsxs)("div",{className:"flex gap-x-3",children:[(0,d.jsx)("div",{className:(0,F.cn)("w-8 h-8 border rounded-md flex items-center justify-center",r===Y.REPLICA_STATUS.ACTIVE_HEALTHY&&S===n.Completed?"bg-brand-400 border-brand-500":"bg-surface-100 border-foreground/20"),children:T?(0,d.jsx)(X.Loader2,{className:"animate-spin",size:16}):(0,d.jsx)(eo.DatabaseBackup,{size:16})}),(0,d.jsxs)("div",{className:"flex flex-col gap-y-0.5",children:[(0,d.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,d.jsxs)("p",{className:"text-sm truncate",children:["Replica ",s.length>0&&`(ID: ${(0,Z.formatDatabaseID)(s)})`]}),S===n.InProgress||r===Y.REPLICA_STATUS.COMING_UP||r===Y.REPLICA_STATUS.UNKNOWN||r===Y.REPLICA_STATUS.INIT_READ_REPLICA?(0,d.jsx)(ej.Badge,{children:"Coming up"}):S===n.Failed||r===Y.REPLICA_STATUS.INIT_READ_REPLICA_FAILED?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(ej.Badge,{variant:"destructive",children:"Init failed"}),(0,d.jsxs)(ei.Tooltip,{children:[(0,d.jsx)(ei.TooltipTrigger,{children:(0,d.jsx)(ed.HelpCircle,{size:16})}),(0,d.jsx)(ei.TooltipContent,{side:"bottom",align:"end",alignOffset:-70,className:"w-60 text-center",children:"Replica failed to initialize. Please drop this replica and spin up a new one."})]})]}):r===Y.REPLICA_STATUS.GOING_DOWN?(0,d.jsx)(ej.Badge,{children:"Going down"}):r===Y.REPLICA_STATUS.RESTARTING?(0,d.jsx)(ej.Badge,{children:"Restarting"}):r===Y.REPLICA_STATUS.RESIZING?(0,d.jsx)(ej.Badge,{children:"Resizing"}):r===Y.REPLICA_STATUS.ACTIVE_HEALTHY?(0,d.jsx)(ej.Badge,{variant:"success",children:"Healthy"}):(0,d.jsx)(ej.Badge,{variant:"warning",children:"Unhealthy"})]}),(0,d.jsxs)("div",{className:"my-0.5",children:[(0,d.jsx)("p",{className:"text-sm text-foreground-light",children:a.name}),(0,d.jsxs)("p",{className:"flex text-sm text-foreground-light items-center gap-x-1",children:[(0,d.jsx)("span",{children:"AWS_NIMBUS"===i?C:i}),y&&!!t&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("span",{children:"•"}),(0,d.jsx)("span",{children:t})]})]})]}),S===n.InProgress&&void 0!==N?(0,d.jsxs)(ei.Tooltip,{children:[(0,d.jsx)(ei.TooltipTrigger,{asChild:!0,children:(0,d.jsx)("div",{className:"w-56",children:(0,d.jsx)(eh.default,{labelBottom:Y.INIT_PROGRESS[N],labelBottomClass:"text-xs !normal-nums text-foreground-light",type:"horizontal",value:100*I,max:100,barClass:"bg-brand"})})}),void 0!==v&&(0,d.jsx)(ei.TooltipContent,{asChild:!0,side:"bottom",children:(0,d.jsxs)("div",{className:"w-56",children:[(0,d.jsx)("p",{className:"text-foreground-light mb-0.5",children:"Duration estimates:"}),void 0!==v.baseBackupDownloadEstimateSeconds&&(0,d.jsxs)("p",{children:["Base backup download:"," ",er(v.baseBackupDownloadEstimateSeconds)]}),void 0!==v.walArchiveReplayEstimateSeconds&&(0,d.jsxs)("p",{children:["WAL archive replay:"," ",er(v.walArchiveReplayEstimateSeconds)]})]})})]}):void 0!==E?(0,d.jsxs)("p",{className:"text-sm text-foreground-light",children:["Error: ",Y.ERROR_STATES[E]]}):(0,d.jsxs)("p",{className:"text-sm text-foreground-light",children:["Created: ",R]})]})]}),(0,d.jsxs)(ey.DropdownMenu,{children:[(0,d.jsx)(ey.DropdownMenuTrigger,{asChild:!0,children:(0,d.jsx)(M.Button,{type:"text",icon:(0,d.jsx)(ec.MoreVertical,{}),className:"px-1"})}),(0,d.jsxs)(ey.DropdownMenuContent,{className:"w-40",side:"bottom",align:"end",children:[(0,d.jsx)(ey.DropdownMenuItem,{disabled:r!==Y.REPLICA_STATUS.ACTIVE_HEALTHY,className:"gap-x-2",onClick:()=>{b(!0),f.setSelectedDatabaseId(s)},children:"View connection string"}),(0,d.jsx)(ey.DropdownMenuItem,{className:"gap-x-2",disabled:r!==Y.REPLICA_STATUS.ACTIVE_HEALTHY,children:(0,d.jsx)(p.default,{href:`/project/${g}/observability/database?db=${s}&chart=replication-lag`,children:"View replication lag"})}),(0,d.jsx)(ey.DropdownMenuSeparator,{}),(0,d.jsx)(ey.DropdownMenuItem,{className:"gap-x-2",onClick:()=>c(),disabled:r!==Y.REPLICA_STATUS.ACTIVE_HEALTHY,children:"Restart replica"}),(0,d.jsx)(eu.DropdownMenuItemTooltip,{className:"gap-x-2 !pointer-events-auto",disabled:!j,onClick:()=>{j&&h()},tooltip:{content:{side:"left",text:"You need additional permissions to drop replicas"}},children:"Drop replica"})]})]})]})]})}],552401);var eb=e.i(551456),e_=e.i(228598),eA=e.i(863805),eS=e.i(215312),eN=e.i(396831),ev=e.i(589285);e.s(["default",0,({onSelectDeployNewReplica:e,onSelectRestartReplica:s,onSelectDropReplica:i})=>{let{ref:a}=(0,x.useParams)(),t=(0,ef.useDatabaseSelectorStateSnapshot)(),{projectHomepageShowInstanceSize:r}=(0,eg.useIsFeatureEnabled)(["project_homepage:show_instance_size"]),[n,l]=(0,u.useState)(!1),[o,c]=(0,u.useState)(1.5),[h,g]=(0,u.useState)([14,7]),[f,j]=(0,u.useState)(),{can:y}=(0,ex.useAsyncCheckPermissions)(m.PermissionAction.CREATE,"projects"),[,b]=(0,ep.useQueryState)("showConnect",ep.parseAsBoolean.withDefault(!1)),{data:_}=(0,R.useReadReplicasQuery)({projectRef:a}),A=_??[],[[S],N]=(0,eb.default)(A,e=>e.identifier===a),v=Y.AVAILABLE_REPLICA_REGIONS.find(e=>S.region.includes(e.region))?.coordinates??[0,0],E=(0,e_.default)(N,e=>Y.AVAILABLE_REPLICA_REGIONS.find(s=>e.region.includes(s.region))?.key),I=Y.AVAILABLE_REPLICA_REGIONS.find(e=>e.coordinates===h)?.region??"",T=Y.AVAILABLE_REPLICA_REGIONS.find(e=>e.region===I),C=A.filter(e=>e.region.includes(I)).sort((e,s)=>+(e.inserted_at>s.inserted_at)).sort(e=>e.identifier===a?-1:0);return(0,u.useEffect)(()=>{setTimeout(()=>l(!0),100)},[]),(0,d.jsxs)("div",{className:"bg-studio h-[500px] relative",children:[(0,d.jsx)(eA.ComposableMap,{projectionConfig:{scale:155},className:"w-full h-full",children:(0,d.jsxs)(eA.ZoomableGroup,{className:n?"transition-all duration-300":"",center:h,zoom:o,minZoom:1.5,maxZoom:2,filterZoomEvent:({constructor:{name:e}})=>!["MouseEvent","WheelEvent"].includes(e),children:[(0,d.jsx)(eA.Geographies,{geography:ev.default,children:({geographies:e})=>e.map(e=>(0,d.jsx)(eA.Geography,{geography:e,strokeWidth:.3,pointerEvents:"none",className:"fill-gray-800 stroke-gray-900 dark:fill-gray-300 dark:stroke-gray-200"},e.rsmKey))}),E.map(e=>{let s=Y.AVAILABLE_REPLICA_REGIONS.find(s=>e.region.includes(s.region))?.coordinates;return s!==v?(0,d.jsx)(eA.Line,{from:s,to:v,stroke:"white",strokeWidth:1,strokeLinecap:"round",strokeOpacity:.2,strokeDasharray:"3, 3",className:"map-path"},`line-${e.identifier}-${S.identifier}`):null}),Y.AVAILABLE_REPLICA_REGIONS.map(e=>{let s=A.filter(s=>s.region.includes(e.region))??[],i=Y.AVAILABLE_REPLICA_REGIONS.find(s=>s.region===e.region)?.coordinates,t=0===s.length,r=s.some(e=>e.identifier===a),n=s.filter(e=>e.identifier!==a)??[];return(0,d.jsxs)(eA.Marker,{coordinates:i,onMouseEnter:()=>{j({x:i[0],y:i[1],region:{key:e.key,country:e.name,region:e.region,name:t?void 0:r?`Primary Database${n.length>0?` + ${n.length} replica${n.length>1?"s":""} `:""}`:`${n.length} Read Replica${n.length>1?"s":""} deployed`}})},onMouseLeave:()=>j(void 0),onClick:()=>{i&&(g(i),c(2))},children:[I===e.region&&(0,d.jsx)("circle",{r:4,className:`animate-ping ${t?"fill-border-stronger":"fill-brand"}`}),(0,d.jsx)("circle",{r:4,className:`cursor-pointer ${t?"fill-background-surface-300 stroke-border-stronger":r?"fill-brand stroke-brand-500":"fill-brand-500 stroke-brand-400"}`})]},e.key)}),void 0!==f&&1.5===o&&(0,d.jsx)(eA.Marker,{coordinates:[f.x-47,f.y-5],children:(0,d.jsx)("foreignObject",{width:220,height:66.25,children:(0,d.jsx)("div",{className:"bg-studio/50 rounded border",children:(0,d.jsxs)("div",{className:"px-3 py-2 flex flex-col",children:[(0,d.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,d.jsx)("img",{alt:"region icon",className:"w-4 rounded-sm",src:`${w.BASE_PATH}/img/regions/${f.region.region}.svg`}),(0,d.jsx)("p",{className:"text-[10px]",children:f.region.country})]}),(0,d.jsx)("p",{className:`text-[10px] ${void 0===f.region.name?"text-foreground-light":""}`,children:f.region.name??"No databases deployed"})]})})})})]})}),2===o&&void 0!==I&&T&&(0,d.jsxs)("div",{className:"absolute bottom-4 right-4 flex flex-col bg-studio/50 backdrop-blur-sm border rounded w-[400px]",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between py-4 px-4 border-b",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("p",{className:"text-xs text-foreground-light",children:[C.length," database",C.length>1?"s":""," deployed in"]}),(0,d.jsx)("p",{className:"text-sm",children:T.name})]}),(0,d.jsx)("img",{alt:"region icon",className:"w-10 rounded-sm",src:`${w.BASE_PATH}/img/regions/${T.region}.svg`})]}),C.length>0&&(0,d.jsx)(eN.ScrollArea,{style:{height:C.length>2?"180px":"auto"},children:(0,d.jsx)("ul",{className:"flex flex-col divide-y",children:C.map(e=>{let n=(0,en.default)(e.inserted_at).format("DD MMM YYYY, HH:mm:ss (ZZ)");return(0,d.jsxs)("li",{className:"text-sm px-4 py-2 flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,d.jsxs)("p",{className:"flex items-center gap-x-2",children:[e.identifier===a?"Primary Database":`Read Replica ${e.identifier.length>0&&`(ID: ${(0,Z.formatDatabaseID)(e.identifier)})`}`,e.status===Y.REPLICA_STATUS.ACTIVE_HEALTHY?(0,d.jsx)(ej.Badge,{variant:"success",children:"Healthy"}):e.status===Y.REPLICA_STATUS.COMING_UP?(0,d.jsx)(ej.Badge,{children:"Coming up"}):e.status===Y.REPLICA_STATUS.RESTARTING?(0,d.jsx)(ej.Badge,{children:"Restarting"}):e.status===Y.REPLICA_STATUS.RESIZING?(0,d.jsx)(ej.Badge,{children:"Resizing"}):(0,d.jsx)(ej.Badge,{variant:"warning",children:"Unhealthy"})]}),(0,d.jsxs)("p",{className:"text-xs text-foreground-light",children:["AWS",r?` • ${e.size}`:""]}),e.identifier!==a&&(0,d.jsxs)("p",{className:"text-xs text-foreground-light",children:["Created on: ",n]})]}),e.identifier!==a&&(0,d.jsxs)(ey.DropdownMenu,{children:[(0,d.jsx)(ey.DropdownMenuTrigger,{asChild:!0,children:(0,d.jsx)(M.Button,{type:"text",icon:(0,d.jsx)(ec.MoreVertical,{}),className:"px-1"})}),(0,d.jsxs)(ey.DropdownMenuContent,{className:"w-40",side:"bottom",align:"end",children:[(0,d.jsx)(ey.DropdownMenuItem,{className:"gap-x-2",disabled:e.status!==Y.REPLICA_STATUS.ACTIVE_HEALTHY,onClick:()=>{b(!0),t.setSelectedDatabaseId(e.identifier)},children:"View connection string"}),(0,d.jsx)(ey.DropdownMenuItem,{className:"gap-x-2",disabled:e.status!==Y.REPLICA_STATUS.ACTIVE_HEALTHY,children:(0,d.jsx)(p.default,{href:`/project/${a}/observability/database?db=${e.identifier}&chart=replication-lag`,children:"View replication lag"})}),(0,d.jsx)(ey.DropdownMenuSeparator,{}),(0,d.jsx)(ey.DropdownMenuItem,{className:"gap-x-2",onClick:()=>s(e),disabled:e.status!==Y.REPLICA_STATUS.ACTIVE_HEALTHY,children:"Restart replica"}),(0,d.jsx)(eu.DropdownMenuItemTooltip,{className:"gap-x-2 !pointer-events-auto",disabled:!y,onClick:()=>i(e),tooltip:{content:{side:"left",text:"You need additional permissions to drop replicas"}},children:"Drop replica"})]})]})]},e.identifier)})})}),(0,d.jsxs)("div",{className:`flex items-center justify-end gap-x-2 px-4 py-4 ${C.length>0?"border-t":""}`,children:[(0,d.jsx)(eS.ButtonTooltip,{type:"default",disabled:!y,onClick:()=>e(T.key),tooltip:{content:{side:"bottom",text:y?void 0:"You need additional permissions to deploy replicas"}},children:"Deploy new replica here"}),(0,d.jsx)(M.Button,{type:"default",onClick:()=>{g([14,7]),c(1.5)},children:"Close"})]})]})]})}],498275);var eE=e.i(351895);e.s(["RestartReplicaConfirmationModal",0,({selectedReplica:e,onSuccess:s,onCancel:i})=>{let{ref:a}=(0,x.useParams)(),t=(0,v.useQueryClient)(),n=(0,Z.formatDatabaseID)(e?.identifier??""),{mutate:l,isPending:o}=(0,eE.useProjectRestartMutation)({onSuccess:()=>{h.toast.success(`Restarting read replica (ID: ${n})`),t.setQueriesData({queryKey:r.replicaKeys.list(a)},s=>s.map(s=>s.identifier===e?.identifier?{...s,status:Y.REPLICA_STATUS.RESTARTING}:s)),s(),i()},onError:e=>{h.toast.error(`Failed to restart replica: ${e.message}`)}});return(0,d.jsxs)(K.default,{size:"medium",loading:o,visible:void 0!==e,title:`Confirm to restart selected replica? (ID: ${n})`,confirmLabel:"Restart replica",confirmLabelLoading:"Restarting replica",onCancel:()=>i(),onConfirm:()=>a?void 0===e?h.toast.error("No replica selected"):void l({ref:a,identifier:e.identifier}):console.error("Project is required"),children:[(0,d.jsx)("p",{className:"text-sm",children:"Your replica will be offline for a few minutes while it is being restarted. Before restarting the replica, consider:"}),(0,d.jsx)("ul",{className:"text-sm text-foreground-light py-1 list-disc mx-4 space-y-1",children:(0,d.jsx)("li",{children:"Network traffic from this region may slow down while the replica is restarting, especially if you have no other replicas in this region"})}),(0,d.jsx)("p",{className:"text-sm mt-2",children:"Are you sure you want to restart this replica now?"})]})}],128)},49589,e=>{"use strict";var s=e.i(4196);function i(){let[e,i]=(0,s.useQueryState)("createReplica",s.parseAsBoolean.withDefault(!1));return{showNewReplicaPanel:e,setShowNewReplicaPanel:i}}e.s(["useShowNewReplicaPanel",()=>i])},554056,e=>{"use strict";var s=e.i(478902),i=e.i(902858),a=e.i(551456),t=e.i(88816),r=e.i(427887),n=e.i(774803),l=e.i(952786),o=e.i(896975),d=e.i(215261),c=e.i(389959),p=e.i(535487),u=e.i(351299),h=e.i(264903);e.i(128328);var m=e.i(158639),x=e.i(567558),g=e.i(215312),f=e.i(330287),j=e.i(150671),y=e.i(10800),b=e.i(2579),_=e.i(912793),A=e.i(635494),S=e.i(48189),N=e.i(837710),v=e.i(874311),E=e.i(843778),R=e.i(544985),I=e.i(403354),T=e.i(555254),C=e.i(410043),w=e.i(72187),P=e.i(623058),D=e.i(552401),L=e.i(498275),k=e.i(128),B=e.i(49589);let O=({diagramOnly:e=!1})=>{let O=(0,h.useReactFlow)(),M=(0,A.useIsOrioleDb)(),{resolvedTheme:$}=(0,o.useTheme)(),{ref:U}=(0,m.useParams)(),{isPending:H}=(0,A.useSelectedProjectQuery)(),z=(0,A.useIsAwsCloudProvider)(),{infrastructureReadReplicas:G}=(0,_.useIsFeatureEnabled)(["infrastructure:read_replicas"]),[V,W]=(0,c.useState)("flow"),[F,Y]=(0,c.useState)(!1),{showNewReplicaPanel:Q,setShowNewReplicaPanel:q}=(0,B.useShowNewReplicaPanel)(),[K,Z]=(0,c.useState)(1e4),[X,J]=(0,c.useState)(),[ee,es]=(0,c.useState)(),[ei,ea]=(0,c.useState)(),{can:et}=(0,b.useAsyncCheckPermissions)(i.PermissionAction.CREATE,"projects"),{data:er,refetch:en,isSuccess:el}=(0,f.useLoadBalancersQuery)({projectRef:U}),{data:eo,error:ed,refetch:ec,isPending:ep,isError:eu,isSuccess:eh}=(0,j.useReadReplicasQuery)({projectRef:U}),[[em],ex]=(0,c.useMemo)(()=>(0,a.default)(eo??[],e=>e.identifier===U),[eo,U]),{data:eg,isSuccess:ef}=(0,y.useReadReplicasStatusesQuery)({projectRef:U},{refetchInterval:K,refetchOnWindowFocus:!1}),ej=(0,c.useMemo)(()=>eo?.length??0,[eo]);(0,c.useEffect)(()=>{ef&&(async()=>{let e=[w.REPLICA_STATUS.ACTIVE_HEALTHY,w.REPLICA_STATUS.ACTIVE_UNHEALTHY,w.REPLICA_STATUS.INIT_READ_REPLICA_FAILED],s=eg.filter(s=>{let{status:i}=s.replicaInitializationStatus||{};return!e.includes(s.status)||i===y.ReplicaInitializationStatus.InProgress}).length>0;eg.length!==ej&&(await ec(),setTimeout(()=>en(),2e3)),s||Z(!1)})()},[ej,ef,en,ec,eg]);let ey=(0,c.useMemo)(()=>eh&&el&&void 0!==em?(0,P.generateNodes)({primary:em,replicas:ex,loadBalancers:er??[],onSelectRestartReplica:ea,onSelectDropReplica:es}):[],[eh,el,em,ex,er]),eb=(0,c.useMemo)(()=>eh&&el?[...(er??[]).length>0?[{id:`load-balancer-${em.identifier}`,source:"load-balancer",target:em.identifier,type:"smoothstep",animated:!0,className:"!cursor-default"}]:[],...ex.map(e=>({id:`${em.identifier}-${e.identifier}`,source:em.identifier,target:e.identifier,type:"smoothstep",animated:!0,className:"!cursor-default",data:{status:e.status,identifier:e.identifier,connectionString:e.connectionString}}))]:[],[el,eh,er,em?.identifier,ex]),e_=(0,c.useMemo)(()=>({PRIMARY:D.PrimaryNode,READ_REPLICA:D.ReplicaNode,REGION:D.RegionNode,LOAD_BALANCER:D.LoadBalancerNode}),[]),eA=(0,c.useMemo)(()=>({smoothstep:C.SmoothstepEdge}),[]),eS=async()=>{let e=(0,P.getDagreGraphLayout)(ey,eb),{nodes:s}=(0,P.addRegionNodes)(e.nodes,e.edges);O.setNodes(s),O.setEdges(e.edges),await (0,S.timeout)(1),O.fitView({maxZoom:.9,minZoom:.9})};return(0,c.useEffect)(()=>{eh&&el&&ey.length>0&&"flow"===V&&eS()},[eh,el,ey,eb,V]),(0,s.jsxs)("div",{className:(0,E.cn)("nowheel",e?"h-full":"border-y"),children:[(0,s.jsxs)("div",{className:`${e?"h-full":"h-[500px]"} w-full relative ${eh&&!H?"":"flex items-center justify-center px-28"}`,children:[(ep||H)&&(0,s.jsx)(n.Loader2,{className:"animate-spin text-foreground-light"}),eu&&(0,s.jsx)(x.default,{error:ed,subject:"Failed to retrieve replicas"}),eh&&!H&&(0,s.jsxs)(s.Fragment,{children:[!e&&G&&(0,s.jsxs)("div",{className:"z-10 absolute top-4 right-4 flex items-center justify-center gap-x-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center",children:[(0,s.jsx)(g.ButtonTooltip,{type:"default",disabled:!et||M,className:(0,E.cn)(ex.length>0?"rounded-r-none":""),onClick:()=>q(!0),tooltip:{content:{side:"bottom",text:et?M?"Read replicas are not supported with OrioleDB":void 0:"You need additional permissions to deploy replicas"}},children:"Deploy a new replica"}),ex.length>0&&(0,s.jsxs)(v.DropdownMenu,{children:[(0,s.jsx)(v.DropdownMenuTrigger,{asChild:!0,children:(0,s.jsx)(N.Button,{type:"default",icon:(0,s.jsx)(t.ChevronDown,{size:16}),className:"px-1 rounded-l-none border-l-0"})}),(0,s.jsxs)(v.DropdownMenuContent,{align:"end",className:"w-52 *:space-x-2",children:[(0,s.jsx)(v.DropdownMenuItem,{asChild:!0,children:(0,s.jsx)(d.default,{href:`/project/${U}/settings/compute-and-disk`,children:"Resize databases"})}),(0,s.jsx)(v.DropdownMenuSeparator,{}),(0,s.jsx)(v.DropdownMenuItem,{onClick:()=>Y(!0),children:(0,s.jsx)("div",{children:"Remove all replicas"})})]})]})]}),z&&(0,s.jsxs)("div",{className:"flex items-center justify-center",children:[(0,s.jsx)(N.Button,{type:"default",icon:(0,s.jsx)(l.Network,{size:15}),className:`rounded-r-none transition ${"flow"===V?"opacity-100":"opacity-50"}`,onClick:()=>W("flow")}),(0,s.jsx)(N.Button,{type:"default",icon:(0,s.jsx)(r.Globe2,{size:15}),className:`rounded-l-none transition ${"map"===V?"opacity-100":"opacity-50"}`,onClick:()=>W("map")})]})]}),"flow"===V?(0,s.jsx)(p.default,{fitView:!0,fitViewOptions:{minZoom:.9,maxZoom:.9},className:"instance-configuration",zoomOnPinch:!1,zoomOnScroll:!1,nodesDraggable:!1,nodesConnectable:!1,zoomOnDoubleClick:!1,edgesFocusable:!1,edgesUpdatable:!1,defaultNodes:[],defaultEdges:[],nodeTypes:e_,edgeTypes:eA,proOptions:{hideAttribution:!0},children:(0,s.jsx)(u.Background,{color:"dark"===$?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.4)"})}):(0,s.jsx)(L.default,{onSelectDeployNewReplica:e=>{J(e),q(!0)},onSelectRestartReplica:ea,onSelectDropReplica:es})]})]}),!e&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(R.default,{visible:Q,selectedDefaultRegion:X,onSuccess:()=>Z(5e3),onClose:()=>{J(void 0),q(!1)}}),(0,s.jsx)(T.default,{selectedReplica:ee,onSuccess:()=>Z(5e3),onCancel:()=>es(void 0)}),(0,s.jsx)(I.default,{visible:F,onSuccess:()=>Z(5e3),onCancel:()=>Y(!1)}),(0,s.jsx)(k.RestartReplicaConfirmationModal,{selectedReplica:ei,onSuccess:()=>Z(5e3),onCancel:()=>ea(void 0)})]})]})};e.s(["InstanceConfiguration",0,({diagramOnly:e=!1})=>(0,s.jsx)(h.ReactFlowProvider,{children:(0,s.jsx)(O,{diagramOnly:e})})])}]);

//# debugId=9af3b73b-d8f6-4721-ce1c-5afa1b52aae6
//# sourceMappingURL=4535737998f09190.js.map